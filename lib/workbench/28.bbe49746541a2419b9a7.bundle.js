(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{205:function(e,t,n){"use strict";var r=r||{};r.Text=function(){function e(e,t,n,r){n=n||10;var o=t/3;return"string"==typeof e?(o*=10/(e.substring(0,t/3).length+1.5),o+=1,e.match(/[\u0900-\u0DFF\u1100-\u11FF\u2E80-\u2EFF\u3000-\u9FFF]/)&&(o*=.6),o<n&&(o=n),Math.round(o)):(o<n&&(o=n),Math.round(o))}return{calcFontSizeRaw:e,calcFontSize:function(t,n,r,o){return e(t,n,r)+"px"},getTextWithElipsisIfNeeded:function(e,t){return"string"==typeof e&&e.length>t?e.substring(0,t-3)+"...":e}}}(),r.Transition={fadeIn:function(e,t){e.style("opacity",0).transition().duration(t).style("opacity",1)},fadeOut:function(e,t){e.style("opacity",1).transition().duration(t).style("opacity",0)}},r.Click={delayDblClick:function(){var e=d3.dispatch("click","dblclick");return d3.rebind((function(t){var n,r=null;t.on("mousedown",(function(){n=d3.mouse(document.body),new Date})),t.on("mouseup",(function(t){var o,i;o=n,i=d3.mouse(document.body),Math.sqrt(Math.pow(o[0]-i[0],2),Math.pow(o[1]-i[1],2))>5||(r?(window.clearTimeout(r),r=null,e.dblclick(t)):r=window.setTimeout((d3.event,function(){e.click(t),r=null}),250))}))}),e,"on")}},t.a=r},208:function(e,t,n){var r,o,i;o=[],void 0===(i="function"==typeof(r=function(){return function(){var e=function(){return"n"},t=function(){return[0,0]},n=function(){return" "},r=u(),o=null,i=null,a=null,s=null;function c(e){var t;o="svg"===(t=(t=e).node()).tagName.toLowerCase()?t:t.ownerSVGElement,i=o.createSVGPoint(),document.body.appendChild(r)}c.show=function(){var r=Array.prototype.slice.call(arguments);r[r.length-1]instanceof SVGElement&&(a=r.pop());var o,i=n.apply(this,r),u=t.apply(this,r),f=e.apply(this,r),g=p(),h=l.length,m=document.documentElement.scrollTop||document.body.scrollTop,y=document.documentElement.scrollLeft||document.body.scrollLeft,v=s.apply(this,r);for(g.html(i).style({opacity:1,"pointer-events":"all"});h--;)g.classed(l[h],!1);return o=d.get(f).apply(this),v?g.style(v):g.classed(f,!0).style({top:o.top+u[0]+m+"px",left:o.left+u[1]+y+"px"}),c},c.hide=function(){return p().style({opacity:0,"pointer-events":"none"}),c},c.attr=function(e,t){if(arguments.length<2&&"string"==typeof e)return p().attr(e);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(p(),n),c},c.style=function(e,t){if(arguments.length<2&&"string"==typeof e)return p().style(e);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.style.apply(p(),n),c},c.direction=function(t){return arguments.length?(e=null==t?t:d3.functor(t),c):e},c.offset=function(e){return arguments.length?(t=null==e?e:d3.functor(e),c):t},c.html=function(e){return arguments.length?(n=null==e?e:d3.functor(e),c):n},c.customPosition=function(e){return arguments.length?(s=null==e?e:d3.functor(e),c):s},c.destroy=function(){return r&&(p().remove(),r=null),c};var d=d3.map({n:function(){var e=f();return{top:e.n.y-r.offsetHeight,left:e.n.x-r.offsetWidth/2}},s:function(){var e=f();return{top:e.s.y,left:e.s.x-r.offsetWidth/2}},e:function(){var e=f();return{top:e.e.y-r.offsetHeight/2,left:e.e.x}},w:function(){var e=f();return{top:e.w.y-r.offsetHeight/2,left:e.w.x-r.offsetWidth}},nw:function(){var e=f();return{top:e.nw.y-r.offsetHeight,left:e.nw.x-r.offsetWidth}},ne:function(){var e=f();return{top:e.ne.y-r.offsetHeight,left:e.ne.x}},sw:function(){var e=f();return{top:e.sw.y,left:e.sw.x-r.offsetWidth}},se:function(){var e=f();return{top:e.se.y,left:e.e.x}}}),l=d.keys();function u(){var e=d3.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function p(){return null===r&&(r=u(),document.body.appendChild(r)),d3.select(r)}function f(){for(var e=a||d3.event.target;void 0===e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var t={},n=e.getScreenCTM(),r=e.getBBox(),o=r.width,s=r.height,c=r.x,d=r.y;return i.x=c,i.y=d,t.nw=i.matrixTransform(n),i.x+=o,t.ne=i.matrixTransform(n),i.y+=s,t.se=i.matrixTransform(n),i.x-=o,t.sw=i.matrixTransform(n),i.y-=s/2,t.w=i.matrixTransform(n),i.x+=o,t.e=i.matrixTransform(n),i.x-=o/2,i.y-=s/2,t.n=i.matrixTransform(n),i.y+=s,t.s=i.matrixTransform(n),t}return c}})?r.apply(t,o):r)||(e.exports=i)},56:function(e,t,n){"use strict";n.r(t);n(2);var r=n(205),o=n(208),i=n.n(o);n(4);function a(e,t,n,o,a,s,c,d,l,u,p,f,g,h,m,y,v,x,S,I){e.languageChanged=!1,e.propertiesObj={},e.propertiesQueryObj={},e.propertiesObj.items=[],e.propertiesNotFiltered=[],e.searchVisible=!1,e.nodeSelected=!1,e.queryResultsMode=!1,e.embedded=u.search().embedded,e.openedNodeInfoPanel=void 0,e.onopen=e.onclose=()=>angular.noop(),e.embedded&&(u.search().query||u.search().uri||u.search().config||u.search().saved)&&(e.noGoHome=!0);const w={};let C=0,b=0,k={},L=0;const P=16,A=d3.behavior.zoom().scaleExtent([.5,10]);let G;const M=1e3,T=1e3;let N;function E(e){g.openCopyToClipboardModal(e)}function R(t){const n=t.appSettings;e.defaultSettings.includeInferred=n.DEFAULT_INFERENCE,e.defaultSettings.sameAsState=n.DEFAULT_INFERENCE&&n.DEFAULT_SAMEAS,e.defaultSettings.includeSchema=n.DEFAULT_VIS_GRAPH_SCHEMA;const r=y.get(v.GRAPHS_VIZ);if(r&&"object"==typeof r)try{e.saveSettings=r,void 0===e.saveSettings.includeSchema&&(e.saveSettings.includeSchema=e.defaultSettings.includeSchema,e.saveSettings.rejectedPredicates=[...e.saveSettings.rejectedPredicates,...e.defaultSettings.rejectedPredicates].unique())}catch(t){e.saveSettings=angular.copy(e.defaultSettings),y.set(v.GRAPHS_VIZ,e.saveSettings)}else e.saveSettings=angular.copy(e.defaultSettings)}t.key="",w.get=function(t,n,r){return f.initLazyList(t,n,r,C,e.propertiesObj.items)},t.$watch((function(){return t.key}),(function(){C=0,_.each(e.propertiesObj.items,(function(e){t.key>e&&C++})),b++})),w.revision=function(){return b},e.datasource=w,e.adapterContainer={adapter:{remain:!0}},e.propertiesQueryObj.query="",e.propertiesSearchPlaceholder="Search instance properties",e.propertiesFilterFunc=function(t){return t.key.toLowerCase().indexOf(e.propertiesQueryObj.query.toLowerCase())>=0},e.resetState=function(){e.searchVisible=!1,e.nodeSelected=!1,e.configLoaded=null,e.queryResultsMode=!1,e.lastSavedGraphName=null,e.lastSavedGraphId=null,e.shared=!1,e.numberOfPinnedNodes=0,k={},L=0},e.pushHistory=function(t,n){e.embedded&&(t.embedded=!0),u.search(t),u.state(n)},e.goToHome=function(){e.resetState(),u.url("graphs-visualizations")},e.shouldShowSettings=function(){return e.configLoaded&&e.configLoaded.id===e.defaultGraphConfig.id},e.shouldDisableSameAs=function(){const t=$("#sameAsCheck");return e.settings&&!e.settings.includeInferred&&t.prop("checked")&&(t.prop("checked",!1),e.settings.sameAsState=!1),e.settings&&!e.settings.includeInferred},e.$watch("propertiesObj.items",(function(){angular.isDefined(e.propertiesObj.items)&&e.propertiesObj.items.length>0&&a((function(){e.adapterContainer.adapter.reload()}),500)})),e.toggleMoreInfo=function(e){angular.element(e.currentTarget).parent().next().toggle(200),angular.element(e.currentTarget).children("span").toggleClass("icon-caret-down").toggleClass("icon-caret-up")},e.copyToClipboard=E,e.defaultSettings={linksLimit:20,includeInferred:!0,sameAsState:!0,languages:["en"],showLinksText:!0,preferredTypes:[],rejectedTypes:[],preferredPredicates:[],rejectedPredicates:["http://dbpedia.org/property/logo","http://dbpedia.org/property/hasPhotoCollection","http://dbpedia.org/property/website","http://dbpedia.org/property/homepage","http://dbpedia.org/ontology/thumbnail","http://xmlns.com/foaf/0.1/depiction","http://xmlns.com/foaf/0.1/homepage","http://xmlns.com/foaf/0.1/mbox","http://dbpedia.org/ontology/wikiPage*","http://dbpedia.org/property/wikiPage*","http://factforge.net/*"],preferredTypesOnly:!1,preferredPredicatesOnly:!1,includeSchema:!0},e.saveSettings=angular.copy(e.defaultSettings);const j=p.getPrincipal();function z(){e.settings.languagesMap=_.map(e.settings.languages,(function(e){return{text:e}})),e.settings.preferredTypesMap=_.map(e.settings.preferredTypes,(function(e){return{text:e}})),e.settings.rejectedTypesMap=_.map(e.settings.rejectedTypes,(function(e){return{text:e}})),e.settings.preferredPredicatesMap=_.map(e.settings.preferredPredicates,(function(e){return{text:e}})),e.settings.rejectedPredicatesMap=_.map(e.settings.rejectedPredicates,(function(e){return{text:e}}))}j?R(j):e.$on("securityInit",(function(){R(p.getPrincipal())})),e.resetSettings=function(){e.settings=angular.copy(e.defaultSettings),z()},e.changeLimit=function(t){let n=e.settings.linksLimit+t;n<1&&(n=1),n>1e3&&(n=1e3),e.settings.linksLimit=n},e.showSettings=function(){e.showInfoPanel=!0,e.showFilter=!0,e.showNodeInfo=!1,e.showPredicates=!1,e.saveSettings?e.settings=angular.copy(e.saveSettings):e.settings=angular.copy(e.defaultSettings),z()},e.reExpandNode=function(){e.rootNodeIri&&e.$broadcast("onRootNodeChange",e.rootNodeIri)};const O=function(t,n,r){const i=void 0===n?e.saveSettings.sameAsState:!0===n,a=void 0===r?e.saveSettings.includeInferred:!0===r;e.loading=!0,s({url:"rest/explore-graph/graph",method:"POST",headers:{"Content-Type":"application/json"},data:{query:t,linksLimit:e.saveSettings.linksLimit,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:a,sameAsState:i}}).then((function(e){oe(e)}),(function(t){e.loading=!1,o.error(getError(t.data),"Cannot load visual graph!")}))};function F(){this.nodes=[],this.links=[],this.addNode=function(e,t,n){return e.x=t,e.y=n,this.nodes.push(e),e},this.computeConnectedness=function(){const e={},t={};_.each(this.links,(function(n){const r=n.source.iri,o=n.target.iri,i=_.min([r,o])+"|"+_.max([r,o]);t[i]||(t[i]=1,e[r]=(e[r]||0)+1,e[o]=(e[o]||0)+1)})),_.each(this.links,(function(t){e[t.source.iri]>1&&e[t.target.iri]>1?t.connectedness=Math.min(5,Math.max(e[t.source.iri],e[t.target.iri])-1):t.connectedness=0}))},this.addAndMatchLinks=function(e){const t=this.nodes;Array.prototype.push.apply(this.links,function(e,t){return _.map(e,(function(e){return{source:_.find(t,(function(t){return t.iri===e.source})),target:_.find(t,(function(t){return t.iri===e.target})),predicates:e.predicates}}))}(e,t)),this.computeConnectedness()};const t=function(e,t){return n(e,t).length};function n(e,t){return _.filter(t,(function(t){return t.source.iri===e.iri||t.target.iri===e.iri}))}this.countLinks=t,this.linksTypes=function(e,t){const r=n(e,t),o=_.map(r,(function(t){return t.source.iri===e.iri?t.target.types:t.source.types}));return _.uniq(_.flatten(o))},this.linksPredicates=function(e,t){const r=n(e,t),o=_.map(r,(function(e){return e.predicates}));return _.uniq(_.flatten(o))},this.removeNode=function(n){this.links=_.reject(this.links,(function(e){return e.source.iri===n.iri||e.target.iri===n.iri}));const r=this.links;this.nodes=_.reject(this.nodes,(function(e){return 0===t(e,r)})),0===this.nodes.length&&(e.nodeSelected=!1),this.computeConnectedness()},this.removeNodeLeafLinks=function(e){let r=this.links;this.links=_.reject(this.links,(function(o){if(o.source.iri===e.iri&&1===t(o.target,r)||o.target.iri===e.iri&&1===t(o.source,r))return!0;let i;return o.source.iri===e.iri&&2===t(o.target,r)?i=n(o.target,r):o.target.iri===e.iri&&2===t(o.source,r)&&(i=n(o.source,r)),i?(i[0].source.iri===e.iri||i[0].target.iri)&&(i[1].source.iri===e.iri||i[1].target.iri):void 0})),r=this.links,this.nodes=_.reject(this.nodes,(function(n){return 0===t(n,r)&&n.iri!==e.iri})),this.computeConnectedness()},this.copyState=function(){return{nodes:_.map(this.nodes,(function(e){return{iri:e.iri,size:e.size,labels:angular.copy(e.labels),types:angular.copy(e.types),rdfRank:e.rdfRank,x:e.x,y:e.y,fixed:e.fixed}})),links:_.map(this.links,(function(e){return{source:e.source.iri,target:e.target.iri,predicates:e.predicates}})),colorIndex:L,type2color:k,scale:A.scale(),translate:A.translate()}},this.restoreState=function(t){e.nodeSelected=!0,e.searchVisible=!1,this.nodes=angular.copy(t.nodes),this.links=[],this.addAndMatchLinks(t.links),_.each(this.nodes,(function(t){t.fixed&&e.numberOfPinnedNodes++})),angular.isDefined(t.colorIndex)&&angular.isDefined(t.type2color)&&(L=t.colorIndex,k=angular.copy(t.type2color)),angular.isDefined(t.translate)&&angular.isDefined(t.scale)&&(G="translate("+t.translate[0]+", "+t.translate[1]+") scale("+t.scale+")",A.translate(t.translate),A.scale(t.scale)),te()}}e.updateSettings=function(){e.saveSettings=e.settings,e.saveSettings.languages=_.map(e.saveSettings.languagesMap,(function(e){return e.text})),e.saveSettings.preferredTypes=_.map(e.saveSettings.preferredTypesMap,(function(e){return e.text})),e.saveSettings.rejectedTypes=_.map(e.saveSettings.rejectedTypesMap,(function(e){return e.text})),e.saveSettings.preferredPredicates=_.map(e.saveSettings.preferredPredicatesMap,(function(e){return e.text})),e.saveSettings.rejectedPredicates=_.map(e.saveSettings.rejectedPredicatesMap,(function(e){return e.text})),e.rootNodeIri?e.reExpandNode(e.rootNodeIri):e.queryResultsMode&&u.search().query?O(u.search().query,u.search().sameAs,u.search().inference):"query"===e.configLoaded.startMode&&e.loadGraphConfig(e.configLoaded),e.saveSettings.showLinksText?d3.selectAll("svg .link-wrapper text").style("display","block"):d3.selectAll("svg .link-wrapper text").style("display","none"),e.showInfoPanel=!1,e.showFilter=!1,y.set(v.GRAPHS_VIZ,e.saveSettings)},e.showInfoPanel=!1;let D=new F;e.defaultGraphConfig={id:"default",name:"Easy graph",startMode:"search"},e.getGraphConfigs=function(t){S.getGraphConfigs().success((function(n){e.graphConfigs=n,t&&t()})).error((function(e){o.error(getError(e),"Could not get graph configs")}))},e.loadConfigForId=function(t,n){t===e.defaultGraphConfig.id?e.loadGraphConfig(e.defaultGraphConfig):S.getConfig(t).success((function(t){e.loadGraphConfig(t),n()})).error((function(e){o.error(getError(e),"Could not load config "+t)}))},e.findConfigById=function(t){return t===e.defaultGraphConfig.id?e.defaultGraphConfig:$.grep(e.graphConfigs,(function(e){return e.id===t}))[0]},e.easyGraphSearch=function(t){e.configLoaded=e.defaultGraphConfig,e.openUri(t)},e.loadGraphConfig=function(t){e.configLoaded=t,"search"===t.startMode?e.searchVisible=!0:"node"===t.startMode&&t.startIRI?a((function(){e.openUri(t.startIRI,!0)}),0):"query"===t.startMode&&t.startGraphQuery&&(e.loading=!0,S.loadGraphForConfig(t,t.startQueryIncludeInferred,e.saveSettings.linksLimit,t.startQuerySameAs).then((function(e){oe(e)}),(function(t){e.loading=!1,o.error(getError(t),"Could not load graph from config")})))},e.deleteConfig=function(t){g.openSimpleModal({title:"Confirm",message:"Are you sure you want to delete the graph config '"+t.name+"'?",warning:!0}).result.then((function(){S.deleteGraphConfig(t).success((function(){e.getGraphConfigs(),e.refreshSavedGraphs()})).error((function(e){o.error(getError(e),"Could not delete graph config")}))}))},e.goToGraphConfig=function(t){e.pushHistory({config:t.id},{config:t}),e.resetState(),e.loadGraphConfig(t)},m.onpopstate=function(t){e.resetState(),t.state&&(t.state.config?(e.loadGraphConfig(t.state.config),t.state.uri&&e.openUri(t.state.uri,!0)):t.state.savedGraph&&e.loadSavedGraph(t.state.savedGraph,!0))};const U=function(){u.search().query?(e.searchVisible=!1,e.queryResultsMode=!0,O(u.search().query,u.search().sameAs,u.search().inference)):e.$on("onRootNodeChange",(function(t,n){e.loading=!0,angular.isDefined(n)&&(e.rootNodeIri=n,s({url:"rest/explore-graph/node",method:"GET",params:{iri:n,config:e.configLoaded?e.configLoaded.id:e.defaultGraphConfig.id,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:e.saveSettings.includeInferred,sameAsState:e.saveSettings.sameAsState}}).then((function(t){e.nodeSelected=!0,e.searchVisible=!1,null===t.data.types&&(t.data.types="greyColor"),D=new F;const n=D.addNode(t.data,M/2,T/2);G="translate(0, -70) scale(1)",A.translate([0,-70]),A.scale(1),ae(n,!0)})).catch((function(t){e.loading=!1,o.error(getError(t),"Could not load visual graph")})))})),u.search().uri&&e.openUri(u.search().uri),u.search().saved&&x.getSavedGraph(u.search().saved).success((function(t){e.loadSavedGraph(t)})).error((function(e){const t=getError(e);o.error(t,"Error! Could not open saved graph")}))},q=function(){u.search().config?e.loadConfigForId(u.search().config,U):u.search().query||u.search().uri?(e.loadGraphConfig(e.defaultGraphConfig),U()):U()};function H(t){!n.getActiveRepository()||e.hasInitedRepository&&!t||(e.hasInitedRepository=!0,t||e.getGraphConfigs(q),e.getNamespacesPromise=I.getNamespaces(e.getActiveRepository()).success((function(t){const n=_.map(t.results.bindings,(function(e){return{uri:e.namespace.value,prefix:e.prefix.value}}));e.namespaces=_.sortBy(n,(function(e){return e.uri.length})),B()})).error((function(e){o.error(getError(e),"Cannot get namespaces for repository. View will not work properly!")})))}function B(){e.getAutocompletePromise=d.checkAutocompleteStatus()}e.replaceIRIWithPrefix=function(t){const n=e.namespaces,r=_.findLast(n,(function(e){return 0===t.indexOf(e.uri)}));return r?r.prefix+":"+t.substring(r.uri.length):t},e.addedTag=function(t){return t.text.indexOf(":")<0?(o.warning("Enter an absolute full or prefixed IRI"),null):(t.text=function(e,t){if(!/^<?(http|urn).*>?/.test(e)){const n=e.split(":"),r=n[0],o=n[1];if(!angular.isUndefined(o)){const e=c.getNamespaceUriForPrefix(t,r);if(e)return e+o}}return e}(t.text,e.namespaces),e.pageslideExpanded=!0,t)},e.validateTag=function(e,t,n){if(e.text.indexOf(":")<0)return n?o.warning("Enter an absolute full or prefixed IRI, optionally ending in *",t):o.warning("Enter an absolute full or prefixed IRI",t),!1;const r=e.text.indexOf("*");if(r>=0){if(!n)return o.warning("Wildcards not allowed here",t),!1;if(r<e.text.length-1)return o.warning("Wildcard allowed only as the last character",t),!1}return!0},e.getTagClass=function(e){return e.endsWith("*")?"tag-item-wildcard":null},e.getActiveRepository=function(){return n.getActiveRepository()},e.hasInitedRepository=!1,e.$on("autocompleteStatus",(function(){B()})),e.$on("repositoryIsSet",(function(t,n){n.newRepo&&(e.hasInitedRepository=!1),H(n.newRepo),n.newRepo&&(e.resetState(),$(".graph-visualization svg").empty(),u.search().query&&(e.goToHome(),U()))})),H();const W=500,V=1.75,Z=d3.scale.linear().domain([0,9]).range(["hsl(0, 100%, 75%)","hsl(360, 90%, 82%)"]).interpolate(d3.interpolateHslLong),K=d3.scale.linear().domain([0,9]).range(["hsl(180, 50%, 75%)","hsl(540, 40%, 82%)"]).interpolate(d3.interpolateHslLong);e.getColor=function(e){angular.isUndefined(k[e])&&(k[e]=L,L++);const t=k[e];return t>39?"#c2c2c2":t%2==0?Z(t/2):K(t/2)};const Q=d3.layout.force().gravity(.07).size([M,T]),J=d3.select(".main-container .graph-visualization").append("svg").attr("viewBox","0 0 "+M+" "+T).attr("preserveAspectRatio","xMidYMid meet");let Y=0,X=0;const ee=new function(){this.state=!1,this.setLoadingState=function(e){this.state=e},this.getLoadingState=function(){return this.state},this.init=function(e,t){d3.select(t).append("circle").attr("cx",(function(){return e.x})).attr("cy",(function(){return e.y})).attr("class","loader-container").attr("r",(function(){return e.size})).style("fill","fff").style("opacity","0.7"),d3.select(t).append("image").attr("xlink:href","js/angular/templates/loader/ot-loader.svg?v=1.10.2").attr("x",(function(){return e.x-e.size+5})).attr("y",(function(){return e.y-e.size})).attr("width",(function(){return 2*e.size})).attr("height",(function(){return 2*e.size})).attr("class","node-loader")}};function te(n){d3.selectAll("svg g").remove(),d3.selectAll("svg rect").remove(),d3.selectAll(".d3-tip").remove(),d3.selectAll(".menu-events").remove(),A.on("zoom",(function(){G="translate("+d3.event.translate+") scale("+d3.event.scale+")",c.attr("transform",G)})),J.append("rect").attr("width",10*M).attr("height",10*T).attr("x",-(10*M-M)/2).attr("y",-(10*T-T)/2).style("fill","none").style("pointer-events","all").call(A).on("click",(function(){d3.event.stopPropagation(),se(),Q.stop()}));const c=J.append("g").attr("class","nodes-container").attr("transform",(function(){return angular.isDefined(G)&&!n?G:""})),d=i()().attr("class","d3-tip").customPosition((function(){const e=N.getBoundingClientRect();return{top:e.bottom+10+"px",left:e.left-30+"px"}})).html((function(t){let n="";return t.fixed&&(n+='<i class="icon-pin"></i>&nbsp;&nbsp;'),t.types.length>0?n+=_.join(_.map(t.types,(function(t){return e.replaceIRIWithPrefix(t)}))," · "):n+="<i>No types</i>",n})),l=function(e){let t="";return t+=_.join(_.map(e.predicates,(function(t,n){if(0===n)return ce(t);if(n<10)return" · "+ce(t);if(10===n){const t=function(e){return e.predicates.length-10}(e);return" · more "+(t>1?t+" predicates":t+" predicate")+" to show"}})),""),t};let p;const f=i()().attr("class","d3-tip").customPosition((function(e){const t=p.getBoundingClientRect(),n=function(e){const t=l(e),n=document.createElement("canvas").getContext("2d");return n.font="13px Arial",e.predicates.length<10?n.measureText(t).width:n.measureText(t).width/2}(e);return{top:t.top-30+"px",left:t.left-30+"px",width:n+"px"}})).html((function(e){return l(e)}));const g=function(){a.cancel(void 0),a.cancel(Y),N=null,d.hide(),X=a((function(){se()}),500)};J.call(d);J.call(f);let h=J.selectAll(".link"),m=J.selectAll(".node");Q.nodes(D.nodes).charge(-3e3),Q.links(D.links).linkDistance((function(e){return function(e){const t=$("<span></span>"),n=e.predicates[0].split("/"),r=n[n.length-1];t.addClass("predicate-text").text(r),$("body").append(t);const o=t.width()+2*e.source.size+2*e.target.size+50;return t.remove(),.75*o}(e)+30*e.connectedness})),c.append("defs").selectAll("marker").data(Q.links()).enter().append("marker").attr("class","arrow-marker").attr("id",(function(e){return e.target.size})).attr("viewBox","0 -5 10 10").attr("refX",(function(e){return e.target.size+11})).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5 L10,0 L0, -5"),h=c.selectAll(".link").data(D.links).enter().append("g").attr("class","link-wrapper").attr("id",(function(e){return e.source.iri+">"+e.target.iri})).append("line").attr("class","link").style("stroke-width",1).style("fill","transparent").style("marker-end",(function(e){return"url("+u.absUrl()+"#"+e.target.size+")"}));const y=c.selectAll(".link-wrapper").append("text").text((function(e){return function(e){if(e.predicates.length>1)return e.predicates.length+" predicates";return ce(e.predicates[0])}(e)})).attr("class",(function(e){return e.predicates.length>1?"predicates":"predicate"})).attr("dy","-0.5em").style("text-anchor","middle").style("display",e.saveSettings.showLinksText?"":"none").on("mouseover",(function(e){d3.event.stopPropagation(),function(e){a.cancel(void 0);const t=p=d3.event.target;a((function(){p===t&&e.predicates.length>1&&f.show(e,p)}),300)}(e)})).on("mouseout",(function(){a.cancel(void 0),p=null,f.hide()})).on("click",(function(t){d3.event.stopPropagation(),function(t){e.showNodeInfo=!1,e.showPredicates=!0,e.showFilter=!1,t.predicates.length>1&&(e.predicates=_.map(t.predicates,(function(e){return ce(e)})),e.showInfoPanel=!0)}(t)}));let v,x=0,S=0,I=0;const w=function(){d3.event.button&&0!==d3.event.button||(g(),a.cancel(v),e.showPredicates=!1,d3.event.timeStamp-x<W?S++:S=1,x=d3.event.timeStamp,d3.event.preventDefault())},C=function(n){if(d3.event.button&&0!==d3.event.button)return;a.cancel(v);const r=d3.event,i=this;if(d3.event.timeStamp-x<W)if(1===S)v=a((function(){!function(n,r,i){if(e.showInfoPanel=!1,e.showPredicates=!1,e.showNodeInfo=!1,i.shiftKey&&(i.ctrlKey||i.metaKey))return void t.$broadcast("onRootNodeChange",n.iri);if(i.ctrlKey||i.metaKey)return void re(n);if(void 0!==e.openedNodeInfoPanel&&e.openedNodeInfoPanel===n)return e.pageslideExpanded=!1,void(e.openedNodeInfoPanel=void 0);!function(t){Q.stop(),e.openedNodeInfoPanel=t,e.showNodeInfo=!0,e.showFilter=!1,e.showPredicates=!1,e.nodeLabels=t.labels,e.nodeTypes=t.types,e.rdfRank=t.rdfRank,e.nodeIri=t.iri,e.encodedIri=encodeURI(t.iri),e.showInfoPanel=!0,e.rdfsLabel=t.labels[0].label,e.rdfsComment=t.comment,e.expanded=!1,e.propertiesQueryObj.query="",e.dataNodeKeysQuery="",s.get("rest/explore-graph/properties",{params:{iri:t.iri,config:e.configLoaded.id,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:e.saveSettings.includeInferred,sameAsState:e.saveSettings.sameAsState,rejectedPredicates:e.shouldShowSettings()?e.saveSettings.rejectedPredicates:[]}}).then((function(t){e.data=_.mapKeys(t.data,(function(t,n){return e.replaceIRIWithPrefix(n)})),e.propertiesObj.items=[],_.forEach(e.data,(function(t,n){e.propertiesObj.items.push({key:n,value:t})})),e.nodeImage=void 0,e.propertiesNotFiltered=e.propertiesObj.items;const n=_.find(e.propertiesObj.items,(function(e){return"image"===e.key}));n&&(e.nodeImage=n.value[0].v),e.propertiesObj.items=_.reject(e.propertiesObj.items,(function(e){return"image"===e.key})),e.propertiesNotFiltered=e.propertiesObj.items}),(function(e){o.warning(getError(e.data),"Error")}))}(n)}(n,0,r)}),40+W-(d3.event.timeStamp-x));else if(2===S){D.countLinks(n,D.links)<=e.saveSettings.linksLimit?ae(n,!1,i.parentNode):o.info("Increase limit to see more connections and try again","Node already expanded to predefined maximum links to show."),e.closeInfoPanel()}d3.event.preventDefault()};function b(e,t){let n,r,o,i,a=!0;if("down"===t)n=2*e.size,r=e.size/3,o=.8,i=.3;else if("down-fixed"===t)n=2*e.size,r=e.size,o=.8,i=.66;else if("up"===t)n=e.size/3,r=2*e.size,o=.3,i=.8;else{if("fixed"!==t)return;n=e.size,o=.66,a=!1}let s=c.selectAll(".node-wrapper").filter((function(t){return t===e})).append("text").text("").classed("icon-any pinned",!0).style("font-size",n+"px").attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).attr("opacity",o);"fixed"!==t&&"down-fixed"!==t||(e.pin=s),a&&(s=s.transition().duration(1e3).style("font-size",(function(){return r+"px"})).attr("opacity",i),"down-fixed"!==t&&s.remove())}const k=d3.behavior.drag().origin((function(e){return e})).on("dragstart",(function(e){0===d3.event.sourceEvent.button&&(e.fixedBeforeDrag=e.fixed,e.isBeingDragged=!0,e.beginDragging=!0,se(),d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0))})).on("drag",(function(t){t.isBeingDragged&&(S=0,t.px=d3.event.x,t.py=d3.event.y,t.fixed?t.beginDragging&&b(t,"fixed"):(e.numberOfPinnedNodes++,t.fixed=!0,b(t,"down-fixed")),t.pinWasFixed=!0,t.beginDragging=null,Q.resume())})).on("dragend",(function(e){e.isBeingDragged&&(e.pinWasFixed&&(e.pinWasFixed=null,d3.select(".pinned").remove()),e.isBeingDragged=!1,d3.select(this).classed("dragging",!1))}));m=c.selectAll(".node").data(D.nodes).enter().append("g").attr("class","node-wrapper").attr("id",(function(e){return e.iri})).append("circle").attr("class","node").attr("r",(function(e){return e.size})).style("fill",(function(t){return"greyColor"===t.types?"c2c2c2":e.getColor(t.types[0])})).call(k).on("mouseover",(function(t){if(!t.isBeingDragged){const n=d3.event;a.cancel(X),Y=a(()=>{(function(t,n){if(e.showInfoPanel)return!1;(ne.closeIcon||ne.expandIcon||ne.focusIcon||ne.copyURIIcon)&&ne.removeIcons();if(Q.alpha()<.05)return ne.initIcons(t,n.parentNode),Q.stop(),!0;return!1})(t,this)&&function(e,t){a.cancel(void 0);const n=N=t.target;a((function(){N===n&&d.show(e,N)}),300)}(t,n)},400)}})).on("mouseout",g).on("mousedown",w).on("touchstart",(function(e){w(),I=0,v=a((function(){I<5&&re(e),v=null,S=0}),1e3)})).on("touchmove",(function(){I++})).on("mouseup",C).on("touchend",C).on("contextmenu",(function(t){d3.event.shiftKey||(d3.event.preventDefault(),se(),e.closeInfoPanel(),t.fixed?(e.numberOfPinnedNodes--,t.fixed=!1,b(t,"up"),Q.resume()):(e.numberOfPinnedNodes++,t.fixed=!0,b(t,"down")),function(e){N&&d.show(e,N)}(t))}));const L=c.selectAll(".node-wrapper").append("foreignObject").style("pointer-events","none").attr("width",(function(e){return 2*e.size*V}));c.insert("g").attr("class","menu-events"),function(e){e.each((function(e){e.fontSize=r.a.Text.calcFontSizeRaw(e.labels[0].label,e.size,P,!0)})).attr("height",(function(e){return 3*e.fontSize})).append("xhtml:div").attr("class","node-label-body").style("font-size",(function(e){return e.fontSize+"px"})).append("xhtml:div").text((function(e){return e.labels[0].label})),a((function(){$(".node-label-body div").each((function(e,t){let n=t.textContent.substring(0,t.textContent.length-1);let r=0;for(;r<200&&(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)n=n.substring(0,n.length-1),t.textContent=n+"…",r++}))}),50)}(L),Q.on("tick",(function(){d3.geom.quadtree(D.nodes);D.nodes.length;h.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),y.attr("x",(function(e){return e.x=.5*(e.source.x+e.target.x)})).attr("y",(function(e){return e.y=.5*(e.source.y+e.target.y)})).attr("transform",(function(e){return"rotate("+function(e,t){const n=e.source,r=e.target,o={x:n.x,y:n.y},i={x:r.x,y:r.y};if(t)return 180*Math.atan2(i.y-o.y,i.x-o.x)/Math.PI;{const e=180*Math.atan2(i.y-o.y,i.x-o.x)/Math.PI;return e<=90&&e>=-90?e:(e>0?-1:1)*(180-Math.abs(e))}}(e,e.direction)+", "+e.x+", "+e.y+")"})),m.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),c.select(".node-loader").attr("x",(function(e){return e.x-e.size+3})).attr("y",(function(e){return e.y-e.size})),c.select(".loader-container").attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),L.attr("x",(function(e){return e.x-e.size*V})).attr("y",(function(e){return e.y-3*e.fontSize/2})),d3.select(".pinned").attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))})),angular.isDefined(ee)&&ee.setLoadingState(!1),e.loading&&(e.loading=!1),d3.selectAll(".link-wrapper").each((function(){const e=$(this).attr("id").split(">")[0],t=$(this).attr("id").split(">")[1];d3.selectAll(".link").each((function(n){if(n.source.iri===t&&n.target.iri===e){let e=n.source.iri;e+=">",e+=n.target.iri;const t=document.createTextNode("  ⟶");document.getElementById(e).lastChild.appendChild(t),n.direction="double"}}))})),d3.selectAll(".d3-actions-tip").remove(),Q.start()}te();const ne=new function(){function e(e,t){return"translate("+(t.x-14+(t.size+15)*Math.cos(e*Math.PI/180-Math.PI/2))+","+(t.y-14+(t.size+15)*Math.sin(e*Math.PI/180-Math.PI/2))+")"}this.closeIcon=void 0,this.expandIcon=void 0,this.collapseIcon=void 0,this.focusIcon=void 0,this.copyURIIcon=void 0,this.actionsTip=void 0,this.removeIcons=function(){this.closeIcon.remove("g"),this.expandIcon&&this.expandIcon.remove("g"),this.collapseIcon&&this.collapseIcon.remove("g"),this.focusIcon.remove("g"),this.copyURIIcon.remove("g"),this.closeIcon=void 0,this.expandIcon=void 0,this.collapseIcon=void 0,this.focusIcon=void 0,this.copyURIIcon=void 0,this.expandedState=!1},this.expandedState=!1,this.initIcons=function(n,r){const o=i()().attr("class","d3-tip d3-actions-tip").customPosition((function(){const e=d3.event.target.getBoundingClientRect();return{top:e.top-20+"px",left:e.right+10+"px"}})).html((function(e){return e}));J.call(o);n.isExpanded?(this.collapseIcon=d3.select(".menu-events").append("g").attr("class","collapse-icon").attr("name","collapse").attr("transform",(function(){return e(20,n)})),this.collapseIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.collapseIcon.append("path").attr("d","M22.67,12a.59.59,0,0,1-.53.65l-6.88.72H15.2a.59.59,0,0,1-.59-.65l.72-6.88A.58.58,0,0,1,16,5.33a.59.59,0,0,1,.53.65L16,11.11,21.3,5.79a.64.64,0,0,1,.91.91L16.89,12,22,11.49A.59.59,0,0,1,22.67,12ZM12.59,14.75l-6.75.85a.59.59,0,0,0-.51.66.58.58,0,0,0,.66.51l4.95-.62-5.2,5.2a.64.64,0,1,0,.91.91l5.2-5.2L11.23,22a.59.59,0,0,0,.51.66h.07a.59.59,0,0,0,.59-.52l.85-6.75a.59.59,0,0,0-.17-.49A.58.58,0,0,0,12.59,14.75Z").style("fill","#ed4f2f"),this.collapseIcon.on("click",(function(){var e;(e=n).isExpanded=!1,D.removeNodeLeafLinks(e),te()})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(Y),a.cancel(X)})).on("mouseout",(function(){o.hide(),X=a((function(){se()}),500)}))):(this.expandIcon=d3.select(".menu-events").append("g").attr("class","expand-icon").attr("name","expand").attr("transform",(function(){return e(20,n)})),this.expandIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.expandIcon.append("path").attr("d","M22.37,6.28l-.72,6.88a.59.59,0,0,1-.59.53H21a.59.59,0,0,1-.53-.65L21,7.9l-5.32,5.32a.64.64,0,0,1-.91-.91L20.1,7,15,7.53a.59.59,0,0,1-.12-1.18l6.88-.72a.59.59,0,0,1,.65.65ZM12.89,20.34,7.95,21l5.2-5.2a.64.64,0,0,0-.91-.91L7,20.05l.62-4.95A.59.59,0,0,0,6.48,15l-.85,6.75a.59.59,0,0,0,.59.67h.07L13,21.52a.59.59,0,1,0-.15-1.18Z").style("fill","#ed4f2f"),this.expandIcon.on("click",(function(){ae(n,!1,r)})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(X),a.cancel(Y)})).on("mouseout",(function(){o.hide(),X=a((function(){se()}),500)}))),this.focusIcon=d3.select(".menu-events").append("g").attr("class","focus-icon").attr("name","focus").attr("transform",(function(){return e(20,n)})),this.focusIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.focusIcon.append("path").attr("d","M14.2,23.81a9.8,9.8,0,1,1,6.93-2.87h0A9.74,9.74,0,0,1,14.2,23.81Zm0-18.17a8.37,8.37,0,1,0,5.92,14.29h0A8.37,8.37,0,0,0,14.2,5.64Zm1.42,6.95a2,2,0,1,0,0,2.85A2,2,0,0,0,15.62,12.59Z").style("fill","#ed4f2f"),this.focusIcon.on("click",(function(){t.$broadcast("onRootNodeChange",n.iri)})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(X),a.cancel(Y)})).on("mouseout",(function(){o.hide(),X=a((function(){se()}),500)})),this.copyURIIcon=d3.select(".menu-events").append("g").attr("class","icon-link").attr("name","link").attr("transform",(function(){return e(20,n)})),this.copyURIIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.copyURIIcon.append("path").attr("d","M 13.457031 10.164062 C 13.648438 10.164062 13.820312 10.242188 13.941406 10.363281 L 15.492188 11.859375 C 15.984375 12.332031 16.292969 12.992188 16.292969 13.714844 C 16.292969 14.441406 15.984375 15.097656 15.492188 15.574219 L 10.394531 20.496094 C 9.902344 20.972656 9.222656 21.265625 8.472656 21.265625 C 7.71875 21.265625 7.039062 20.972656 6.546875 20.496094 L 4.996094 19 C 4.507812 18.523438 4.203125 17.867188 4.203125 17.144531 C 4.203125 16.421875 4.507812 15.765625 4.996094 15.289062 L 7.542969 12.824219 C 7.667969 12.707031 7.84375 12.628906 8.035156 12.628906 C 8.417969 12.628906 8.726562 12.929688 8.726562 13.300781 C 8.726562 13.484375 8.648438 13.652344 8.523438 13.773438 L 5.976562 16.234375 C 5.738281 16.46875 5.589844 16.792969 5.589844 17.148438 C 5.589844 17.503906 5.738281 17.824219 5.976562 18.058594 L 7.527344 19.566406 C 7.773438 19.792969 8.105469 19.929688 8.472656 19.929688 C 8.835938 19.929688 9.167969 19.792969 9.414062 19.566406 L 14.511719 14.644531 C 14.753906 14.410156 14.90625 14.089844 14.90625 13.730469 C 14.90625 13.375 14.753906 13.054688 14.511719 12.820312 L 12.964844 11.324219 C 12.839844 11.203125 12.761719 11.039062 12.761719 10.855469 C 12.761719 10.488281 13.070312 10.1875 13.449219 10.1875 Z M 17.082031 3.976562 C 17.082031 3.976562 17.085938 3.976562 17.085938 3.976562 C 17.824219 3.976562 18.492188 4.261719 18.980469 4.722656 L 20.535156 6.203125 C 21.042969 6.679688 21.355469 7.34375 21.355469 8.082031 C 21.355469 8.792969 21.058594 9.441406 20.582031 9.914062 L 18.0625 12.402344 C 17.9375 12.527344 17.761719 12.605469 17.566406 12.605469 C 17.183594 12.605469 16.875 12.304688 16.875 11.9375 C 16.875 11.753906 16.949219 11.589844 17.070312 11.46875 L 19.605469 8.984375 C 19.847656 8.75 19.996094 8.429688 19.996094 8.070312 C 19.996094 7.714844 19.847656 7.394531 19.605469 7.160156 L 18.019531 5.667969 C 17.773438 5.445312 17.4375 5.304688 17.070312 5.300781 C 16.703125 5.304688 16.367188 5.453125 16.128906 5.691406 L 11.085938 10.667969 C 10.84375 10.898438 10.695312 11.222656 10.695312 11.578125 C 10.695312 11.933594 10.84375 12.257812 11.085938 12.488281 L 12.675781 13.980469 C 12.804688 14.101562 12.882812 14.273438 12.882812 14.457031 C 12.882812 14.828125 12.574219 15.128906 12.191406 15.128906 C 12.003906 15.128906 11.832031 15.054688 11.707031 14.9375 L 10.140625 13.457031 C 9.636719 12.980469 9.324219 12.316406 9.324219 11.582031 C 9.324219 10.863281 9.621094 10.214844 10.101562 9.742188 L 15.140625 4.765625 C 15.625 4.285156 16.304688 3.980469 17.054688 3.976562 Z M 17.082031 3.976562").style("fill","#ed4f2f"),this.copyURIIcon.on("click",(function(){E(n.iri),se(),o.hide()})).on("mouseover",(function(){o.show("<div style='text-align: center;'><b>Copy to ClipBoard</b><br>"+n.iri+"</div>"),a.cancel(X),a.cancel(Y)})).on("mouseout",(function(){o.hide(),X=a((function(){se()}),500)})),this.closeIcon=d3.select(".menu-events").append("g").attr("class","close-icon").attr("name","remove").attr("transform",(function(){return e(20,n)})),this.closeIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.closeIcon.append("path").attr("d","M14.94,14l5.87-5.87a.66.66,0,1,0-.94-.94L14,13.06,8.13,7.19a.66.66,0,0,0-.94.94L13.06,14,7.19,19.87a.66.66,0,1,0,.94.94L14,14.94l5.87,5.87a.66.66,0,1,0,.94-.94Z").style("fill","#ed4f2f"),this.closeIcon.on("click",(function(){re(n)})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(X),a.cancel(Y)})).on("mouseout",(function(){o.hide(),X=a((function(){se()}),500)})),this.animateMenu(n)},this.animateMenu=function(t){let n=0;let r=20;this.expandIcon&&this.expandIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return e(r,t)})).delay(n+=35),this.collapseIcon&&this.collapseIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return e(r,t)})).delay(n+=35),this.copyURIIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return r+=30,e(r,t)})).delay(n+=35),this.focusIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return r+=30,e(r,t)})).delay(n+=35),this.closeIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return r+=30,e(r,t)})).delay(n+=35),this.expandedState=!0}};function re(e){D.removeNode(e),te()}function oe(t){!function(t){e.nodeSelected=!0,null===t.data.types&&(t.data.types="greyColor"),D=new F,G="translate(0, -70) scale(1)",A.translate([0,-70]),A.scale(1)}(t),ie(t)}function ie(t,n,r){let i=t.data;i=_.filter(i,(function(e){return-1===_.findIndex(D.links,(function(t){return e.source===t.source.iri&&e.target===t.target.iri}))})),i=_.filter(i,(function(e){return e.source!==e.target}));const a=_.union(_.flatten(_.map(t.data,(function(e){return[e.source,e.target]})))),c=_.map(D.nodes,(function(e){return e.iri})),d=_.reject(a,(function(e){return _.includes(c,e)}));if(0===d.length)r?o.info("This node has no visible connections. Check your Graph Settings if you expect such."):0===i.length&&o.info("This node has no other visible connections. Check your Graph Settings if you expect such."),D.addAndMatchLinks(i),te();else{const t=[],r=[];_.forEach(d,(function(n,o){t.push(s({url:"rest/explore-graph/node",method:"GET",params:{iri:n,config:e.configLoaded.id,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:e.saveSettings.includeInferred,sameAsState:e.saveSettings.sameAsState}}).then((function(e){r[o]=e.data})))})),l.all(t).then((function(){_.forEach(r,(function(e,t){const o=2*Math.PI*t/r.length,i=(n?n.x:0)+Math.cos(o)*T/3,a=(n?n.y:0)+Math.sin(o)*T/3;D.addNode(e,i,a)})),D.addAndMatchLinks(i),n&&(n.isExpanded=!0),te()}))}}function ae(t,n,r){if(ee.getLoadingState())return;ee.init(t,r);const i=t.iri;s({url:"rest/explore-graph/links",method:"GET",params:{iri:i,linksLimit:e.saveSettings.linksLimit,includeInferred:e.saveSettings.includeInferred,config:e.configLoaded.id,preferredTypes:e.shouldShowSettings()?e.saveSettings.preferredTypes:[],rejectedTypes:e.shouldShowSettings()?e.saveSettings.rejectedTypes:[],preferredPredicates:e.shouldShowSettings()?e.saveSettings.preferredPredicates:[],rejectedPredicates:e.shouldShowSettings()?e.saveSettings.rejectedPredicates:[],preferredTypesOnly:e.shouldShowSettings()?e.saveSettings.preferredTypesOnly:[],preferredPredicatesOnly:e.shouldShowSettings()?e.saveSettings.preferredPredicatesOnly:[],languages:e.shouldShowSettings()?e.saveSettings.languages:[],sameAsState:e.saveSettings.sameAsState,includeSchema:e.saveSettings.includeSchema}}).then((function(e){ie(e,t,n)}),(function(t){const n=getError(t.data);o.error(n,"Error exploring node"),e.loading=!1,ee.setLoadingState(!1)}))}function se(){angular.isDefined(ne)&&ne.expandedState&&ne.removeIcons()}function ce(t){const n=e.replaceIRIWithPrefix(t);return n.length===t.length?t.split("/")[t.split("/").length-1]:n}e.toggleSidePanel=function(){e.pageslideExpanded=!e.pageslideExpanded},e.closeInfoPanel=function(){e.pageslideExpanded=!1,e.openedNodeInfoPanel=void 0,a((function(){e.showInfoPanel=!1}))},e.splitPredicate=function(e){return e.split("/")[e.split("/").length-1]},e.getActiveRepository=function(){return n.getActiveRepository()},e.isLoadingLocation=function(){return n.isLoadingLocation()},e.hasActiveLocation=function(){return n.hasActiveLocation()},e.rotate=function(e){se();const t=2*(e?1:-1)*Math.PI/180,n=Math.cos(t),r=Math.sin(t),o=M/2,i=T/2;d3.selectAll(".node-wrapper").each((function(e){e.x=o+(n*(e.x-o)+r*(e.y-i)),e.y=i+(-r*(e.x-o)+n*(e.y-i)),e.fixed&&(e.px=e.x,e.py=e.y)})),Q.resume()},e.openUri=function(t,n){if(!n){const n={};e.configLoaded.id!==e.defaultGraphConfig.id&&(n.config=e.configLoaded.id),n.uri=t,e.pushHistory(n,{uri:t,config:e.configLoaded})}e.$broadcast("onRootNodeChange",t)},e.saveOrUpdateGraph=function(){const t=JSON.stringify(D.copyState()),n={id:e.lastSavedGraphId,name:e.lastSavedGraphName,data:t,shared:e.shared};n.id?e.saveGraphModal("update",n):e.saveGraphModal("new",n)},e.renameSavedGraph=function(t){e.saveGraphModal("rename",{id:t.id,name:t.name,config:t.config,shared:t.shared})};const de=function(t){x.editSavedGraph(t).success((function(){e.lastSavedGraphName=t.name,e.shared=t.shared,e.refreshSavedGraphs(),o.success("Saved graph "+t.name+" was edited.")})).error((function(e){const t=getError(e);o.error(t,"Error! Cannot edit saved graph")}))};e.saveGraphModal=function(t,n,r){h.open({templateUrl:"js/angular/graphexplore/templates/modal/save-graph.html",controller:"SaveGraphModalCtrl",resolve:{data:function(){return{mode:t,graph:n,graphExists:r,shared:n.shared}}}}).result.then((function(t){if(t.restart)e.saveGraphModal(t.mode,t.graph,!1);else switch(t.mode){case"new":!function(t){e.configLoaded&&(t.config=e.configLoaded.id),x.addNewSavedGraph(t).success((function(n,r,i){e.lastSavedGraphName=t.name,e.lastSavedGraphId=i()["x-saved-graph-id"],e.shared=t.shared,e.refreshSavedGraphs(),o.success("Saved graph "+t.name+" was saved.")})).error((function(n,r){if(422===r)e.saveGraphModal("new",t,!0);else{const e=getError(n);o.error(e,"Error! Cannot create saved graph")}}))}(t.graph);break;case"update":case"rename":de(t.graph)}}))},e.refreshSavedGraphs=function(){x.getSavedGraphs().success((function(t){e.savedGraphs=t})).error((function(e){const t=getError(e);o.error(t,"Error! Could not get saved graphs")}))},e.loadSavedGraph=function(t,n){t.owner?(e.lastSavedGraphName=t.name,e.lastSavedGraphId=t.id,e.shared=t.shared,e.configLoaded=e.findConfigById(t.config)):(e.lastSavedGraphName=null,e.lastSavedGraphId=null,e.shared=t.shared),e.configLoaded||(e.configLoaded=e.defaultGraphConfig),D.restoreState(JSON.parse(t.data)),n||e.pushHistory({saved:t.id},{savedGraph:t})},e.copyToClipboardSavedGraph=function(e){E([location.protocol,"//",location.host,location.pathname,"?saved=",e.id].join(""))},e.deleteSavedGraph=function(t){g.openSimpleModal({title:"Confirm",message:"Are you sure you want to delete the saved graph '"+t.name+"'?",warning:!0}).result.then((function(){!function(t){x.deleteSavedGraph(t).success((function(){e.refreshSavedGraphs(),o.success("Saved graph "+t.name+" was deleted.")})).error((function(e){const t=getError(e);o.error(t,"Error! Cannot delete saved graph")}))}(t)}))},e.openIRI=function(t,n){return n.shiftKey?e.$broadcast("onRootNodeChange",t):window.open(t,"_blank"),!1},e.togglePinAllNodes=function(){se();const t=e.numberOfPinnedNodes<=0;e.numberOfPinnedNodes=0,d3.selectAll(".node").each((function(n){n.fixed=t,t&&e.numberOfPinnedNodes++})),Q.resume()},$("body").on("keydown",(function(t){"input"!==t.target.nodeName&&e.nodeSelected&&(37===t.keyCode?e.rotate(!0):39===t.keyCode&&e.rotate(!1))})),e.getLiteralFromPropValue=function(e){return e.substring(e.indexOf(":")+1)}}function s(e,t,n){switch(e.mode=n.mode,e.graph=angular.copy(n.graph),e.graphExists=n.graphExists,e.mode){case"new":e.title="Create new saved graph",e.okButtonText="Create";break;case"update":e.title="Update saved graph",e.okButtonText="Save";break;case"rename":e.title="Rename saved graph",e.okButtonText="Save"}e.ok=function(){e.form.$valid&&t.close({graph:e.graph,mode:e.mode})},e.saveNew=function(){e.graph.name=e.graph.name+" (new)",t.close({graph:e.graph,mode:"new",restart:!0})},e.cancel=function(){t.dismiss("cancel")}}angular.module("graphdb.framework.graphexplore.controllers.graphviz",["ui.scroll.jqlite","ui.scroll","toastr","ui.bootstrap","ngTagsInput","graphdb.framework.utils.localstorageadapter"]).controller("GraphsVisualizationsCtrl",a).controller("SaveGraphModalCtrl",s).config(["$tooltipProvider",function(e){e.options({appendToBody:!0})}]),a.$inject=["$scope","$rootScope","$repositories","toastr","$timeout","$http","ClassInstanceDetailsService","AutocompleteRestService","$q","$location","$jwtAuth","UiScrollService","ModalService","$modal","$window","LocalStorageAdapter","LSKeys","SavedGraphsRestService","GraphConfigRestService","RDF4JRepositoriesRestService"],s.$inject=["$scope","$modalInstance","data"]}}]);
//# sourceMappingURL=28.bbe49746541a2419b9a7.bundle.js.map