{"version":3,"sources":["webpack:///./src/js/angular/graphexplore/controllers/domain-range-graph.controller.js"],"names":["DomainRangeGraphCtlr","$scope","$location","$rootScope","$timeout","$repositories","$window","LocalStorageAdapter","LSKeys","GraphDataRestService","UiScrollService","ModalService","toastr","predicatesObj","predicatesQueryObj","items","query","predicatesListNotFiltered","predicatesSearchPlaceholder","onopen","onclose","angular","noop","datasource","position","current","key","get","index","count","success","initLazyList","$watch","_","each","item","revision","adapterContainer","adapter","remain","doCollapseEdges","DOMAIN_RANGE_COLLAPSE_EDGES","goToClassHierarchyView","lastSelectedClass","CLASS_HIERARCHY_LAST_SELECTED_CLASS","search","hash","path","collapseEdges","$on","event","selectedClass","uri","objectPropClassUri","name","objectPropClassName","collapsed","currentActiveRepository","getActiveRepository","set","copyToClipboard","openCopyToClipboardModal","toggleCollapseEdgesState","history","pushState","predicatesListFilterFunc","pred","resolvedUri","toLowerCase","indexOf","reload","showPredicatesInfoPanel","selectedPredicate","targetNode","target","sourceNode","source","encodedUri","encodeURIComponent","sourceTargetObjectNodeUri","encodedSourceTargetObjectNodeUri","sourceTargetObjectNodeName","getRdfsLabelAndComment","response","rdfsLabel","label","rdfsComment","comment","error","undefined","allEdges","obj","absUri","absUriNonEncoded","isImplicit","implicit","push","prepareDataForPredicatesInfoSidePanel","$","document","ready","click","hide","module","controller","$inject"],"mappings":"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","file":"57.10c0975367e2a775b3e2.bundle.js","sourcesContent":["import 'angular/utils/local-storage-adapter';\n\nangular\n    .module('graphdb.framework.graphexplore.controllers.domainrange', [\n        'ui.scroll.jqlite',\n        'ui.scroll',\n        'ngSanitize',\n        'graphdb.framework.utils.localstorageadapter'\n    ])\n    .controller('DomainRangeGraphCtlr', DomainRangeGraphCtlr);\n\nDomainRangeGraphCtlr.$inject = ['$scope', '$location', '$rootScope', '$timeout', '$repositories', '$window', 'LocalStorageAdapter', 'LSKeys', 'GraphDataRestService', 'UiScrollService', 'ModalService', 'toastr'];\n\nfunction DomainRangeGraphCtlr($scope, $location, $rootScope, $timeout, $repositories, $window, LocalStorageAdapter, LSKeys, GraphDataRestService, UiScrollService, ModalService, toastr) {\n    $scope.predicatesObj = {};\n    $scope.predicatesQueryObj = {};\n    $scope.predicatesObj.items = [];\n    $scope.predicatesQueryObj.query = '';\n    $scope.predicatesListNotFiltered = [];\n    $scope.predicatesSearchPlaceholder = 'Search predicates';\n\n    // Handle pageslide directive callbacks which incidentally appeared to be present in the angular's\n    // scope, so we need to define our's and pass them to pageslide, otherwise it throws an error.\n    $scope.onopen = $scope.onclose = () => angular.noop();\n\n    // creating datasource for predicates data\n    const datasource = {};\n    let position = 0;\n    let current = 0;\n    $rootScope.key = '';\n    datasource.get = function (index, count, success) {\n        return UiScrollService.initLazyList(index, count, success, position, $scope.predicatesObj.items);\n    };\n    $rootScope.$watch(function () {\n        return $rootScope.key;\n    }, function () {\n        position = 0;\n        _.each($scope.predicatesObj.items, function (item) {\n            if ($rootScope.key > item) position++;\n        });\n        current++;\n    });\n\n    datasource.revision = function () {\n        return current;\n    };\n\n    // adapter implementation for ui-scroll directive\n    $scope.adapterContainer = {adapter: {remain: true}};\n\n\n    const doCollapseEdges = LocalStorageAdapter.get(LSKeys.DOMAIN_RANGE_COLLAPSE_EDGES);\n    if (doCollapseEdges === null) {\n        $scope.collapseEdges = true;\n    } else {\n        $scope.collapseEdges = doCollapseEdges === 'true';\n    }\n\n    $scope.datasource = datasource;\n\n    $scope.$on('reloadDomainRangeGraphView', reloadDomainRangeGraphView);\n    $scope.$on('switchEdgeMode', switchEdgeMode);\n    $scope.$on('repositoryIsSet', onRepositoryIsSet);\n    $scope.$on('changeCollapsedEdgesState', function (event, collapsed) {\n        $scope.collapseEdges = !collapsed;\n        LocalStorageAdapter.set(LSKeys.DOMAIN_RANGE_COLLAPSE_EDGES, $scope.collapseEdges);\n    });\n\n    $scope.goToClassHierarchyView = goToClassHierarchyView;\n    $scope.copyToClipboard = copyToClipboard;\n    $scope.toggleCollapseEdgesState = toggleCollapseEdgesState;\n    $scope.predicatesListFilterFunc = predicatesListFilterFunc;\n\n    $scope.$watch('predicatesObj.items', function () {\n        if ($scope.predicatesObj.items > 0) {\n            $timeout(function () {\n                $scope.adapterContainer.adapter.reload();\n            }, 30);\n        }\n    });\n\n    $scope.$watch('selectedPredicate', function () {\n        if ($scope.showPredicatesInfoPanel) {\n            prepareDataForPredicatesInfoSidePanel($scope.selectedPredicate);\n        }\n    });\n\n    function predicatesListFilterFunc(pred) {\n        return pred.resolvedUri\n            .toLowerCase()\n            .indexOf($scope.predicatesQueryObj.query.toLowerCase()) >= 0;\n    }\n\n    function prepareDataForPredicatesInfoSidePanel(selectedPredicate) {\n        const targetNode = selectedPredicate.target;\n        const sourceNode = selectedPredicate.source;\n\n        $scope.encodedUri = encodeURIComponent(selectedPredicate.uri);\n\n        $scope.sourceTargetObjectNodeUri = targetNode.objectPropClassUri\n            ? targetNode.objectPropClassUri\n            : sourceNode.objectPropClassUri;\n\n        $scope.encodedSourceTargetObjectNodeUri = encodeURIComponent($scope.sourceTargetObjectNodeUri);\n\n        $scope.sourceTargetObjectNodeName = targetNode.objectPropClassName\n            ? targetNode.objectPropClassName\n            : sourceNode.objectPropClassName\n                ? sourceNode.objectPropClassName\n                : '<i>Literal</i>';\n\n        if ($scope.sourceTargetObjectNodeName.indexOf('Literal') === -1) {\n            GraphDataRestService.getRdfsLabelAndComment($scope.sourceTargetObjectNodeUri)\n                .success(function (response) {\n                    $scope.rdfsLabel = response.label;\n                    $scope.rdfsComment = response.comment;\n                })\n                .error(function () {\n                    toastr.error('Error getting rdfs:label and rdfs:comment');\n                });\n        } else {\n            $scope.rdfsComment = undefined;\n            $scope.rdfsLabel = undefined;\n        }\n\n        $scope.predicatesObj.items = [];\n\n        // clear predicates search input field when changing edges\n        $scope.predicatesQueryObj.query = '';\n\n        // if target node of selected predicate has no edges then it is a left edge and edges should\n        // come from the source node\n        const allEdges = targetNode.allEdges\n            ? targetNode.allEdges\n            : sourceNode.allEdges;\n\n        _.each(allEdges, function (pred) {\n            const obj = {};\n            obj.absUri = encodeURIComponent(pred.uri);\n            obj.absUriNonEncoded = pred.uri;\n            obj.resolvedUri = pred.name;\n            obj.isImplicit = pred.implicit;\n            $scope.predicatesObj.items.push(obj);\n        });\n        $scope.predicatesListNotFiltered = $scope.predicatesObj.items;\n    }\n\n\n    // Hack needed to force hide collapsed-mode toggle tooltip in order not be\n    // visible after icon is switched\n    $(document).ready(function () {\n        $('.compact-mode-toggle').click(function () {\n            $('.tooltip').hide();\n        });\n    });\n\n    function reloadDomainRangeGraphView(event, selectedClass) {\n        const uri = selectedClass.objectPropClassUri;\n        const name = selectedClass.objectPropClassName;\n\n        $location\n            .path('domain-range-graph')\n            .search('uri', uri)\n            .search('name', name);\n    }\n\n    function switchEdgeMode(event, selectedClass) {\n        $location\n            .path('domain-range-graph')\n            .search('uri', selectedClass.uri)\n            .search('name', selectedClass.name)\n            .search('collapsed', selectedClass.collapsed);\n    }\n\n    function goToClassHierarchyView() {\n        const lastSelectedClass = LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_LAST_SELECTED_CLASS);\n\n        $location\n            .search('')\n            .hash(lastSelectedClass)\n            .path('hierarchy');\n    }\n\n    function toggleCollapseEdgesState() {\n        $scope.collapseEdges = !$scope.collapseEdges;\n        $window.history.pushState({collapsed: $scope.collapseEdges}, 'domainRangePage', null);\n    }\n\n    function copyToClipboard(uri) {\n        ModalService.openCopyToClipboardModal(uri);\n    }\n\n\n    let currentActiveRepository = $repositories.getActiveRepository();\n\n    function onRepositoryIsSet() {\n        if (currentActiveRepository === $repositories.getActiveRepository()) {\n            return;\n        } else {\n            currentActiveRepository = $repositories.getActiveRepository();\n        }\n        goToClassHierarchyView();\n    }\n}\n"],"sourceRoot":""}