(window.webpackJsonp=window.webpackJsonp||[]).push([[27,35,84],{29:function(e,n){angular.module("graphdb.framework.rest.connectors.service",[]).factory("ConnectorsRestService",r),r.$inject=["$http"];const t="rest/connectors";function r(e){return{getConnectors:function(){return e.get(t)},initConnector:function(n){return e.get(`${t}/options?prefix=${n}`)},hasConnector:function(n){return e.get(`${t}/existing?prefix=${n}`)},checkConnector:function(n){return e.post(`${t}/check`,n,{headers:{"Content-Type":"text/plain"}})}}}},32:function(e,n,t){"use strict";t.r(n);t(10),t(29);function r(e){const n=[];return Object.keys(e).forEach((function(t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))})),n.join("&")}function o(e,n){for(let r=0;r<n.length;r++){const o=n[r];if("StringArray"===o.__type)e[o.__name]||(e[o.__name]=[""]);else if("OptionArray"===o.__type)if(e[o.__name])for(let n=0;n<o.__childOptions.length;n++){const t=o.__childOptions[n];if("Boolean"===t.__type)for(let n=0;n<e[o.__name].length;n++){const r=e[o.__name][n];!r.hasOwnProperty([t.__name])&&angular.isDefined(t.__defaultValue)&&(r[t.__name]=t.__defaultValue)}}else{e[o.__name]=[];const n={};for(let e=0;e<o.__childOptions.length;e++){const t=o.__childOptions[e];"StringArray"===t.__type?n[t.__name]=[""]:n[t.__name]=angular.isUndefined(t.__defaultValue)?"":t.__defaultValue}e[o.__name].push(n)}else"Map"===o.__type?e[o.__name]?e[o.__name]=(t=e[o.__name],_.map(t,(function(e,n){return{key:n,value:e}}))):e[o.__name]=[]:"JsonString"===o.__type?e[o.__name]&&(e[o.__name]=angular.toJson(e[o.__name],2)):angular.isUndefined(e[o.__name])&&(e[o.__name]=angular.isUndefined(o.__defaultValue)?"":o.__defaultValue)}var t;return e}function a(e,n,t){return e.post("repositories/"+n,r({query:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/sparql-results+json","X-GraphDB-Local-Consistency":"updating"}})}function i(e){return e.substring(0,e.length-1)+"/instance#"}function s(e,n,t,r,o){const a=function e(n,t){const r={};return _.each(t,(function(t){angular.isDefined(n[t.__name])&&("OptionArray"===t.__type?(r[t.__name]=[],_.each(n[t.__name],(function(n){r[t.__name].push(e(n,t.__childOptions))}))):r[t.__name]=angular.copy(n[t.__name]))})),r}(t,r);for(let e=0;e<r.length;e++)try{"Map"===r[e].__type?a[r[e].__name]=(s=a[r[e].__name],_.reduce(s,(function(e,n){if(""===n.key&&""===n.value);else{if(""===n.key)throw new Error('Key may not be empty with value "'+n.value+'"');if(e.hasOwnProperty(n.key))throw new Error("Duplicate key "+n.key);e[n.key]=n.value}return e}),{})):"JsonString"===r[e].__type&&(a[r[e].__name]=angular.fromJson(a[r[e].__name]))}catch(n){return o(r[e].__label,n.message),null}var s;!function e(n){Array.isArray(n)&&(n=_.filter(n,(function(e){return null!==e&&(!e.trim||""!==e.trim())})));return Object.keys(n).forEach((function(t){""!==n[t]&&null!=n[t]||!1===n[t]?"object"==typeof n[t]&&(n[t]=e(n[t])):delete n[t]})),n}(a);let u="";return u+="PREFIX :<"+n+">\n",u+="PREFIX inst:<"+i(n)+">\n",u+="INSERT DATA {\n",u+="\tinst:"+e+" :createConnector '''\n",u+=angular.toJson(a,2),u+="\n''' .\n}\n",u=u.replace(/\\/g,"\\\\\\"),u}function u(e,n,t,u,c,l,d,p,g){function f(n){e.beingBuiltConnector={percentDone:0,status:{processedEntities:0,estimatedEntities:0,indexedEntities:0,entitiesPerSecond:0},actionName:n?"Repairing":"Creating",waitOnRepairStartOnce:!!n,eta:"-",inline:!1,iri:null}}function m(n,t,r){return f(r),$.extend(e.beingBuiltConnector,{iri:i(n)+t,name:t,inline:!1,doneCallback:function(){e.beingBuiltConnector.modalInstance.dismiss("cancel")}}),e.beingBuiltConnector.modalInstance=u.open({templateUrl:"pages/connectorProgress.html",controller:"CreateProgressCtrl",size:"lg",backdrop:"static",scope:e}),e.beingBuiltConnector.modalInstance}function y(n,o,a){const i=m(n.value,o.name,!1);p.addStatements(t.getActiveRepository(),r({update:o.query})).then((function(){g.getConnectors().then((function(){g.hasConnector(encodeURIComponent(n.value)).then((function(t){e.existing[n.key]=t.data}))})),c.success("Created connector "+o.name)}),(function(e){c.error(getError(e)),a()})).finally((function(){i.dismiss("cancel")}))}e.loader=!1,e.controllers=[],e.existing={},e.definitions={},e.getLoaderMessage=function(){const n=(Date.now()-e.loaderStartTime)/1e3,t=e.getHumanReadableSeconds(n);let r="";return r=e.progressMessage?e.progressMessage+"... "+t:"Running operation..."+t,e.extraMessage&&n>10&&(r+="\n"+e.extraMessage),r},e.setLoader=function(n,t,r){n?(e.loader=!0,e.loaderStartTime=Date.now(),e.progressMessage=t,e.extraMessage=r):(e.loader=!1,e.progressMessage="",e.extraMessage="")},e.initConnector=function(n){return g.initConnector(encodeURIComponent(n.value)).then((function(t){return e.definitions[n.key]=t.data,g.hasConnector(encodeURIComponent(n.value)).then((function(t){e.existing[n.key]=t.data}))}))},e.getConnectors=function(){e.canWriteActiveRepo()&&(e.setLoader(!0,"Fetching connectors","Normally this is a fast operation but it may take longer if a bigger repository needs to be initialised first."),g.getConnectors().then((function(r){e.connectors=Object.keys(r.data).map((function(e){return{key:e,value:r.data[e]}})),d.all(_.map(e.connectors,(function(n){return e.initConnector(n)}))).finally((function(){f();const r=function(e){const n=_.map(e,(function(e){return"<"+e.value+"connectorStatus>"})).join("|");return n?"SELECT ?connector ?status { ?connector "+n+" ?status }":null}(e.connectors);r?function(e){return a(n,t.getActiveRepository(),e)}(r).then((function(n){const t=function(e){if(e.bindings)for(let n=0;n<e.bindings.length;n++)try{const t=JSON.parse(e.bindings[n].status.value);if("BUILDING"===t.status)return{connector:e.bindings[n].connector.value,status:t}}catch(e){console.error(e)}return{}}(n.data.results);if(t.connector){const n=t.connector.split(/#/);n[0]=n[0].replace(/\/instance$/,"#"),r=n[0],o=n[1],f(),$.extend(e.beingBuiltConnector,{iri:i(r)+o,name:o,inline:!0,doneCallback:function(){e.beingBuiltConnector.inline=!1}})}var r,o})).finally((function(){e.setLoader(!1)})):e.setLoader(!1)}))})).catch((function(n){e.setLoader(!1),c.error(getError(n),"Could not get connectors")})),e.existing={})},e.getOptions=function(n){return e.definitions[n.key]},e.isEmpty=function(e){return angular.isObject(e)&&0===Object.keys(e).length},e.toPrettyJson=function(e){return angular.toJson(e,2)},e.$watch((function(){return t.getActiveRepository()}),e.getConnectors),e.$watch((function(){return t.getActiveLocation()}),e.getConnectors),e.copyConnector=function(n,t){let r;angular.isUndefined(t)||(r=angular.copy(t),r.name=r.name+"-copy"),u.open({templateUrl:"pages/createConnector.html",controller:"CreateConnectorCtrl",size:"lg",backdrop:"static",resolve:{connector:function(){return n},values:function(){return angular.isUndefined(r)?{name:"",values:{}}:r},options:function(){return e.getOptions(n)}}}).result.then((function(t){y(n,t,(function(){t.skipConversion=!0,e.newConnector(n,t)}))}))},e.newConnector=function(n,t){u.open({templateUrl:"pages/createConnector.html",controller:"CreateConnectorCtrl",size:"lg",backdrop:"static",resolve:{connector:function(){return n},values:function(){return angular.isUndefined(t)?{name:"",values:{}}:t},options:function(){return e.getOptions(n)}}}).result.then((function(t){y(n,t,(function(){t.skipConversion=!0,e.newConnector(n,t)}))}))},e.repair=function(n,o){l.openSimpleModal({title:"Confirm repair",message:"Are you sure you want to repair this connector?<br>Note that repair means delete + recreate with the same settings.",warning:!0}).result.then((function(){const a=m(o.value,n.name,!0),s=(u=n.name,"PREFIX prefix:<"+(l=o.value)+">\nINSERT DATA {\n\t<"+i(l)+u+'> prefix:repairConnector ""\n}');var u,l;p.addStatements(t.getActiveRepository(),r({update:s})).then((function(){g.getConnectors().then((function(){g.hasConnector(encodeURIComponent(o.value)).then((function(n){e.existing[o.key]=n.data}))})),c.success("Repaired connector "+n.name)}),(function(e){c.error(getError(e))})).finally((function(){a.dismiss("cancel")}))}))},e.delete=function(n,o){const a=o.key.indexOf("Elastic")>=0||o.key.indexOf("Solr")>=0;u.open({templateUrl:"js/angular/externalsync/templates/deleteConnector.html",controller:"DeleteConnectorCtrl",resolve:{type:function(){return o.key},isExternal:function(){return a}}}).result.then((function(i){e.setLoader(!0,"Deleting connector "+n.name,"This is usually a fast operation but it might take a while.");const s=function(e,n,t){const r=n.substring(0,n.length-1)+"/instance#";return"PREFIX prefix:<"+n+">\nINSERT DATA {\n\t<"+r+e+'> prefix:dropConnector "'+(t?"force":"")+'"\n}'}(n.name,o.value,i);p.addStatements(t.getActiveRepository(),r({update:s})).then((function(){g.getConnectors().then((function(){g.hasConnector(encodeURIComponent(o.value)).then((function(n){e.existing[o.key]=n.data}))})),i?(c.success("Deleted (with force) connector "+n.name),a&&c.warning("You may have to remove the index manually from "+o.key)):c.success("Deleted connector "+n.name)}),(function(e){c.error(getError(e))})).finally((function(){e.setLoader(!1)}))}))},e.viewQuery=function(n,t){u.open({templateUrl:"pages/viewQuery.html",controller:"ViewQueryCtrl",resolve:{query:function(){const r=e.getOptions(n);return s(t.name,n.value,o(t.values,r),r)}}})}}function c(e,n,t,r){e.force=!1,e.type=t,e.isExternal=r,e.ok=function(){n.close(e.force)},e.cancel=function(){n.dismiss()}}function l(e,n,t,r,o){function a(){return s(e.name,t.value,e.values,e.options,(function(e,n){o.error(n,e)}))}e.connector=t,e.addField=function(n,t){const r=angular.copy(e.defaultValues[t][0]);e.values[t].splice(n+1,0,r)},e.addOption=function(e,n){n.splice(e+1,0,"")},e.deleteOption=function(e,n){n.splice(e,1)},e.addMapOption=function(e,n){n.splice(e+1,0,{key:"",value:""})},e.deleteMapOption=function(e,n){n.splice(e,1)},e.ok=function(){if(e.form.$valid){const t=a();t&&n.close({name:e.name,values:e.values,options:e.options,query:t})}},e.viewQuery=function(){const e=a();e&&r.open({templateUrl:"pages/viewQuery.html",controller:"ViewQueryCtrl",resolve:{query:function(){return e}}})},e.cancel=function(){n.dismiss("cancel")}}function d(e,n,t,r,a,i,s,u){angular.extend(this,n("ExtendNewConnectorCtrl",{$scope:e,$modalInstance:r,connector:a,$modal:i})),e.values=s.values,e.options=u,e.name=s.name,s.skipConversion||(e.values=o(e.values,e.options)),e.defaultValues=angular.copy(e.values)}function p(e,n,t,r){function o(){const o=function(e){const n=e.replace(/\/instance#.+$/,"#connectorStatus");let t="";return t+="SELECT ?status {\n",t+="\t<"+e+"> <"+n+"> ?status",t+="\n}",t}(e.beingBuiltConnector.iri);e.beingBuiltConnector.iri=null,e.progressInterval=n((function(){(function(e){return a(t,r.getActiveRepository(),e)})(o).then((function(t){const r=function(e){if(e.bindings&&e.bindings.length>0)try{return JSON.parse(e.bindings[0].status.value)}catch(e){console.error(e)}return{}}(t.data.results);"BUILDING"===r.status?(e.beingBuiltConnector.status=r,e.beingBuiltConnector.percentDone=(100*r.processedEntities/r.estimatedEntities).toFixed(0),e.beingBuiltConnector.eta=e.getHumanReadableSeconds(r.etaSeconds),e.beingBuiltConnector.actionName=r.repair?"Repairing":"Creating",e.beingBuiltConnector.waitOnRepairStartOnce=!1):"BUILT"!==r.status||e.beingBuiltConnector.waitOnRepairStartOnce||(n.cancel(e.progressInterval),e.beingBuiltConnector.doneCallback&&e.beingBuiltConnector.doneCallback())}))}),1e3),e.$on("$destroy",(function(){n.cancel(e.progressInterval)}))}e.beingBuiltConnector=e.beingBuiltConnector||{},!e.beingBuiltConnector.inline&&e.beingBuiltConnector.iri&&o(),e.$watch("beingBuiltConnector.iri",(function(n){e.beingBuiltConnector.inline&&n&&o()}))}angular.module("graphdb.framework.externalsync.controllers",["graphdb.framework.rest.rdf4j.repositories.service","graphdb.framework.rest.connectors.service"]).controller("ConnectorsCtrl",u).controller("ExtendNewConnectorCtrl",l).controller("CreateConnectorCtrl",d).controller("CreateProgressCtrl",p).controller("DeleteConnectorCtrl",c).filter("ceil",(function(){return function(e){return Math.ceil(e)}})),u.$inject=["$scope","$http","$repositories","$modal","toastr","ModalService","$q","RDF4JRepositoriesRestService","ConnectorsRestService"],c.$inject=["$scope","$modalInstance","type","isExternal"],l.$inject=["$scope","$modalInstance","connector","$modal","toastr"],d.$inject=["$scope","$controller","$http","$modalInstance","connector","$modal","values","options"],p.$inject=["$scope","$interval","$http","$repositories"]},34:function(e,n,t){"use strict";t.r(n);t(29),t(4),t(32);var r=t(209),o=t.n(r),a=t(207),i=t.n(a);function s(e,n,t,r,a,s,u,c,l,d,p,g){let f;return{restrict:"AE",scope:!1,templateUrl:"js/angular/core/directives/queryeditor/templates/query-editor.html",link:function(m,y,C){m.nostorage=C.hasOwnProperty("nostorage"),m.notabs=C.hasOwnProperty("notabs"),m.notoolbar=C.hasOwnProperty("notoolbar"),m.notoolbarSaved=C.hasOwnProperty("notoolbarSaved"),m.notoolbarCopy=C.hasOwnProperty("notoolbarCopy"),m.notoolbarInference=C.hasOwnProperty("notoolbarInference"),m.notoolbarSameAs=C.hasOwnProperty("notoolbarSameAs"),m.nostatus=C.hasOwnProperty("nostatus"),m.norun=C.hasOwnProperty("norun"),m.runButtonName="Run",C.runButtonName&&(m.runButtonName=C.runButtonName);if(m.nocount="true"===C.nocount,C.callbackOnChange){const e=m[C.callbackOnChange];"function"==typeof e&&(f=e)}e((function(){!function(m){function y(){angular.element("#wb-sparql-saveQuery")[0].click()}function C(){m.runQuery(!1,!1)}function h(){m.runQuery(!1,!0)}function b(){if(m.tabs.length<2||!m.currentQuery.id||!m.isTabChangeOk(!1))return;let e=Q(m.currentQuery.id);e=(e+1)%m.tabs.length,w(m.tabs[e].id)}function T(){if(m.tabs.length<2||!m.currentQuery.id||!m.isTabChangeOk(!1))return;let e=Q(m.currentQuery.id);e--,-1===e&&(e=m.tabs.length-1),w(m.tabs[e].id)}function w(n){e((function(){let e=$('a[data-id = "'+n+'"]');0===e.length&&(e=$("a[data-id]").first()),e.tab("show")}),0)}m.changePagination=function(){m.runQuery(!0,m.explainRequested)},window.editor=o.a.fromTextArea(document.getElementById("query"),{persistent:null,value:"",indentUnit:4,createShareLink:null,cursorHeight:1,sparql:{showQueryButton:!1,acceptHeaderGraph:"application/x-graphdb-table-results+json, application/rdf+json;q=0.9, */*;q=0.8",acceptHeaderSelect:"application/x-sparqlstar-results+json, application/sparql-results+json;q=0.9, */*;q=0.8"},extraKeys:{"Ctrl-Enter":C,"Cmd-Enter":C,"Shift-Ctrl-Enter":h,"Shift-Cmd-Enter":h,"Ctrl-Alt-T":m.addNewTab,"Cmd-Alt-T":m.addNewTab,"Ctrl-S":y,"Cmd-S":y,"Ctrl-Alt-Left":T,"Cmd-Alt-Left":T,"Ctrl-Alt-Right":b,"Cmd-Alt-Right":b}}),window.editor.toastBuildIndex=function(){t.warning("",'<div class="autocomplete-toast"><a href="autocomplete">Autocomplete is OFF<br>Go to Setup -> Autocomplete</a></div>',{allowHtml:!0})},window.editor.toastError=function(e){t.error("Cannot execute autocomplete query. "+getError(e))},window.editor.on("changes",(function(){angular.element(".CodeMirror-linenumbers").css("width","1px"),angular.element(".CodeMirror-sizer").css("margin-left","0px"),clearTimeout(m.changesTimeout);const e=!window.editor.queryValid;m.changesTimeout=setTimeout(f?f():function(){const n=Q(m.currentQuery.id)+1;$('a[data-id = "'+n+'"]').toggleClass("query-has-error",e).attr("title",e?"Query contains a syntax error. See the relevant line for more information.":"")},200),m.currentQuery.query=window.editor.getValue(),m.currentQuery.queryType=window.editor.getQueryType()})),$(".fullscreenToggleBtns").hide();const v=function(e){$(e.target).removeClass("fa-link").addClass("fa-check").blur(),setTimeout((function(){$(e.target).removeClass("fa-check").addClass("fa-link")}),1e3)};window.onbeforeunload=function(){m.nostorage||p.set(g.TABS_STATE,m.tabs),m.saveTab(m.currentQuery.id)};const R=o.a.executeQuery,S=o.a.getUrlArguments;function x(e,n,t){return{status:e,statusText:n,responseText:t}}let A,E;m.$on("$destroy",(function(){m.nostorage||p.set(g.TABS_STATE,m.tabs),o.a.executeQuery=R,o.a.getUrlArguments=S,m.saveTab(m.currentQuery.id)})),o.a.drawButtons=function(e){e.buttons=$("#yasqe_buttons_mocked")},o.a.getActiveRepository=function(){return r.getActiveRepository()},o.a.getUrlArguments=function(e,n){const t=S(e,n),r=window.editor.getQueryType();return"SELECT"!==r&&"CONSTRUCT"!==r&&"DESCRIBE"!==r||(t.push({name:"limit",value:m.currentTabConfig.pageSize+1}),m.currentTabConfig.offset=(m.currentTabConfig.page-1)*m.currentTabConfig.pageSize+1,t.push({name:"offset",value:m.currentTabConfig.offset-1})),!m.explainRequested||"SELECT"!==r&&"CONSTRUCT"!==r||t.push({name:"explain",value:"true"}),t},o.a.executeQuery=function(e){if(E&&$(E.resultsContainer).length&&$(E.resultsContainer).empty(),e.options.sparql.headers["X-GraphDB-Catch"]=m.currentTabConfig.pageSize+"; throw",m.currentTrackAlias="query-editor-"+performance.now()+"-"+Date.now(),e.options.sparql.headers["X-GraphDB-Track-Alias"]=m.currentTrackAlias,m.countTimeouted=!1,"query"===e.getQueryMode()?e.options.sparql.endpoint="repositories/"+r.getActiveRepository():"update"===e.getQueryMode()&&(e.options.sparql.endpoint="repositories/"+r.getActiveRepository()+"/statements"),e.options.sparql.args=[{name:"infer",value:m.currentQuery.inference},{name:"sameAs",value:m.currentQuery.sameAs}],m.currentTabConfig.customUpdateMessage="","update"!==window.editor.getQueryMode()){const n=m.currentTabConfig,t=m.executedQueryTab.id;return window.editor.options.sparql.handlers.countCallback=function(e,r,o){if(200===e.status){const a=m.tabs[Q(t)];a&&(E.setResultsCount(e,r,o),n.allResultsCount=E.allCount,a.allResultsCount=E.allCount,n.allResultsCountExact=!0,a.allResultsCountExact=!0,m.saveTab(a.id))}else n.countTimeouted=!0},null!=m.currentQuery.outputType?E.options.output=m.currentQuery.outputType:E.options.output="table",m.currentTabConfig.queryType=window.editor.getQueryType(),m.queryStartTime=(new Date).getTime(),R(e,{setQueryLimit:function(e){return"CONSTRUCT"===m.currentTabConfig.queryType&&r.isActiveRepoOntopType()?window.editor.getValueWithoutComments():e}})}{const n=function(){m.currentTabConfig.queryType="UPDATE",l.getRepositorySize().success((function(n){return m.repoSize=parseInt(n),m.queryStartTime=(new Date).getTime(),R(e,{})})).error((function(n){return t.warning("Could not get repository size for: "+r.getActiveRepository()+"; "+getError(n)),m.queryStartTime=(new Date).getTime(),R(e,{})}))};d.checkConnector(window.editor.getValue()).then((function(e){if(e.data.command&&!e.data.hasSupport){m.currentTabConfig.queryType="ERROR",m.currentTabConfig.timeFinished=Date.now(),m.currentTabConfig.timeTook=(m.currentTabConfig.timeFinished-m.queryStartTime)/1e3;const n=x(-1,"No support for "+e.data.connectorName,e.data.connectorName+" connectors are not supported because the plugin "+e.data.pluginName+" is not active.");return E.results={getException:function(){return n}},m.setLoader(!1),void q({customError:n},"",null)}if("create"===e.data.command||"repair"===e.data.command){const n="repair"===e.data.command;n?(m.setLoader(!0,"Repairing connector "+e.data.name),m.currentTabConfig.customUpdateMessage="Repaired connector "+e.data.name+"."):(m.setLoader(!0,"Creating connector "+e.data.name),m.currentTabConfig.customUpdateMessage="Created connector "+e.data.name+".");const t=m.$new(!0);t.beingBuiltConnector={percentDone:0,status:{processedEntities:0,estimatedEntities:0,indexedEntities:0,entitiesPerSecond:0},actionName:n?"Repairing":"Creating",eta:"-",inline:!1,iri:e.data.iri,name:e.data.name,doneCallback:function(){A.dismiss("cancel")}},t.getHumanReadableSeconds=m.getHumanReadableSeconds,A=u.open({templateUrl:"pages/connectorProgress.html",controller:"CreateProgressCtrl",size:"lg",backdrop:"static",scope:t})}else"drop"===e.data.command&&(m.setLoader(!0,"Deleting connector "+e.data.name),m.currentTabConfig.customUpdateMessage="Deleted connector "+e.data.name+".");n()}),(function(){n()}))}};const k=o.a.getAjaxConfig;function q(e,n,t){e.getResponseHeader&&e.getResponseHeader("content-type")&&(e.contentType=e.getResponseHeader("content-type")),delete e.response;const r=Q(m.executedQueryTab.id),o=m.tabs[r],a={queryType:m.currentTabConfig.queryType,yasrData:e,textStatus:n,jqXhrOrErrorString:t,page:m.currentTabConfig.page,pageSize:m.currentTabConfig.pageSize,allResultsCount:m.currentTabConfig.allResultsCount,allResultsCountExact:m.currentTabConfig.allResultsCountExact,resultsCount:m.currentTabConfig.resultsCount,offset:m.currentTabConfig.offset,timeTook:m.currentTabConfig.timeTook,timeFinished:m.currentTabConfig.timeFinished,sizeDelta:m.currentTabConfig.sizeDelta,customUpdateMessage:m.currentTabConfig.customUpdateMessage,errorMessage:m.currentTabConfig.errorMessage,warningMessage:m.currentTabConfig.warningMessage};"ERROR"!==m.currentTabConfig.queryType&&"UPDATE"!==m.currentTabConfig.queryType&&"ASK"!==m.currentTabConfig.queryType&&(a.outputType=m.yasr.options.output),angular.extend(m.currentQuery,a),angular.extend(o,a),m.nostorage||p.set(g.TABS_STATE,m.tabs),$('a[data-id = "'+m.executedQueryTab.id+'"]').tab("show")}function Q(e){for(let n=0;n<m.tabs.length;n++){if(m.tabs[n].id===e)return n}}function O(e){return angular.isDefined(e)&&"false"!==e}function D(e,t,r){const o=m.getExistingTabId(e),a=m.$on("tabLoaded",(function(){angular.isDefined(t)&&(m.currentQuery.inference=O(t)),angular.isDefined(r)&&(m.currentQuery.sameAs=O(r)),O(n.search().execute)&&("update"===window.editor.getQueryMode()?s.openSimpleModal({title:"Confirm execute",message:"This is an update and it may change the data in the repository.<br>Are you sure you want to execute it automatically?",warning:!0}).result.then((function(){m.runQuery(!1)})):m.runQuery(!1)),a()}));m.highlightNextTabChange=!0,angular.isDefined(o)?w(o):m.addNewTab(null,e.name,e.body)}function B(){if(n.search().savedQueryName)e=n.search().savedQueryName,r=n.search().owner,o=n.search().infer,i=n.search().sameAs,a.getSavedQuery(e,r).success((function(e){D(e,o,i)})).error((function(n){t.error("Could not get data for saved query: "+e+"; "+getError(n))}));else if(n.search().query){D({name:n.search().name,body:n.search().query},n.search().infer,n.search().sameAs)}else{w(p.get(g.TABS_STATE_CURRENT_ID))}var e,r,o,i}function U(){m.getNamespaces(),o.a.signal(window.editor,"repositoryOrAuthorizationChanged",r.getActiveRepository(),c.getAuthToken()),B()}o.a.getAjaxConfig=function(e,n){const t=k(e,n);return _.extend(t.headers,{Authorization:c.getAuthToken()}),t},m.copyToClipboardQuery=function(e,n){s.openCopyToClipboardModal(function(e,n){let t=[location.protocol,"//",location.host,location.pathname].join("");e?(t=t+"?savedQueryName="+encodeURIComponent(e),null!=n&&(t+="&owner="+encodeURIComponent(n))):t=t+"?"+$.param({name:m.currentQuery.name,infer:m.currentQuery.inference,sameAs:m.currentQuery.sameAs,query:window.editor.getValue()});return t}(e,n))},m.copyToClipboardResult=function(e){s.openCopyToClipboardModal(e)},m.goToVisual=function(){const e={query:window.editor.getValue(),sameAs:m.currentQuery.sameAs,inference:m.currentQuery.inference};n.path("graphs-visualizations").search(e)},$("textarea").on("paste",(function(){e((function(){m.addKnownPrefixes()}),0)})),E=i()(document.getElementById("yasr"),{getUsedPrefixes:{},persistency:!1}),window.yasr=E,E.afterCopy=v,E.getQueryResultsAsFormat=function(e){const n=$("#wb-download");n.attr("action","repositories/"+r.getActiveRepository()),$("#wb-download-query").val(m.currentQuery.query),window.editor.getValue()!==m.currentQuery.query&&t.warning("The query in your editor does not match the query results. Download will save the results from the last executed query."),$("#wb-download-infer").val(m.currentQuery.inference),$("#wb-download-sameAs").val(m.currentQuery.sameAs);const o=localStorage.getItem("com.ontotext.graphdb.auth");o&&$("#wb-auth-token").val(o),$("#wb-download-accept").val(e),n.submit()},window.editor.options.sparql.handlers.complete=function(n,r,o){function a(){q(n,r,o)}if(A&&A.dismiss("cancel"),null===window.editor)return void m.setLoader(!1);if(m.currentTabConfig.errorMessage=n.getResponseHeader("X-GraphDB-Error"),m.currentTabConfig.warningMessage=n.getResponseHeader("X-GraphDB-Warning"),E.currentQuery=m.currentQuery,m.currentTabConfig.timeFinished=Date.now(),m.currentTabConfig.timeTook=(m.currentTabConfig.timeFinished-m.queryStartTime)/1e3,n.status>=400)return n.responseText=n.responseText.replace(/^([^: ]+: )+/,""),m.currentTabConfig.queryType="ERROR",a(),m.setYasrResponse(n,r,o),void m.setLoader(!1);if(0===n.status){m.currentTabConfig.queryType="ERROR";const e=x(-1,"Request was aborted","The request has been aborted. There are no results to show.");return E.results={getException:function(){return e}},m.setLoader(!1),void q({customError:e},"",null)}let i;if(m.setLoader(!1),"update"===window.editor.getQueryMode())i=function(){l.getRepositorySize().success((function(e){let n;void 0!==m.repoSize&&(n=Number(e)-m.repoSize),m.currentTabConfig.sizeDelta=n,a()})).error((function(e){t.warning("Could not get repository size for: "+m.getActiveRepository()+"; "+getError(e)),m.currentTabConfig.sizeDelta=void 0,a()}))};else{if(200===n.status){const e=n.getResponseHeader("Content-Type");0!==e.indexOf("application/sparql-results+json")&&0!==e.indexOf("application/x-sparqlstar-results+json")&&0!==e.indexOf("application/x-graphdb-table-results+json")||n.responseJSON.results&&(m.currentTabConfig.resultsCount=n.responseJSON.results.bindings.length,n.responseJSON.results.bindings.length>m.currentTabConfig.pageSize&&(n.responseJSON.results.bindings.length=m.currentTabConfig.pageSize),m.currentTabConfig.allResultsCountExact||((m.nocount||m.countTimeouted||m.currentTabConfig.resultsCount<=m.currentTabConfig.pageSize)&&(n.status=204),m.currentTabConfig.allResultsCount=Math.max(m.currentTabConfig.allResultsCount,m.currentTabConfig.pageSize*(m.currentTabConfig.page-1)+m.currentTabConfig.resultsCount),m.currentTabConfig.resultsCount<=m.currentTabConfig.pageSize&&(m.currentTabConfig.allResultsCountExact=!0)))}m.setLoader(!0,"Rendering results",null,!0),i=function(){m.setYasrResponse(n,r,o),a(),m.setLoader(!1)}}e((function(){i(),"CONSTRUCT"!==window.editor.getQueryType()?($(".yasr_btnGroup.nav.nav-tabs li a.disabled").removeClass("disabled").css("font-weight","400"),$(".yasr_btnGroup.nav.nav-tabs li.disabled a").addClass("disabled").css("font-weight","200"),"DESCRIBE"===window.editor.getQueryType()&&$(".yasr_btnGroup.nav.nav-tabs li a").removeClass("disabled").css("font-weight","400")):"CONSTRUCT"===window.editor.getQueryType()&&$(".yasr_btnGroup.nav.nav-tabs li a.disabled").removeClass("disabled").css("font-weight","400"),$("#yasr").css("padding","0"),$(".yasr_btnGroup li:nth-child(2)").hasClass("active")&&e((function(){$(".yasr_btnGroup li:nth-child(2) a").get(0).click()}),100),$("#wb-sparql-addNewTab").click((function(){$(".dataTables_filter").hide(),$(".resultsTable").hide()}))}),100)},window.editor.options.sparql.handlers.resetResults=function(){},m.yasr=E,m.setYasrResponse=function(e,n,t){e.responseJSON&&(e.response=e.responseJSON,e.responseText=void 0),E.setResponse(e,n,t)},m.$watch("yasr.options.output",(function(e){if(e&&"UPDATE"!==m.currentTabConfig.queryType&&"ASK"!==m.currentTabConfig.queryType){const n=m.tabs[Q(m.currentQuery.id)];angular.isDefined(n)&&m.currentTabConfig.queryType&&n.outputType!==e&&(n.outputType=m.currentQuery.outputType=e,m.saveTab(n.id))}})),void m.$watch("namespaces",(function(){m.namespaces&&(E&&E.options&&m.namespaces&&(E.options.getUsedPrefixes=m.namespaces),o.a.signal(window.editor,"namespacesChanged",m.namespaces))})),$(document).mouseup((function(e){const n=$("#sampleQueriesCollapse");!n.is(e.target)&&0===n.has(e.target).length&&m.showSampleQueries&&m.toggleSampleQueries()})),r.getActiveRepository()&&U();m.$on("repositoryIsSet",(function(){r.getActiveRepository()&&U()})),e((function(){angular.element(document).find(".CodeMirror textarea:first-child").focus()}),50)}(m)}),150)}}}angular.module("graphdb.framework.core.directives.queryeditor.queryeditor",["ngCookies","graphdb.framework.externalsync.controllers","graphdb.framework.rest.connectors.service","graphdb.framework.utils.localstorageadapter"]).directive("queryEditor",s),s.$inject=["$timeout","$location","toastr","$repositories","SparqlRestService","ModalService","$modal","$jwtAuth","RDF4JRepositoriesRestService","ConnectorsRestService","LocalStorageAdapter","LSKeys"]}}]);
//# sourceMappingURL=27.5089831daf42bf903e6c.bundle.js.map