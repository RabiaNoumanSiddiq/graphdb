(window.webpackJsonp=window.webpackJsonp||[]).push([[14,2,10,22,27,28,29,30,35,36,48,56,57,58,59,60,61,62,64,65,84,85,86,89,104],{205:function(e,t,n){"use strict";var r=r||{};r.Text=function(){function e(e,t,n,r){n=n||10;var o=t/3;return"string"==typeof e?(o*=10/(e.substring(0,t/3).length+1.5),o+=1,e.match(/[\u0900-\u0DFF\u1100-\u11FF\u2E80-\u2EFF\u3000-\u9FFF]/)&&(o*=.6),o<n&&(o=n),Math.round(o)):(o<n&&(o=n),Math.round(o))}return{calcFontSizeRaw:e,calcFontSize:function(t,n,r,o){return e(t,n,r)+"px"},getTextWithElipsisIfNeeded:function(e,t){return"string"==typeof e&&e.length>t?e.substring(0,t-3)+"...":e}}}(),r.Transition={fadeIn:function(e,t){e.style("opacity",0).transition().duration(t).style("opacity",1)},fadeOut:function(e,t){e.style("opacity",1).transition().duration(t).style("opacity",0)}},r.Click={delayDblClick:function(){var e=d3.dispatch("click","dblclick");return d3.rebind((function(t){var n,r=null;t.on("mousedown",(function(){n=d3.mouse(document.body),new Date})),t.on("mouseup",(function(t){var o,i;o=n,i=d3.mouse(document.body),Math.sqrt(Math.pow(o[0]-i[0],2),Math.pow(o[1]-i[1],2))>5||(r?(window.clearTimeout(r),r=null,e.dblclick(t)):r=window.setTimeout((d3.event,function(){e.click(t),r=null}),250))}))}),e,"on")}},t.a=r},206:function(e,t,n){"use strict";var r=r||{};r.Export={getCSSRules:function(e){var t=$('link[href="'+e+'"]')[0].sheet.rules,n="";return _.each(t,(function(e){n+=e.cssText})),n},generateBase64ImageSource:function(){var e=d3.selectAll("svg").attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg"}).node().parentNode.innerHTML;return"data:image/svg+xml;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(e)))}},t.a=r},208:function(e,t,n){var r,o,i;o=[],void 0===(i="function"==typeof(r=function(){return function(){var e=function(){return"n"},t=function(){return[0,0]},n=function(){return" "},r=f(),o=null,i=null,a=null,s=null;function u(e){var t;o="svg"===(t=(t=e).node()).tagName.toLowerCase()?t:t.ownerSVGElement,i=o.createSVGPoint(),document.body.appendChild(r)}u.show=function(){var r=Array.prototype.slice.call(arguments);r[r.length-1]instanceof SVGElement&&(a=r.pop());var o,i=n.apply(this,r),f=t.apply(this,r),p=e.apply(this,r),h=d(),g=l.length,y=document.documentElement.scrollTop||document.body.scrollTop,m=document.documentElement.scrollLeft||document.body.scrollLeft,v=s.apply(this,r);for(h.html(i).style({opacity:1,"pointer-events":"all"});g--;)h.classed(l[g],!1);return o=c.get(p).apply(this),v?h.style(v):h.classed(p,!0).style({top:o.top+f[0]+y+"px",left:o.left+f[1]+m+"px"}),u},u.hide=function(){return d().style({opacity:0,"pointer-events":"none"}),u},u.attr=function(e,t){if(arguments.length<2&&"string"==typeof e)return d().attr(e);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(d(),n),u},u.style=function(e,t){if(arguments.length<2&&"string"==typeof e)return d().style(e);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.style.apply(d(),n),u},u.direction=function(t){return arguments.length?(e=null==t?t:d3.functor(t),u):e},u.offset=function(e){return arguments.length?(t=null==e?e:d3.functor(e),u):t},u.html=function(e){return arguments.length?(n=null==e?e:d3.functor(e),u):n},u.customPosition=function(e){return arguments.length?(s=null==e?e:d3.functor(e),u):s},u.destroy=function(){return r&&(d().remove(),r=null),u};var c=d3.map({n:function(){var e=p();return{top:e.n.y-r.offsetHeight,left:e.n.x-r.offsetWidth/2}},s:function(){var e=p();return{top:e.s.y,left:e.s.x-r.offsetWidth/2}},e:function(){var e=p();return{top:e.e.y-r.offsetHeight/2,left:e.e.x}},w:function(){var e=p();return{top:e.w.y-r.offsetHeight/2,left:e.w.x-r.offsetWidth}},nw:function(){var e=p();return{top:e.nw.y-r.offsetHeight,left:e.nw.x-r.offsetWidth}},ne:function(){var e=p();return{top:e.ne.y-r.offsetHeight,left:e.ne.x}},sw:function(){var e=p();return{top:e.sw.y,left:e.sw.x-r.offsetWidth}},se:function(){var e=p();return{top:e.se.y,left:e.e.x}}}),l=c.keys();function f(){var e=d3.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function d(){return null===r&&(r=f(),document.body.appendChild(r)),d3.select(r)}function p(){for(var e=a||d3.event.target;void 0===e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var t={},n=e.getScreenCTM(),r=e.getBBox(),o=r.width,s=r.height,u=r.x,c=r.y;return i.x=u,i.y=c,t.nw=i.matrixTransform(n),i.x+=o,t.ne=i.matrixTransform(n),i.y+=s,t.se=i.matrixTransform(n),i.x-=o,t.sw=i.matrixTransform(n),i.y-=s/2,t.w=i.matrixTransform(n),i.x+=o,t.e=i.matrixTransform(n),i.x-=o/2,i.y-=s/2,t.n=i.matrixTransform(n),i.y+=s,t.s=i.matrixTransform(n),t}return u}})?r.apply(t,o):r)||(e.exports=i)},213:function(e,t,n){var r,o;!function(){var i={version:"3.5.12"},a=[].slice,s=function(e){return a.call(e)},u=this.document;function c(e){return e&&(e.ownerDocument||e.document||e).documentElement}function l(e){return e&&(e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView)}if(u)try{s(u.documentElement.childNodes)[0].nodeType}catch(e){s=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}if(Date.now||(Date.now=function(){return+new Date}),u)try{u.createElement("DIV").style.setProperty("opacity",0,"")}catch(e){var f=this.Element.prototype,d=f.setAttribute,p=f.setAttributeNS,h=this.CSSStyleDeclaration.prototype,g=h.setProperty;f.setAttribute=function(e,t){d.call(this,e,t+"")},f.setAttributeNS=function(e,t,n){p.call(this,e,t,n+"")},h.setProperty=function(e,t,n){g.call(this,e,t+"",n)}}function y(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function m(e){return null===e?NaN:+e}function v(e){return!isNaN(e)}function x(e){return{left:function(t,n,r,o){for(arguments.length<3&&(r=0),arguments.length<4&&(o=t.length);r<o;){var i=r+o>>>1;e(t[i],n)<0?r=i+1:o=i}return r},right:function(t,n,r,o){for(arguments.length<3&&(r=0),arguments.length<4&&(o=t.length);r<o;){var i=r+o>>>1;e(t[i],n)>0?o=i:r=i+1}return r}}}i.ascending=y,i.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},i.min=function(e,t){var n,r,o=-1,i=e.length;if(1===arguments.length){for(;++o<i;)if(null!=(r=e[o])&&r>=r){n=r;break}for(;++o<i;)null!=(r=e[o])&&n>r&&(n=r)}else{for(;++o<i;)if(null!=(r=t.call(e,e[o],o))&&r>=r){n=r;break}for(;++o<i;)null!=(r=t.call(e,e[o],o))&&n>r&&(n=r)}return n},i.max=function(e,t){var n,r,o=-1,i=e.length;if(1===arguments.length){for(;++o<i;)if(null!=(r=e[o])&&r>=r){n=r;break}for(;++o<i;)null!=(r=e[o])&&r>n&&(n=r)}else{for(;++o<i;)if(null!=(r=t.call(e,e[o],o))&&r>=r){n=r;break}for(;++o<i;)null!=(r=t.call(e,e[o],o))&&r>n&&(n=r)}return n},i.extent=function(e,t){var n,r,o,i=-1,a=e.length;if(1===arguments.length){for(;++i<a;)if(null!=(r=e[i])&&r>=r){n=o=r;break}for(;++i<a;)null!=(r=e[i])&&(n>r&&(n=r),o<r&&(o=r))}else{for(;++i<a;)if(null!=(r=t.call(e,e[i],i))&&r>=r){n=o=r;break}for(;++i<a;)null!=(r=t.call(e,e[i],i))&&(n>r&&(n=r),o<r&&(o=r))}return[n,o]},i.sum=function(e,t){var n,r=0,o=e.length,i=-1;if(1===arguments.length)for(;++i<o;)v(n=+e[i])&&(r+=n);else for(;++i<o;)v(n=+t.call(e,e[i],i))&&(r+=n);return r},i.mean=function(e,t){var n,r=0,o=e.length,i=-1,a=o;if(1===arguments.length)for(;++i<o;)v(n=m(e[i]))?r+=n:--a;else for(;++i<o;)v(n=m(t.call(e,e[i],i)))?r+=n:--a;if(a)return r/a},i.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),o=+e[r-1],i=n-r;return i?o+i*(e[r]-o):o},i.median=function(e,t){var n,r=[],o=e.length,a=-1;if(1===arguments.length)for(;++a<o;)v(n=m(e[a]))&&r.push(n);else for(;++a<o;)v(n=m(t.call(e,e[a],a)))&&r.push(n);if(r.length)return i.quantile(r.sort(y),.5)},i.variance=function(e,t){var n,r,o=e.length,i=0,a=0,s=-1,u=0;if(1===arguments.length)for(;++s<o;)v(n=m(e[s]))&&(a+=(r=n-i)*(n-(i+=r/++u)));else for(;++s<o;)v(n=m(t.call(e,e[s],s)))&&(a+=(r=n-i)*(n-(i+=r/++u)));if(u>1)return a/(u-1)},i.deviation=function(){var e=i.variance.apply(this,arguments);return e?Math.sqrt(e):e};var w=x(y);function b(e){return e.length}i.bisectLeft=w.left,i.bisect=i.bisectRight=w.right,i.bisector=function(e){return x(1===e.length?function(t,n){return y(e(t),n)}:e)},i.shuffle=function(e,t,n){(i=arguments.length)<3&&(n=e.length,i<2&&(t=0));for(var r,o,i=n-t;i;)o=Math.random()*i--|0,r=e[i+t],e[i+t]=e[o+t],e[o+t]=r;return e},i.permute=function(e,t){for(var n=t.length,r=new Array(n);n--;)r[n]=e[t[n]];return r},i.pairs=function(e){for(var t=0,n=e.length-1,r=e[0],o=new Array(n<0?0:n);t<n;)o[t]=[r,r=e[++t]];return o},i.zip=function(){if(!(r=arguments.length))return[];for(var e=-1,t=i.min(arguments,b),n=new Array(t);++e<t;)for(var r,o=-1,a=n[e]=new Array(r);++o<r;)a[o]=arguments[o][e];return n},i.transpose=function(e){return i.zip.apply(i,e)},i.keys=function(e){var t=[];for(var n in e)t.push(n);return t},i.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},i.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},i.merge=function(e){for(var t,n,r,o=e.length,i=-1,a=0;++i<o;)a+=e[i].length;for(n=new Array(a);--o>=0;)for(t=(r=e[o]).length;--t>=0;)n[--a]=r[t];return n};var C=Math.abs;function S(e){for(var t=1;e*t%1;)t*=10;return t}function M(e,t){for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}function E(){this._=Object.create(null)}i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var r,o=[],i=S(C(n)),a=-1;if(e*=i,t*=i,(n*=i)<0)for(;(r=e+n*++a)>t;)o.push(r/i);else for(;(r=e+n*++a)<t;)o.push(r/i);return o},i.map=function(e,t){var n=new E;if(e instanceof E)e.forEach((function(e,t){n.set(e,t)}));else if(Array.isArray(e)){var r,o=-1,i=e.length;if(1===arguments.length)for(;++o<i;)n.set(o,e[o]);else for(;++o<i;)n.set(t.call(e,r=e[o],o),r)}else for(var a in e)n.set(a,e[a]);return n};var _="__proto__",T="\0";function R(e){return(e+="")===_||e[0]===T?T+e:e}function k(e){return(e+="")[0]===T?e.slice(1):e}function A(e){return R(e)in this._}function I(e){return(e=R(e))in this._&&delete this._[e]}function N(){var e=[];for(var t in this._)e.push(k(t));return e}function L(){var e=0;for(var t in this._)++e;return e}function $(){for(var e in this._)return!1;return!0}function D(){this._=Object.create(null)}function P(e){return e}function q(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function O(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var n=0,r=U.length;n<r;++n){var o=U[n]+t;if(o in e)return o}}M(E,{has:A,get:function(e){return this._[R(e)]},set:function(e,t){return this._[R(e)]=t},remove:I,keys:N,values:function(){var e=[];for(var t in this._)e.push(this._[t]);return e},entries:function(){var e=[];for(var t in this._)e.push({key:k(t),value:this._[t]});return e},size:L,empty:$,forEach:function(e){for(var t in this._)e.call(this,k(t),this._[t])}}),i.nest=function(){var e,t,n={},r=[],o=[];function a(o,i,s){if(s>=r.length)return t?t.call(n,i):e?i.sort(e):i;for(var u,c,l,f,d=-1,p=i.length,h=r[s++],g=new E;++d<p;)(f=g.get(u=h(c=i[d])))?f.push(c):g.set(u,[c]);return o?(c=o(),l=function(e,t){c.set(e,a(o,t,s))}):(c={},l=function(e,t){c[e]=a(o,t,s)}),g.forEach(l),c}return n.map=function(e,t){return a(t,e,0)},n.entries=function(e){return function e(t,n){if(n>=r.length)return t;var i=[],a=o[n++];return t.forEach((function(t,r){i.push({key:t,values:e(r,n)})})),a?i.sort((function(e,t){return a(e.key,t.key)})):i}(a(i.map,e,0),0)},n.key=function(e){return r.push(e),n},n.sortKeys=function(e){return o[r.length-1]=e,n},n.sortValues=function(t){return e=t,n},n.rollup=function(e){return t=e,n},n},i.set=function(e){var t=new D;if(e)for(var n=0,r=e.length;n<r;++n)t.add(e[n]);return t},M(D,{has:A,add:function(e){return this._[R(e+="")]=!0,e},remove:I,values:N,size:L,empty:$,forEach:function(e){for(var t in this._)e.call(this,k(t))}}),i.behavior={},i.rebind=function(e,t){for(var n,r=1,o=arguments.length;++r<o;)e[n=arguments[r]]=q(e,t,t[n]);return e};var U=["webkit","ms","moz","Moz","o","O"];function j(){}function z(){}function Q(e){var t=[],n=new E;function r(){for(var n,r=t,o=-1,i=r.length;++o<i;)(n=r[o].on)&&n.apply(this,arguments);return e}return r.on=function(r,o){var i,a=n.get(r);return arguments.length<2?a&&a.on:(a&&(a.on=null,t=t.slice(0,i=t.indexOf(a)).concat(t.slice(i+1)),n.remove(r)),o&&t.push(n.set(r,{on:o})),e)},r}function H(){i.event.preventDefault()}function F(){for(var e,t=i.event;e=t.sourceEvent;)t=e;return t}function G(e){for(var t=new z,n=0,r=arguments.length;++n<r;)t[arguments[n]]=Q(t);return t.of=function(n,r){return function(o){try{var a=o.sourceEvent=i.event;o.target=e,i.event=o,t[o.type].apply(n,r)}finally{i.event=a}}},t}i.dispatch=function(){for(var e=new z,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=Q(e);return e},z.prototype.on=function(e,t){var n=e.indexOf("."),r="";if(n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(r,null);return this}},i.event=null,i.requote=function(e){return e.replace(B,"\\$&")};var B=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,V={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};function Y(e){return V(e,K),e}var W=function(e,t){return t.querySelector(e)},X=function(e,t){return t.querySelectorAll(e)},Z=function(e,t){var n=e.matches||e[O(e,"matchesSelector")];return(Z=function(e,t){return n.call(e,t)})(e,t)};"function"==typeof Sizzle&&(W=function(e,t){return Sizzle(e,t)[0]||null},X=Sizzle,Z=Sizzle.matchesSelector),i.selection=function(){return i.select(u.documentElement)};var K=i.selection.prototype=[];function J(e){return"function"==typeof e?e:function(){return W(e,this)}}function ee(e){return"function"==typeof e?e:function(){return X(e,this)}}K.select=function(e){var t,n,r,o,i=[];e=J(e);for(var a=-1,s=this.length;++a<s;){i.push(t=[]),t.parentNode=(r=this[a]).parentNode;for(var u=-1,c=r.length;++u<c;)(o=r[u])?(t.push(n=e.call(o,o.__data__,u,a)),n&&"__data__"in o&&(n.__data__=o.__data__)):t.push(null)}return Y(i)},K.selectAll=function(e){var t,n,r=[];e=ee(e);for(var o=-1,i=this.length;++o<i;)for(var a=this[o],u=-1,c=a.length;++u<c;)(n=a[u])&&(r.push(t=s(e.call(n,n.__data__,u,o))),t.parentNode=n);return Y(r)};var te={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ne(e,t){return e=i.ns.qualify(e),null==t?e.local?function(){this.removeAttributeNS(e.space,e.local)}:function(){this.removeAttribute(e)}:"function"==typeof t?e.local?function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}:function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}:e.local?function(){this.setAttributeNS(e.space,e.local,t)}:function(){this.setAttribute(e,t)}}function re(e){return e.trim().replace(/\s+/g," ")}function oe(e){return new RegExp("(?:^|\\s+)"+i.requote(e)+"(?:\\s+|$)","g")}function ie(e){return(e+"").trim().split(/^|\s+/)}function ae(e,t){var n=(e=ie(e).map(se)).length;return"function"==typeof t?function(){for(var r=-1,o=t.apply(this,arguments);++r<n;)e[r](this,o)}:function(){for(var r=-1;++r<n;)e[r](this,t)}}function se(e){var t=oe(e);return function(n,r){if(o=n.classList)return r?o.add(e):o.remove(e);var o=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(o)||n.setAttribute("class",re(o+" "+e))):n.setAttribute("class",re(o.replace(t," ")))}}function ue(e,t,n){return null==t?function(){this.style.removeProperty(e)}:"function"==typeof t?function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}:function(){this.style.setProperty(e,t,n)}}function ce(e,t){return null==t?function(){delete this[e]}:"function"==typeof t?function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}:function(){this[e]=t}}function le(e){return"function"==typeof e?e:(e=i.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)}:function(){var t=this.ownerDocument,n=this.namespaceURI;return n?t.createElementNS(n,e):t.createElement(e)}}function fe(){var e=this.parentNode;e&&e.removeChild(this)}function de(e){return{__data__:e}}function pe(e){return function(){return Z(this,e)}}function he(e){return arguments.length||(e=y),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function ge(e,t){for(var n=0,r=e.length;n<r;n++)for(var o,i=e[n],a=0,s=i.length;a<s;a++)(o=i[a])&&t(o,a,n);return e}function ye(e){return V(e,me),e}i.ns={prefix:te,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&"xmlns"!==(n=e.slice(0,t))&&(e=e.slice(t+1)),te.hasOwnProperty(n)?{space:te[n],local:e}:e}},K.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return(e=i.ns.qualify(e)).local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(ne(t,e[t]));return this}return this.each(ne(e,t))},K.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),r=(e=ie(e)).length,o=-1;if(t=n.classList){for(;++o<r;)if(!t.contains(e[o]))return!1}else for(t=n.getAttribute("class");++o<r;)if(!oe(e[o]).test(t))return!1;return!0}for(t in e)this.each(ae(t,e[t]));return this}return this.each(ae(e,t))},K.style=function(e,t,n){var r=arguments.length;if(r<3){if("string"!=typeof e){for(n in r<2&&(t=""),e)this.each(ue(n,e[n],t));return this}if(r<2){var o=this.node();return l(o).getComputedStyle(o,null).getPropertyValue(e)}n=""}return this.each(ue(e,t,n))},K.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(ce(t,e[t]));return this}return this.each(ce(e,t))},K.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},K.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},K.append=function(e){return e=le(e),this.select((function(){return this.appendChild(e.apply(this,arguments))}))},K.insert=function(e,t){return e=le(e),t=J(t),this.select((function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)}))},K.remove=function(){return this.each(fe)},K.data=function(e,t){var n,r,o=-1,i=this.length;if(!arguments.length){for(e=new Array(i=(n=this[0]).length);++o<i;)(r=n[o])&&(e[o]=r.__data__);return e}function a(e,n){var r,o,i,a=e.length,l=n.length,f=Math.min(a,l),d=new Array(l),p=new Array(l),h=new Array(a);if(t){var g,y=new E,m=new Array(a);for(r=-1;++r<a;)(o=e[r])&&(y.has(g=t.call(o,o.__data__,r))?h[r]=o:y.set(g,o),m[r]=g);for(r=-1;++r<l;)(o=y.get(g=t.call(n,i=n[r],r)))?!0!==o&&(d[r]=o,o.__data__=i):p[r]=de(i),y.set(g,!0);for(r=-1;++r<a;)r in m&&!0!==y.get(m[r])&&(h[r]=e[r])}else{for(r=-1;++r<f;)o=e[r],i=n[r],o?(o.__data__=i,d[r]=o):p[r]=de(i);for(;r<l;++r)p[r]=de(n[r]);for(;r<a;++r)h[r]=e[r]}p.update=d,p.parentNode=d.parentNode=h.parentNode=e.parentNode,s.push(p),u.push(d),c.push(h)}var s=ye([]),u=Y([]),c=Y([]);if("function"==typeof e)for(;++o<i;)a(n=this[o],e.call(n,n.parentNode.__data__,o));else for(;++o<i;)a(n=this[o],e);return u.enter=function(){return s},u.exit=function(){return c},u},K.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},K.filter=function(e){var t,n,r,o=[];"function"!=typeof e&&(e=pe(e));for(var i=0,a=this.length;i<a;i++){o.push(t=[]),t.parentNode=(n=this[i]).parentNode;for(var s=0,u=n.length;s<u;s++)(r=n[s])&&e.call(r,r.__data__,s,i)&&t.push(r)}return Y(o)},K.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,r=this[e],o=r.length-1,i=r[o];--o>=0;)(n=r[o])&&(i&&i!==n.nextSibling&&i.parentNode.insertBefore(n,i),i=n);return this},K.sort=function(e){e=he.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},K.each=function(e){return ge(this,(function(t,n,r){e.call(t,t.__data__,n,r)}))},K.call=function(e){var t=s(arguments);return e.apply(t[0]=this,t),this},K.empty=function(){return!this.node()},K.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],r=0,o=n.length;r<o;r++){var i=n[r];if(i)return i}return null},K.size=function(){var e=0;return ge(this,(function(){++e})),e};var me=[];function ve(e){var t,n;return function(r,o,i){var a,s=e[i].update,u=s.length;for(i!=n&&(n=i,t=0),o>=t&&(t=o+1);!(a=s[t])&&++t<u;);return a}}function xe(e,t,n){var r="__on"+e,o=e.indexOf("."),a=be;o>0&&(e=e.slice(0,o));var u=we.get(e);function c(){var t=this[r];t&&(this.removeEventListener(e,t,t.$),delete this[r])}return u&&(e=u,a=Ce),o?t?function(){var o=a(t,s(arguments));c.call(this),this.addEventListener(e,this[r]=o,o.$=n),o._=t}:c:t?j:function(){var t,n=new RegExp("^__on([^.]+)"+i.requote(e)+"$");for(var r in this)if(t=r.match(n)){var o=this[r];this.removeEventListener(t[1],o,o.$),delete this[r]}}}i.selection.enter=ye,i.selection.enter.prototype=me,me.append=K.append,me.empty=K.empty,me.node=K.node,me.call=K.call,me.size=K.size,me.select=function(e){for(var t,n,r,o,i,a=[],s=-1,u=this.length;++s<u;){r=(o=this[s]).update,a.push(t=[]),t.parentNode=o.parentNode;for(var c=-1,l=o.length;++c<l;)(i=o[c])?(t.push(r[c]=n=e.call(o.parentNode,i.__data__,c,s)),n.__data__=i.__data__):t.push(null)}return Y(a)},me.insert=function(e,t){return arguments.length<2&&(t=ve(this)),K.insert.call(this,e,t)},i.select=function(e){var t;return"string"==typeof e?(t=[W(e,u)]).parentNode=u.documentElement:(t=[e]).parentNode=c(e),Y([t])},i.selectAll=function(e){var t;return"string"==typeof e?(t=s(X(e,u))).parentNode=u.documentElement:(t=s(e)).parentNode=null,Y([t])},K.on=function(e,t,n){var r=arguments.length;if(r<3){if("string"!=typeof e){for(n in r<2&&(t=!1),e)this.each(xe(n,e[n],t));return this}if(r<2)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(xe(e,t,n))};var we=i.map({mouseenter:"mouseover",mouseleave:"mouseout"});function be(e,t){return function(n){var r=i.event;i.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{i.event=r}}}function Ce(e,t){var n=be(e,t);return function(e){var t=e.relatedTarget;t&&(t===this||8&t.compareDocumentPosition(this))||n.call(this,e)}}u&&we.forEach((function(e){"on"+e in u&&we.remove(e)}));var Se,Me=0;function Ee(e){var t=".dragsuppress-"+ ++Me,n="click"+t,r=i.select(l(e)).on("touchmove"+t,H).on("dragstart"+t,H).on("selectstart"+t,H);if(null==Se&&(Se=!("onselectstart"in e)&&O(e.style,"userSelect")),Se){var o=c(e).style,a=o[Se];o[Se]="none"}return function(e){if(r.on(t,null),Se&&(o[Se]=a),e){var i=function(){r.on(n,null)};r.on(n,(function(){H(),i()}),!0),setTimeout(i,0)}}}i.mouse=function(e){return Te(e,F())};var _e=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function Te(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(_e<0){var o=l(e);if(o.scrollX||o.scrollY){var a=(n=i.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM();_e=!(a.f||a.e),n.remove()}}return _e?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function Re(){return i.event.changedTouches[0].identifier}i.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=F().changedTouches),t)for(var r,o=0,i=t.length;o<i;++o)if((r=t[o]).identifier===n)return Te(e,r)},i.behavior.drag=function(){var e=G(o,"drag","dragstart","dragend"),t=null,n=a(j,i.mouse,l,"mousemove","mouseup"),r=a(Re,i.touch,P,"touchmove","touchend");function o(){this.on("mousedown.drag",n).on("touchstart.drag",r)}function a(n,r,o,a,s){return function(){var u,c=this,l=i.event.target,f=c.parentNode,d=e.of(c,arguments),p=0,h=n(),g=".drag"+(null==h?"":"-"+h),y=i.select(o(l)).on(a+g,x).on(s+g,w),m=Ee(l),v=r(f,h);function x(){var e,t,n=r(f,h);n&&(e=n[0]-v[0],t=n[1]-v[1],p|=e|t,v=n,d({type:"drag",x:n[0]+u[0],y:n[1]+u[1],dx:e,dy:t}))}function w(){r(f,h)&&(y.on(a+g,null).on(s+g,null),m(p),d({type:"dragend"}))}u=t?[(u=t.apply(c,arguments)).x-v[0],u.y-v[1]]:[0,0],d({type:"dragstart"})}}return o.origin=function(e){return arguments.length?(t=e,o):t},i.rebind(o,e,"on")},i.touches=function(e,t){return arguments.length<2&&(t=F().touches),t?s(t).map((function(t){var n=Te(e,t);return n.identifier=t.identifier,n})):[]};var ke=1e-6,Ae=ke*ke,Ie=Math.PI,Ne=2*Ie,Le=Ne-ke,$e=Ie/2,De=Ie/180,Pe=180/Ie;function qe(e){return e>0?1:e<0?-1:0}function Oe(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function Ue(e){return e>1?0:e<-1?Ie:Math.acos(e)}function je(e){return e>1?$e:e<-1?-$e:Math.asin(e)}function ze(e){return((e=Math.exp(e))+1/e)/2}function Qe(e){return(e=Math.sin(e/2))*e}var He=Math.SQRT2;i.interpolateZoom=function(e,t){var n,r,o=e[0],i=e[1],a=e[2],s=t[0],u=t[1],c=t[2],l=s-o,f=u-i,d=l*l+f*f;if(d<Ae)r=Math.log(c/a)/He,n=function(e){return[o+e*l,i+e*f,a*Math.exp(He*e*r)]};else{var p=Math.sqrt(d),h=(c*c-a*a+4*d)/(2*a*2*p),g=(c*c-a*a-4*d)/(2*c*2*p),y=Math.log(Math.sqrt(h*h+1)-h),m=Math.log(Math.sqrt(g*g+1)-g);r=(m-y)/He,n=function(e){var t,n=e*r,s=ze(y),u=a/(2*p)*(s*(t=He*n+y,((t=Math.exp(2*t))-1)/(t+1))-function(e){return((e=Math.exp(e))-1/e)/2}(y));return[o+u*l,i+u*f,a*s/ze(He*n+y)]}}return n.duration=1e3*r,n},i.behavior.zoom=function(){var e,t,n,r,o,a,s,c,f,d={x:0,y:0,k:1},p=[960,500],h=Be,g=250,y=0,m="mousedown.zoom",v="mousemove.zoom",x="mouseup.zoom",w="touchstart.zoom",b=G(C,"zoomstart","zoom","zoomend");function C(e){e.on(m,I).on(Ge+".zoom",L).on("dblclick.zoom",$).on(w,N)}function S(e){return[(e[0]-d.x)/d.k,(e[1]-d.y)/d.k]}function M(e){d.k=Math.max(h[0],Math.min(h[1],e))}function E(e,t){t=function(e){return[e[0]*d.k+d.x,e[1]*d.k+d.y]}(t),d.x+=e[0]-t[0],d.y+=e[1]-t[1]}function _(e,n,r,o){e.__chart__={x:d.x,y:d.y,k:d.k},M(Math.pow(2,o)),E(t=n,r),e=i.select(e),g>0&&(e=e.transition().duration(g)),e.call(C.event)}function T(){s&&s.domain(a.range().map((function(e){return(e-d.x)/d.k})).map(a.invert)),f&&f.domain(c.range().map((function(e){return(e-d.y)/d.k})).map(c.invert))}function R(e){y++||e({type:"zoomstart"})}function k(e){T(),e({type:"zoom",scale:d.k,translate:[d.x,d.y]})}function A(e){--y||(e({type:"zoomend"}),t=null)}function I(){var e=this,t=b.of(e,arguments),n=0,r=i.select(l(e)).on(v,(function(){n=1,E(i.mouse(e),o),k(t)})).on(x,(function(){r.on(v,null).on(x,null),a(n),A(t)})),o=S(i.mouse(e)),a=Ee(e);_s.call(e),R(t)}function N(){var e,t=this,n=b.of(t,arguments),r={},a=0,s=".zoom-"+i.event.changedTouches[0].identifier,u="touchmove"+s,c="touchend"+s,l=[],f=i.select(t),p=Ee(t);function h(){var n=i.touches(t);return e=d.k,n.forEach((function(e){e.identifier in r&&(r[e.identifier]=S(e))})),n}function g(){var e=i.event.target;i.select(e).on(u,y).on(c,v),l.push(e);for(var n=i.event.changedTouches,s=0,f=n.length;s<f;++s)r[n[s].identifier]=null;var p=h(),g=Date.now();if(1===p.length){if(g-o<500){var m=p[0];_(t,m,r[m.identifier],Math.floor(Math.log(d.k)/Math.LN2)+1),H()}o=g}else if(p.length>1){m=p[0];var x=p[1],w=m[0]-x[0],b=m[1]-x[1];a=w*w+b*b}}function y(){var s,u,c,l,f=i.touches(t);_s.call(t);for(var d=0,p=f.length;d<p;++d,l=null)if(c=f[d],l=r[c.identifier]){if(u)break;s=c,u=l}if(l){var h=(h=c[0]-s[0])*h+(h=c[1]-s[1])*h,g=a&&Math.sqrt(h/a);s=[(s[0]+c[0])/2,(s[1]+c[1])/2],u=[(u[0]+l[0])/2,(u[1]+l[1])/2],M(g*e)}o=null,E(s,u),k(n)}function v(){if(i.event.touches.length){for(var e=i.event.changedTouches,t=0,o=e.length;t<o;++t)delete r[e[t].identifier];for(var a in r)return void h()}i.selectAll(l).on(s,null),f.on(m,I).on(w,N),p(),A(n)}g(),R(n),f.on(m,null).on(w,g)}function L(){var o=b.of(this,arguments);r?clearTimeout(r):(_s.call(this),e=S(t=n||i.mouse(this)),R(o)),r=setTimeout((function(){r=null,A(o)}),50),H(),M(Math.pow(2,.002*Fe())*d.k),E(t,e),k(o)}function $(){var e=i.mouse(this),t=Math.log(d.k)/Math.LN2;_(this,e,S(e),i.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}return Ge||(Ge="onwheel"in u?(Fe=function(){return-i.event.deltaY*(i.event.deltaMode?120:1)},"wheel"):"onmousewheel"in u?(Fe=function(){return i.event.wheelDelta},"mousewheel"):(Fe=function(){return-i.event.detail},"MozMousePixelScroll")),C.event=function(e){e.each((function(){var e=b.of(this,arguments),n=d;ks?i.select(this).transition().each("start.zoom",(function(){d=this.__chart__||{x:0,y:0,k:1},R(e)})).tween("zoom:zoom",(function(){var r=p[0],o=p[1],a=t?t[0]:r/2,s=t?t[1]:o/2,u=i.interpolateZoom([(a-d.x)/d.k,(s-d.y)/d.k,r/d.k],[(a-n.x)/n.k,(s-n.y)/n.k,r/n.k]);return function(t){var n=u(t),o=r/n[2];this.__chart__=d={x:a-n[0]*o,y:s-n[1]*o,k:o},k(e)}})).each("interrupt.zoom",(function(){A(e)})).each("end.zoom",(function(){A(e)})):(this.__chart__=d,R(e),k(e),A(e))}))},C.translate=function(e){return arguments.length?(d={x:+e[0],y:+e[1],k:d.k},T(),C):[d.x,d.y]},C.scale=function(e){return arguments.length?(d={x:d.x,y:d.y,k:null},M(+e),T(),C):d.k},C.scaleExtent=function(e){return arguments.length?(h=null==e?Be:[+e[0],+e[1]],C):h},C.center=function(e){return arguments.length?(n=e&&[+e[0],+e[1]],C):n},C.size=function(e){return arguments.length?(p=e&&[+e[0],+e[1]],C):p},C.duration=function(e){return arguments.length?(g=+e,C):g},C.x=function(e){return arguments.length?(s=e,a=e.copy(),d={x:0,y:0,k:1},C):s},C.y=function(e){return arguments.length?(f=e,c=e.copy(),d={x:0,y:0,k:1},C):f},i.rebind(C,b,"on")};var Fe,Ge,Be=[0,1/0];function Ve(){}function Ye(e,t,n){return this instanceof Ye?(this.h=+e,this.s=+t,void(this.l=+n)):arguments.length<2?e instanceof Ye?new Ye(e.h,e.s,e.l):yt(""+e,mt,Ye):new Ye(e,t,n)}i.color=Ve,Ve.prototype.toString=function(){return this.rgb()+""},i.hsl=Ye;var We=Ye.prototype=new Ve;function Xe(e,t,n){var r,o;function i(e){return Math.round(255*function(e){return e>360?e-=360:e<0&&(e+=360),e<60?r+(o-r)*e/60:e<180?o:e<240?r+(o-r)*(240-e)/60:r}(e))}return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,r=2*(n=n<0?0:n>1?1:n)-(o=n<=.5?n*(1+t):n+t-n*t),new ft(i(e+120),i(e),i(e-120))}function Ze(e,t,n){return this instanceof Ze?(this.h=+e,this.c=+t,void(this.l=+n)):arguments.length<2?e instanceof Ze?new Ze(e.h,e.c,e.l):st(e instanceof et?e.l:(e=vt((e=i.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new Ze(e,t,n)}We.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new Ye(this.h,this.s,this.l/e)},We.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new Ye(this.h,this.s,e*this.l)},We.rgb=function(){return Xe(this.h,this.s,this.l)},i.hcl=Ze;var Ke=Ze.prototype=new Ve;function Je(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new et(n,Math.cos(e*=De)*t,Math.sin(e)*t)}function et(e,t,n){return this instanceof et?(this.l=+e,this.a=+t,void(this.b=+n)):arguments.length<2?e instanceof et?new et(e.l,e.a,e.b):e instanceof Ze?Je(e.h,e.c,e.l):vt((e=ft(e)).r,e.g,e.b):new et(e,t,n)}Ke.brighter=function(e){return new Ze(this.h,this.c,Math.min(100,this.l+tt*(arguments.length?e:1)))},Ke.darker=function(e){return new Ze(this.h,this.c,Math.max(0,this.l-tt*(arguments.length?e:1)))},Ke.rgb=function(){return Je(this.h,this.c,this.l).rgb()},i.lab=et;var tt=18,nt=.95047,rt=1,ot=1.08883,it=et.prototype=new Ve;function at(e,t,n){var r=(e+16)/116,o=r+t/500,i=r-n/200;return new ft(lt(3.2404542*(o=ut(o)*nt)-1.5371385*(r=ut(r)*rt)-.4985314*(i=ut(i)*ot)),lt(-.969266*o+1.8760108*r+.041556*i),lt(.0556434*o-.2040259*r+1.0572252*i))}function st(e,t,n){return e>0?new Ze(Math.atan2(n,t)*Pe,Math.sqrt(t*t+n*n),e):new Ze(NaN,NaN,e)}function ut(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function ct(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function lt(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function ft(e,t,n){return this instanceof ft?(this.r=~~e,this.g=~~t,void(this.b=~~n)):arguments.length<2?e instanceof ft?new ft(e.r,e.g,e.b):yt(""+e,ft,Xe):new ft(e,t,n)}function dt(e){return new ft(e>>16,e>>8&255,255&e)}function pt(e){return dt(e)+""}it.brighter=function(e){return new et(Math.min(100,this.l+tt*(arguments.length?e:1)),this.a,this.b)},it.darker=function(e){return new et(Math.max(0,this.l-tt*(arguments.length?e:1)),this.a,this.b)},it.rgb=function(){return at(this.l,this.a,this.b)},i.rgb=ft;var ht=ft.prototype=new Ve;function gt(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function yt(e,t,n){var r,o,i,a=0,s=0,u=0;if(r=/([a-z]+)\((.*)\)/.exec(e=e.toLowerCase()))switch(o=r[2].split(","),r[1]){case"hsl":return n(parseFloat(o[0]),parseFloat(o[1])/100,parseFloat(o[2])/100);case"rgb":return t(wt(o[0]),wt(o[1]),wt(o[2]))}return(i=bt.get(e))?t(i.r,i.g,i.b):(null==e||"#"!==e.charAt(0)||isNaN(i=parseInt(e.slice(1),16))||(4===e.length?(a=(3840&i)>>4,a|=a>>4,s=240&i,s|=s>>4,u=15&i,u|=u<<4):7===e.length&&(a=(16711680&i)>>16,s=(65280&i)>>8,u=255&i)),t(a,s,u))}function mt(e,t,n){var r,o,i=Math.min(e/=255,t/=255,n/=255),a=Math.max(e,t,n),s=a-i,u=(a+i)/2;return s?(o=u<.5?s/(a+i):s/(2-a-i),r=e==a?(t-n)/s+(t<n?6:0):t==a?(n-e)/s+2:(e-t)/s+4,r*=60):(r=NaN,o=u>0&&u<1?0:r),new Ye(r,o,u)}function vt(e,t,n){var r=ct((.4124564*(e=xt(e))+.3575761*(t=xt(t))+.1804375*(n=xt(n)))/nt),o=ct((.2126729*e+.7151522*t+.072175*n)/rt);return et(116*o-16,500*(r-o),200*(o-ct((.0193339*e+.119192*t+.9503041*n)/ot)))}function xt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function wt(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}ht.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,o=30;return t||n||r?(t&&t<o&&(t=o),n&&n<o&&(n=o),r&&r<o&&(r=o),new ft(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,r/e))):new ft(o,o,o)},ht.darker=function(e){return new ft((e=Math.pow(.7,arguments.length?e:1))*this.r,e*this.g,e*this.b)},ht.hsl=function(){return mt(this.r,this.g,this.b)},ht.toString=function(){return"#"+gt(this.r)+gt(this.g)+gt(this.b)};var bt=i.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function Ct(e){return"function"==typeof e?e:function(){return e}}function St(e){return function(t,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),Mt(t,n,e,r)}}function Mt(e,t,n,r){var o={},a=i.dispatch("beforesend","progress","load","error"),u={},c=new XMLHttpRequest,l=null;function f(){var e,t=c.status;if(!t&&function(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}(c)||t>=200&&t<300||304===t){try{e=n.call(o,c)}catch(e){return void a.error.call(o,e)}a.load.call(o,e)}else a.error.call(o,c)}return!this.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(e)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=f:c.onreadystatechange=function(){c.readyState>3&&f()},c.onprogress=function(e){var t=i.event;i.event=e;try{a.progress.call(o,c)}finally{i.event=t}},o.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u[e]:(null==t?delete u[e]:u[e]=t+"",o)},o.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",o):t},o.responseType=function(e){return arguments.length?(l=e,o):l},o.response=function(e){return n=e,o},["get","post"].forEach((function(e){o[e]=function(){return o.send.apply(o,[e].concat(s(arguments)))}})),o.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),c.open(n,e,!0),null==t||"accept"in u||(u.accept=t+",*/*"),c.setRequestHeader)for(var s in u)c.setRequestHeader(s,u[s]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=l&&(c.responseType=l),null!=i&&o.on("error",i).on("load",(function(e){i(null,e)})),a.beforesend.call(o,c),c.send(null==r?null:r),o},o.abort=function(){return c.abort(),o},i.rebind(o,a,"on"),null==r?o:o.get(function(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}(r))}bt.forEach((function(e,t){bt.set(e,dt(t))})),i.functor=Ct,i.xhr=St(P),i.dsv=function(e,t){var n=new RegExp('["'+e+"\n]"),r=e.charCodeAt(0);function o(e,n,r){arguments.length<3&&(r=n,n=null);var o=Mt(e,t,null==n?i:a(n),r);return o.row=function(e){return arguments.length?o.response(null==(n=e)?i:a(e)):n},o}function i(e){return o.parse(e.responseText)}function a(e){return function(t){return o.parse(t.responseText,e)}}function s(t){return t.map(u).join(e)}function u(e){return n.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}return o.parse=function(e,t){var n;return o.parseRows(e,(function(e,r){if(n)return n(e,r-1);var o=new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+"]"})).join(",")+"}");n=t?function(e,n){return t(o(e),n)}:o}))},o.parseRows=function(e,t){var n,o,i={},a={},s=[],u=e.length,c=0,l=0;function f(){if(c>=u)return a;if(o)return o=!1,i;var t=c;if(34===e.charCodeAt(t)){for(var n=t;n++<u;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}return c=n+2,13===(s=e.charCodeAt(n+1))?(o=!0,10===e.charCodeAt(n+2)&&++c):10===s&&(o=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;c<u;){var s,l=1;if(10===(s=e.charCodeAt(c++)))o=!0;else if(13===s)o=!0,10===e.charCodeAt(c)&&(++c,++l);else if(s!==r)continue;return e.slice(t,c-l)}return e.slice(t)}for(;(n=f())!==a;){for(var d=[];n!==i&&n!==a;)d.push(n),n=f();t&&null==(d=t(d,l++))||s.push(d)}return s},o.format=function(t){if(Array.isArray(t[0]))return o.formatRows(t);var n=new D,r=[];return t.forEach((function(e){for(var t in e)n.has(t)||r.push(n.add(t))})),[r.map(u).join(e)].concat(t.map((function(t){return r.map((function(e){return u(t[e])})).join(e)}))).join("\n")},o.formatRows=function(e){return e.map(s).join("\n")},o},i.csv=i.dsv(",","text/csv"),i.tsv=i.dsv("\t","text/tab-separated-values");var Et,_t,Tt,Rt,kt=this[O(this,"requestAnimationFrame")]||function(e){setTimeout(e,17)};function At(e,t,n){var r=arguments.length;r<2&&(t=0),r<3&&(n=Date.now());var o={c:e,t:n+t,n:null};return _t?_t.n=o:Et=o,_t=o,Tt||(Rt=clearTimeout(Rt),Tt=1,kt(It)),o}function It(){var e=Nt(),t=Lt()-e;t>24?(isFinite(t)&&(clearTimeout(Rt),Rt=setTimeout(It,t)),Tt=0):(Tt=1,kt(It))}function Nt(){for(var e=Date.now(),t=Et;t;)e>=t.t&&t.c(e-t.t)&&(t.c=null),t=t.n;return e}function Lt(){for(var e,t=Et,n=1/0;t;)t.c?(t.t<n&&(n=t.t),t=(e=t).n):t=e?e.n=t.n:Et=t.n;return _t=e,n}function $t(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}i.timer=function(){At.apply(this,arguments)},i.timer.flush=function(){Nt(),Lt()},i.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var Dt=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"].map((function(e,t){var n=Math.pow(10,3*C(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}));function Pt(e){var t=e.decimal,n=e.thousands,r=e.grouping,o=e.currency,a=r&&n?function(e,t){for(var o=e.length,i=[],a=0,s=r[0],u=0;o>0&&s>0&&(u+s+1>t&&(s=Math.max(1,t-u)),i.push(e.substring(o-=s,o+s)),!((u+=s+1)>t));)s=r[a=(a+1)%r.length];return i.reverse().join(n)}:P;return function(e){var n=qt.exec(e),r=n[1]||" ",s=n[2]||">",u=n[3]||"-",c=n[4]||"",l=n[5],f=+n[6],d=n[7],p=n[8],h=n[9],g=1,y="",m="",v=!1,x=!0;switch(p&&(p=+p.substring(1)),(l||"0"===r&&"="===s)&&(l=r="0",s="="),h){case"n":d=!0,h="g";break;case"%":g=100,m="%",h="f";break;case"p":g=100,m="%",h="r";break;case"b":case"o":case"x":case"X":"#"===c&&(y="0"+h.toLowerCase());case"c":x=!1;case"d":v=!0,p=0;break;case"s":g=-1,h="r"}"$"===c&&(y=o[0],m=o[1]),"r"!=h||p||(h="g"),null!=p&&("g"==h?p=Math.max(1,Math.min(21,p)):"e"!=h&&"f"!=h||(p=Math.max(0,Math.min(20,p)))),h=Ot.get(h)||Ut;var w=l&&d;return function(e){var n=m;if(v&&e%1)return"";var o=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===u?"":u;if(g<0){var c=i.formatPrefix(e,p);e=c.scale(e),n=c.symbol+m}else e*=g;var b,C,S=(e=h(e,p)).lastIndexOf(".");if(S<0){var M=x?e.lastIndexOf("e"):-1;M<0?(b=e,C=""):(b=e.substring(0,M),C=e.substring(M))}else b=e.substring(0,S),C=t+e.substring(S+1);!l&&d&&(b=a(b,1/0));var E=y.length+b.length+C.length+(w?0:o.length),_=E<f?new Array(E=f-E+1).join(r):"";return w&&(b=a(_+b,_.length?f-C.length:1/0)),o+=y,e=b+C,("<"===s?o+e+_:">"===s?_+o+e:"^"===s?_.substring(0,E>>=1)+o+e+_.substring(E):o+(w?e:_+e))+n}}}i.formatPrefix=function(e,t){var n=0;return(e=+e)&&(e<0&&(e*=-1),t&&(e=i.round(e,$t(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Dt[8+n/3]};var qt=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Ot=i.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=i.round(e,$t(e,t))).toFixed(Math.max(0,Math.min(20,$t(e*(1+1e-15),t))))}});function Ut(e){return e+""}var jt=i.time={},zt=Date;function Qt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}Qt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Ht.setUTCDate.apply(this._,arguments)},setDay:function(){Ht.setUTCDay.apply(this._,arguments)},setFullYear:function(){Ht.setUTCFullYear.apply(this._,arguments)},setHours:function(){Ht.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Ht.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Ht.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Ht.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Ht.setUTCSeconds.apply(this._,arguments)},setTime:function(){Ht.setTime.apply(this._,arguments)}};var Ht=Date.prototype;function Ft(e,t,n){function r(t){var n=e(t),r=i(n,1);return t-n<r-t?n:r}function o(n){return t(n=e(new zt(n-1)),1),n}function i(e,n){return t(e=new zt(+e),n),e}function a(e,r,i){var a=o(e),s=[];if(i>1)for(;a<r;)n(a)%i||s.push(new Date(+a)),t(a,1);else for(;a<r;)s.push(new Date(+a)),t(a,1);return s}e.floor=e,e.round=r,e.ceil=o,e.offset=i,e.range=a;var s=e.utc=Gt(e);return s.floor=s,s.round=Gt(r),s.ceil=Gt(o),s.offset=Gt(i),s.range=function(e,t,n){try{zt=Qt;var r=new Qt;return r._=e,a(r,t,n)}finally{zt=Date}},e}function Gt(e){return function(t,n){try{zt=Qt;var r=new Qt;return r._=t,e(r,n)._}finally{zt=Date}}}function Bt(e){var t=e.dateTime,n=e.date,r=e.time,o=e.periods,a=e.days,s=e.shortDays,u=e.months,c=e.shortMonths;function l(e){var t=e.length;function n(n){for(var r,o,i,a=[],s=-1,u=0;++s<t;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(o=Vt[r=e.charAt(++s)])&&(r=e.charAt(++s)),(i=b[r])&&(r=i(n,null==o?"e"===r?" ":"0":o)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}return n.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(f(n,e,t,0)!=t.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var r=null!=n.Z&&zt!==Qt,o=new(r?Qt:zt);return"j"in n?o.setFullYear(n.y,0,n.j):"W"in n||"U"in n?("w"in n||(n.w="W"in n?1:0),o.setFullYear(n.y,0,1),o.setFullYear(n.y,0,"W"in n?(n.w+6)%7+7*n.W-(o.getDay()+5)%7:n.w+7*n.U-(o.getDay()+6)%7)):o.setFullYear(n.y,n.m,n.d),o.setHours(n.H+(n.Z/100|0),n.M+n.Z%100,n.S,n.L),r?o._:o},n.toString=function(){return e},n}function f(e,t,n,r){for(var o,i,a,s=0,u=t.length,c=n.length;s<u;){if(r>=c)return-1;if(37===(o=t.charCodeAt(s++))){if(a=t.charAt(s++),!(i=C[a in Vt?t.charAt(s++):a])||(r=i(e,n,r))<0)return-1}else if(o!=n.charCodeAt(r++))return-1}return r}l.utc=function(e){var t=l(e);function n(e){try{var n=new(zt=Qt);return n._=e,t(n)}finally{zt=Date}}return n.parse=function(e){try{zt=Qt;var n=t.parse(e);return n&&n._}finally{zt=Date}},n.toString=t.toString,n},l.multi=l.utc.multi=gn;var d=i.map(),p=Zt(a),h=Kt(a),g=Zt(s),y=Kt(s),m=Zt(u),v=Kt(u),x=Zt(c),w=Kt(c);o.forEach((function(e,t){d.set(e.toLowerCase(),t)}));var b={a:function(e){return s[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return c[e.getMonth()]},B:function(e){return u[e.getMonth()]},c:l(t),d:function(e,t){return Xt(e.getDate(),t,2)},e:function(e,t){return Xt(e.getDate(),t,2)},H:function(e,t){return Xt(e.getHours(),t,2)},I:function(e,t){return Xt(e.getHours()%12||12,t,2)},j:function(e,t){return Xt(1+jt.dayOfYear(e),t,3)},L:function(e,t){return Xt(e.getMilliseconds(),t,3)},m:function(e,t){return Xt(e.getMonth()+1,t,2)},M:function(e,t){return Xt(e.getMinutes(),t,2)},p:function(e){return o[+(e.getHours()>=12)]},S:function(e,t){return Xt(e.getSeconds(),t,2)},U:function(e,t){return Xt(jt.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Xt(jt.mondayOfYear(e),t,2)},x:l(n),X:l(r),y:function(e,t){return Xt(e.getFullYear()%100,t,2)},Y:function(e,t){return Xt(e.getFullYear()%1e4,t,4)},Z:pn,"%":function(){return"%"}},C={a:function(e,t,n){g.lastIndex=0;var r=g.exec(t.slice(n));return r?(e.w=y.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){p.lastIndex=0;var r=p.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){x.lastIndex=0;var r=x.exec(t.slice(n));return r?(e.m=w.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){m.lastIndex=0;var r=m.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,t,n){return f(e,b.c.toString(),t,n)},d:sn,e:sn,H:cn,I:cn,j:un,L:dn,m:an,M:ln,p:function(e,t,n){var r=d.get(t.slice(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)},S:fn,U:en,w:Jt,W:tn,x:function(e,t,n){return f(e,b.x.toString(),t,n)},X:function(e,t,n){return f(e,b.X.toString(),t,n)},y:rn,Y:nn,Z:on,"%":hn};return l}jt.year=Ft((function(e){return(e=jt.day(e)).setMonth(0,1),e}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e){return e.getFullYear()})),jt.years=jt.year.range,jt.years.utc=jt.year.utc.range,jt.day=Ft((function(e){var t=new zt(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e){return e.getDate()-1})),jt.days=jt.day.range,jt.days.utc=jt.day.utc.range,jt.dayOfYear=function(e){var t=jt.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach((function(e,t){t=7-t;var n=jt[e]=Ft((function(e){return(e=jt.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e}),(function(e,t){e.setDate(e.getDate()+7*Math.floor(t))}),(function(e){var n=jt.year(e).getDay();return Math.floor((jt.dayOfYear(e)+(n+t)%7)/7)-(n!==t)}));jt[e+"s"]=n.range,jt[e+"s"].utc=n.utc.range,jt[e+"OfYear"]=function(e){var n=jt.year(e).getDay();return Math.floor((jt.dayOfYear(e)+(n+t)%7)/7)}})),jt.week=jt.sunday,jt.weeks=jt.sunday.range,jt.weeks.utc=jt.sunday.utc.range,jt.weekOfYear=jt.sundayOfYear;var Vt={"-":"",_:" ",0:"0"},Yt=/^\s*\d+/,Wt=/^%/;function Xt(e,t,n){var r=e<0?"-":"",o=(r?-e:e)+"",i=o.length;return r+(i<n?new Array(n-i+1).join(t)+o:o)}function Zt(e){return new RegExp("^(?:"+e.map(i.requote).join("|")+")","i")}function Kt(e){for(var t=new E,n=-1,r=e.length;++n<r;)t.set(e[n].toLowerCase(),n);return t}function Jt(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function en(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n));return r?(e.U=+r[0],n+r[0].length):-1}function tn(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n));return r?(e.W=+r[0],n+r[0].length):-1}function nn(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function rn(e,t,n){Yt.lastIndex=0;var r,o=Yt.exec(t.slice(n,n+2));return o?(e.y=(r=+o[0])+(r>68?1900:2e3),n+o[0].length):-1}function on(e,t,n){return/^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1}function an(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function sn(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function un(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1}function cn(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function ln(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function fn(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function dn(e,t,n){Yt.lastIndex=0;var r=Yt.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function pn(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=C(t)/60|0,o=C(t)%60;return n+Xt(r,"0",2)+Xt(o,"0",2)}function hn(e,t,n){Wt.lastIndex=0;var r=Wt.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function gn(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,r=e[n];!r[1](t);)r=e[++n];return r[0](t)}}i.locale=function(e){return{numberFormat:Pt(e),timeFormat:Bt(e)}};var yn=i.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function mn(){}i.format=yn.numberFormat,i.geo={},mn.prototype={s:0,t:0,add:function(e){xn(e,this.t,vn),xn(vn.s,this.s,this),this.s?this.t+=vn.t:this.s=vn.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var vn=new mn;function xn(e,t,n){var r=n.s=e+t,o=r-e,i=r-o;n.t=e-i+(t-o)}function wn(e,t){e&&Cn.hasOwnProperty(e.type)&&Cn[e.type](e,t)}i.geo.stream=function(e,t){e&&bn.hasOwnProperty(e.type)?bn[e.type](e,t):wn(e,t)};var bn={Feature:function(e,t){wn(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,o=n.length;++r<o;)wn(n[r].geometry,t)}},Cn={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,o=n.length;++r<o;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Sn(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,o=n.length;++r<o;)Sn(n[r],t,0)},Polygon:function(e,t){Mn(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,o=n.length;++r<o;)Mn(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,o=n.length;++r<o;)wn(n[r],t)}};function Sn(e,t,n){var r,o=-1,i=e.length-n;for(t.lineStart();++o<i;)r=e[o],t.point(r[0],r[1],r[2]);t.lineEnd()}function Mn(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Sn(e[n],t,1);t.polygonEnd()}i.geo.area=function(e){return En=0,i.geo.stream(e,On),En};var En,_n,Tn,Rn,kn,An,In,Nn,Ln,$n,Dn,Pn,qn=new mn,On={sphere:function(){En+=4*Ie},point:j,lineStart:j,lineEnd:j,polygonStart:function(){qn.reset(),On.lineStart=Un},polygonEnd:function(){var e=2*qn;En+=e<0?4*Ie+e:e,On.lineStart=On.lineEnd=On.point=j}};function Un(){var e,t,n,r,o;function i(e,t){t=t*De/2+Ie/4;var i=(e*=De)-n,a=i>=0?1:-1,s=a*i,u=Math.cos(t),c=Math.sin(t),l=o*c,f=r*u+l*Math.cos(s),d=l*a*Math.sin(s);qn.add(Math.atan2(d,f)),n=e,r=u,o=c}On.point=function(a,s){On.point=i,n=(e=a)*De,r=Math.cos(s=(t=s)*De/2+Ie/4),o=Math.sin(s)},On.lineEnd=function(){i(e,t)}}function jn(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)]}function zn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Qn(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Hn(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Fn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Gn(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Bn(e){return[Math.atan2(e[1],e[0]),je(e[2])]}function Vn(e,t){return C(e[0]-t[0])<ke&&C(e[1]-t[1])<ke}i.geo.bounds=function(){var e,t,n,r,o,a,s,u,c,l,f,d={point:p,lineStart:g,lineEnd:y,polygonStart:function(){d.point=m,d.lineStart=v,d.lineEnd=x,c=0,On.polygonStart()},polygonEnd:function(){On.polygonEnd(),d.point=p,d.lineStart=g,d.lineEnd=y,qn<0?(e=-(n=180),t=-(r=90)):c>ke?r=90:c<-ke&&(t=-90),f[0]=e,f[1]=n}};function p(o,i){l.push(f=[e=o,n=o]),i<t&&(t=i),i>r&&(r=i)}function h(i,a){var s=jn([i*De,a*De]);if(u){var c=Qn(u,s),l=Qn([c[1],-c[0],0],c);Gn(l),l=Bn(l);var f=i-o,d=f>0?1:-1,h=l[0]*Pe*d,g=C(f)>180;if(g^(d*o<h&&h<d*i))(y=l[1]*Pe)>r&&(r=y);else if(g^(d*o<(h=(h+360)%360-180)&&h<d*i)){var y;(y=-l[1]*Pe)<t&&(t=y)}else a<t&&(t=a),a>r&&(r=a);g?i<o?w(e,i)>w(e,n)&&(n=i):w(i,n)>w(e,n)&&(e=i):n>=e?(i<e&&(e=i),i>n&&(n=i)):i>o?w(e,i)>w(e,n)&&(n=i):w(i,n)>w(e,n)&&(e=i)}else p(i,a);u=s,o=i}function g(){d.point=h}function y(){f[0]=e,f[1]=n,d.point=p,u=null}function m(e,t){if(u){var n=e-o;c+=C(n)>180?n+(n>0?360:-360):n}else a=e,s=t;On.point(e,t),h(e,t)}function v(){On.lineStart()}function x(){m(a,s),On.lineEnd(),C(c)>ke&&(e=-(n=180)),f[0]=e,f[1]=n,u=null}function w(e,t){return(t-=e)<0?t+360:t}function b(e,t){return e[0]-t[0]}function S(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}return function(o){if(r=n=-(e=t=1/0),l=[],i.geo.stream(o,d),c=l.length){l.sort(b);for(var a=1,s=[g=l[0]];a<c;++a)S((p=l[a])[0],g)||S(p[1],g)?(w(g[0],p[1])>w(g[0],g[1])&&(g[1]=p[1]),w(p[0],g[1])>w(g[0],g[1])&&(g[0]=p[0])):s.push(g=p);for(var u,c,p,h=-1/0,g=(a=0,s[c=s.length-1]);a<=c;g=p,++a)p=s[a],(u=w(g[1],p[0]))>h&&(h=u,e=p[0],n=g[1])}return l=f=null,e===1/0||t===1/0?[[NaN,NaN],[NaN,NaN]]:[[e,t],[n,r]]}}(),i.geo.centroid=function(e){_n=Tn=Rn=kn=An=In=Nn=Ln=$n=Dn=Pn=0,i.geo.stream(e,Yn);var t=$n,n=Dn,r=Pn,o=t*t+n*n+r*r;return o<Ae&&(t=In,n=Nn,r=Ln,Tn<ke&&(t=Rn,n=kn,r=An),(o=t*t+n*n+r*r)<Ae)?[NaN,NaN]:[Math.atan2(n,t)*Pe,je(r/Math.sqrt(o))*Pe]};var Yn={sphere:j,point:Wn,lineStart:Zn,lineEnd:Kn,polygonStart:function(){Yn.lineStart=Jn},polygonEnd:function(){Yn.lineStart=Zn}};function Wn(e,t){e*=De;var n=Math.cos(t*=De);Xn(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function Xn(e,t,n){++_n,Rn+=(e-Rn)/_n,kn+=(t-kn)/_n,An+=(n-An)/_n}function Zn(){var e,t,n;function r(r,o){r*=De;var i=Math.cos(o*=De),a=i*Math.cos(r),s=i*Math.sin(r),u=Math.sin(o),c=Math.atan2(Math.sqrt((c=t*u-n*s)*c+(c=n*a-e*u)*c+(c=e*s-t*a)*c),e*a+t*s+n*u);Tn+=c,In+=c*(e+(e=a)),Nn+=c*(t+(t=s)),Ln+=c*(n+(n=u)),Xn(e,t,n)}Yn.point=function(o,i){o*=De;var a=Math.cos(i*=De);e=a*Math.cos(o),t=a*Math.sin(o),n=Math.sin(i),Yn.point=r,Xn(e,t,n)}}function Kn(){Yn.point=Wn}function Jn(){var e,t,n,r,o;function i(e,t){e*=De;var i=Math.cos(t*=De),a=i*Math.cos(e),s=i*Math.sin(e),u=Math.sin(t),c=r*u-o*s,l=o*a-n*u,f=n*s-r*a,d=Math.sqrt(c*c+l*l+f*f),p=n*a+r*s+o*u,h=d&&-Ue(p)/d,g=Math.atan2(d,p);$n+=h*c,Dn+=h*l,Pn+=h*f,Tn+=g,In+=g*(n+(n=a)),Nn+=g*(r+(r=s)),Ln+=g*(o+(o=u)),Xn(n,r,o)}Yn.point=function(a,s){e=a,t=s,Yn.point=i,a*=De;var u=Math.cos(s*=De);n=u*Math.cos(a),r=u*Math.sin(a),o=Math.sin(s),Xn(n,r,o)},Yn.lineEnd=function(){i(e,t),Yn.lineEnd=Kn,Yn.point=Wn}}function er(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function tr(){return!0}function nr(e,t,n,r,o){var i=[],a=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],r=e[t];if(Vn(n,r)){o.lineStart();for(var s=0;s<t;++s)o.point((n=e[s])[0],n[1]);o.lineEnd()}else{var u=new or(n,e,null,!0),c=new or(n,null,u,!1);u.o=c,i.push(u),a.push(c),u=new or(r,e,null,!1),c=new or(r,null,u,!0),u.o=c,i.push(u),a.push(c)}}})),a.sort(t),rr(i),rr(a),i.length){for(var s=0,u=n,c=a.length;s<c;++s)a[s].e=u=!u;for(var l,f,d=i[0];;){for(var p=d,h=!0;p.v;)if((p=p.n)===d)return;l=p.z,o.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(s=0,c=l.length;s<c;++s)o.point((f=l[s])[0],f[1]);else r(p.x,p.n.x,1,o);p=p.n}else{if(h)for(s=(l=p.p.z).length-1;s>=0;--s)o.point((f=l[s])[0],f[1]);else r(p.x,p.p.x,-1,o);p=p.p}l=(p=p.o).z,h=!h}while(!p.v);o.lineEnd()}}}function rr(e){if(t=e.length){for(var t,n,r=0,o=e[0];++r<t;)o.n=n=e[r],n.p=o,o=n;o.n=n=e[0],n.p=o}}function or(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function ir(e,t,n,r){return function(o,a){var s,u=t(a),c=o.invert(r[0],r[1]),l={point:f,lineStart:p,lineEnd:h,polygonStart:function(){l.point=w,l.lineStart=b,l.lineEnd=C,s=[],g=[]},polygonEnd:function(){l.point=f,l.lineStart=p,l.lineEnd=h,s=i.merge(s);var e=function(e,t){var n=e[0],r=e[1],o=[Math.sin(n),-Math.cos(n),0],i=0,a=0;qn.reset();for(var s=0,u=t.length;s<u;++s){var c=t[s],l=c.length;if(l)for(var f=c[0],d=f[0],p=f[1]/2+Ie/4,h=Math.sin(p),g=Math.cos(p),y=1;;){y===l&&(y=0);var m=(e=c[y])[0],v=e[1]/2+Ie/4,x=Math.sin(v),w=Math.cos(v),b=m-d,C=b>=0?1:-1,S=C*b,M=S>Ie,E=h*x;if(qn.add(Math.atan2(E*C*Math.sin(S),g*w+E*Math.cos(S))),i+=M?b+C*Ne:b,M^d>=n^m>=n){var _=Qn(jn(f),jn(e));Gn(_);var T=Qn(o,_);Gn(T);var R=(M^b>=0?-1:1)*je(T[2]);(r>R||r===R&&(_[0]||_[1]))&&(a+=M^b>=0?1:-1)}if(!y++)break;d=m,h=x,g=w,f=e}}return(i<-ke||i<ke&&qn<0)^1&a}(c,g);s.length?(x||(a.polygonStart(),x=!0),nr(s,ur,e,n,a)):e&&(x||(a.polygonStart(),x=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),x&&(a.polygonEnd(),x=!1),s=g=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function f(t,n){var r=o(t,n);e(t=r[0],n=r[1])&&a.point(t,n)}function d(e,t){var n=o(e,t);u.point(n[0],n[1])}function p(){l.point=d,u.lineStart()}function h(){l.point=f,u.lineEnd()}var g,y,m=sr(),v=t(m),x=!1;function w(e,t){y.push([e,t]);var n=o(e,t);v.point(n[0],n[1])}function b(){v.lineStart(),y=[]}function C(){w(y[0][0],y[0][1]),v.lineEnd();var e,t=v.clean(),n=m.buffer(),r=n.length;if(y.pop(),g.push(y),y=null,r)if(1&t){var o,i=-1;if((r=(e=n[0]).length-1)>0){for(x||(a.polygonStart(),x=!0),a.lineStart();++i<r;)a.point((o=e[i])[0],o[1]);a.lineEnd()}}else r>1&&2&t&&n.push(n.pop().concat(n.shift())),s.push(n.filter(ar))}return l}}function ar(e){return e.length>1}function sr(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:j,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function ur(e,t){return((e=e.x)[0]<0?e[1]-$e-ke:$e-e[1])-((t=t.x)[0]<0?t[1]-$e-ke:$e-t[1])}var cr=ir(tr,(function(e){var t,n=NaN,r=NaN,o=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(i,a){var s=i>0?Ie:-Ie,u=C(i-n);C(u-Ie)<ke?(e.point(n,r=(r+a)/2>0?$e:-$e),e.point(o,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(i,r),t=0):o!==s&&u>=Ie&&(C(n-o)<ke&&(n-=o*ke),C(i-s)<ke&&(i-=s*ke),r=function(e,t,n,r){var o,i,a=Math.sin(e-n);return C(a)>ke?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(n)-Math.sin(r)*(o=Math.cos(t))*Math.sin(e))/(o*i*a)):(t+r)/2}(n,r,i,a),e.point(o,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=i,r=a),o=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var o;if(null==e)o=n*$e,r.point(-Ie,o),r.point(0,o),r.point(Ie,o),r.point(Ie,0),r.point(Ie,-o),r.point(0,-o),r.point(-Ie,-o),r.point(-Ie,0),r.point(-Ie,o);else if(C(e[0]-t[0])>ke){var i=e[0]<t[0]?Ie:-Ie;o=n*i/2,r.point(-i,o),r.point(0,o),r.point(i,o)}else r.point(t[0],t[1])}),[-Ie,-Ie/2]);function lr(e){var t=Math.cos(e),n=t>0,r=C(t)>ke;return ir(o,(function(e){var t,s,u,c,l;return{lineStart:function(){c=u=!1,l=1},point:function(f,d){var p,h=[f,d],g=o(f,d),y=n?g?0:a(f,d):g?a(f+(f<0?Ie:-Ie),d):0;if(!t&&(c=u=g)&&e.lineStart(),g!==u&&(p=i(t,h),(Vn(t,p)||Vn(h,p))&&(h[0]+=ke,h[1]+=ke,g=o(h[0],h[1]))),g!==u)l=0,g?(e.lineStart(),p=i(h,t),e.point(p[0],p[1])):(p=i(t,h),e.point(p[0],p[1]),e.lineEnd()),t=p;else if(r&&t&&n^g){var m;y&s||!(m=i(h,t,!0))||(l=0,n?(e.lineStart(),e.point(m[0][0],m[0][1]),e.point(m[1][0],m[1][1]),e.lineEnd()):(e.point(m[1][0],m[1][1]),e.lineEnd(),e.lineStart(),e.point(m[0][0],m[0][1])))}!g||t&&Vn(t,h)||e.point(h[0],h[1]),t=h,u=g,s=y},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return l|(c&&u)<<1}}}),Vr(e,6*De),n?[0,-e]:[-Ie,e-Ie]);function o(e,n){return Math.cos(e)*Math.cos(n)>t}function i(e,n,r){var o=[1,0,0],i=Qn(jn(e),jn(n)),a=zn(i,i),s=i[0],u=a-s*s;if(!u)return!r&&e;var c=t*a/u,l=-t*s/u,f=Qn(o,i),d=Fn(o,c);Hn(d,Fn(i,l));var p=f,h=zn(d,p),g=zn(p,p),y=h*h-g*(zn(d,d)-1);if(!(y<0)){var m=Math.sqrt(y),v=Fn(p,(-h-m)/g);if(Hn(v,d),v=Bn(v),!r)return v;var x,w=e[0],b=n[0],S=e[1],M=n[1];b<w&&(x=w,w=b,b=x);var E=b-w,_=C(E-Ie)<ke;if(!_&&M<S&&(x=S,S=M,M=x),_||E<ke?_?S+M>0^v[1]<(C(v[0]-w)<ke?S:M):S<=v[1]&&v[1]<=M:E>Ie^(w<=v[0]&&v[0]<=b)){var T=Fn(p,(-h+m)/g);return Hn(T,d),[v,Bn(T)]}}}function a(t,r){var o=n?e:Ie-e,i=0;return t<-o?i|=1:t>o&&(i|=2),r<-o?i|=4:r>o&&(i|=8),i}}function fr(e,t,n,r){return function(o){var i,a=o.a,s=o.b,u=a.x,c=a.y,l=0,f=1,d=s.x-u,p=s.y-c;if(i=e-u,d||!(i>0)){if(i/=d,d<0){if(i<l)return;i<f&&(f=i)}else if(d>0){if(i>f)return;i>l&&(l=i)}if(i=n-u,d||!(i<0)){if(i/=d,d<0){if(i>f)return;i>l&&(l=i)}else if(d>0){if(i<l)return;i<f&&(f=i)}if(i=t-c,p||!(i>0)){if(i/=p,p<0){if(i<l)return;i<f&&(f=i)}else if(p>0){if(i>f)return;i>l&&(l=i)}if(i=r-c,p||!(i<0)){if(i/=p,p<0){if(i>f)return;i>l&&(l=i)}else if(p>0){if(i<l)return;i<f&&(f=i)}return l>0&&(o.a={x:u+l*d,y:c+l*p}),f<1&&(o.b={x:u+f*d,y:c+f*p}),o}}}}}}var dr=1e9;function pr(e,t,n,r){return function(u){var c,l,f,d,p,h,g,y,m,v,x,w=u,b=sr(),C=fr(e,t,n,r),S={point:_,lineStart:function(){S.point=T,l&&l.push(f=[]);v=!0,m=!1,g=y=NaN},lineEnd:function(){c&&(T(d,p),h&&m&&b.rejoin(),c.push(b.buffer()));S.point=_,m&&u.lineEnd()},polygonStart:function(){u=b,c=[],l=[],x=!0},polygonEnd:function(){u=w,c=i.merge(c);var t=function(e){for(var t=0,n=l.length,r=e[1],o=0;o<n;++o)for(var i,a=1,s=l[o],u=s.length,c=s[0];a<u;++a)i=s[a],c[1]<=r?i[1]>r&&Oe(c,i,e)>0&&++t:i[1]<=r&&Oe(c,i,e)<0&&--t,c=i;return 0!==t}([e,r]),n=x&&t,o=c.length;(n||o)&&(u.polygonStart(),n&&(u.lineStart(),M(null,null,1,u),u.lineEnd()),o&&nr(c,a,t,M,u),u.polygonEnd()),c=l=f=null}};function M(i,a,u,c){var l=0,f=0;if(null==i||(l=o(i,u))!==(f=o(a,u))||s(i,a)<0^u>0)do{c.point(0===l||3===l?e:n,l>1?r:t)}while((l=(l+u+4)%4)!==f);else c.point(a[0],a[1])}function E(o,i){return e<=o&&o<=n&&t<=i&&i<=r}function _(e,t){E(e,t)&&u.point(e,t)}function T(e,t){var n=E(e=Math.max(-dr,Math.min(dr,e)),t=Math.max(-dr,Math.min(dr,t)));if(l&&f.push([e,t]),v)d=e,p=t,h=n,v=!1,n&&(u.lineStart(),u.point(e,t));else if(n&&m)u.point(e,t);else{var r={a:{x:g,y:y},b:{x:e,y:t}};C(r)?(m||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),n||u.lineEnd(),x=!1):n&&(u.lineStart(),u.point(e,t),x=!1)}g=e,y=t,m=n}return S};function o(r,o){return C(r[0]-e)<ke?o>0?0:3:C(r[0]-n)<ke?o>0?2:1:C(r[1]-t)<ke?o>0?1:0:o>0?3:2}function a(e,t){return s(e.x,t.x)}function s(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}}function hr(e){var t=0,n=Ie/3,r=Ur(e),o=r(t,n);return o.parallels=function(e){return arguments.length?r(t=e[0]*Ie/180,n=e[1]*Ie/180):[t/Ie*180,n/Ie*180]},o}function gr(e,t){var n=Math.sin(e),r=(n+Math.sin(t))/2,o=1+n*(2*r-n),i=Math.sqrt(o)/r;function a(e,t){var n=Math.sqrt(o-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),i-n*Math.cos(e)]}return a.invert=function(e,t){var n=i-t;return[Math.atan2(e,n)/r,je((o-(e*e+n*n)*r*r)/(2*r))]},a}i.geo.clipExtent=function(){var e,t,n,r,o,i,a={stream:function(e){return o&&(o.valid=!1),(o=i(e)).valid=!0,o},extent:function(s){return arguments.length?(i=pr(e=+s[0][0],t=+s[0][1],n=+s[1][0],r=+s[1][1]),o&&(o.valid=!1,o=null),a):[[e,t],[n,r]]}};return a.extent([[0,0],[960,500]])},(i.geo.conicEqualArea=function(){return hr(gr)}).raw=gr,i.geo.albers=function(){return i.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},i.geo.albersUsa=function(){var e,t,n,r,o=i.geo.albers(),a=i.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=i.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(t,n){e=[t,n]}};function c(o){var i=o[0],a=o[1];return e=null,t(i,a),e||(n(i,a),e)||r(i,a),e}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?a:i>=.166&&i<.234&&r>=-.214&&r<-.115?s:o).invert(e)},c.stream=function(e){var t=o.stream(e),n=a.stream(e),r=s.stream(e);return{point:function(e,o){t.point(e,o),n.point(e,o),r.point(e,o)},sphere:function(){t.sphere(),n.sphere(),r.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},c.precision=function(e){return arguments.length?(o.precision(e),a.precision(e),s.precision(e),c):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),a.scale(.35*e),s.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var i=o.scale(),l=+e[0],f=+e[1];return t=o.translate(e).clipExtent([[l-.455*i,f-.238*i],[l+.455*i,f+.238*i]]).stream(u).point,n=a.translate([l-.307*i,f+.201*i]).clipExtent([[l-.425*i+ke,f+.12*i+ke],[l-.214*i-ke,f+.234*i-ke]]).stream(u).point,r=s.translate([l-.205*i,f+.212*i]).clipExtent([[l-.214*i+ke,f+.166*i+ke],[l-.115*i-ke,f+.234*i-ke]]).stream(u).point,c},c.scale(1070)};var yr,mr,vr,xr,wr,br,Cr={point:j,lineStart:j,lineEnd:j,polygonStart:function(){mr=0,Cr.lineStart=Sr},polygonEnd:function(){Cr.lineStart=Cr.lineEnd=Cr.point=j,yr+=C(mr/2)}};function Sr(){var e,t,n,r;function o(e,t){mr+=r*e-n*t,n=e,r=t}Cr.point=function(i,a){Cr.point=o,e=n=i,t=r=a},Cr.lineEnd=function(){o(e,t)}}var Mr={point:function(e,t){e<vr&&(vr=e);e>wr&&(wr=e);t<xr&&(xr=t);t>br&&(br=t)},lineStart:j,lineEnd:j,polygonStart:j,polygonEnd:j};function Er(){var e=_r(4.5),t=[],n={point:r,lineStart:function(){n.point=o},lineEnd:a,polygonStart:function(){n.lineEnd=s},polygonEnd:function(){n.lineEnd=a,n.point=r},pointRadius:function(t){return e=_r(t),n},result:function(){if(t.length){var e=t.join("");return t=[],e}}};function r(n,r){t.push("M",n,",",r,e)}function o(e,r){t.push("M",e,",",r),n.point=i}function i(e,n){t.push("L",e,",",n)}function a(){n.point=r}function s(){t.push("Z")}return n}function _r(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}var Tr,Rr={point:kr,lineStart:Ar,lineEnd:Ir,polygonStart:function(){Rr.lineStart=Nr},polygonEnd:function(){Rr.point=kr,Rr.lineStart=Ar,Rr.lineEnd=Ir}};function kr(e,t){Rn+=e,kn+=t,++An}function Ar(){var e,t;function n(n,r){var o=n-e,i=r-t,a=Math.sqrt(o*o+i*i);In+=a*(e+n)/2,Nn+=a*(t+r)/2,Ln+=a,kr(e=n,t=r)}Rr.point=function(r,o){Rr.point=n,kr(e=r,t=o)}}function Ir(){Rr.point=kr}function Nr(){var e,t,n,r;function o(e,t){var o=e-n,i=t-r,a=Math.sqrt(o*o+i*i);In+=a*(n+e)/2,Nn+=a*(r+t)/2,Ln+=a,$n+=(a=r*e-n*t)*(n+e),Dn+=a*(r+t),Pn+=3*a,kr(n=e,r=t)}Rr.point=function(i,a){Rr.point=o,kr(e=n=i,t=r=a)},Rr.lineEnd=function(){o(e,t)}}function Lr(e){var t=4.5,n={point:r,lineStart:function(){n.point=o},lineEnd:a,polygonStart:function(){n.lineEnd=s},polygonEnd:function(){n.lineEnd=a,n.point=r},pointRadius:function(e){return t=e,n},result:j};function r(n,r){e.moveTo(n+t,r),e.arc(n,r,t,0,Ne)}function o(t,r){e.moveTo(t,r),n.point=i}function i(t,n){e.lineTo(t,n)}function a(){n.point=r}function s(){e.closePath()}return n}function $r(e){var t=.5,n=Math.cos(30*De),r=16;function o(e){return(r?a:i)(e)}function i(t){return qr(t,(function(n,r){n=e(n,r),t.point(n[0],n[1])}))}function a(t){var n,o,i,a,u,c,l,f,d,p,h,g,y={point:m,lineStart:v,lineEnd:w,polygonStart:function(){t.polygonStart(),y.lineStart=b},polygonEnd:function(){t.polygonEnd(),y.lineStart=v}};function m(n,r){n=e(n,r),t.point(n[0],n[1])}function v(){f=NaN,y.point=x,t.lineStart()}function x(n,o){var i=jn([n,o]),a=e(n,o);s(f,d,l,p,h,g,f=a[0],d=a[1],l=n,p=i[0],h=i[1],g=i[2],r,t),t.point(f,d)}function w(){y.point=m,t.lineEnd()}function b(){v(),y.point=C,y.lineEnd=S}function C(e,t){x(n=e,t),o=f,i=d,a=p,u=h,c=g,y.point=x}function S(){s(f,d,l,p,h,g,o,i,n,a,u,c,r,t),y.lineEnd=w,w()}return y}function s(r,o,i,a,u,c,l,f,d,p,h,g,y,m){var v=l-r,x=f-o,w=v*v+x*x;if(w>4*t&&y--){var b=a+p,S=u+h,M=c+g,E=Math.sqrt(b*b+S*S+M*M),_=Math.asin(M/=E),T=C(C(M)-1)<ke||C(i-d)<ke?(i+d)/2:Math.atan2(S,b),R=e(T,_),k=R[0],A=R[1],I=k-r,N=A-o,L=x*I-v*N;(L*L/w>t||C((v*I+x*N)/w-.5)>.3||a*p+u*h+c*g<n)&&(s(r,o,i,a,u,c,k,A,T,b/=E,S/=E,M,y,m),m.point(k,A),s(k,A,T,b,S,M,l,f,d,p,h,g,y,m))}}return o.precision=function(e){return arguments.length?(r=(t=e*e)>0&&16,o):Math.sqrt(t)},o}function Dr(e){var t=$r((function(t,n){return e([t*Pe,n*Pe])}));return function(e){return jr(t(e))}}function Pr(e){this.stream=e}function qr(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function Or(e){return Ur((function(){return e}))()}function Ur(e){var t,n,r,o,a,s,u=$r((function(e,n){return[(e=t(e,n))[0]*c+o,a-e[1]*c]})),c=150,l=480,f=250,d=0,p=0,h=0,g=0,y=0,m=cr,v=P,x=null,w=null;function b(e){return[(e=r(e[0]*De,e[1]*De))[0]*c+o,a-e[1]*c]}function C(e){return(e=r.invert((e[0]-o)/c,(a-e[1])/c))&&[e[0]*Pe,e[1]*Pe]}function S(){r=er(n=Hr(h,g,y),t);var e=t(d,p);return o=l-e[0]*c,a=f+e[1]*c,M()}function M(){return s&&(s.valid=!1,s=null),b}return b.stream=function(e){return s&&(s.valid=!1),(s=jr(m(n,u(v(e))))).valid=!0,s},b.clipAngle=function(e){return arguments.length?(m=null==e?(x=e,cr):lr((x=+e)*De),M()):x},b.clipExtent=function(e){return arguments.length?(w=e,v=e?pr(e[0][0],e[0][1],e[1][0],e[1][1]):P,M()):w},b.scale=function(e){return arguments.length?(c=+e,S()):c},b.translate=function(e){return arguments.length?(l=+e[0],f=+e[1],S()):[l,f]},b.center=function(e){return arguments.length?(d=e[0]%360*De,p=e[1]%360*De,S()):[d*Pe,p*Pe]},b.rotate=function(e){return arguments.length?(h=e[0]%360*De,g=e[1]%360*De,y=e.length>2?e[2]%360*De:0,S()):[h*Pe,g*Pe,y*Pe]},i.rebind(b,u,"precision"),function(){return t=e.apply(this,arguments),b.invert=t.invert&&C,S()}}function jr(e){return qr(e,(function(t,n){e.point(t*De,n*De)}))}function zr(e,t){return[e,t]}function Qr(e,t){return[e>Ie?e-Ne:e<-Ie?e+Ne:e,t]}function Hr(e,t,n){return e?t||n?er(Gr(e),Br(t,n)):Gr(e):t||n?Br(t,n):Qr}function Fr(e){return function(t,n){return[(t+=e)>Ie?t-Ne:t<-Ie?t+Ne:t,n]}}function Gr(e){var t=Fr(e);return t.invert=Fr(-e),t}function Br(e,t){var n=Math.cos(e),r=Math.sin(e),o=Math.cos(t),i=Math.sin(t);function a(e,t){var a=Math.cos(t),s=Math.cos(e)*a,u=Math.sin(e)*a,c=Math.sin(t),l=c*n+s*r;return[Math.atan2(u*o-l*i,s*n-c*r),je(l*o+u*i)]}return a.invert=function(e,t){var a=Math.cos(t),s=Math.cos(e)*a,u=Math.sin(e)*a,c=Math.sin(t),l=c*o-u*i;return[Math.atan2(u*o+c*i,s*n+l*r),je(l*n-s*r)]},a}function Vr(e,t){var n=Math.cos(e),r=Math.sin(e);return function(o,i,a,s){var u=a*t;null!=o?(o=Yr(n,o),i=Yr(n,i),(a>0?o<i:o>i)&&(o+=a*Ne)):(o=e+a*Ne,i=e-.5*u);for(var c,l=o;a>0?l>i:l<i;l-=u)s.point((c=Bn([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],c[1])}}function Yr(e,t){var n=jn(t);n[0]-=e,Gn(n);var r=Ue(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-ke)%(2*Math.PI)}function Wr(e,t,n){var r=i.range(e,t-ke,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function Xr(e,t,n){var r=i.range(e,t-ke,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function Zr(e){return e.source}function Kr(e){return e.target}i.geo.path=function(){var e,t,n,r,o,a=4.5;function s(e){return e&&("function"==typeof a&&r.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=n(r)),i.geo.stream(e,o)),r.result()}function u(){return o=null,s}return s.area=function(e){return yr=0,i.geo.stream(e,n(Cr)),yr},s.centroid=function(e){return Rn=kn=An=In=Nn=Ln=$n=Dn=Pn=0,i.geo.stream(e,n(Rr)),Pn?[$n/Pn,Dn/Pn]:Ln?[In/Ln,Nn/Ln]:An?[Rn/An,kn/An]:[NaN,NaN]},s.bounds=function(e){return wr=br=-(vr=xr=1/0),i.geo.stream(e,n(Mr)),[[vr,xr],[wr,br]]},s.projection=function(t){return arguments.length?(n=(e=t)?t.stream||Dr(t):P,u()):e},s.context=function(e){return arguments.length?(r=null==(t=e)?new Er:new Lr(e),"function"!=typeof a&&r.pointRadius(a),u()):t},s.pointRadius=function(e){return arguments.length?(a="function"==typeof e?e:(r.pointRadius(+e),+e),s):a},s.projection(i.geo.albersUsa()).context(null)},i.geo.transform=function(e){return{stream:function(t){var n=new Pr(t);for(var r in e)n[r]=e[r];return n}}},Pr.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},i.geo.projection=Or,i.geo.projectionMutator=Ur,(i.geo.equirectangular=function(){return Or(zr)}).raw=zr.invert=zr,i.geo.rotation=function(e){function t(t){return(t=e(t[0]*De,t[1]*De))[0]*=Pe,t[1]*=Pe,t}return e=Hr(e[0]%360*De,e[1]*De,e.length>2?e[2]*De:0),t.invert=function(t){return(t=e.invert(t[0]*De,t[1]*De))[0]*=Pe,t[1]*=Pe,t},t},Qr.invert=zr,i.geo.circle=function(){var e,t,n=[0,0],r=6;function o(){var e="function"==typeof n?n.apply(this,arguments):n,r=Hr(-e[0]*De,-e[1]*De,0).invert,o=[];return t(null,null,1,{point:function(e,t){o.push(e=r(e,t)),e[0]*=Pe,e[1]*=Pe}}),{type:"Polygon",coordinates:[o]}}return o.origin=function(e){return arguments.length?(n=e,o):n},o.angle=function(n){return arguments.length?(t=Vr((e=+n)*De,r*De),o):e},o.precision=function(n){return arguments.length?(t=Vr(e*De,(r=+n)*De),o):r},o.angle(90)},i.geo.distance=function(e,t){var n,r=(t[0]-e[0])*De,o=e[1]*De,i=t[1]*De,a=Math.sin(r),s=Math.cos(r),u=Math.sin(o),c=Math.cos(o),l=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((n=f*a)*n+(n=c*l-u*f*s)*n),u*l+c*f*s)},i.geo.graticule=function(){var e,t,n,r,o,a,s,u,c,l,f,d,p=10,h=p,g=90,y=360,m=2.5;function v(){return{type:"MultiLineString",coordinates:x()}}function x(){return i.range(Math.ceil(r/g)*g,n,g).map(f).concat(i.range(Math.ceil(u/y)*y,s,y).map(d)).concat(i.range(Math.ceil(t/p)*p,e,p).filter((function(e){return C(e%g)>ke})).map(c)).concat(i.range(Math.ceil(a/h)*h,o,h).filter((function(e){return C(e%y)>ke})).map(l))}return v.lines=function(){return x().map((function(e){return{type:"LineString",coordinates:e}}))},v.outline=function(){return{type:"Polygon",coordinates:[f(r).concat(d(s).slice(1),f(n).reverse().slice(1),d(u).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.majorExtent(e).minorExtent(e):v.minorExtent()},v.majorExtent=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],u=+e[0][1],s=+e[1][1],r>n&&(e=r,r=n,n=e),u>s&&(e=u,u=s,s=e),v.precision(m)):[[r,u],[n,s]]},v.minorExtent=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],o=+n[1][1],t>e&&(n=t,t=e,e=n),a>o&&(n=a,a=o,o=n),v.precision(m)):[[t,a],[e,o]]},v.step=function(e){return arguments.length?v.majorStep(e).minorStep(e):v.minorStep()},v.majorStep=function(e){return arguments.length?(g=+e[0],y=+e[1],v):[g,y]},v.minorStep=function(e){return arguments.length?(p=+e[0],h=+e[1],v):[p,h]},v.precision=function(i){return arguments.length?(m=+i,c=Wr(a,o,90),l=Xr(t,e,m),f=Wr(u,s,90),d=Xr(r,n,m),v):m},v.majorExtent([[-180,-90+ke],[180,90-ke]]).minorExtent([[-180,-80-ke],[180,80+ke]])},i.geo.greatArc=function(){var e,t,n=Zr,r=Kr;function o(){return{type:"LineString",coordinates:[e||n.apply(this,arguments),t||r.apply(this,arguments)]}}return o.distance=function(){return i.geo.distance(e||n.apply(this,arguments),t||r.apply(this,arguments))},o.source=function(t){return arguments.length?(n=t,e="function"==typeof t?null:t,o):n},o.target=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,o):r},o.precision=function(){return arguments.length?o:0},o},i.geo.interpolate=function(e,t){return n=e[0]*De,r=e[1]*De,o=t[0]*De,i=t[1]*De,a=Math.cos(r),s=Math.sin(r),u=Math.cos(i),c=Math.sin(i),l=a*Math.cos(n),f=a*Math.sin(n),d=u*Math.cos(o),p=u*Math.sin(o),h=2*Math.asin(Math.sqrt(Qe(i-r)+a*u*Qe(o-n))),g=1/Math.sin(h),(y=h?function(e){var t=Math.sin(e*=h)*g,n=Math.sin(h-e)*g,r=n*l+t*d,o=n*f+t*p,i=n*s+t*c;return[Math.atan2(o,r)*Pe,Math.atan2(i,Math.sqrt(r*r+o*o))*Pe]}:function(){return[n*Pe,r*Pe]}).distance=h,y;var n,r,o,i,a,s,u,c,l,f,d,p,h,g,y},i.geo.length=function(e){return Tr=0,i.geo.stream(e,Jr),Tr};var Jr={sphere:j,point:j,lineStart:function(){var e,t,n;function r(r,o){var i=Math.sin(o*=De),a=Math.cos(o),s=C((r*=De)-e),u=Math.cos(s);Tr+=Math.atan2(Math.sqrt((s=a*Math.sin(s))*s+(s=n*i-t*a*u)*s),t*i+n*a*u),e=r,t=i,n=a}Jr.point=function(o,i){e=o*De,t=Math.sin(i*=De),n=Math.cos(i),Jr.point=r},Jr.lineEnd=function(){Jr.point=Jr.lineEnd=j}},lineEnd:j,polygonStart:j,polygonEnd:j};function eo(e,t){function n(t,n){var r=Math.cos(t),o=Math.cos(n),i=e(r*o);return[i*o*Math.sin(t),i*Math.sin(n)]}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),o=t(r),i=Math.sin(o),a=Math.cos(o);return[Math.atan2(e*i,r*a),Math.asin(r&&n*i/r)]},n}var to=eo((function(e){return Math.sqrt(2/(1+e))}),(function(e){return 2*Math.asin(e/2)}));(i.geo.azimuthalEqualArea=function(){return Or(to)}).raw=to;var no=eo((function(e){var t=Math.acos(e);return t&&t/Math.sin(t)}),P);function ro(e,t){var n=Math.cos(e),r=function(e){return Math.tan(Ie/4+e/2)},o=e===t?Math.sin(e):Math.log(n/Math.cos(t))/Math.log(r(t)/r(e)),i=n*Math.pow(r(e),o)/o;if(!o)return ao;function a(e,t){i>0?t<-$e+ke&&(t=-$e+ke):t>$e-ke&&(t=$e-ke);var n=i/Math.pow(r(t),o);return[n*Math.sin(o*e),i-n*Math.cos(o*e)]}return a.invert=function(e,t){var n=i-t,r=qe(o)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/o,2*Math.atan(Math.pow(i/r,1/o))-$e]},a}function oo(e,t){var n=Math.cos(e),r=e===t?Math.sin(e):(n-Math.cos(t))/(t-e),o=n/r+e;if(C(r)<ke)return zr;function i(e,t){var n=o-t;return[n*Math.sin(r*e),o-n*Math.cos(r*e)]}return i.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/r,o-qe(r)*Math.sqrt(e*e+n*n)]},i}(i.geo.azimuthalEquidistant=function(){return Or(no)}).raw=no,(i.geo.conicConformal=function(){return hr(ro)}).raw=ro,(i.geo.conicEquidistant=function(){return hr(oo)}).raw=oo;var io=eo((function(e){return 1/e}),Math.atan);function ao(e,t){return[e,Math.log(Math.tan(Ie/4+t/2))]}function so(e){var t,n=Or(e),r=n.scale,o=n.translate,i=n.clipExtent;return n.scale=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=o.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var a=i.apply(n,arguments);if(a===n){if(t=null==e){var s=Ie*r(),u=o();i([[u[0]-s,u[1]-s],[u[0]+s,u[1]+s]])}}else t&&(a=null);return a},n.clipExtent(null)}(i.geo.gnomonic=function(){return Or(io)}).raw=io,ao.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-$e]},(i.geo.mercator=function(){return so(ao)}).raw=ao;var uo=eo((function(){return 1}),Math.asin);(i.geo.orthographic=function(){return Or(uo)}).raw=uo;var co=eo((function(e){return 1/(1+e)}),(function(e){return 2*Math.atan(e)}));function lo(e,t){return[Math.log(Math.tan(Ie/4+t/2)),-e]}function fo(e){return e[0]}function po(e){return e[1]}function ho(e){for(var t=e.length,n=[0,1],r=2,o=2;o<t;o++){for(;r>1&&Oe(e[n[r-2]],e[n[r-1]],e[o])<=0;)--r;n[r++]=o}return n.slice(0,r)}function go(e,t){return e[0]-t[0]||e[1]-t[1]}(i.geo.stereographic=function(){return Or(co)}).raw=co,lo.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-$e]},(i.geo.transverseMercator=function(){var e=so(lo),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90])}).raw=lo,i.geom={},i.geom.hull=function(e){var t=fo,n=po;if(arguments.length)return r(e);function r(e){if(e.length<3)return[];var r,o=Ct(t),i=Ct(n),a=e.length,s=[],u=[];for(r=0;r<a;r++)s.push([+o.call(this,e[r],r),+i.call(this,e[r],r),r]);for(s.sort(go),r=0;r<a;r++)u.push([s[r][0],-s[r][1]]);var c=ho(s),l=ho(u),f=l[0]===c[0],d=l[l.length-1]===c[c.length-1],p=[];for(r=c.length-1;r>=0;--r)p.push(e[s[c[r]][2]]);for(r=+f;r<l.length-d;++r)p.push(e[s[l[r]][2]]);return p}return r.x=function(e){return arguments.length?(t=e,r):t},r.y=function(e){return arguments.length?(n=e,r):n},r},i.geom.polygon=function(e){return V(e,yo),e};var yo=i.geom.polygon.prototype=[];function mo(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function vo(e,t,n,r){var o=e[0],i=n[0],a=t[0]-o,s=r[0]-i,u=e[1],c=n[1],l=t[1]-u,f=r[1]-c,d=(s*(u-c)-f*(o-i))/(f*a-s*l);return[o+d*a,u+d*l]}function xo(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}yo.area=function(){for(var e,t=-1,n=this.length,r=this[n-1],o=0;++t<n;)e=r,r=this[t],o+=e[1]*r[0]-e[0]*r[1];return.5*o},yo.centroid=function(e){var t,n,r=-1,o=this.length,i=0,a=0,s=this[o-1];for(arguments.length||(e=-1/(6*this.area()));++r<o;)t=s,s=this[r],n=t[0]*s[1]-s[0]*t[1],i+=(t[0]+s[0])*n,a+=(t[1]+s[1])*n;return[i*e,a*e]},yo.clip=function(e){for(var t,n,r,o,i,a,s=xo(e),u=-1,c=this.length-xo(this),l=this[c-1];++u<c;){for(t=e.slice(),e.length=0,o=this[u],i=t[(r=t.length-s)-1],n=-1;++n<r;)mo(a=t[n],l,o)?(mo(i,l,o)||e.push(vo(i,a,l,o)),e.push(a)):mo(i,l,o)&&e.push(vo(i,a,l,o)),i=a;s&&e.push(e[0]),l=o}return e};var wo,bo,Co,So,Mo,Eo=[],_o=[];function To(){Bo(this),this.edge=this.site=this.circle=null}function Ro(e){var t=Eo.pop()||new To;return t.site=e,t}function ko(e){Oo(e),Co.remove(e),Eo.push(e),Bo(e)}function Ao(e){var t=e.circle,n=t.x,r=t.cy,o={x:n,y:r},i=e.P,a=e.N,s=[e];ko(e);for(var u=i;u.circle&&C(n-u.circle.x)<ke&&C(r-u.circle.cy)<ke;)i=u.P,s.unshift(u),ko(u),u=i;s.unshift(u),Oo(u);for(var c=a;c.circle&&C(n-c.circle.x)<ke&&C(r-c.circle.cy)<ke;)a=c.N,s.push(c),ko(c),c=a;s.push(c),Oo(c);var l,f=s.length;for(l=1;l<f;++l)c=s[l],u=s[l-1],Ho(c.edge,u.site,c.site,o);u=s[0],(c=s[f-1]).edge=zo(u.site,c.site,null,o),qo(u),qo(c)}function Io(e){for(var t,n,r,o,i=e.x,a=e.y,s=Co._;s;)if((r=No(s,a)-i)>ke)s=s.L;else{if(!((o=i-Lo(s,a))>ke)){r>-ke?(t=s.P,n=s):o>-ke?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}var u=Ro(e);if(Co.insert(t,u),t||n){if(t===n)return Oo(t),n=Ro(t.site),Co.insert(u,n),u.edge=n.edge=zo(t.site,u.site),qo(t),void qo(n);if(n){Oo(t),Oo(n);var c=t.site,l=c.x,f=c.y,d=e.x-l,p=e.y-f,h=n.site,g=h.x-l,y=h.y-f,m=2*(d*y-p*g),v=d*d+p*p,x=g*g+y*y,w={x:(y*v-p*x)/m+l,y:(d*x-g*v)/m+f};Ho(n.edge,c,h,w),u.edge=zo(c,e,null,w),n.edge=zo(e,h,null,w),qo(t),qo(n)}else u.edge=zo(t.site,u.site)}}function No(e,t){var n=e.site,r=n.x,o=n.y,i=o-t;if(!i)return r;var a=e.P;if(!a)return-1/0;var s=(n=a.site).x,u=n.y,c=u-t;if(!c)return s;var l=s-r,f=1/i-1/c,d=l/c;return f?(-d+Math.sqrt(d*d-2*f*(l*l/(-2*c)-u+c/2+o-i/2)))/f+r:(r+s)/2}function Lo(e,t){var n=e.N;if(n)return No(n,t);var r=e.site;return r.y===t?r.x:1/0}function $o(e){this.site=e,this.edges=[]}function Do(e,t){return t.angle-e.angle}function Po(){Bo(this),this.x=this.y=this.arc=this.site=this.cy=null}function qo(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,o=e.site,i=n.site;if(r!==i){var a=o.x,s=o.y,u=r.x-a,c=r.y-s,l=i.x-a,f=2*(u*(y=i.y-s)-c*l);if(!(f>=-Ae)){var d=u*u+c*c,p=l*l+y*y,h=(y*d-c*p)/f,g=(u*p-l*d)/f,y=g+s,m=_o.pop()||new Po;m.arc=e,m.site=o,m.x=h+a,m.y=y+Math.sqrt(h*h+g*g),m.cy=y,e.circle=m;for(var v=null,x=Mo._;x;)if(m.y<x.y||m.y===x.y&&m.x<=x.x){if(!x.L){v=x.P;break}x=x.L}else{if(!x.R){v=x;break}x=x.R}Mo.insert(v,m),v||(So=m)}}}}function Oo(e){var t=e.circle;t&&(t.P||(So=t.N),Mo.remove(t),_o.push(t),Bo(t),e.circle=null)}function Uo(e,t){var n=e.b;if(n)return!0;var r,o,i=e.a,a=t[0][0],s=t[1][0],u=t[0][1],c=t[1][1],l=e.l,f=e.r,d=l.x,p=l.y,h=f.x,g=f.y,y=(d+h)/2,m=(p+g)/2;if(g===p){if(y<a||y>=s)return;if(d>h){if(i){if(i.y>=c)return}else i={x:y,y:u};n={x:y,y:c}}else{if(i){if(i.y<u)return}else i={x:y,y:c};n={x:y,y:u}}}else if(o=m-(r=(d-h)/(g-p))*y,r<-1||r>1)if(d>h){if(i){if(i.y>=c)return}else i={x:(u-o)/r,y:u};n={x:(c-o)/r,y:c}}else{if(i){if(i.y<u)return}else i={x:(c-o)/r,y:c};n={x:(u-o)/r,y:u}}else if(p<g){if(i){if(i.x>=s)return}else i={x:a,y:r*a+o};n={x:s,y:r*s+o}}else{if(i){if(i.x<a)return}else i={x:s,y:r*s+o};n={x:a,y:r*a+o}}return e.a=i,e.b=n,!0}function jo(e,t){this.l=e,this.r=t,this.a=this.b=null}function zo(e,t,n,r){var o=new jo(e,t);return wo.push(o),n&&Ho(o,e,t,n),r&&Ho(o,t,e,r),bo[e.i].edges.push(new Fo(o,e,t)),bo[t.i].edges.push(new Fo(o,t,e)),o}function Qo(e,t,n){var r=new jo(e,null);return r.a=t,r.b=n,wo.push(r),r}function Ho(e,t,n,r){e.a||e.b?e.l===n?e.b=r:e.a=r:(e.a=r,e.l=t,e.r=n)}function Fo(e,t,n){var r=e.a,o=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(o.x-r.x,r.y-o.y):Math.atan2(r.x-o.x,o.y-r.y)}function Go(){this._=null}function Bo(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Vo(e,t){var n=t,r=t.R,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Yo(e,t){var n=t,r=t.L,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function Wo(e){for(;e.L;)e=e.L;return e}function Xo(e,t){var n,r,o,i=e.sort(Zo).pop();for(wo=[],bo=new Array(e.length),Co=new Go,Mo=new Go;;)if(o=So,i&&(!o||i.y<o.y||i.y===o.y&&i.x<o.x))i.x===n&&i.y===r||(bo[i.i]=new $o(i),Io(i),n=i.x,r=i.y),i=e.pop();else{if(!o)break;Ao(o.arc)}t&&(function(e){for(var t,n=wo,r=fr(e[0][0],e[0][1],e[1][0],e[1][1]),o=n.length;o--;)(!Uo(t=n[o],e)||!r(t)||C(t.a.x-t.b.x)<ke&&C(t.a.y-t.b.y)<ke)&&(t.a=t.b=null,n.splice(o,1))}(t),function(e){for(var t,n,r,o,i,a,s,u,c,l,f=e[0][0],d=e[1][0],p=e[0][1],h=e[1][1],g=bo,y=g.length;y--;)if((i=g[y])&&i.prepare())for(u=(s=i.edges).length,a=0;a<u;)r=(l=s[a].end()).x,o=l.y,t=(c=s[++a%u].start()).x,n=c.y,(C(r-t)>ke||C(o-n)>ke)&&(s.splice(a,0,new Fo(Qo(i.site,l,C(r-f)<ke&&h-o>ke?{x:f,y:C(t-f)<ke?n:h}:C(o-h)<ke&&d-r>ke?{x:C(n-h)<ke?t:d,y:h}:C(r-d)<ke&&o-p>ke?{x:d,y:C(t-d)<ke?n:p}:C(o-p)<ke&&r-f>ke?{x:C(n-p)<ke?t:f,y:p}:null),i.site,null)),++u)}(t));var a={cells:bo,edges:wo};return Co=Mo=wo=bo=null,a}function Zo(e,t){return t.y-e.y||t.x-e.x}$o.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)(e=t[n].edge).b&&e.a||t.splice(n,1);return t.sort(Do),t.length},Fo.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Go.prototype={insert:function(e,t){var n,r,o;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=Wo(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(o=r.R)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.R&&(Vo(this,n),n=(e=n).U),n.C=!1,r.C=!0,Yo(this,r)):(o=r.L)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.L&&(Yo(this,n),n=(e=n).U),n.C=!1,r.C=!0,Vo(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,o=e.U,i=e.L,a=e.R;if(n=i?a?Wo(a):i:a,o?o.L===e?o.L=n:o.R=n:this._=n,i&&a?(r=n.C,n.C=e.C,n.L=i,i.U=n,n!==a?(o=n.U,n.U=e.U,e=n.R,o.L=e,n.R=a,a.U=n):(n.U=o,o=n,e=n.R)):(r=e.C,e=n),e&&(e.U=o),!r)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===o.L){if((t=o.R).C&&(t.C=!1,o.C=!0,Vo(this,o),t=o.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Yo(this,t),t=o.R),t.C=o.C,o.C=t.R.C=!1,Vo(this,o),e=this._;break}}else if((t=o.L).C&&(t.C=!1,o.C=!0,Yo(this,o),t=o.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Vo(this,t),t=o.L),t.C=o.C,o.C=t.L.C=!1,Yo(this,o),e=this._;break}t.C=!0,e=o,o=o.U}while(!e.C);e&&(e.C=!1)}}},i.geom.voronoi=function(e){var t=fo,n=po,r=t,o=n,i=Ko;if(e)return a(e);function a(e){var t=new Array(e.length),n=i[0][0],r=i[0][1],o=i[1][0],a=i[1][1];return Xo(s(e),i).cells.forEach((function(i,s){var u=i.edges,c=i.site;(t[s]=u.length?u.map((function(e){var t=e.start();return[t.x,t.y]})):c.x>=n&&c.x<=o&&c.y>=r&&c.y<=a?[[n,a],[o,a],[o,r],[n,r]]:[]).point=e[s]})),t}function s(e){return e.map((function(e,t){return{x:Math.round(r(e,t)/ke)*ke,y:Math.round(o(e,t)/ke)*ke,i:t}}))}return a.links=function(e){return Xo(s(e)).edges.filter((function(e){return e.l&&e.r})).map((function(t){return{source:e[t.l.i],target:e[t.r.i]}}))},a.triangles=function(e){var t=[];return Xo(s(e)).cells.forEach((function(n,r){for(var o,i,a,s,u=n.site,c=n.edges.sort(Do),l=-1,f=c.length,d=c[f-1].edge,p=d.l===u?d.r:d.l;++l<f;)d,o=p,p=(d=c[l].edge).l===u?d.r:d.l,r<o.i&&r<p.i&&(a=o,s=p,((i=u).x-s.x)*(a.y-i.y)-(i.x-a.x)*(s.y-i.y)<0)&&t.push([e[r],e[o.i],e[p.i]])})),t},a.x=function(e){return arguments.length?(r=Ct(t=e),a):t},a.y=function(e){return arguments.length?(o=Ct(n=e),a):n},a.clipExtent=function(e){return arguments.length?(i=null==e?Ko:e,a):i===Ko?null:i},a.size=function(e){return arguments.length?a.clipExtent(e&&[[0,0],e]):i===Ko?null:i&&i[1]},a};var Ko=[[-1e6,-1e6],[1e6,1e6]];function Jo(e){return e.x}function ei(e){return e.y}function ti(e,t,n,r,o,i){if(!e(t,n,r,o,i)){var a=.5*(n+o),s=.5*(r+i),u=t.nodes;u[0]&&ti(e,u[0],n,r,a,s),u[1]&&ti(e,u[1],a,r,o,s),u[2]&&ti(e,u[2],n,s,a,i),u[3]&&ti(e,u[3],a,s,o,i)}}function ni(e,t,n,r,o,i,a){var s,u=1/0;return function e(c,l,f,d,p){if(!(l>i||f>a||d<r||p<o)){if(h=c.point){var h,g=t-c.x,y=n-c.y,m=g*g+y*y;if(m<u){var v=Math.sqrt(u=m);r=t-v,o=n-v,i=t+v,a=n+v,s=h}}for(var x=c.nodes,w=.5*(l+d),b=.5*(f+p),C=(n>=b)<<1|t>=w,S=C+4;C<S;++C)if(c=x[3&C])switch(3&C){case 0:e(c,l,f,w,b);break;case 1:e(c,w,f,d,b);break;case 2:e(c,l,b,w,p);break;case 3:e(c,w,b,d,p)}}}(e,r,o,i,a),s}function ri(e,t){e=i.rgb(e),t=i.rgb(t);var n=e.r,r=e.g,o=e.b,a=t.r-n,s=t.g-r,u=t.b-o;return function(e){return"#"+gt(Math.round(n+a*e))+gt(Math.round(r+s*e))+gt(Math.round(o+u*e))}}function oi(e,t){var n,r={},o={};for(n in e)n in t?r[n]=ci(e[n],t[n]):o[n]=e[n];for(n in t)n in e||(o[n]=t[n]);return function(e){for(n in r)o[n]=r[n](e);return o}}function ii(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ai(e,t){var n,r,o,i=si.lastIndex=ui.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=si.exec(e))&&(r=ui.exec(t));)(o=r.index)>i&&(o=t.slice(i,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:ii(n,r)})),i=ui.lastIndex;return i<t.length&&(o=t.slice(i),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?(t=u[0].x,function(e){return t(e)+""}):function(){return t}:(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}i.geom.delaunay=function(e){return i.geom.voronoi().triangles(e)},i.geom.quadtree=function(e,t,n,r,o){var i,a=fo,s=po;if(i=arguments.length)return a=Jo,s=ei,3===i&&(o=n,r=t,n=t=0),u(e);function u(e){var u,c,l,f,d,p,h,g,y,m=Ct(a),v=Ct(s);if(null!=t)p=t,h=n,g=r,y=o;else if(g=y=-(p=h=1/0),c=[],l=[],d=e.length,i)for(f=0;f<d;++f)(u=e[f]).x<p&&(p=u.x),u.y<h&&(h=u.y),u.x>g&&(g=u.x),u.y>y&&(y=u.y),c.push(u.x),l.push(u.y);else for(f=0;f<d;++f){var x=+m(u=e[f],f),w=+v(u,f);x<p&&(p=x),w<h&&(h=w),x>g&&(g=x),w>y&&(y=w),c.push(x),l.push(w)}var b=g-p,S=y-h;function M(e,t,n,r,o,i,a,s){if(!isNaN(n)&&!isNaN(r))if(e.leaf){var u=e.x,c=e.y;if(null!=u)if(C(u-n)+C(c-r)<.01)E(e,t,n,r,o,i,a,s);else{var l=e.point;e.x=e.y=e.point=null,E(e,l,u,c,o,i,a,s),E(e,t,n,r,o,i,a,s)}else e.x=n,e.y=r,e.point=t}else E(e,t,n,r,o,i,a,s)}function E(e,t,n,r,o,i,a,s){var u=.5*(o+a),c=.5*(i+s),l=n>=u,f=r>=c,d=f<<1|l;e.leaf=!1,l?o=u:a=u,f?i=c:s=c,M(e=e.nodes[d]||(e.nodes[d]={leaf:!0,nodes:[],point:null,x:null,y:null}),t,n,r,o,i,a,s)}b>S?y=h+b:g=p+S;var _={leaf:!0,nodes:[],point:null,x:null,y:null,add:function(e){M(_,e,+m(e,++f),+v(e,f),p,h,g,y)},visit:function(e){ti(e,_,p,h,g,y)},find:function(e){return ni(_,e[0],e[1],p,h,g,y)}};if(f=-1,null==t){for(;++f<d;)M(_,e[f],c[f],l[f],p,h,g,y);--f}else e.forEach(_.add);return c=l=e=u=null,_}return u.x=function(e){return arguments.length?(a=e,u):a},u.y=function(e){return arguments.length?(s=e,u):s},u.extent=function(e){return arguments.length?(null==e?t=n=r=o=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],o=+e[1][1]),u):null==t?null:[[t,n],[r,o]]},u.size=function(e){return arguments.length?(null==e?t=n=r=o=null:(t=n=0,r=+e[0],o=+e[1]),u):null==t?null:[r-t,o-n]},u},i.interpolateRgb=ri,i.interpolateObject=oi,i.interpolateNumber=ii,i.interpolateString=ai;var si=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ui=new RegExp(si.source,"g");function ci(e,t){for(var n,r=i.interpolators.length;--r>=0&&!(n=i.interpolators[r](e,t)););return n}function li(e,t){var n,r=[],o=[],i=e.length,a=t.length,s=Math.min(e.length,t.length);for(n=0;n<s;++n)r.push(ci(e[n],t[n]));for(;n<i;++n)o[n]=e[n];for(;n<a;++n)o[n]=t[n];return function(e){for(n=0;n<s;++n)o[n]=r[n](e);return o}}i.interpolate=ci,i.interpolators=[function(e,t){var n=typeof t;return("string"===n?bt.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?ri:ai:t instanceof Ve?ri:Array.isArray(t)?li:"object"===n&&isNaN(t)?oi:ii)(e,t)}],i.interpolateArray=li;var fi=function(){return P},di=i.map({linear:fi,poly:function(e){return function(t){return Math.pow(t,e)}},quad:function(){return mi},cubic:function(){return vi},sin:function(){return wi},exp:function(){return bi},circle:function(){return Ci},elastic:function(e,t){var n;arguments.length<2&&(t=.45);arguments.length?n=t/Ne*Math.asin(1/e):(e=1,n=t/4);return function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*Ne/t)}},back:function(e){e||(e=1.70158);return function(t){return t*t*((e+1)*t-e)}},bounce:function(){return Si}}),pi=i.map({in:P,out:gi,"in-out":yi,"out-in":function(e){return yi(gi(e))}});function hi(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function gi(e){return function(t){return 1-e(1-t)}}function yi(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function mi(e){return e*e}function vi(e){return e*e*e}function xi(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function wi(e){return 1-Math.cos(e*$e)}function bi(e){return Math.pow(2,10*(e-1))}function Ci(e){return 1-Math.sqrt(1-e*e)}function Si(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Mi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Ei(e){var t,n,r,o=[e.a,e.b],i=[e.c,e.d],a=Ti(o),s=_i(o,i),u=Ti(((t=i)[0]+=(r=-s)*(n=o)[0],t[1]+=r*n[1],t))||0;o[0]*i[1]<i[0]*o[1]&&(o[0]*=-1,o[1]*=-1,a*=-1,s*=-1),this.rotate=(a?Math.atan2(o[1],o[0]):Math.atan2(-i[0],i[1]))*Pe,this.translate=[e.e,e.f],this.scale=[a,u],this.skew=u?Math.atan2(s,u)*Pe:0}function _i(e,t){return e[0]*t[0]+e[1]*t[1]}function Ti(e){var t=Math.sqrt(_i(e,e));return t&&(e[0]/=t,e[1]/=t),t}i.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.slice(0,t):e,r=t>=0?e.slice(t+1):"in";return n=di.get(n)||fi,hi((r=pi.get(r)||P)(n.apply(null,a.call(arguments,1))))},i.interpolateHcl=function(e,t){e=i.hcl(e),t=i.hcl(t);var n=e.h,r=e.c,o=e.l,a=t.h-n,s=t.c-r,u=t.l-o;isNaN(s)&&(s=0,r=isNaN(r)?t.c:r);isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360);return function(e){return Je(n+a*e,r+s*e,o+u*e)+""}},i.interpolateHsl=function(e,t){e=i.hsl(e),t=i.hsl(t);var n=e.h,r=e.s,o=e.l,a=t.h-n,s=t.s-r,u=t.l-o;isNaN(s)&&(s=0,r=isNaN(r)?t.s:r);isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360);return function(e){return Xe(n+a*e,r+s*e,o+u*e)+""}},i.interpolateHslLong=function(e,t){e=i.hsl(e),t=i.hsl(t);var n=e.h,r=e.s,o=e.l,a=t.h-n,s=t.s-r,u=t.l-o;isNaN(s)&&(s=0,r=isNaN(r)?t.s:r);isNaN(a)&&(a=0,n=isNaN(n)?t.h:n);return function(e){return Xe(n+a*e,r+s*e,o+u*e)+""}},i.interpolateLab=function(e,t){e=i.lab(e),t=i.lab(t);var n=e.l,r=e.a,o=e.b,a=t.l-n,s=t.a-r,u=t.b-o;return function(e){return at(n+a*e,r+s*e,o+u*e)+""}},i.interpolateRound=Mi,i.transform=function(e){var t=u.createElementNS(i.ns.prefix.svg,"g");return(i.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new Ei(n?n.matrix:Ri)})(e)},Ei.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Ri={a:1,b:0,c:0,d:1,e:0,f:0};function ki(e){return e.length?e.pop()+",":""}function Ai(e,t){var n=[],r=[];return e=i.transform(e),t=i.transform(t),function(e,t,n,r){if(e[0]!==t[0]||e[1]!==t[1]){var o=n.push("translate(",null,",",null,")");r.push({i:o-4,x:ii(e[0],t[0])},{i:o-2,x:ii(e[1],t[1])})}else(t[0]||t[1])&&n.push("translate("+t+")")}(e.translate,t.translate,n,r),function(e,t,n,r){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),r.push({i:n.push(ki(n)+"rotate(",null,")")-2,x:ii(e,t)})):t&&n.push(ki(n)+"rotate("+t+")")}(e.rotate,t.rotate,n,r),function(e,t,n,r){e!==t?r.push({i:n.push(ki(n)+"skewX(",null,")")-2,x:ii(e,t)}):t&&n.push(ki(n)+"skewX("+t+")")}(e.skew,t.skew,n,r),function(e,t,n,r){if(e[0]!==t[0]||e[1]!==t[1]){var o=n.push(ki(n)+"scale(",null,",",null,")");r.push({i:o-4,x:ii(e[0],t[0])},{i:o-2,x:ii(e[1],t[1])})}else 1===t[0]&&1===t[1]||n.push(ki(n)+"scale("+t+")")}(e.scale,t.scale,n,r),e=t=null,function(e){for(var t,o=-1,i=r.length;++o<i;)n[(t=r[o]).i]=t.x(e);return n.join("")}}function Ii(e,t){return t=(t-=e=+e)||1/t,function(n){return(n-e)/t}}function Ni(e,t){return t=(t-=e=+e)||1/t,function(n){return Math.max(0,Math.min(1,(n-e)/t))}}function Li(e){for(var t=e.source,n=e.target,r=function(e,t){if(e===t)return e;var n=$i(e),r=$i(t),o=n.pop(),i=r.pop(),a=null;for(;o===i;)a=o,o=n.pop(),i=r.pop();return a}(t,n),o=[t];t!==r;)t=t.parent,o.push(t);for(var i=o.length;n!==r;)o.splice(i,0,n),n=n.parent;return o}function $i(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function Di(e){e.fixed|=2}function Pi(e){e.fixed&=-7}function qi(e){e.fixed|=4,e.px=e.x,e.py=e.y}function Oi(e){e.fixed&=-5}i.interpolateTransform=Ai,i.layout={},i.layout.bundle=function(){return function(e){for(var t=[],n=-1,r=e.length;++n<r;)t.push(Li(e[n]));return t}},i.layout.chord=function(){var e,t,n,r,o,a,s,u={},c=0;function l(){var u,l,d,p,h,g={},y=[],m=i.range(r),v=[];for(e=[],t=[],u=0,p=-1;++p<r;){for(l=0,h=-1;++h<r;)l+=n[p][h];y.push(l),v.push(i.range(r)),u+=l}for(o&&m.sort((function(e,t){return o(y[e],y[t])})),a&&v.forEach((function(e,t){e.sort((function(e,r){return a(n[t][e],n[t][r])}))})),u=(Ne-c*r)/u,l=0,p=-1;++p<r;){for(d=l,h=-1;++h<r;){var x=m[p],w=v[x][h],b=n[x][w],C=l,S=l+=b*u;g[x+"-"+w]={index:x,subindex:w,startAngle:C,endAngle:S,value:b}}t[x]={index:x,startAngle:d,endAngle:l,value:y[x]},l+=c}for(p=-1;++p<r;)for(h=p-1;++h<r;){var M=g[p+"-"+h],E=g[h+"-"+p];(M.value||E.value)&&e.push(M.value<E.value?{source:E,target:M}:{source:M,target:E})}s&&f()}function f(){e.sort((function(e,t){return s((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)}))}return u.matrix=function(o){return arguments.length?(r=(n=o)&&n.length,e=t=null,u):n},u.padding=function(n){return arguments.length?(c=n,e=t=null,u):c},u.sortGroups=function(n){return arguments.length?(o=n,e=t=null,u):o},u.sortSubgroups=function(t){return arguments.length?(a=t,e=null,u):a},u.sortChords=function(t){return arguments.length?(s=t,e&&f(),u):s},u.chords=function(){return e||l(),e},u.groups=function(){return t||l(),t},u},i.layout.force=function(){var e,t,n,r,o,a,s={},u=i.dispatch("start","tick","end"),c=[1,1],l=.9,f=Ui,d=ji,p=-30,h=zi,g=.1,y=.64,m=[],v=[];function x(e){return function(t,n,r,o){if(t.point!==e){var i=t.cx-e.x,a=t.cy-e.y,s=o-n,u=i*i+a*a;if(s*s/y<u){if(u<h){var c=t.charge/u;e.px-=i*c,e.py-=a*c}return!0}if(t.point&&u&&u<h){c=t.pointCharge/u;e.px-=i*c,e.py-=a*c}}return!t.charge}}function w(e){e.px=i.event.x,e.py=i.event.y,s.resume()}return s.tick=function(){if((n*=.99)<.005)return e=null,u.end({type:"end",alpha:n=0}),!0;var t,s,f,d,h,y,w,b,C,S=m.length,M=v.length;for(s=0;s<M;++s)d=(f=v[s]).source,(y=(b=(h=f.target).x-d.x)*b+(C=h.y-d.y)*C)&&(b*=y=n*o[s]*((y=Math.sqrt(y))-r[s])/y,C*=y,h.x-=b*(w=d.weight+h.weight?d.weight/(d.weight+h.weight):.5),h.y-=C*w,d.x+=b*(w=1-w),d.y+=C*w);if((w=n*g)&&(b=c[0]/2,C=c[1]/2,s=-1,w))for(;++s<S;)(f=m[s]).x+=(b-f.x)*w,f.y+=(C-f.y)*w;if(p)for(!function e(t,n,r){var o=0,i=0;if(t.charge=0,!t.leaf)for(var a,s=t.nodes,u=s.length,c=-1;++c<u;)null!=(a=s[c])&&(e(a,n,r),t.charge+=a.charge,o+=a.charge*a.cx,i+=a.charge*a.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var l=n*r[t.point.index];t.charge+=t.pointCharge=l,o+=l*t.point.x,i+=l*t.point.y}t.cx=o/t.charge,t.cy=i/t.charge}(t=i.geom.quadtree(m),n,a),s=-1;++s<S;)(f=m[s]).fixed||t.visit(x(f));for(s=-1;++s<S;)(f=m[s]).fixed?(f.x=f.px,f.y=f.py):(f.x-=(f.px-(f.px=f.x))*l,f.y-=(f.py-(f.py=f.y))*l);u.tick({type:"tick",alpha:n})},s.nodes=function(e){return arguments.length?(m=e,s):m},s.links=function(e){return arguments.length?(v=e,s):v},s.size=function(e){return arguments.length?(c=e,s):c},s.linkDistance=function(e){return arguments.length?(f="function"==typeof e?e:+e,s):f},s.distance=s.linkDistance,s.linkStrength=function(e){return arguments.length?(d="function"==typeof e?e:+e,s):d},s.friction=function(e){return arguments.length?(l=+e,s):l},s.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,s):p},s.chargeDistance=function(e){return arguments.length?(h=e*e,s):Math.sqrt(h)},s.gravity=function(e){return arguments.length?(g=+e,s):g},s.theta=function(e){return arguments.length?(y=e*e,s):Math.sqrt(y)},s.alpha=function(t){return arguments.length?(t=+t,n?t>0?n=t:(e.c=null,e.t=NaN,e=null,u.end({type:"end",alpha:n=0})):t>0&&(u.start({type:"start",alpha:n=t}),e=At(s.tick)),s):n},s.start=function(){var e,t,n,i=m.length,u=v.length,l=c[0],h=c[1];for(e=0;e<i;++e)(n=m[e]).index=e,n.weight=0;for(e=0;e<u;++e)"number"==typeof(n=v[e]).source&&(n.source=m[n.source]),"number"==typeof n.target&&(n.target=m[n.target]),++n.source.weight,++n.target.weight;for(e=0;e<i;++e)n=m[e],isNaN(n.x)&&(n.x=g("x",l)),isNaN(n.y)&&(n.y=g("y",h)),isNaN(n.px)&&(n.px=n.x),isNaN(n.py)&&(n.py=n.y);if(r=[],"function"==typeof f)for(e=0;e<u;++e)r[e]=+f.call(this,v[e],e);else for(e=0;e<u;++e)r[e]=f;if(o=[],"function"==typeof d)for(e=0;e<u;++e)o[e]=+d.call(this,v[e],e);else for(e=0;e<u;++e)o[e]=d;if(a=[],"function"==typeof p)for(e=0;e<i;++e)a[e]=+p.call(this,m[e],e);else for(e=0;e<i;++e)a[e]=p;function g(n,r){if(!t){for(t=new Array(i),c=0;c<i;++c)t[c]=[];for(c=0;c<u;++c){var o=v[c];t[o.source.index].push(o.target),t[o.target.index].push(o.source)}}for(var a,s=t[e],c=-1,l=s.length;++c<l;)if(!isNaN(a=s[c][n]))return a;return Math.random()*r}return s.resume()},s.resume=function(){return s.alpha(.1)},s.stop=function(){return s.alpha(0)},s.drag=function(){if(t||(t=i.behavior.drag().origin(P).on("dragstart.force",Di).on("drag.force",w).on("dragend.force",Pi)),!arguments.length)return t;this.on("mouseover.force",qi).on("mouseout.force",Oi).call(t)},i.rebind(s,u,"on")};var Ui=20,ji=1,zi=1/0;function Qi(e,t){return i.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=Yi,e}function Hi(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(o=e.children)&&(r=o.length))for(var r,o;--r>=0;)n.push(o[r])}function Fi(e,t){for(var n=[e],r=[];null!=(e=n.pop());)if(r.push(e),(i=e.children)&&(o=i.length))for(var o,i,a=-1;++a<o;)n.push(i[a]);for(;null!=(e=r.pop());)t(e)}function Gi(e){return e.children}function Bi(e){return e.value}function Vi(e,t){return t.value-e.value}function Yi(e){return i.merge(e.map((function(e){return(e.children||[]).map((function(t){return{source:e,target:t}}))})))}i.layout.hierarchy=function(){var e=Vi,t=Gi,n=Bi;function r(o){var i,a=[o],s=[];for(o.depth=0;null!=(i=a.pop());)if(s.push(i),(c=t.call(r,i,i.depth))&&(u=c.length)){for(var u,c,l;--u>=0;)a.push(l=c[u]),l.parent=i,l.depth=i.depth+1;n&&(i.value=0),i.children=c}else n&&(i.value=+n.call(r,i,i.depth)||0),delete i.children;return Fi(o,(function(t){var r,o;e&&(r=t.children)&&r.sort(e),n&&(o=t.parent)&&(o.value+=t.value)})),s}return r.sort=function(t){return arguments.length?(e=t,r):e},r.children=function(e){return arguments.length?(t=e,r):t},r.value=function(e){return arguments.length?(n=e,r):n},r.revalue=function(e){return n&&(Hi(e,(function(e){e.children&&(e.value=0)})),Fi(e,(function(e){var t;e.children||(e.value=+n.call(r,e,e.depth)||0),(t=e.parent)&&(t.value+=e.value)}))),e},r},i.layout.partition=function(){var e=i.layout.hierarchy(),t=[1,1];function n(n,r){var o=e.call(this,n,r);return function e(t,n,r,o){var i=t.children;if(t.x=n,t.y=t.depth*o,t.dx=r,t.dy=o,i&&(a=i.length)){var a,s,u,c=-1;for(r=t.value?r/t.value:0;++c<a;)e(s=i[c],n,u=s.value*r,o),n+=u}}(o[0],0,t[0],t[1]/function e(t){var n=t.children,r=0;if(n&&(o=n.length))for(var o,i=-1;++i<o;)r=Math.max(r,e(n[i]));return 1+r}(o[0])),o}return n.size=function(e){return arguments.length?(t=e,n):t},Qi(n,e)},i.layout.pie=function(){var e=Number,t=Wi,n=0,r=Ne,o=0;function a(s){var u,c=s.length,l=s.map((function(t,n){return+e.call(a,t,n)})),f=+("function"==typeof n?n.apply(this,arguments):n),d=("function"==typeof r?r.apply(this,arguments):r)-f,p=Math.min(Math.abs(d)/c,+("function"==typeof o?o.apply(this,arguments):o)),h=p*(d<0?-1:1),g=i.sum(l),y=g?(d-c*h)/g:0,m=i.range(c),v=[];return null!=t&&m.sort(t===Wi?function(e,t){return l[t]-l[e]}:function(e,n){return t(s[e],s[n])}),m.forEach((function(e){v[e]={data:s[e],value:u=l[e],startAngle:f,endAngle:f+=u*y+h,padAngle:p}})),v}return a.value=function(t){return arguments.length?(e=t,a):e},a.sort=function(e){return arguments.length?(t=e,a):t},a.startAngle=function(e){return arguments.length?(n=e,a):n},a.endAngle=function(e){return arguments.length?(r=e,a):r},a.padAngle=function(e){return arguments.length?(o=e,a):o},a};var Wi={};function Xi(e){return e.x}function Zi(e){return e.y}function Ki(e,t,n){e.y0=t,e.y=n}i.layout.stack=function(){var e=P,t=ta,n=na,r=Ki,o=Xi,a=Zi;function s(u,c){if(!(p=u.length))return u;var l=u.map((function(t,n){return e.call(s,t,n)})),f=l.map((function(e){return e.map((function(e,t){return[o.call(s,e,t),a.call(s,e,t)]}))})),d=t.call(s,f,c);l=i.permute(l,d),f=i.permute(f,d);var p,h,g,y,m=n.call(s,f,c),v=l[0].length;for(g=0;g<v;++g)for(r.call(s,l[0][g],y=m[g],f[0][g][1]),h=1;h<p;++h)r.call(s,l[h][g],y+=f[h-1][g][1],f[h][g][1]);return u}return s.values=function(t){return arguments.length?(e=t,s):e},s.order=function(e){return arguments.length?(t="function"==typeof e?e:Ji.get(e)||ta,s):t},s.offset=function(e){return arguments.length?(n="function"==typeof e?e:ea.get(e)||na,s):n},s.x=function(e){return arguments.length?(o=e,s):o},s.y=function(e){return arguments.length?(a=e,s):a},s.out=function(e){return arguments.length?(r=e,s):r},s};var Ji=i.map({"inside-out":function(e){var t,n,r=e.length,o=e.map(ra),a=e.map(oa),s=i.range(r).sort((function(e,t){return o[e]-o[t]})),u=0,c=0,l=[],f=[];for(t=0;t<r;++t)n=s[t],u<c?(u+=a[n],l.push(n)):(c+=a[n],f.push(n));return f.reverse().concat(l)},reverse:function(e){return i.range(e.length).reverse()},default:ta}),ea=i.map({silhouette:function(e){var t,n,r,o=e.length,i=e[0].length,a=[],s=0,u=[];for(n=0;n<i;++n){for(t=0,r=0;t<o;t++)r+=e[t][n][1];r>s&&(s=r),a.push(r)}for(n=0;n<i;++n)u[n]=(s-a[n])/2;return u},wiggle:function(e){var t,n,r,o,i,a,s,u,c,l=e.length,f=e[0],d=f.length,p=[];for(p[0]=u=c=0,n=1;n<d;++n){for(t=0,o=0;t<l;++t)o+=e[t][n][1];for(t=0,i=0,s=f[n][0]-f[n-1][0];t<l;++t){for(r=0,a=(e[t][n][1]-e[t][n-1][1])/(2*s);r<t;++r)a+=(e[r][n][1]-e[r][n-1][1])/s;i+=a*e[t][n][1]}p[n]=u-=o?i/o*s:0,u<c&&(c=u)}for(n=0;n<d;++n)p[n]-=c;return p},expand:function(e){var t,n,r,o=e.length,i=e[0].length,a=1/o,s=[];for(n=0;n<i;++n){for(t=0,r=0;t<o;t++)r+=e[t][n][1];if(r)for(t=0;t<o;t++)e[t][n][1]/=r;else for(t=0;t<o;t++)e[t][n][1]=a}for(n=0;n<i;++n)s[n]=0;return s},zero:na});function ta(e){return i.range(e.length)}function na(e){for(var t=-1,n=e[0].length,r=[];++t<n;)r[t]=0;return r}function ra(e){for(var t,n=1,r=0,o=e[0][1],i=e.length;n<i;++n)(t=e[n][1])>o&&(r=n,o=t);return r}function oa(e){return e.reduce(ia,0)}function ia(e,t){return e+t[1]}function aa(e,t){return sa(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function sa(e,t){for(var n=-1,r=+e[0],o=(e[1]-r)/t,i=[];++n<=t;)i[n]=o*n+r;return i}function ua(e){return[i.min(e),i.max(e)]}function ca(e,t){return e.value-t.value}function la(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function fa(e,t){e._pack_next=t,t._pack_prev=e}function da(e,t){var n=t.x-e.x,r=t.y-e.y,o=e.r+t.r;return.999*o*o>n*n+r*r}function pa(e){if((t=e.children)&&(u=t.length)){var t,n,r,o,i,a,s,u,c=1/0,l=-1/0,f=1/0,d=-1/0;if(t.forEach(ha),(n=t[0]).x=-n.r,n.y=0,x(n),u>1&&((r=t[1]).x=r.r,r.y=0,x(r),u>2))for(ya(n,r,o=t[2]),x(o),la(n,o),n._pack_prev=o,la(o,r),r=n._pack_next,i=3;i<u;i++){ya(n,r,o=t[i]);var p=0,h=1,g=1;for(a=r._pack_next;a!==r;a=a._pack_next,h++)if(da(a,o)){p=1;break}if(1==p)for(s=n._pack_prev;s!==a._pack_prev&&!da(s,o);s=s._pack_prev,g++);p?(h<g||h==g&&r.r<n.r?fa(n,r=a):fa(n=s,r),i--):(la(n,o),r=o,x(o))}var y=(c+l)/2,m=(f+d)/2,v=0;for(i=0;i<u;i++)(o=t[i]).x-=y,o.y-=m,v=Math.max(v,o.r+Math.sqrt(o.x*o.x+o.y*o.y));e.r=v,t.forEach(ga)}function x(e){c=Math.min(e.x-e.r,c),l=Math.max(e.x+e.r,l),f=Math.min(e.y-e.r,f),d=Math.max(e.y+e.r,d)}}function ha(e){e._pack_next=e._pack_prev=e}function ga(e){delete e._pack_next,delete e._pack_prev}function ya(e,t,n){var r=e.r+n.r,o=t.x-e.x,i=t.y-e.y;if(r&&(o||i)){var a=t.r+n.r,s=o*o+i*i,u=.5+((r*=r)-(a*=a))/(2*s),c=Math.sqrt(Math.max(0,2*a*(r+s)-(r-=s)*r-a*a))/(2*s);n.x=e.x+u*o+c*i,n.y=e.y+u*i-c*o}else n.x=e.x+r,n.y=e.y}function ma(e,t){return e.parent==t.parent?1:2}function va(e){var t=e.children;return t.length?t[0]:e.t}function xa(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function wa(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function ba(e,t,n){return e.a.parent===t.parent?e.a:n}function Ca(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Sa(e,t){var n=e.x+t[3],r=e.y+t[0],o=e.dx-t[1]-t[3],i=e.dy-t[0]-t[2];return o<0&&(n+=o/2,o=0),i<0&&(r+=i/2,i=0),{x:n,y:r,dx:o,dy:i}}function Ma(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Ea(e){return e.rangeExtent?e.rangeExtent():Ma(e.range())}function _a(e,t,n,r){var o=n(e[0],e[1]),i=r(t[0],t[1]);return function(e){return i(o(e))}}function Ta(e,t){var n,r=0,o=e.length-1,i=e[r],a=e[o];return a<i&&(n=r,r=o,o=n,n=i,i=a,a=n),e[r]=t.floor(i),e[o]=t.ceil(a),e}function Ra(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:ka}i.layout.histogram=function(){var e=!0,t=Number,n=ua,r=aa;function o(o,a){for(var s,u,c=[],l=o.map(t,this),f=n.call(this,l,a),d=r.call(this,f,l,a),p=(a=-1,l.length),h=d.length-1,g=e?1:1/p;++a<h;)(s=c[a]=[]).dx=d[a+1]-(s.x=d[a]),s.y=0;if(h>0)for(a=-1;++a<p;)(u=l[a])>=f[0]&&u<=f[1]&&((s=c[i.bisect(d,u,1,h)-1]).y+=g,s.push(o[a]));return c}return o.value=function(e){return arguments.length?(t=e,o):t},o.range=function(e){return arguments.length?(n=Ct(e),o):n},o.bins=function(e){return arguments.length?(r="number"==typeof e?function(t){return sa(t,e)}:Ct(e),o):r},o.frequency=function(t){return arguments.length?(e=!!t,o):e},o},i.layout.pack=function(){var e,t=i.layout.hierarchy().sort(ca),n=0,r=[1,1];function o(o,i){var a=t.call(this,o,i),s=a[0],u=r[0],c=r[1],l=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,Fi(s,(function(e){e.r=+l(e.value)})),Fi(s,pa),n){var f=n*(e?1:Math.max(2*s.r/u,2*s.r/c))/2;Fi(s,(function(e){e.r+=f})),Fi(s,pa),Fi(s,(function(e){e.r-=f}))}return function e(t,n,r,o){var i=t.children;if(t.x=n+=o*t.x,t.y=r+=o*t.y,t.r*=o,i)for(var a=-1,s=i.length;++a<s;)e(i[a],n,r,o)}(s,u/2,c/2,e?1:1/Math.max(2*s.r/u,2*s.r/c)),a}return o.size=function(e){return arguments.length?(r=e,o):r},o.radius=function(t){return arguments.length?(e=null==t||"function"==typeof t?t:+t,o):e},o.padding=function(e){return arguments.length?(n=+e,o):n},Qi(o,t)},i.layout.tree=function(){var e=i.layout.hierarchy().sort(null).value(null),t=ma,n=[1,1],r=null;function o(o,i){var c=e.call(this,o,i),l=c[0],f=function(e){var t,n={A:null,children:[e]},r=[n];for(;null!=(t=r.pop());)for(var o,i=t.children,a=0,s=i.length;a<s;++a)r.push((i[a]=o={_:i[a],parent:t,children:(o=i[a].children)&&o.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:a}).a=o);return n.children[0]}(l);if(Fi(f,a),f.parent.m=-f.z,Hi(f,s),r)Hi(l,u);else{var d=l,p=l,h=l;Hi(l,(function(e){e.x<d.x&&(d=e),e.x>p.x&&(p=e),e.depth>h.depth&&(h=e)}));var g=t(d,p)/2-d.x,y=n[0]/(p.x+t(p,d)/2+g),m=n[1]/(h.depth||1);Hi(l,(function(e){e.x=(e.x+g)*y,e.y=e.depth*m}))}return c}function a(e){var n=e.children,r=e.parent.children,o=e.i?r[e.i-1]:null;if(n.length){!function(e){var t,n=0,r=0,o=e.children,i=o.length;for(;--i>=0;)(t=o[i]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(e);var i=(n[0].z+n[n.length-1].z)/2;o?(e.z=o.z+t(e._,o._),e.m=e.z-i):e.z=i}else o&&(e.z=o.z+t(e._,o._));e.parent.A=function(e,n,r){if(n){for(var o,i=e,a=e,s=n,u=i.parent.children[0],c=i.m,l=a.m,f=s.m,d=u.m;s=xa(s),i=va(i),s&&i;)u=va(u),(a=xa(a)).a=e,(o=s.z+f-i.z-c+t(s._,i._))>0&&(wa(ba(s,e,r),e,o),c+=o,l+=o),f+=s.m,c+=i.m,d+=u.m,l+=a.m;s&&!xa(a)&&(a.t=s,a.m+=f-l),i&&!va(u)&&(u.t=i,u.m+=c-d,r=e)}return r}(e,o,e.parent.A||r[0])}function s(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function u(e){e.x*=n[0],e.y=e.depth*n[1]}return o.separation=function(e){return arguments.length?(t=e,o):t},o.size=function(e){return arguments.length?(r=null==(n=e)?u:null,o):r?null:n},o.nodeSize=function(e){return arguments.length?(r=null==(n=e)?null:u,o):r?n:null},Qi(o,e)},i.layout.cluster=function(){var e=i.layout.hierarchy().sort(null).value(null),t=ma,n=[1,1],r=!1;function o(o,a){var s,u=e.call(this,o,a),c=u[0],l=0;Fi(c,(function(e){var n=e.children;n&&n.length?(e.x=function(e){return e.reduce((function(e,t){return e+t.x}),0)/e.length}(n),e.y=function(e){return 1+i.max(e,(function(e){return e.y}))}(n)):(e.x=s?l+=t(e,s):0,e.y=0,s=e)}));var f=function e(t){var n=t.children;return n&&n.length?e(n[0]):t}(c),d=function e(t){var n,r=t.children;return r&&(n=r.length)?e(r[n-1]):t}(c),p=f.x-t(f,d)/2,h=d.x+t(d,f)/2;return Fi(c,r?function(e){e.x=(e.x-c.x)*n[0],e.y=(c.y-e.y)*n[1]}:function(e){e.x=(e.x-p)/(h-p)*n[0],e.y=(1-(c.y?e.y/c.y:1))*n[1]}),u}return o.separation=function(e){return arguments.length?(t=e,o):t},o.size=function(e){return arguments.length?(r=null==(n=e),o):r?null:n},o.nodeSize=function(e){return arguments.length?(r=null!=(n=e),o):r?n:null},Qi(o,e)},i.layout.treemap=function(){var e,t=i.layout.hierarchy(),n=Math.round,r=[1,1],o=null,a=Ca,s=!1,u="squarify",c=.5*(1+Math.sqrt(5));function l(e,t){for(var n,r,o=-1,i=e.length;++o<i;)r=(n=e[o]).value*(t<0?0:t),n.area=isNaN(r)||r<=0?0:r}function f(e){var t=e.children;if(t&&t.length){var n,r,o,i=a(e),s=[],c=t.slice(),d=1/0,g="slice"===u?i.dx:"dice"===u?i.dy:"slice-dice"===u?1&e.depth?i.dy:i.dx:Math.min(i.dx,i.dy);for(l(c,i.dx*i.dy/e.value),s.area=0;(o=c.length)>0;)s.push(n=c[o-1]),s.area+=n.area,"squarify"!==u||(r=p(s,g))<=d?(c.pop(),d=r):(s.area-=s.pop().area,h(s,g,i,!1),g=Math.min(i.dx,i.dy),s.length=s.area=0,d=1/0);s.length&&(h(s,g,i,!0),s.length=s.area=0),t.forEach(f)}}function d(e){var t=e.children;if(t&&t.length){var n,r=a(e),o=t.slice(),i=[];for(l(o,r.dx*r.dy/e.value),i.area=0;n=o.pop();)i.push(n),i.area+=n.area,null!=n.z&&(h(i,n.z?r.dx:r.dy,r,!o.length),i.length=i.area=0);t.forEach(d)}}function p(e,t){for(var n,r=e.area,o=0,i=1/0,a=-1,s=e.length;++a<s;)(n=e[a].area)&&(n<i&&(i=n),n>o&&(o=n));return t*=t,(r*=r)?Math.max(t*o*c/r,r/(t*i*c)):1/0}function h(e,t,r,o){var i,a=-1,s=e.length,u=r.x,c=r.y,l=t?n(e.area/t):0;if(t==r.dx){for((o||l>r.dy)&&(l=r.dy);++a<s;)(i=e[a]).x=u,i.y=c,i.dy=l,u+=i.dx=Math.min(r.x+r.dx-u,l?n(i.area/l):0);i.z=!0,i.dx+=r.x+r.dx-u,r.y+=l,r.dy-=l}else{for((o||l>r.dx)&&(l=r.dx);++a<s;)(i=e[a]).x=u,i.y=c,i.dx=l,c+=i.dy=Math.min(r.y+r.dy-c,l?n(i.area/l):0);i.z=!1,i.dy+=r.y+r.dy-c,r.x+=l,r.dx-=l}}function g(n){var o=e||t(n),i=o[0];return i.x=i.y=0,i.value?(i.dx=r[0],i.dy=r[1]):i.dx=i.dy=0,e&&t.revalue(i),l([i],i.dx*i.dy/i.value),(e?d:f)(i),s&&(e=o),o}return g.size=function(e){return arguments.length?(r=e,g):r},g.padding=function(e){if(!arguments.length)return o;function t(t){var n=e.call(g,t,t.depth);return null==n?Ca(t):Sa(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return Sa(t,e)}var r;return a=null==(o=e)?Ca:"function"==(r=typeof e)?t:"number"===r?(e=[e,e,e,e],n):n,g},g.round=function(e){return arguments.length?(n=e?Math.round:Number,g):n!=Number},g.sticky=function(t){return arguments.length?(s=t,e=null,g):s},g.ratio=function(e){return arguments.length?(c=e,g):c},g.mode=function(e){return arguments.length?(u=e+"",g):u},Qi(g,t)},i.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,r,o;do{o=(n=2*Math.random()-1)*n+(r=2*Math.random()-1)*r}while(!o||o>1);return e+t*n*Math.sqrt(-2*Math.log(o)/o)}},logNormal:function(){var e=i.random.normal.apply(i,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=i.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},i.scale={};var ka={floor:P,ceil:P};function Aa(e,t,n,r){var o=[],a=[],s=0,u=Math.min(e.length,t.length)-1;for(e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<=u;)o.push(n(e[s-1],e[s])),a.push(r(t[s-1],t[s]));return function(t){var n=i.bisect(e,t,1,u)-1;return a[n](o[n](t))}}function Ia(e,t){return i.rebind(e,t,"range","rangeRound","interpolate","clamp")}function Na(e,t){return Ta(e,Ra(La(e,t)[2])),Ta(e,Ra(La(e,t)[2])),e}function La(e,t){null==t&&(t=10);var n=Ma(e),r=n[1]-n[0],o=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*o;return i<=.15?o*=10:i<=.35?o*=5:i<=.75&&(o*=2),n[0]=Math.ceil(n[0]/o)*o,n[1]=Math.floor(n[1]/o)*o+.5*o,n[2]=o,n}function $a(e,t){return i.range.apply(i,La(e,t))}function Da(e,t,n){var r=La(e,t);if(n){var o=qt.exec(n);if(o.shift(),"s"===o[8]){var a=i.formatPrefix(Math.max(C(r[0]),C(r[1])));return o[7]||(o[7]="."+qa(a.scale(r[2]))),o[8]="f",n=i.format(o.join("")),function(e){return n(a.scale(e))+a.symbol}}o[7]||(o[7]="."+function(e,t){var n=qa(t[2]);return e in Pa?Math.abs(n-qa(Math.max(C(t[0]),C(t[1]))))+ +("e"!==e):n-2*("%"===e)}(o[8],r)),n=o.join("")}else n=",."+qa(r[2])+"f";return i.format(n)}i.scale.linear=function(){return function e(t,n,r,o){var i,a;function s(){var e=Math.min(t.length,n.length)>2?Aa:_a,s=o?Ni:Ii;return i=e(t,n,s,r),a=e(n,t,s,ci),u}function u(e){return i(e)}return u.invert=function(e){return a(e)},u.domain=function(e){return arguments.length?(t=e.map(Number),s()):t},u.range=function(e){return arguments.length?(n=e,s()):n},u.rangeRound=function(e){return u.range(e).interpolate(Mi)},u.clamp=function(e){return arguments.length?(o=e,s()):o},u.interpolate=function(e){return arguments.length?(r=e,s()):r},u.ticks=function(e){return $a(t,e)},u.tickFormat=function(e,n){return Da(t,e,n)},u.nice=function(e){return Na(t,e),s()},u.copy=function(){return e(t,n,r,o)},s()}([0,1],[0,1],ci,!1)};var Pa={s:1,g:1,p:1,r:1,e:1};function qa(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}i.scale.log=function(){return function e(t,n,r,o){function a(e){return(r?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(n)}function s(e){return r?Math.pow(n,e):-Math.pow(n,-e)}function u(e){return t(a(e))}return u.invert=function(e){return s(t.invert(e))},u.domain=function(e){return arguments.length?(r=e[0]>=0,t.domain((o=e.map(Number)).map(a)),u):o},u.base=function(e){return arguments.length?(n=+e,t.domain(o.map(a)),u):n},u.nice=function(){var e=Ta(o.map(a),r?Math:Ua);return t.domain(e),o=e.map(s),u},u.ticks=function(){var e=Ma(o),t=[],i=e[0],u=e[1],c=Math.floor(a(i)),l=Math.ceil(a(u)),f=n%1?2:n;if(isFinite(l-c)){if(r){for(;c<l;c++)for(var d=1;d<f;d++)t.push(s(c)*d);t.push(s(c))}else for(t.push(s(c));c++<l;)for(d=f-1;d>0;d--)t.push(s(c)*d);for(c=0;t[c]<i;c++);for(l=t.length;t[l-1]>u;l--);t=t.slice(c,l)}return t},u.tickFormat=function(e,t){if(!arguments.length)return Oa;arguments.length<2?t=Oa:"function"!=typeof t&&(t=i.format(t));var r=Math.max(1,n*e/u.ticks().length);return function(e){var o=e/s(Math.round(a(e)));return o*n<n-.5&&(o*=n),o<=r?t(e):""}},u.copy=function(){return e(t.copy(),n,r,o)},Ia(u,t)}(i.scale.linear().domain([0,1]),10,!0,[1,10])};var Oa=i.format(".0e"),Ua={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};function ja(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}i.scale.pow=function(){return function e(t,n,r){var o=ja(n),i=ja(1/n);function a(e){return t(o(e))}return a.invert=function(e){return i(t.invert(e))},a.domain=function(e){return arguments.length?(t.domain((r=e.map(Number)).map(o)),a):r},a.ticks=function(e){return $a(r,e)},a.tickFormat=function(e,t){return Da(r,e,t)},a.nice=function(e){return a.domain(Na(r,e))},a.exponent=function(e){return arguments.length?(o=ja(n=e),i=ja(1/n),t.domain(r.map(o)),a):n},a.copy=function(){return e(t.copy(),n,r)},Ia(a,t)}(i.scale.linear(),1,[0,1])},i.scale.sqrt=function(){return i.scale.pow().exponent(.5)},i.scale.ordinal=function(){return function e(t,n){var r,o,a;function s(e){return o[((r.get(e)||("range"===n.t?r.set(e,t.push(e)):NaN))-1)%o.length]}function u(e,n){return i.range(t.length).map((function(t){return e+n*t}))}return s.domain=function(e){if(!arguments.length)return t;t=[],r=new E;for(var o,i=-1,a=e.length;++i<a;)r.has(o=e[i])||r.set(o,t.push(o));return s[n.t].apply(s,n.a)},s.range=function(e){return arguments.length?(o=e,a=0,n={t:"range",a:arguments},s):o},s.rangePoints=function(e,r){arguments.length<2&&(r=0);var i=e[0],c=e[1],l=t.length<2?(i=(i+c)/2,0):(c-i)/(t.length-1+r);return o=u(i+l*r/2,l),a=0,n={t:"rangePoints",a:arguments},s},s.rangeRoundPoints=function(e,r){arguments.length<2&&(r=0);var i=e[0],c=e[1],l=t.length<2?(i=c=Math.round((i+c)/2),0):(c-i)/(t.length-1+r)|0;return o=u(i+Math.round(l*r/2+(c-i-(t.length-1+r)*l)/2),l),a=0,n={t:"rangeRoundPoints",a:arguments},s},s.rangeBands=function(e,r,i){arguments.length<2&&(r=0),arguments.length<3&&(i=r);var c=e[1]<e[0],l=e[c-0],f=e[1-c],d=(f-l)/(t.length-r+2*i);return o=u(l+d*i,d),c&&o.reverse(),a=d*(1-r),n={t:"rangeBands",a:arguments},s},s.rangeRoundBands=function(e,r,i){arguments.length<2&&(r=0),arguments.length<3&&(i=r);var c=e[1]<e[0],l=e[c-0],f=e[1-c],d=Math.floor((f-l)/(t.length-r+2*i));return o=u(l+Math.round((f-l-(t.length-r)*d)/2),d),c&&o.reverse(),a=Math.round(d*(1-r)),n={t:"rangeRoundBands",a:arguments},s},s.rangeBand=function(){return a},s.rangeExtent=function(){return Ma(n.a[0])},s.copy=function(){return e(t,n)},s.domain(t)}([],{t:"range",a:[[]]})},i.scale.category10=function(){return i.scale.ordinal().range(za)},i.scale.category20=function(){return i.scale.ordinal().range(Qa)},i.scale.category20b=function(){return i.scale.ordinal().range(Ha)},i.scale.category20c=function(){return i.scale.ordinal().range(Fa)};var za=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(pt),Qa=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(pt),Ha=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(pt),Fa=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(pt);function Ga(){return 0}i.scale.quantile=function(){return function e(t,n){var r;function o(){var e=0,o=n.length;for(r=[];++e<o;)r[e-1]=i.quantile(t,e/o);return a}function a(e){if(!isNaN(e=+e))return n[i.bisect(r,e)]}return a.domain=function(e){return arguments.length?(t=e.map(m).filter(v).sort(y),o()):t},a.range=function(e){return arguments.length?(n=e,o()):n},a.quantiles=function(){return r},a.invertExtent=function(e){return(e=n.indexOf(e))<0?[NaN,NaN]:[e>0?r[e-1]:t[0],e<r.length?r[e]:t[t.length-1]]},a.copy=function(){return e(t,n)},o()}([],[])},i.scale.quantize=function(){return function e(t,n,r){var o,i;function a(e){return r[Math.max(0,Math.min(i,Math.floor(o*(e-t))))]}function s(){return o=r.length/(n-t),i=r.length-1,a}return a.domain=function(e){return arguments.length?(t=+e[0],n=+e[e.length-1],s()):[t,n]},a.range=function(e){return arguments.length?(r=e,s()):r},a.invertExtent=function(e){return[e=(e=r.indexOf(e))<0?NaN:e/o+t,e+1/o]},a.copy=function(){return e(t,n,r)},s()}(0,1,[0,1])},i.scale.threshold=function(){return function e(t,n){function r(e){if(e<=e)return n[i.bisect(t,e)]}return r.domain=function(e){return arguments.length?(t=e,r):t},r.range=function(e){return arguments.length?(n=e,r):n},r.invertExtent=function(e){return e=n.indexOf(e),[t[e-1],t[e]]},r.copy=function(){return e(t,n)},r}([.5],[0,1])},i.scale.identity=function(){return function e(t){function n(e){return+e}return n.invert=n,n.domain=n.range=function(e){return arguments.length?(t=e.map(n),n):t},n.ticks=function(e){return $a(t,e)},n.tickFormat=function(e,n){return Da(t,e,n)},n.copy=function(){return e(t)},n}([0,1])},i.svg={},i.svg.arc=function(){var e=Va,t=Ya,n=Ga,r=Ba,o=Wa,i=Xa,a=Za;function s(){var s=Math.max(0,+e.apply(this,arguments)),c=Math.max(0,+t.apply(this,arguments)),l=o.apply(this,arguments)-$e,f=i.apply(this,arguments)-$e,d=Math.abs(f-l),p=l>f?0:1;if(c<s&&(h=c,c=s,s=h),d>=Le)return u(c,p)+(s?u(s,1-p):"")+"Z";var h,g,y,m,v,x,w,b,C,S,M,E,_=0,T=0,R=[];if((m=(+a.apply(this,arguments)||0)/2)&&(y=r===Ba?Math.sqrt(s*s+c*c):+r.apply(this,arguments),p||(T*=-1),c&&(T=je(y/c*Math.sin(m))),s&&(_=je(y/s*Math.sin(m)))),c){v=c*Math.cos(l+T),x=c*Math.sin(l+T),w=c*Math.cos(f-T),b=c*Math.sin(f-T);var k=Math.abs(f-l-2*T)<=Ie?0:1;if(T&&Ka(v,x,w,b)===p^k){var A=(l+f)/2;v=c*Math.cos(A),x=c*Math.sin(A),w=b=null}}else v=x=0;if(s){C=s*Math.cos(f-_),S=s*Math.sin(f-_),M=s*Math.cos(l+_),E=s*Math.sin(l+_);var I=Math.abs(l-f+2*_)<=Ie?0:1;if(_&&Ka(C,S,M,E)===1-p^I){var N=(l+f)/2;C=s*Math.cos(N),S=s*Math.sin(N),M=E=null}}else C=S=0;if(d>ke&&(h=Math.min(Math.abs(c-s)/2,+n.apply(this,arguments)))>.001){g=s<c^p?0:1;var L=h,$=h;if(d<Ie){var D=null==M?[C,S]:null==w?[v,x]:vo([v,x],[M,E],[w,b],[C,S]),P=v-D[0],q=x-D[1],O=w-D[0],U=b-D[1],j=1/Math.sin(Math.acos((P*O+q*U)/(Math.sqrt(P*P+q*q)*Math.sqrt(O*O+U*U)))/2),z=Math.sqrt(D[0]*D[0]+D[1]*D[1]);$=Math.min(h,(s-z)/(j-1)),L=Math.min(h,(c-z)/(j+1))}if(null!=w){var Q=Ja(null==M?[C,S]:[M,E],[v,x],c,L,p),H=Ja([w,b],[C,S],c,L,p);h===L?R.push("M",Q[0],"A",L,",",L," 0 0,",g," ",Q[1],"A",c,",",c," 0 ",1-p^Ka(Q[1][0],Q[1][1],H[1][0],H[1][1]),",",p," ",H[1],"A",L,",",L," 0 0,",g," ",H[0]):R.push("M",Q[0],"A",L,",",L," 0 1,",g," ",H[0])}else R.push("M",v,",",x);if(null!=M){var F=Ja([v,x],[M,E],s,-$,p),G=Ja([C,S],null==w?[v,x]:[w,b],s,-$,p);h===$?R.push("L",G[0],"A",$,",",$," 0 0,",g," ",G[1],"A",s,",",s," 0 ",p^Ka(G[1][0],G[1][1],F[1][0],F[1][1]),",",1-p," ",F[1],"A",$,",",$," 0 0,",g," ",F[0]):R.push("L",G[0],"A",$,",",$," 0 0,",g," ",F[0])}else R.push("L",C,",",S)}else R.push("M",v,",",x),null!=w&&R.push("A",c,",",c," 0 ",k,",",p," ",w,",",b),R.push("L",C,",",S),null!=M&&R.push("A",s,",",s," 0 ",I,",",1-p," ",M,",",E);return R.push("Z"),R.join("")}function u(e,t){return"M0,"+e+"A"+e+","+e+" 0 1,"+t+" 0,"+-e+"A"+e+","+e+" 0 1,"+t+" 0,"+e}return s.innerRadius=function(t){return arguments.length?(e=Ct(t),s):e},s.outerRadius=function(e){return arguments.length?(t=Ct(e),s):t},s.cornerRadius=function(e){return arguments.length?(n=Ct(e),s):n},s.padRadius=function(e){return arguments.length?(r=e==Ba?Ba:Ct(e),s):r},s.startAngle=function(e){return arguments.length?(o=Ct(e),s):o},s.endAngle=function(e){return arguments.length?(i=Ct(e),s):i},s.padAngle=function(e){return arguments.length?(a=Ct(e),s):a},s.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+o.apply(this,arguments)+ +i.apply(this,arguments))/2-$e;return[Math.cos(r)*n,Math.sin(r)*n]},s};var Ba="auto";function Va(e){return e.innerRadius}function Ya(e){return e.outerRadius}function Wa(e){return e.startAngle}function Xa(e){return e.endAngle}function Za(e){return e&&e.padAngle}function Ka(e,t,n,r){return(e-n)*t-(t-r)*e>0?0:1}function Ja(e,t,n,r,o){var i=e[0]-t[0],a=e[1]-t[1],s=(o?r:-r)/Math.sqrt(i*i+a*a),u=s*a,c=-s*i,l=e[0]+u,f=e[1]+c,d=t[0]+u,p=t[1]+c,h=(l+d)/2,g=(f+p)/2,y=d-l,m=p-f,v=y*y+m*m,x=n-r,w=l*p-d*f,b=(m<0?-1:1)*Math.sqrt(Math.max(0,x*x*v-w*w)),C=(w*m-y*b)/v,S=(-w*y-m*b)/v,M=(w*m+y*b)/v,E=(-w*y+m*b)/v,_=C-h,T=S-g,R=M-h,k=E-g;return _*_+T*T>R*R+k*k&&(C=M,S=E),[[C-u,S-c],[C*n/x,S*n/x]]}function es(e){var t=fo,n=po,r=tr,o=ns,i=o.key,a=.7;function s(i){var s,u=[],c=[],l=-1,f=i.length,d=Ct(t),p=Ct(n);function h(){u.push("M",o(e(c),a))}for(;++l<f;)r.call(this,s=i[l],l)?c.push([+d.call(this,s,l),+p.call(this,s,l)]):c.length&&(h(),c=[]);return c.length&&h(),u.length?u.join(""):null}return s.x=function(e){return arguments.length?(t=e,s):t},s.y=function(e){return arguments.length?(n=e,s):n},s.defined=function(e){return arguments.length?(r=e,s):r},s.interpolate=function(e){return arguments.length?(i="function"==typeof e?o=e:(o=ts.get(e)||ns).key,s):i},s.tension=function(e){return arguments.length?(a=e,s):a},s}i.svg.line=function(){return es(P)};var ts=i.map({linear:ns,"linear-closed":rs,step:function(e){var t=0,n=e.length,r=e[0],o=[r[0],",",r[1]];for(;++t<n;)o.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);n>1&&o.push("H",r[0]);return o.join("")},"step-before":os,"step-after":is,basis:us,"basis-open":function(e){if(e.length<4)return ns(e);var t,n=[],r=-1,o=e.length,i=[0],a=[0];for(;++r<3;)t=e[r],i.push(t[0]),a.push(t[1]);n.push(cs(ds,i)+","+cs(ds,a)),--r;for(;++r<o;)t=e[r],i.shift(),i.push(t[0]),a.shift(),a.push(t[1]),ps(n,i,a);return n.join("")},"basis-closed":function(e){var t,n,r=-1,o=e.length,i=o+4,a=[],s=[];for(;++r<4;)n=e[r%o],a.push(n[0]),s.push(n[1]);t=[cs(ds,a),",",cs(ds,s)],--r;for(;++r<i;)n=e[r%o],a.shift(),a.push(n[0]),s.shift(),s.push(n[1]),ps(t,a,s);return t.join("")},bundle:function(e,t){var n=e.length-1;if(n)for(var r,o,i=e[0][0],a=e[0][1],s=e[n][0]-i,u=e[n][1]-a,c=-1;++c<=n;)r=e[c],o=c/n,r[0]=t*r[0]+(1-t)*(i+o*s),r[1]=t*r[1]+(1-t)*(a+o*u);return us(e)},cardinal:function(e,t){return e.length<3?ns(e):e[0]+as(e,ss(e,t))},"cardinal-open":function(e,t){return e.length<4?ns(e):e[1]+as(e.slice(1,-1),ss(e,t))},"cardinal-closed":function(e,t){return e.length<3?rs(e):e[0]+as((e.push(e[0]),e),ss([e[e.length-2]].concat(e,[e[1]]),t))},monotone:function(e){return e.length<3?ns(e):e[0]+as(e,function(e){var t,n,r,o,i=[],a=function(e){var t=0,n=e.length-1,r=[],o=e[0],i=e[1],a=r[0]=hs(o,i);for(;++t<n;)r[t]=(a+(a=hs(o=i,i=e[t+1])))/2;return r[t]=a,r}(e),s=-1,u=e.length-1;for(;++s<u;)t=hs(e[s],e[s+1]),C(t)<ke?a[s]=a[s+1]=0:(n=a[s]/t,r=a[s+1]/t,(o=n*n+r*r)>9&&(o=3*t/Math.sqrt(o),a[s]=o*n,a[s+1]=o*r));s=-1;for(;++s<=u;)o=(e[Math.min(u,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+a[s]*a[s])),i.push([o||0,a[s]*o||0]);return i}(e))}});function ns(e){return e.length>1?e.join("L"):e+"Z"}function rs(e){return e.join("L")+"Z"}function os(e){for(var t=0,n=e.length,r=e[0],o=[r[0],",",r[1]];++t<n;)o.push("V",(r=e[t])[1],"H",r[0]);return o.join("")}function is(e){for(var t=0,n=e.length,r=e[0],o=[r[0],",",r[1]];++t<n;)o.push("H",(r=e[t])[0],"V",r[1]);return o.join("")}function as(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return ns(e);var n=e.length!=t.length,r="",o=e[0],i=e[1],a=t[0],s=a,u=1;if(n&&(r+="Q"+(i[0]-2*a[0]/3)+","+(i[1]-2*a[1]/3)+","+i[0]+","+i[1],o=e[1],u=2),t.length>1){s=t[1],i=e[u],u++,r+="C"+(o[0]+a[0])+","+(o[1]+a[1])+","+(i[0]-s[0])+","+(i[1]-s[1])+","+i[0]+","+i[1];for(var c=2;c<t.length;c++,u++)i=e[u],s=t[c],r+="S"+(i[0]-s[0])+","+(i[1]-s[1])+","+i[0]+","+i[1]}if(n){var l=e[u];r+="Q"+(i[0]+2*s[0]/3)+","+(i[1]+2*s[1]/3)+","+l[0]+","+l[1]}return r}function ss(e,t){for(var n,r=[],o=(1-t)/2,i=e[0],a=e[1],s=1,u=e.length;++s<u;)n=i,i=a,a=e[s],r.push([o*(a[0]-n[0]),o*(a[1]-n[1])]);return r}function us(e){if(e.length<3)return ns(e);var t=1,n=e.length,r=e[0],o=r[0],i=r[1],a=[o,o,o,(r=e[1])[0]],s=[i,i,i,r[1]],u=[o,",",i,"L",cs(ds,a),",",cs(ds,s)];for(e.push(e[n-1]);++t<=n;)r=e[t],a.shift(),a.push(r[0]),s.shift(),s.push(r[1]),ps(u,a,s);return e.pop(),u.push("L",r),u.join("")}function cs(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}ts.forEach((function(e,t){t.key=e,t.closed=/-closed$/.test(e)}));var ls=[0,2/3,1/3,0],fs=[0,1/3,2/3,0],ds=[0,1/6,2/3,1/6];function ps(e,t,n){e.push("C",cs(ls,t),",",cs(ls,n),",",cs(fs,t),",",cs(fs,n),",",cs(ds,t),",",cs(ds,n))}function hs(e,t){return(t[1]-e[1])/(t[0]-e[0])}function gs(e){for(var t,n,r,o=-1,i=e.length;++o<i;)n=(t=e[o])[0],r=t[1]-$e,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);return e}function ys(e){var t=fo,n=fo,r=0,o=po,i=tr,a=ns,s=a.key,u=a,c="L",l=.7;function f(s){var f,d,p,h=[],g=[],y=[],m=-1,v=s.length,x=Ct(t),w=Ct(r),b=t===n?function(){return d}:Ct(n),C=r===o?function(){return p}:Ct(o);function S(){h.push("M",a(e(y),l),c,u(e(g.reverse()),l),"Z")}for(;++m<v;)i.call(this,f=s[m],m)?(g.push([d=+x.call(this,f,m),p=+w.call(this,f,m)]),y.push([+b.call(this,f,m),+C.call(this,f,m)])):g.length&&(S(),g=[],y=[]);return g.length&&S(),h.length?h.join(""):null}return f.x=function(e){return arguments.length?(t=n=e,f):n},f.x0=function(e){return arguments.length?(t=e,f):t},f.x1=function(e){return arguments.length?(n=e,f):n},f.y=function(e){return arguments.length?(r=o=e,f):o},f.y0=function(e){return arguments.length?(r=e,f):r},f.y1=function(e){return arguments.length?(o=e,f):o},f.defined=function(e){return arguments.length?(i=e,f):i},f.interpolate=function(e){return arguments.length?(s="function"==typeof e?a=e:(a=ts.get(e)||ns).key,u=a.reverse||a,c=a.closed?"M":"L",f):s},f.tension=function(e){return arguments.length?(l=e,f):l},f}function ms(e){return e.radius}function vs(e){return[e.x,e.y]}function xs(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]-$e;return[n*Math.cos(r),n*Math.sin(r)]}}function ws(){return 64}function bs(){return"circle"}function Cs(e){var t=Math.sqrt(e/Ie);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}i.svg.line.radial=function(){var e=es(gs);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},os.reverse=is,is.reverse=os,i.svg.area=function(){return ys(P)},i.svg.area.radial=function(){var e=ys(gs);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},i.svg.chord=function(){var e=Zr,t=Kr,n=ms,r=Wa,o=Xa;function i(n,r){var o,i,c=a(this,e,n,r),l=a(this,t,n,r),f=function(e){return!(Math.abs(1e3*e.p0[0]-1e3*e.p1[0])<1&&Math.abs(1e3*e.p0[1]-1e3*e.p1[1])<1)};return"M"+c.p0+(f(c)?s(c.r,c.p1,c.a1-c.a0):"")+(i=l,(o=c).a0==i.a0&&o.a1==i.a1?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+(f(l)?s(l.r,l.p1,l.a1-l.a0):"")+u(l.r,l.p1,c.r,c.p0))+"Z"}function a(e,t,i,a){var s=t.call(e,i,a),u=n.call(e,s,a),c=r.call(e,s,a)-$e,l=o.call(e,s,a)-$e;return{r:u,a0:c,a1:l,p0:[u*Math.cos(c),u*Math.sin(c)],p1:[u*Math.cos(l),u*Math.sin(l)]}}function s(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Ie)+",1 "+t}function u(e,t,n,r){return"Q 0,0 "+r}return i.radius=function(e){return arguments.length?(n=Ct(e),i):n},i.source=function(t){return arguments.length?(e=Ct(t),i):e},i.target=function(e){return arguments.length?(t=Ct(e),i):t},i.startAngle=function(e){return arguments.length?(r=Ct(e),i):r},i.endAngle=function(e){return arguments.length?(o=Ct(e),i):o},i},i.svg.diagonal=function(){var e=Zr,t=Kr,n=vs;function r(r,o){var i=e.call(this,r,o),a=t.call(this,r,o),s=(i.y+a.y)/2,u=[i,{x:i.x,y:s},{x:a.x,y:s},a];return"M"+(u=u.map(n))[0]+"C"+u[1]+" "+u[2]+" "+u[3]}return r.source=function(t){return arguments.length?(e=Ct(t),r):e},r.target=function(e){return arguments.length?(t=Ct(e),r):t},r.projection=function(e){return arguments.length?(n=e,r):n},r},i.svg.diagonal.radial=function(){var e=i.svg.diagonal(),t=vs,n=e.projection;return e.projection=function(e){return arguments.length?n(xs(t=e)):t},e},i.svg.symbol=function(){var e=bs,t=ws;function n(n,r){return(Ss.get(e.call(this,n,r))||Cs)(t.call(this,n,r))}return n.type=function(t){return arguments.length?(e=Ct(t),n):e},n.size=function(e){return arguments.length?(t=Ct(e),n):t},n};var Ss=i.map({circle:Cs,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Es)),n=t*Es;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Ms),n=t*Ms/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Ms),n=t*Ms/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});i.svg.symbolTypes=Ss.keys();var Ms=Math.sqrt(3),Es=Math.tan(30*De);K.transition=function(e){for(var t,n,r=ks||++Ns,o=Ds(e),i=[],a=As||{time:Date.now(),ease:xi,delay:0,duration:250},s=-1,u=this.length;++s<u;){i.push(t=[]);for(var c=this[s],l=-1,f=c.length;++l<f;)(n=c[l])&&Ps(n,l,o,r,a),t.push(n)}return Rs(i,o,r)},K.interrupt=function(e){return this.each(null==e?_s:Ts(Ds(e)))};var _s=Ts(Ds());function Ts(e){return function(){var t,n,r;(t=this[e])&&(r=t[n=t.active])&&(r.timer.c=null,r.timer.t=NaN,--t.count?delete t[n]:delete this[e],t.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function Rs(e,t,n){return V(e,Is),e.namespace=t,e.id=n,e}var ks,As,Is=[],Ns=0;function Ls(e,t,n,r){var o=e.id,i=e.namespace;return ge(e,"function"==typeof n?function(e,a,s){e[i][o].tween.set(t,r(n.call(e,e.__data__,a,s)))}:(n=r(n),function(e){e[i][o].tween.set(t,n)}))}function $s(e){return null==e&&(e=""),function(){this.textContent=e}}function Ds(e){return null==e?"__transition__":"__transition_"+e+"__"}function Ps(e,t,n,r,o){var i,a,s,u,c,l=e[n]||(e[n]={active:0,count:0}),f=l[r];function d(n){var o=l.active,d=l[o];for(var h in d&&(d.timer.c=null,d.timer.t=NaN,--l.count,delete l[o],d.event&&d.event.interrupt.call(e,e.__data__,d.index)),l)if(+h<r){var g=l[h];g.timer.c=null,g.timer.t=NaN,--l.count,delete l[h]}a.c=p,At((function(){return a.c&&p(n||1)&&(a.c=null,a.t=NaN),1}),0,i),l.active=r,f.event&&f.event.start.call(e,e.__data__,t),c=[],f.tween.forEach((function(n,r){(r=r.call(e,e.__data__,t))&&c.push(r)})),u=f.ease,s=f.duration}function p(o){for(var i=o/s,a=u(i),d=c.length;d>0;)c[--d].call(e,a);if(i>=1)return f.event&&f.event.end.call(e,e.__data__,t),--l.count?delete l[r]:delete e[n],1}f||(i=o.time,a=At((function(e){var t=f.delay;if(a.t=t+i,t<=e)return d(e-t);a.c=d}),0,i),f=l[r]={tween:new E,time:i,timer:a,delay:o.delay,duration:o.duration,ease:o.ease,index:t},o=null,++l.count)}Is.call=K.call,Is.empty=K.empty,Is.node=K.node,Is.size=K.size,i.transition=function(e,t){return e&&e.transition?ks?e.transition(t):e:i.selection().transition(e)},i.transition.prototype=Is,Is.select=function(e){var t,n,r,o=this.id,i=this.namespace,a=[];e=J(e);for(var s=-1,u=this.length;++s<u;){a.push(t=[]);for(var c=this[s],l=-1,f=c.length;++l<f;)(r=c[l])&&(n=e.call(r,r.__data__,l,s))?("__data__"in r&&(n.__data__=r.__data__),Ps(n,l,i,o,r[i][o]),t.push(n)):t.push(null)}return Rs(a,i,o)},Is.selectAll=function(e){var t,n,r,o,i,a=this.id,s=this.namespace,u=[];e=ee(e);for(var c=-1,l=this.length;++c<l;)for(var f=this[c],d=-1,p=f.length;++d<p;)if(r=f[d]){i=r[s][a],n=e.call(r,r.__data__,d,c),u.push(t=[]);for(var h=-1,g=n.length;++h<g;)(o=n[h])&&Ps(o,h,s,a,i),t.push(o)}return Rs(u,s,a)},Is.filter=function(e){var t,n,r=[];"function"!=typeof e&&(e=pe(e));for(var o=0,i=this.length;o<i;o++){r.push(t=[]);for(var a,s=0,u=(a=this[o]).length;s<u;s++)(n=a[s])&&e.call(n,n.__data__,s,o)&&t.push(n)}return Rs(r,this.namespace,this.id)},Is.tween=function(e,t){var n=this.id,r=this.namespace;return arguments.length<2?this.node()[r][n].tween.get(e):ge(this,null==t?function(t){t[r][n].tween.remove(e)}:function(o){o[r][n].tween.set(e,t)})},Is.attr=function(e,t){if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var n="transform"==e?Ai:ci,r=i.ns.qualify(e);function o(){this.removeAttribute(r)}function a(){this.removeAttributeNS(r.space,r.local)}function s(e){return null==e?o:(e+="",function(){var t,o=this.getAttribute(r);return o!==e&&(t=n(o,e),function(e){this.setAttribute(r,t(e))})})}function u(e){return null==e?a:(e+="",function(){var t,o=this.getAttributeNS(r.space,r.local);return o!==e&&(t=n(o,e),function(e){this.setAttributeNS(r.space,r.local,t(e))})})}return Ls(this,"attr."+e,t,r.local?u:s)},Is.attrTween=function(e,t){var n=i.ns.qualify(e);return this.tween("attr."+e,n.local?function(e,r){var o=t.call(this,e,r,this.getAttributeNS(n.space,n.local));return o&&function(e){this.setAttributeNS(n.space,n.local,o(e))}}:function(e,r){var o=t.call(this,e,r,this.getAttribute(n));return o&&function(e){this.setAttribute(n,o(e))}})},Is.style=function(e,t,n){var r=arguments.length;if(r<3){if("string"!=typeof e){for(n in r<2&&(t=""),e)this.style(n,e[n],t);return this}n=""}function o(){this.style.removeProperty(e)}function i(t){return null==t?o:(t+="",function(){var r,o=l(this).getComputedStyle(this,null).getPropertyValue(e);return o!==t&&(r=ci(o,t),function(t){this.style.setProperty(e,r(t),n)})})}return Ls(this,"style."+e,t,i)},Is.styleTween=function(e,t,n){function r(r,o){var i=t.call(this,r,o,l(this).getComputedStyle(this,null).getPropertyValue(e));return i&&function(t){this.style.setProperty(e,i(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,r)},Is.text=function(e){return Ls(this,"text",e,$s)},Is.remove=function(){var e=this.namespace;return this.each("end.transition",(function(){var t;this[e].count<2&&(t=this.parentNode)&&t.removeChild(this)}))},Is.ease=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].ease:("function"!=typeof e&&(e=i.ease.apply(i,arguments)),ge(this,(function(r){r[n][t].ease=e})))},Is.delay=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].delay:ge(this,"function"==typeof e?function(r,o,i){r[n][t].delay=+e.call(r,r.__data__,o,i)}:(e=+e,function(r){r[n][t].delay=e}))},Is.duration=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].duration:ge(this,"function"==typeof e?function(r,o,i){r[n][t].duration=Math.max(1,e.call(r,r.__data__,o,i))}:(e=Math.max(1,e),function(r){r[n][t].duration=e}))},Is.each=function(e,t){var n=this.id,r=this.namespace;if(arguments.length<2){var o=As,a=ks;try{ks=n,ge(this,(function(t,o,i){As=t[r][n],e.call(t,t.__data__,o,i)}))}finally{As=o,ks=a}}else ge(this,(function(o){var a=o[r][n];(a.event||(a.event=i.dispatch("start","end","interrupt"))).on(e,t)}));return this},Is.transition=function(){for(var e,t,n,r=this.id,o=++Ns,i=this.namespace,a=[],s=0,u=this.length;s<u;s++){a.push(e=[]);for(var c,l=0,f=(c=this[s]).length;l<f;l++)(t=c[l])&&Ps(t,l,i,o,{time:(n=t[i][r]).time,ease:n.ease,delay:n.delay+n.duration,duration:n.duration}),e.push(t)}return Rs(a,i,o)},i.svg.axis=function(){var e,t=i.scale.linear(),n=qs,r=6,o=6,a=3,u=[10],c=null;function l(s){s.each((function(){var s,l=i.select(this),f=this.__chart__||t,d=this.__chart__=t.copy(),p=null==c?d.ticks?d.ticks.apply(d,u):d.domain():c,h=null==e?d.tickFormat?d.tickFormat.apply(d,u):P:e,g=l.selectAll(".tick").data(p,d),y=g.enter().insert("g",".domain").attr("class","tick").style("opacity",ke),m=i.transition(g.exit()).style("opacity",ke).remove(),v=i.transition(g.order()).style("opacity",1),x=Math.max(r,0)+a,w=Ea(d),b=l.selectAll(".domain").data([0]),C=(b.enter().append("path").attr("class","domain"),i.transition(b));y.append("line"),y.append("text");var S,M,E,_,T=y.select("line"),R=v.select("line"),k=g.select("text").text(h),A=y.select("text"),I=v.select("text"),N="top"===n||"left"===n?-1:1;if("bottom"===n||"top"===n?(s=Us,S="x",E="y",M="x2",_="y2",k.attr("dy",N<0?"0em":".71em").style("text-anchor","middle"),C.attr("d","M"+w[0]+","+N*o+"V0H"+w[1]+"V"+N*o)):(s=js,S="y",E="x",M="y2",_="x2",k.attr("dy",".32em").style("text-anchor",N<0?"end":"start"),C.attr("d","M"+N*o+","+w[0]+"H0V"+w[1]+"H"+N*o)),T.attr(_,N*r),A.attr(E,N*x),R.attr(M,0).attr(_,N*r),I.attr(S,0).attr(E,N*x),d.rangeBand){var L=d,$=L.rangeBand()/2;f=d=function(e){return L(e)+$}}else f.rangeBand?f=d:m.call(s,d,f);y.call(s,f,d),v.call(s,d,d)}))}return l.scale=function(e){return arguments.length?(t=e,l):t},l.orient=function(e){return arguments.length?(n=e in Os?e+"":qs,l):n},l.ticks=function(){return arguments.length?(u=s(arguments),l):u},l.tickValues=function(e){return arguments.length?(c=e,l):c},l.tickFormat=function(t){return arguments.length?(e=t,l):e},l.tickSize=function(e){var t=arguments.length;return t?(r=+e,o=+arguments[t-1],l):r},l.innerTickSize=function(e){return arguments.length?(r=+e,l):r},l.outerTickSize=function(e){return arguments.length?(o=+e,l):o},l.tickPadding=function(e){return arguments.length?(a=+e,l):a},l.tickSubdivide=function(){return arguments.length&&l},l};var qs="bottom",Os={top:1,right:1,bottom:1,left:1};function Us(e,t,n){e.attr("transform",(function(e){var r=t(e);return"translate("+(isFinite(r)?r:n(e))+",0)"}))}function js(e,t,n){e.attr("transform",(function(e){var r=t(e);return"translate(0,"+(isFinite(r)?r:n(e))+")"}))}i.svg.brush=function(){var e,t,n=G(d,"brushstart","brush","brushend"),r=null,o=null,a=[0,0],s=[0,0],u=!0,c=!0,f=Qs[0];function d(e){e.each((function(){var e=i.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",y).on("touchstart.brush",y),t=e.selectAll(".background").data([0]);t.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),e.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var n=e.selectAll(".resize").data(f,P);n.exit().remove(),n.enter().append("g").attr("class",(function(e){return"resize "+e})).style("cursor",(function(e){return zs[e]})).append("rect").attr("x",(function(e){return/[ew]$/.test(e)?-3:null})).attr("y",(function(e){return/^[ns]/.test(e)?-3:null})).attr("width",6).attr("height",6).style("visibility","hidden"),n.style("display",d.empty()?"none":null);var a,s=i.transition(e),u=i.transition(t);r&&(a=Ea(r),u.attr("x",a[0]).attr("width",a[1]-a[0]),h(s)),o&&(a=Ea(o),u.attr("y",a[0]).attr("height",a[1]-a[0]),g(s)),p(s)}))}function p(e){e.selectAll(".resize").attr("transform",(function(e){return"translate("+a[+/e$/.test(e)]+","+s[+/^s/.test(e)]+")"}))}function h(e){e.select(".extent").attr("x",a[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",a[1]-a[0])}function g(e){e.select(".extent").attr("y",s[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",s[1]-s[0])}function y(){var f,y,m=this,v=i.select(i.event.target),x=n.of(m,arguments),w=i.select(m),b=v.datum(),C=!/^(n|s)$/.test(b)&&r,S=!/^(e|w)$/.test(b)&&o,M=v.classed("extent"),E=Ee(m),_=i.mouse(m),T=i.select(l(m)).on("keydown.brush",(function(){32==i.event.keyCode&&(M||(f=null,_[0]-=a[1],_[1]-=s[1],M=2),H())})).on("keyup.brush",(function(){32==i.event.keyCode&&2==M&&(_[0]+=a[1],_[1]+=s[1],M=0,H())}));if(i.event.changedTouches?T.on("touchmove.brush",A).on("touchend.brush",N):T.on("mousemove.brush",A).on("mouseup.brush",N),w.interrupt().selectAll("*").interrupt(),M)_[0]=a[0]-_[0],_[1]=s[0]-_[1];else if(b){var R=+/w$/.test(b),k=+/^n/.test(b);y=[a[1-R]-_[0],s[1-k]-_[1]],_[0]=a[R],_[1]=s[k]}else i.event.altKey&&(f=_.slice());function A(){var e=i.mouse(m),t=!1;y&&(e[0]+=y[0],e[1]+=y[1]),M||(i.event.altKey?(f||(f=[(a[0]+a[1])/2,(s[0]+s[1])/2]),_[0]=a[+(e[0]<f[0])],_[1]=s[+(e[1]<f[1])]):f=null),C&&I(e,r,0)&&(h(w),t=!0),S&&I(e,o,1)&&(g(w),t=!0),t&&(p(w),x({type:"brush",mode:M?"move":"resize"}))}function I(n,r,o){var i,l,d=Ea(r),p=d[0],h=d[1],g=_[o],y=o?s:a,m=y[1]-y[0];if(M&&(p-=g,h-=m+g),i=(o?c:u)?Math.max(p,Math.min(h,n[o])):n[o],M?l=(i+=g)+m:(f&&(g=Math.max(p,Math.min(h,2*f[o]-i))),g<i?(l=i,i=g):l=g),y[0]!=i||y[1]!=l)return o?t=null:e=null,y[0]=i,y[1]=l,!0}function N(){A(),w.style("pointer-events","all").selectAll(".resize").style("display",d.empty()?"none":null),i.select("body").style("cursor",null),T.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),E(),x({type:"brushend"})}w.style("pointer-events","none").selectAll(".resize").style("display",null),i.select("body").style("cursor",v.style("cursor")),x({type:"brushstart"}),A()}return d.event=function(r){r.each((function(){var r=n.of(this,arguments),o={x:a,y:s,i:e,j:t},u=this.__chart__||o;this.__chart__=o,ks?i.select(this).transition().each("start.brush",(function(){e=u.i,t=u.j,a=u.x,s=u.y,r({type:"brushstart"})})).tween("brush:brush",(function(){var n=li(a,o.x),i=li(s,o.y);return e=t=null,function(e){a=o.x=n(e),s=o.y=i(e),r({type:"brush",mode:"resize"})}})).each("end.brush",(function(){e=o.i,t=o.j,r({type:"brush",mode:"resize"}),r({type:"brushend"})})):(r({type:"brushstart"}),r({type:"brush",mode:"resize"}),r({type:"brushend"}))}))},d.x=function(e){return arguments.length?(f=Qs[!(r=e)<<1|!o],d):r},d.y=function(e){return arguments.length?(f=Qs[!r<<1|!(o=e)],d):o},d.clamp=function(e){return arguments.length?(r&&o?(u=!!e[0],c=!!e[1]):r?u=!!e:o&&(c=!!e),d):r&&o?[u,c]:r?u:o?c:null},d.extent=function(n){var i,u,c,l,f;return arguments.length?(r&&(i=n[0],u=n[1],o&&(i=i[0],u=u[0]),e=[i,u],r.invert&&(i=r(i),u=r(u)),u<i&&(f=i,i=u,u=f),i==a[0]&&u==a[1]||(a=[i,u])),o&&(c=n[0],l=n[1],r&&(c=c[1],l=l[1]),t=[c,l],o.invert&&(c=o(c),l=o(l)),l<c&&(f=c,c=l,l=f),c==s[0]&&l==s[1]||(s=[c,l])),d):(r&&(e?(i=e[0],u=e[1]):(i=a[0],u=a[1],r.invert&&(i=r.invert(i),u=r.invert(u)),u<i&&(f=i,i=u,u=f))),o&&(t?(c=t[0],l=t[1]):(c=s[0],l=s[1],o.invert&&(c=o.invert(c),l=o.invert(l)),l<c&&(f=c,c=l,l=f))),r&&o?[[i,c],[u,l]]:r?[i,u]:o&&[c,l])},d.clear=function(){return d.empty()||(a=[0,0],s=[0,0],e=t=null),d},d.empty=function(){return!!r&&a[0]==a[1]||!!o&&s[0]==s[1]},i.rebind(d,n,"on")};var zs={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Qs=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Hs=jt.format=yn.timeFormat,Fs=Hs.utc,Gs=Fs("%Y-%m-%dT%H:%M:%S.%LZ");function Bs(e){return e.toISOString()}function Vs(e,t,n){function r(t){return e(t)}function o(e,n){var r=(e[1]-e[0])/n,o=i.bisect(Ws,r);return o==Ws.length?[t.year,La(e.map((function(e){return e/31536e6})),n)[2]]:o?t[r/Ws[o-1]<Ws[o]/r?o-1:o]:[Ks,La(e,n)[2]]}return r.invert=function(t){return Ys(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(Ys)},r.nice=function(e,t){var n=r.domain(),i=Ma(n),a=null==e?o(i,10):"number"==typeof e&&o(i,e);function s(n){return!isNaN(n)&&!e.range(n,Ys(+n+1),t).length}return a&&(e=a[0],t=a[1]),r.domain(Ta(n,t>1?{floor:function(t){for(;s(t=e.floor(t));)t=Ys(t-1);return t},ceil:function(t){for(;s(t=e.ceil(t));)t=Ys(+t+1);return t}}:e))},r.ticks=function(e,t){var n=Ma(r.domain()),i=null==e?o(n,10):"number"==typeof e?o(n,e):!e.range&&[{range:e},t];return i&&(e=i[0],t=i[1]),e.range(n[0],Ys(+n[1]+1),t<1?1:t)},r.tickFormat=function(){return n},r.copy=function(){return Vs(e.copy(),t,n)},Ia(r,e)}function Ys(e){return new Date(e)}Hs.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Bs:Gs,Bs.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},Bs.toString=Gs.toString,jt.second=Ft((function(e){return new zt(1e3*Math.floor(e/1e3))}),(function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))}),(function(e){return e.getSeconds()})),jt.seconds=jt.second.range,jt.seconds.utc=jt.second.utc.range,jt.minute=Ft((function(e){return new zt(6e4*Math.floor(e/6e4))}),(function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))}),(function(e){return e.getMinutes()})),jt.minutes=jt.minute.range,jt.minutes.utc=jt.minute.utc.range,jt.hour=Ft((function(e){var t=e.getTimezoneOffset()/60;return new zt(36e5*(Math.floor(e/36e5-t)+t))}),(function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))}),(function(e){return e.getHours()})),jt.hours=jt.hour.range,jt.hours.utc=jt.hour.utc.range,jt.month=Ft((function(e){return(e=jt.day(e)).setDate(1),e}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e){return e.getMonth()})),jt.months=jt.month.range,jt.months.utc=jt.month.utc.range;var Ws=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Xs=[[jt.second,1],[jt.second,5],[jt.second,15],[jt.second,30],[jt.minute,1],[jt.minute,5],[jt.minute,15],[jt.minute,30],[jt.hour,1],[jt.hour,3],[jt.hour,6],[jt.hour,12],[jt.day,1],[jt.day,2],[jt.week,1],[jt.month,1],[jt.month,3],[jt.year,1]],Zs=Hs.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",tr]]),Ks={range:function(e,t,n){return i.range(Math.ceil(e/n)*n,+t,n).map(Ys)},floor:P,ceil:P};Xs.year=jt.year,jt.scale=function(){return Vs(i.scale.linear(),Xs,Zs)};var Js=Xs.map((function(e){return[e[0].utc,e[1]]})),eu=Fs.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",tr]]);function tu(e){return JSON.parse(e.responseText)}function nu(e){var t=u.createRange();return t.selectNode(u.body),t.createContextualFragment(e.responseText)}Js.year=jt.year.utc,jt.scale.utc=function(){return Vs(i.scale.linear(),Js,eu)},i.text=St((function(e){return e.responseText})),i.json=function(e,t){return Mt(e,"application/json",tu,t)},i.html=function(e,t){return Mt(e,"text/html",nu,t)},i.xml=St((function(e){return e.responseXML})),this.d3=i,void 0===(o="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=o)}()},214:function(e,t,n){"use strict";var r=r||{};r.SingleChild={addPlaceholders:function e(t,n){if(t.children){for(var r=0;r<t.children.length;r++)e(t.children[r]);if(1===t.children.length){var o=1.2*t.size;n&&(o=.1*t.children[0].size),t.children.push({name:"placeholder",size:o})}}},removePlaceholders:function e(t){for(var n=t.length-1;n>=0;n--){var r=t[n];"placeholder"===r.name?t.splice(n,1):r.children&&e(r.children)}},centerNodes:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.children&&1===n.children.length){var r=n.x-n.children[0].x;n.children[0].x+=r,o(n.children[0],r)}}function o(e,t){if(e.children)for(var n=0;n<e.children.length;n++)e.children[n].x+=t,o(e.children[n],t)}},makePositionsRelativeToZero:function(e){for(var t=e[0].x,n=e[0].y,r=0;r<e.length;r++){var o=e[r];o.x-=t,o.y-=n}}},t.a=r},225:function(e,t){
/*! Copyright (c) 2014 Hidenari Nozaki and contributors | Licensed under the MIT license */
!function(e,t){"use strict";!function(e){e.module("angucomplete-alt",[]).directive("angucompleteAlt",["$q","$parse","$http","$sce","$timeout","$templateCache","$interpolate",function(e,t,n,r,o,i,a){var s=40,u=39,c=38,l=37,f=27,d=13,p=9,h=3,g=524288,y=500,m=200,v="autocomplete-required",x="Searching...",w="No results found";function b(t,i,a,b){var C,S,M,E,_,T,R=i.find("input"),k=h,A=null,I=v,N=null,L=null,$=i[0].querySelector(".angucomplete-dropdown"),D=!1,P=null;function q(e,n){e&&("object"==typeof e?(t.searchStr=z(e),j({originalObject:e})):"string"==typeof e&&e.length>0?t.searchStr=e:console&&console.error&&console.error("Tried to set "+(n?"initial":"")+" value of angucomplete to",e,"which is an invalid value"),F(!0))}function O(e){P=null,t.hideResults(e),document.body.removeEventListener("click",O)}function U(e){return e.which?e.which:e.keyCode}function j(e){"function"==typeof t.selectedObject?t.selectedObject(e,t.selectedObjectData):t.selectedObject=e,F(!!e)}function z(e){return t.titleField.split(",").map((function(t){return Q(e,t)})).join(" ")}function Q(e,t){var n,r;if(t){n=t.split("."),r=e;for(var o=0;o<n.length;o++)r=r[n[o]]}else r=e;return r}function H(e,n){var o,i,a;if(a=new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),e)return e.match&&e.replace||(e=e.toString()),o=(i=e.match(a))?e.replace(a,'<span class="'+t.matchClass+'">'+i[0]+"</span>"):e,r.trustAsHtml(o)}function F(e){t.notEmpty=e,N=t.searchStr,t.fieldRequired&&b&&t.inputName&&b[t.inputName].$setValidity(I,e)}function G(e){!t.overrideSuggestions||t.selectedObject&&t.selectedObject.originalObject===t.searchStr||(e&&e.preventDefault(),o.cancel(A),Z(),j({originalObject:t.searchStr}),t.clearSelected&&(t.searchStr=null),ee())}function B(){return i[0].querySelectorAll(".angucomplete-row")[t.currentIndex]}function V(e){$.scrollTop=$.scrollTop+e}function Y(){var e=t.results[t.currentIndex];t.matchClass?R.val(z(e.originalObject)):R.val(e.title)}function W(e){return function(n,r,o,i){r||o||i||!n.data||(n=n.data),t.searching=!1,re(Q(S(n),t.remoteUrlDataField),e)}}function X(e,n,r,o){t.searching=!1,0!==n&&-1!==n&&(n||r||o||(n=e.status),t.remoteUrlErrorCallback?t.remoteUrlErrorCallback(e,n,r,o):console&&console.error&&console.error("http error"))}function Z(){L&&L.resolve()}function K(r){var o={},i=t.remoteUrl+encodeURIComponent(r);t.remoteUrlRequestFormatter&&(o={params:t.remoteUrlRequestFormatter(r)},i=t.remoteUrl),t.remoteUrlRequestWithCredentials&&(o.withCredentials=!0),Z(),L=e.defer(),o.timeout=L.promise,n.get(i,o).success(W(r)).error(X)}function J(n){Z(),L=e.defer(),t.remoteApiHandler(n,L.promise).then(W(n)).catch(X)}function ee(){t.showDropdown=!1,t.results=[],$&&($.scrollTop=0)}function te(){t.showDropdown=E,t.currentIndex=t.focusFirst?0:-1,t.results=[]}function ne(e){!e||e.length<k||(t.localData?t.$apply((function(){var n;n=void 0!==t.localSearch()?t.localSearch()(e,t.localData):function(e){var n,r,o,i,a=t.searchFields.split(","),s=[];for(void 0!==t.parseInput()&&(e=t.parseInput()(e)),n=0;n<t.localData.length;n++){for(r=!1,o=0;o<a.length;o++)i=Q(t.localData[n],a[o])||"",r=r||i.toString().toLowerCase().indexOf(e.toString().toLowerCase())>=0;r&&(s[s.length]=t.localData[n])}return s}(e),t.searching=!1,re(n,e)})):t.remoteApiHandler?J(e):K(e))}function re(e,n){var r,o,i,a,s,u;if(e&&e.length>0)for(t.results=[],r=0;r<e.length;r++)t.titleField&&""!==t.titleField&&(a=s=z(e[r])),o="",t.descriptionField&&(o=u=Q(e[r],t.descriptionField)),i="",t.imageField&&(i=Q(e[r],t.imageField)),t.matchClass&&(s=H(a,n),u=H(o,n)),t.results[t.results.length]={title:s,description:u,image:i,originalObject:e[r]};else t.results=[];t.autoMatch&&1===t.results.length&&function(e,n,r){if(!r)return!1;for(var o in n)if(n[o].toLowerCase()===r.toLowerCase())return t.selectResult(e),!0;return!1}(t.results[0],{title:a,desc:o||""},t.searchStr)?t.showDropdown=!1:0!==t.results.length||_?t.showDropdown=!0:t.showDropdown=!1}function oe(){t.localData?re(t.localData,""):t.remoteApiHandler?J(""):K("")}i.on("mousedown",(function(e){e.target.id?(P=e.target.id)===t.id+"_dropdown"&&document.body.addEventListener("click",O):P=e.target.className})),t.currentIndex=t.focusFirst?0:null,t.searching=!1,M=t.$watch("initialValue",(function(e){e&&(M(),q(e,!0))})),t.$watch("fieldRequired",(function(e,n){e!==n&&(e?N&&-1!==t.currentIndex?F(!0):F(!1):b[t.inputName].$setValidity(I,!0))})),t.$on("angucomplete-alt:clearInput",(function(e,n){n&&n!==t.id||(t.searchStr=null,j(),F(!1),ee())})),t.$on("angucomplete-alt:changeInput",(function(e,n,r){n&&n===t.id&&q(r)})),t.onFocusHandler=function(){t.focusIn&&t.focusIn(),0!==k||t.searchStr&&0!==t.searchStr.length||(t.currentIndex=t.focusFirst?0:t.currentIndex,t.showDropdown=!0,oe())},t.hideResults=function(){P&&(P===t.id+"_dropdown"||P.indexOf("angucomplete")>=0)?P=null:(C=o((function(){ee(),t.$apply((function(){t.searchStr&&t.searchStr.length>0&&R.val(t.searchStr)}))}),m),Z(),t.focusOut&&t.focusOut(),t.overrideSuggestions&&t.searchStr&&t.searchStr.length>0&&-1===t.currentIndex&&G())},t.resetHideResults=function(){C&&o.cancel(C)},t.hoverRow=function(e){t.currentIndex=e},t.selectResult=function(e){t.matchClass&&(e.title=z(e.originalObject),e.description=Q(e.originalObject,t.descriptionField)),t.clearSelected?t.searchStr=null:t.searchStr=e.title,j(e),ee()},t.inputChangeHandler=function(e){return e.length<k?(Z(),ee()):0===e.length&&0===k&&(t.searching=!1,oe()),t.inputChanged&&(e=t.inputChanged(e)),e},t.fieldRequiredClass&&""!==t.fieldRequiredClass&&(I=t.fieldRequiredClass),t.minlength&&""!==t.minlength&&(k=parseInt(t.minlength,10)),t.pause||(t.pause=y),t.clearSelected||(t.clearSelected=!1),t.overrideSuggestions||(t.overrideSuggestions=!1),t.fieldRequired&&b&&(t.initialValue?F(!0):F(!1)),t.inputType=a.type?a.type:"text",t.textSearching=a.textSearching?a.textSearching:x,t.textNoResults=a.textNoResults?a.textNoResults:w,E="false"!==t.textSearching,_="false"!==t.textNoResults,t.maxlength=a.maxlength?a.maxlength:g,R.on("keydown",(function(e){var n=U(e),r=null,o=null;n===d&&t.results?(t.currentIndex>=0&&t.currentIndex<t.results.length?(e.preventDefault(),t.selectResult(t.results[t.currentIndex])):(G(e),ee()),t.$apply()):n===s&&t.results?(e.preventDefault(),t.currentIndex+1<t.results.length&&t.showDropdown&&(t.$apply((function(){t.currentIndex++,Y()})),D&&(r=B(),$.getBoundingClientRect().top+parseInt(getComputedStyle($).maxHeight,10)<r.getBoundingClientRect().bottom&&V(function(e){var t=getComputedStyle(e);return e.offsetHeight+parseInt(t.marginTop,10)+parseInt(t.marginBottom,10)}(r))))):n===c&&t.results?(e.preventDefault(),t.currentIndex>=1?(t.$apply((function(){t.currentIndex--,Y()})),D&&(o=B().getBoundingClientRect().top-($.getBoundingClientRect().top+parseInt(getComputedStyle($).paddingTop,10)))<0&&V(o-1)):0===t.currentIndex&&t.$apply((function(){t.currentIndex=-1,R.val(t.searchStr)}))):n===p?t.results&&t.results.length>0&&t.showDropdown?-1===t.currentIndex&&t.overrideSuggestions?G():(-1===t.currentIndex&&(t.currentIndex=0),t.selectResult(t.results[t.currentIndex]),t.$digest()):t.searchStr&&t.searchStr.length>0&&G():n===f&&e.preventDefault()})),R.on("keyup",(function(e){var n=U(e);if(n!==l&&n!==u)if(n===c||n===d)e.preventDefault();else if(n===s)e.preventDefault(),!t.showDropdown&&t.searchStr&&t.searchStr.length>=k&&(te(),t.searching=!0,ne(t.searchStr));else if(n===f)ee(),t.$apply((function(){R.val(t.searchStr)}));else{if(0===k&&!t.searchStr)return;t.searchStr&&""!==t.searchStr?t.searchStr.length>=k&&(te(),A&&o.cancel(A),t.searching=!0,A=o((function(){ne(t.searchStr)}),t.pause)):t.showDropdown=!1,N&&N!==t.searchStr&&!t.clearSelected&&t.$apply((function(){j()}))}})),T="remoteUrlResponseFormatter",S=function(e){return t[T]?t[T](e):e},o((function(){var e=getComputedStyle($);D=e.maxHeight&&"auto"===e.overflowY}))}return(i.put("/angucomplete-alt/index.html",'<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">  <input id="{{id}}_value" name="{{inputName}}" tabindex="{{fieldTabindex}}" ng-class="{\'angucomplete-input-not-empty\': notEmpty}" ng-model="searchStr" ng-disabled="disableInput" type="{{inputType}}" placeholder="{{placeholder}}" maxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()" ng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)"/>  <div id="{{id}}_dropdown" class="angucomplete-dropdown" ng-show="showDropdown">    <div class="angucomplete-searching" ng-show="searching" ng-bind="textSearching"></div>    <div class="angucomplete-searching" ng-show="!searching && (!results || results.length == 0)" ng-bind="textNoResults"></div>    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">      <div ng-if="imageField" class="angucomplete-image-holder">        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"></div>      </div>      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>      <div class="angucomplete-title" ng-if="!matchClass">{{ result.title }}</div>      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"></div>      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div>    </div>  </div></div>'),{restrict:"EA",require:"^?form",scope:{selectedObject:"=",selectedObjectData:"=",disableInput:"=",initialValue:"=",localData:"=",localSearch:"&",remoteUrlRequestFormatter:"=",remoteUrlRequestWithCredentials:"@",remoteUrlResponseFormatter:"=",remoteUrlErrorCallback:"=",remoteApiHandler:"=",id:"@",type:"@",placeholder:"@",textSearching:"@",textNoResults:"@",remoteUrl:"@",remoteUrlDataField:"@",titleField:"@",descriptionField:"@",imageField:"@",inputClass:"@",pause:"@",searchFields:"@",minlength:"@",matchClass:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"=",fieldRequiredClass:"@",inputChanged:"=",autoMatch:"@",focusOut:"&",focusIn:"&",fieldTabindex:"@",inputName:"@",focusFirst:"@",parseInput:"&"},templateUrl:function(e,t){return t.templateUrl||"/angucomplete-alt/index.html"},compile:function(e){var t=a.startSymbol(),n=a.endSymbol();if("{{"!==t||"}}"!==n){var r=e.html().replace(/\{\{/g,t).replace(/\}\}/g,n);e.html(r)}return b}})}])}(window.angular)}()},29:function(e,t){angular.module("graphdb.framework.rest.connectors.service",[]).factory("ConnectorsRestService",r),r.$inject=["$http"];const n="rest/connectors";function r(e){return{getConnectors:function(){return e.get(n)},initConnector:function(t){return e.get(`${n}/options?prefix=${t}`)},hasConnector:function(t){return e.get(`${n}/existing?prefix=${t}`)},checkConnector:function(t){return e.post(`${n}/check`,t,{headers:{"Content-Type":"text/plain"}})}}}},31:function(e,t){function n(e){return{showToastMessageWithDelay:function(t){return new Promise(n=>{e.success(t),setTimeout(n,200)})}}}angular.module("graphdb.framework.utils.notifications",[]).factory("Notifications",n),n.$inject=["toastr"]},32:function(e,t,n){"use strict";n.r(t);n(10),n(29);function r(e){const t=[];return Object.keys(e).forEach((function(n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))})),t.join("&")}function o(e,t){for(let r=0;r<t.length;r++){const o=t[r];if("StringArray"===o.__type)e[o.__name]||(e[o.__name]=[""]);else if("OptionArray"===o.__type)if(e[o.__name])for(let t=0;t<o.__childOptions.length;t++){const n=o.__childOptions[t];if("Boolean"===n.__type)for(let t=0;t<e[o.__name].length;t++){const r=e[o.__name][t];!r.hasOwnProperty([n.__name])&&angular.isDefined(n.__defaultValue)&&(r[n.__name]=n.__defaultValue)}}else{e[o.__name]=[];const t={};for(let e=0;e<o.__childOptions.length;e++){const n=o.__childOptions[e];"StringArray"===n.__type?t[n.__name]=[""]:t[n.__name]=angular.isUndefined(n.__defaultValue)?"":n.__defaultValue}e[o.__name].push(t)}else"Map"===o.__type?e[o.__name]?e[o.__name]=(n=e[o.__name],_.map(n,(function(e,t){return{key:t,value:e}}))):e[o.__name]=[]:"JsonString"===o.__type?e[o.__name]&&(e[o.__name]=angular.toJson(e[o.__name],2)):angular.isUndefined(e[o.__name])&&(e[o.__name]=angular.isUndefined(o.__defaultValue)?"":o.__defaultValue)}var n;return e}function i(e,t,n){return e.post("repositories/"+t,r({query:n}),{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/sparql-results+json","X-GraphDB-Local-Consistency":"updating"}})}function a(e){return e.substring(0,e.length-1)+"/instance#"}function s(e,t,n,r,o){const i=function e(t,n){const r={};return _.each(n,(function(n){angular.isDefined(t[n.__name])&&("OptionArray"===n.__type?(r[n.__name]=[],_.each(t[n.__name],(function(t){r[n.__name].push(e(t,n.__childOptions))}))):r[n.__name]=angular.copy(t[n.__name]))})),r}(n,r);for(let e=0;e<r.length;e++)try{"Map"===r[e].__type?i[r[e].__name]=(s=i[r[e].__name],_.reduce(s,(function(e,t){if(""===t.key&&""===t.value);else{if(""===t.key)throw new Error('Key may not be empty with value "'+t.value+'"');if(e.hasOwnProperty(t.key))throw new Error("Duplicate key "+t.key);e[t.key]=t.value}return e}),{})):"JsonString"===r[e].__type&&(i[r[e].__name]=angular.fromJson(i[r[e].__name]))}catch(t){return o(r[e].__label,t.message),null}var s;!function e(t){Array.isArray(t)&&(t=_.filter(t,(function(e){return null!==e&&(!e.trim||""!==e.trim())})));return Object.keys(t).forEach((function(n){""!==t[n]&&null!=t[n]||!1===t[n]?"object"==typeof t[n]&&(t[n]=e(t[n])):delete t[n]})),t}(i);let u="";return u+="PREFIX :<"+t+">\n",u+="PREFIX inst:<"+a(t)+">\n",u+="INSERT DATA {\n",u+="\tinst:"+e+" :createConnector '''\n",u+=angular.toJson(i,2),u+="\n''' .\n}\n",u=u.replace(/\\/g,"\\\\\\"),u}function u(e,t,n,u,c,l,f,d,p){function h(t){e.beingBuiltConnector={percentDone:0,status:{processedEntities:0,estimatedEntities:0,indexedEntities:0,entitiesPerSecond:0},actionName:t?"Repairing":"Creating",waitOnRepairStartOnce:!!t,eta:"-",inline:!1,iri:null}}function g(t,n,r){return h(r),$.extend(e.beingBuiltConnector,{iri:a(t)+n,name:n,inline:!1,doneCallback:function(){e.beingBuiltConnector.modalInstance.dismiss("cancel")}}),e.beingBuiltConnector.modalInstance=u.open({templateUrl:"pages/connectorProgress.html",controller:"CreateProgressCtrl",size:"lg",backdrop:"static",scope:e}),e.beingBuiltConnector.modalInstance}function y(t,o,i){const a=g(t.value,o.name,!1);d.addStatements(n.getActiveRepository(),r({update:o.query})).then((function(){p.getConnectors().then((function(){p.hasConnector(encodeURIComponent(t.value)).then((function(n){e.existing[t.key]=n.data}))})),c.success("Created connector "+o.name)}),(function(e){c.error(getError(e)),i()})).finally((function(){a.dismiss("cancel")}))}e.loader=!1,e.controllers=[],e.existing={},e.definitions={},e.getLoaderMessage=function(){const t=(Date.now()-e.loaderStartTime)/1e3,n=e.getHumanReadableSeconds(t);let r="";return r=e.progressMessage?e.progressMessage+"... "+n:"Running operation..."+n,e.extraMessage&&t>10&&(r+="\n"+e.extraMessage),r},e.setLoader=function(t,n,r){t?(e.loader=!0,e.loaderStartTime=Date.now(),e.progressMessage=n,e.extraMessage=r):(e.loader=!1,e.progressMessage="",e.extraMessage="")},e.initConnector=function(t){return p.initConnector(encodeURIComponent(t.value)).then((function(n){return e.definitions[t.key]=n.data,p.hasConnector(encodeURIComponent(t.value)).then((function(n){e.existing[t.key]=n.data}))}))},e.getConnectors=function(){e.canWriteActiveRepo()&&(e.setLoader(!0,"Fetching connectors","Normally this is a fast operation but it may take longer if a bigger repository needs to be initialised first."),p.getConnectors().then((function(r){e.connectors=Object.keys(r.data).map((function(e){return{key:e,value:r.data[e]}})),f.all(_.map(e.connectors,(function(t){return e.initConnector(t)}))).finally((function(){h();const r=function(e){const t=_.map(e,(function(e){return"<"+e.value+"connectorStatus>"})).join("|");return t?"SELECT ?connector ?status { ?connector "+t+" ?status }":null}(e.connectors);r?function(e){return i(t,n.getActiveRepository(),e)}(r).then((function(t){const n=function(e){if(e.bindings)for(let t=0;t<e.bindings.length;t++)try{const n=JSON.parse(e.bindings[t].status.value);if("BUILDING"===n.status)return{connector:e.bindings[t].connector.value,status:n}}catch(e){console.error(e)}return{}}(t.data.results);if(n.connector){const t=n.connector.split(/#/);t[0]=t[0].replace(/\/instance$/,"#"),r=t[0],o=t[1],h(),$.extend(e.beingBuiltConnector,{iri:a(r)+o,name:o,inline:!0,doneCallback:function(){e.beingBuiltConnector.inline=!1}})}var r,o})).finally((function(){e.setLoader(!1)})):e.setLoader(!1)}))})).catch((function(t){e.setLoader(!1),c.error(getError(t),"Could not get connectors")})),e.existing={})},e.getOptions=function(t){return e.definitions[t.key]},e.isEmpty=function(e){return angular.isObject(e)&&0===Object.keys(e).length},e.toPrettyJson=function(e){return angular.toJson(e,2)},e.$watch((function(){return n.getActiveRepository()}),e.getConnectors),e.$watch((function(){return n.getActiveLocation()}),e.getConnectors),e.copyConnector=function(t,n){let r;angular.isUndefined(n)||(r=angular.copy(n),r.name=r.name+"-copy"),u.open({templateUrl:"pages/createConnector.html",controller:"CreateConnectorCtrl",size:"lg",backdrop:"static",resolve:{connector:function(){return t},values:function(){return angular.isUndefined(r)?{name:"",values:{}}:r},options:function(){return e.getOptions(t)}}}).result.then((function(n){y(t,n,(function(){n.skipConversion=!0,e.newConnector(t,n)}))}))},e.newConnector=function(t,n){u.open({templateUrl:"pages/createConnector.html",controller:"CreateConnectorCtrl",size:"lg",backdrop:"static",resolve:{connector:function(){return t},values:function(){return angular.isUndefined(n)?{name:"",values:{}}:n},options:function(){return e.getOptions(t)}}}).result.then((function(n){y(t,n,(function(){n.skipConversion=!0,e.newConnector(t,n)}))}))},e.repair=function(t,o){l.openSimpleModal({title:"Confirm repair",message:"Are you sure you want to repair this connector?<br>Note that repair means delete + recreate with the same settings.",warning:!0}).result.then((function(){const i=g(o.value,t.name,!0),s=(u=t.name,"PREFIX prefix:<"+(l=o.value)+">\nINSERT DATA {\n\t<"+a(l)+u+'> prefix:repairConnector ""\n}');var u,l;d.addStatements(n.getActiveRepository(),r({update:s})).then((function(){p.getConnectors().then((function(){p.hasConnector(encodeURIComponent(o.value)).then((function(t){e.existing[o.key]=t.data}))})),c.success("Repaired connector "+t.name)}),(function(e){c.error(getError(e))})).finally((function(){i.dismiss("cancel")}))}))},e.delete=function(t,o){const i=o.key.indexOf("Elastic")>=0||o.key.indexOf("Solr")>=0;u.open({templateUrl:"js/angular/externalsync/templates/deleteConnector.html",controller:"DeleteConnectorCtrl",resolve:{type:function(){return o.key},isExternal:function(){return i}}}).result.then((function(a){e.setLoader(!0,"Deleting connector "+t.name,"This is usually a fast operation but it might take a while.");const s=function(e,t,n){const r=t.substring(0,t.length-1)+"/instance#";return"PREFIX prefix:<"+t+">\nINSERT DATA {\n\t<"+r+e+'> prefix:dropConnector "'+(n?"force":"")+'"\n}'}(t.name,o.value,a);d.addStatements(n.getActiveRepository(),r({update:s})).then((function(){p.getConnectors().then((function(){p.hasConnector(encodeURIComponent(o.value)).then((function(t){e.existing[o.key]=t.data}))})),a?(c.success("Deleted (with force) connector "+t.name),i&&c.warning("You may have to remove the index manually from "+o.key)):c.success("Deleted connector "+t.name)}),(function(e){c.error(getError(e))})).finally((function(){e.setLoader(!1)}))}))},e.viewQuery=function(t,n){u.open({templateUrl:"pages/viewQuery.html",controller:"ViewQueryCtrl",resolve:{query:function(){const r=e.getOptions(t);return s(n.name,t.value,o(n.values,r),r)}}})}}function c(e,t,n,r){e.force=!1,e.type=n,e.isExternal=r,e.ok=function(){t.close(e.force)},e.cancel=function(){t.dismiss()}}function l(e,t,n,r,o){function i(){return s(e.name,n.value,e.values,e.options,(function(e,t){o.error(t,e)}))}e.connector=n,e.addField=function(t,n){const r=angular.copy(e.defaultValues[n][0]);e.values[n].splice(t+1,0,r)},e.addOption=function(e,t){t.splice(e+1,0,"")},e.deleteOption=function(e,t){t.splice(e,1)},e.addMapOption=function(e,t){t.splice(e+1,0,{key:"",value:""})},e.deleteMapOption=function(e,t){t.splice(e,1)},e.ok=function(){if(e.form.$valid){const n=i();n&&t.close({name:e.name,values:e.values,options:e.options,query:n})}},e.viewQuery=function(){const e=i();e&&r.open({templateUrl:"pages/viewQuery.html",controller:"ViewQueryCtrl",resolve:{query:function(){return e}}})},e.cancel=function(){t.dismiss("cancel")}}function f(e,t,n,r,i,a,s,u){angular.extend(this,t("ExtendNewConnectorCtrl",{$scope:e,$modalInstance:r,connector:i,$modal:a})),e.values=s.values,e.options=u,e.name=s.name,s.skipConversion||(e.values=o(e.values,e.options)),e.defaultValues=angular.copy(e.values)}function d(e,t,n,r){function o(){const o=function(e){const t=e.replace(/\/instance#.+$/,"#connectorStatus");let n="";return n+="SELECT ?status {\n",n+="\t<"+e+"> <"+t+"> ?status",n+="\n}",n}(e.beingBuiltConnector.iri);e.beingBuiltConnector.iri=null,e.progressInterval=t((function(){(function(e){return i(n,r.getActiveRepository(),e)})(o).then((function(n){const r=function(e){if(e.bindings&&e.bindings.length>0)try{return JSON.parse(e.bindings[0].status.value)}catch(e){console.error(e)}return{}}(n.data.results);"BUILDING"===r.status?(e.beingBuiltConnector.status=r,e.beingBuiltConnector.percentDone=(100*r.processedEntities/r.estimatedEntities).toFixed(0),e.beingBuiltConnector.eta=e.getHumanReadableSeconds(r.etaSeconds),e.beingBuiltConnector.actionName=r.repair?"Repairing":"Creating",e.beingBuiltConnector.waitOnRepairStartOnce=!1):"BUILT"!==r.status||e.beingBuiltConnector.waitOnRepairStartOnce||(t.cancel(e.progressInterval),e.beingBuiltConnector.doneCallback&&e.beingBuiltConnector.doneCallback())}))}),1e3),e.$on("$destroy",(function(){t.cancel(e.progressInterval)}))}e.beingBuiltConnector=e.beingBuiltConnector||{},!e.beingBuiltConnector.inline&&e.beingBuiltConnector.iri&&o(),e.$watch("beingBuiltConnector.iri",(function(t){e.beingBuiltConnector.inline&&t&&o()}))}angular.module("graphdb.framework.externalsync.controllers",["graphdb.framework.rest.rdf4j.repositories.service","graphdb.framework.rest.connectors.service"]).controller("ConnectorsCtrl",u).controller("ExtendNewConnectorCtrl",l).controller("CreateConnectorCtrl",f).controller("CreateProgressCtrl",d).controller("DeleteConnectorCtrl",c).filter("ceil",(function(){return function(e){return Math.ceil(e)}})),u.$inject=["$scope","$http","$repositories","$modal","toastr","ModalService","$q","RDF4JRepositoriesRestService","ConnectorsRestService"],c.$inject=["$scope","$modalInstance","type","isExternal"],l.$inject=["$scope","$modalInstance","connector","$modal","toastr"],f.$inject=["$scope","$controller","$http","$modalInstance","connector","$modal","values","options"],d.$inject=["$scope","$interval","$http","$repositories"]},33:function(e,t,n){"use strict";n.r(t);n(4),n(12);function r(e,t,n,r,o,i,a,s,u,c,l,f,d,p){const h={id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:!0,sameAs:!0};let g,y=c.getPrincipal();function m(e,t){h.inference=t.appSettings.DEFAULT_INFERENCE,h.sameAs=t.appSettings.DEFAULT_SAMEAS,e.skipCountQuery=!t.appSettings.EXECUTE_COUNT,e.ignoreSharedQueries=t.appSettings.IGNORE_SHARED_QUERIES,e.tabsData=e.tabs=d.get(p.TABS_STATE)||[h],e.$watchCollection("[currentQuery.inference, currentQuery.sameAs]",(function(e,t,n){v(n.currentQuery)})),e.$on("repositoryIsSet",C)}function v(t){e.tabs.forEach((function(n,r){n.id===t.id&&(e.tabs[r].query=t.query,e.tabs[r].inference=t.inference,e.tabs[r].sameAs=t.sameAs)})),d.set(p.TABS_STATE,e.tabs)}function x(t,n,r,o){const i=angular.element(document.getElementById("yasr-inner"));e.queryIsRunning=t,t?(e.queryStartTime=Date.now(),e.countTimeouted=!1,e.progressMessage=n,e.extraMessage=r,e.noLoaderTimer=o,i.addClass("hide")):(e.progressMessage="",e.extraMessage="",e.noLoaderTimer=!1,e.currentTrackAlias=null,e.abortRequested=!1,i.removeClass("hide")),null===e.$$phase&&e.$apply()}function w(n){function r(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}if(e.orientationViewMode){if("yasr"===e.viewMode){let e=r()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px"}else e.noPadding={},document.querySelector(".CodeMirror-wrap").style.height="";document.getElementById("yasr").style.minHeight=""}else if(e.noPadding={paddingRight:15,paddingLeft:0},window.editor&&document.querySelector(".CodeMirror-wrap")){let e=r()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px",document.getElementById("yasr").style.minHeight=e+"px"}else{let r;r=t(n?function(){e.fixSizesOnHorizontalViewModeSwitch(n)}:e.fixSizesOnHorizontalViewModeSwitch,100),e.$on("$destroy",(function(){t.cancel(r)}))}window.yasr&&window.yasr.container&&t((function(){window.yasr.container.resize()}),100)}function b(){w(!0)}function C(t,n){n.newRepo&&(e.tabsData=d.get(p.TABS_STATE),e.tabsData.forEach((function(e){e.yasrData=void 0,e.queryType=void 0,e.resultsCount=0,e.allResultsCount=0,e.sizeDelta=void 0})),d.set(p.TABS_STATE,e.tabsData),e.tabs=e.tabsData,e.currentQuery={},e.errorMessage=null,e.repositoryError=null)}function S(e){t((function(){$('a[data-id = "'+e+'"]').tab("show")}),0)}function M(o,i){if(e.executedQueryTab=e.currentQuery,i){if("SELECT"!==window.editor.getQueryType()&&"CONSTRUCT"!==window.editor.getQueryType())return void n.warning("Explain only works with SELECT or CONSTRUCT queries.");if(r.isActiveRepoOntopType())return void n.warning("Explain not supported for Virtual repositories.")}if(e.explainRequested=i,!e.queryIsRunning){if(o?e.currentTabConfig.resultsCount=0:e.resetCurrentTabConfig(),e.lastRunQueryMode=window.editor.getQueryMode(),"update"===e.lastRunQueryMode&&r.isActiveRepoOntopType())return void n.warning("Updates are not supported for Virtual repositories.");if(x(!0,"update"===e.lastRunQueryMode?"Executing update":"Evaluating query"),"none"!==e.viewMode){e.viewMode="none",e.orientationViewMode&&e.fixSizesOnHorizontalViewModeSwitch();const n=t(window.editor.query,500);e.$on("$destroy",(function(){t.cancel(n)}))}else window.editor.query()}}function E(){e.showSampleQueries=!e.showSampleQueries,e.showSampleQueries?a.getSavedQueries().success((function(t){e.sampleQueries=t,$("#sampleQueriesCollapse").collapse("show").width("300px")})).error((function(e){const t=getError(e);n.error(t,"Error! Could not get saved queries")})):$("#sampleQueriesCollapse").collapse("hide")}function _(t){let n=void 0;return e.tabsData.forEach((function(e){if(e.name===t.name&&e.query===t.body)return n=e.id,e})),n}function T(t){return function(n,r,o){e.savedQuery={name:n,query:r||window.editor.getValue(),shared:o},$(t).modal("show")}}function R(t){for(let n=0;n<e.tabsData.length;n++){if(e.tabsData[n].id===t)return n}}y?m(e,y):e.$on("securityInit",(function(e){y=c.getPrincipal(),m(e.currentScope,y)})),this.hint=document.createElement("span"),this.hint.innerHTML='Hint: "abC" matches "abC*", "ab c*" and "ab-c*"',this.hint.style.fontSize="12px",this.hint.style.color="gray",this.hint.style.backgroundColor="white",this.hint.style.position="absolute",this.hint.style.zIndex="3",this.hint.style.paddingLeft="12px",e.$watch((function(){return angular.element(".CodeMirror-hints").length}),e=>{if(e){const e=angular.element(".CodeMirror-hints")[0].getBoundingClientRect();document.body.appendChild(this.hint),this.hint.style.top=e.top-20+"px",this.hint.style.left=e.right-this.hint.offsetWidth-12+"px"}else this.hint&&this.hint.parentNode&&this.hint.parentNode.removeChild(this.hint)}),e.resetCurrentTabConfig=function(){e.currentTabConfig={pageSize:1e3,page:1,allResultsCount:0,resultsCount:0}},e.queryExists=!1,e.resetCurrentTabConfig(),e.saveTab=function(t){const n=R(t);if(void 0===n)return{};const r=e.tabsData[n];return e.saveQueryToLocal(r),r},e.loadTab=function(n){e.tabsData=d.get(p.TABS_STATE)||[h];const o=R(n),i=e.tabsData[o];i.yasrData&&x(!0,"Rendering results",null,!0);t((function(){""===e.currentQuery.query&&(e.currentQuery.query=" "),t((function(){window.editor.setValue(e.currentQuery.query),e.yasr.updateDownloadDropdown(),e.$broadcast("tabLoaded",e.currentQuery.id),e.yasr.options.output=i.outputType,i.yasrData&&(i.yasrData.customError?(e.yasr.results={getException:function(){return i.yasrData.customError}},x(!1)):t((function(){e.setYasrResponse(i.yasrData,i.textStatus,i.jqXhrOrErrorString),x(!1),$(".yasr_btnGroup li:nth-child(2)").hasClass("active")&&t((function(){$(".yasr_btnGroup li:nth-child(2) a").get(0).click()}),0)}),0))}),0)}),0),d.set(p.TABS_STATE_CURRENT_ID,n),e.currentQuery=i,t((function(){e.currentTabConfig={},e.currentTabConfig.queryType=i.queryType,e.currentTabConfig.resultsCount=i.resultsCount,e.currentTabConfig.offset=i.offset,e.currentTabConfig.allResultsCount=i.allResultsCount,e.currentTabConfig.allResultsCountExact=i.allResultsCountExact,e.currentTabConfig.page=i.page,e.currentTabConfig.pageSize=i.pageSize,e.currentTabConfig.timeFinished=i.timeFinished,e.currentTabConfig.timeTook=i.timeTook,e.currentTabConfig.sizeDelta=i.sizeDelta,e.currentTabConfig.customUpdateMessage=i.customUpdateMessage,e.currentTabConfig.errorMessage=i.errorMessage,e.currentTabConfig.warningMessage=i.warningMessage,e.$apply()}),0),$("#yasr").css("padding","0"),g||(g=setInterval(I,200));!function(){const t=r.isActiveRepoOntopType(),n=r.isActiveRepoFedXType();(function(e){const t=document.getElementById("sameAs"),n=document.getElementById("inference");t.disabled=!(!t||!e),n.disabled=!(!n||!e)})(t),e.nocount=!(!t&&!n)||!y.appSettings.EXECUTE_COUNT,e.currentQuery.inference=!!t||y.appSettings.DEFAULT_INFERENCE,e.currentQuery.sameAs=!!t||y.appSettings.DEFAULT_SAMEAS}()},e.addNewTab=function(n,r,o){if(!N(!0))return;let i;i=r||o?{id:"1",name:r,query:o,inference:y.appSettings.DEFAULT_INFERENCE,sameAs:y.appSettings.DEFAULT_SAMEAS}:{id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:y.appSettings.DEFAULT_INFERENCE,sameAs:y.appSettings.DEFAULT_SAMEAS};k++;const a=""+k;e.tabsData=e.tabs;const s=i;s.id=a,e.tabsData.push(s),d.set(p.TABS_STATE_MAXID,k),d.set(p.TABS_STATE,e.tabsData);const u=Array.prototype.slice.call(arguments,1);t((function(){e.$apply(),S(a),n&&n.apply(this,u)}),0),e.tabs=e.tabsData},e.isTabChangeOk=N,e.runQuery=M,e.abortCurrentQuery=function(){f.abortQueryByAlias(e.currentTrackAlias).success((function(){e.abortRequested=!0}))},e.editQuery=function(t){o.open({templateUrl:"js/angular/core/directives/queryeditor/templates/query-sample.html",controller:"QuerySampleModalCtrl",resolve:{data:function(){return{title:'Edit Saved Query: "'+t.name+'"',query:t,edit:!0,okButtonText:"Save"}}}}).result.then((function(r){const o={name:r.name,body:r.body,shared:r.shared};t.name!==r.name?a.addNewSavedQuery(o).success((function(){e.deleteQueryHttp(t.name,!0)})).error((function(e){const t=getError(e);n.error(t,"Error! Cannot edit saved query")})):a.editSavedQuery(o).success((function(){$("#editQueryContainer").modal("hide"),e.toggleSampleQueries(),n.success("Saved query "+t.name+" was edited.")})).error((function(e){const t=getError(e);n.error(t,"Error! Cannot edit Saved query")}))}))},e.getNamespaces=function(){x(!0,"Refreshing namespaces","Normally this is a fast operation but it may take longer if a bigger repository needs to be initialised first."),e.namespacesLoading=!0,l.getRepositoryNamespaces().success((function(t){const n={};t.results.bindings.forEach((function(e){n[e.prefix.value]=e.namespace.value})),e.namespaces=n})).error((function(t){e.repositoryError=getError(t)})).finally((function(){x(!1),e.namespacesLoading=!1}))},e.changePagination=function(){M(!0,e.explainRequested)},e.toggleSampleQueries=E,e.addKnownPrefixes=function(){a.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success((function(e){angular.isDefined(window.editor)&&angular.isDefined(e)&&e!==window.editor.getValue()&&window.editor.setValue(e)})).error((function(e){const t=getError(e);return n.error(t,"Error! Could not add known prefixes"),!0}))},e.getExistingTabId=_,e.querySelected=function(t){const n=_(t);e.toggleSampleQueries(),e.isTabChangeOk(!1)&&(e.highlightNextTabChange=!0,angular.isDefined(n)?S(n):e.addNewTab(null,t.name,t.body))},e.deleteQuery=function(t){i.openSimpleModal({title:"Confirm",message:"Are you sure you want to delete the saved query '"+t+"'?",warning:!0}).result.then((function(){e.deleteQueryHttp(t)}))},e.deleteQueryHttp=function(t,r){a.deleteSavedQuery(t).success((function(){e.toggleSampleQueries(),r||n.success("Saved query: "+t+" was deleted.")})).error((function(e){const t=getError(e);n.error(t,"Error! Cannot delete saved query")}))},e.saveQuery=function(t,n){o.open({templateUrl:"js/angular/core/directives/queryeditor/templates/query-sample.html",controller:"QuerySampleModalCtrl",resolve:{data:function(){return{title:"Create New Saved Query",query:{name:t.name,body:t.query,shared:t.shared},edit:!1,okButtonText:"Create",queryExists:n}}}}).result.then((function(t){e.saveQueryHttp(t)}),(function(){}))},e.saveQueryHttp=function(t){a.addNewSavedQuery(t).success((function(){n.success("Saved query "+t.name+" was saved.")})).error((function(r){let o=getError(r);if(n.error(o,"Error! Cannot create saved query"),o="Query '"+t.name+"' already exists!"){t.query=t.body;const n=!0;e.saveQuery(t,n)}}))},e.saveQueryToLocal=v,e.setLoader=x,e.getLoaderMessage=function(){const t=(Date.now()-e.queryStartTime)/1e3;let n="",r="";e.noLoaderTimer||(n=e.getHumanReadableSeconds(t));r=e.progressMessage?e.progressMessage+"... "+n:"Running operation... "+n;e.extraMessage&&t>10&&(r+="\n"+e.extraMessage);return r},e.fixSizesOnHorizontalViewModeSwitch=w,e.changeViewMode=function(){e.viewMode="none",e.orientationViewMode=!e.orientationViewMode,d.set(p.VIEW_MODE,e.orientationViewMode),w()},e.showHideEditor=b,e.focusQueryEditor=function(){angular.element(document).find(".editable-input").is(":focus")||angular.element(document).find(".CodeMirror textarea:first-child").focus()},e.orientationViewMode=!d.get(p.VIEW_MODE)||"true"===d.get(p.VIEW_MODE),e.viewMode="none",e.getActiveRepository=function(){return r.getActiveRepository()},e.getActiveRepositoryNoError=function(){if(!e.repositoryError)return r.getActiveRepository()},e.orientationViewMode||b(),window.onbeforeunload=function(){e.currentQuery&&e.saveTab(e.currentQuery.id),d.set(p.TABS_STATE,e.tabs)},e.$on("$destroy",(function(){e.currentQuery&&e.saveTab(e.currentQuery.id),d.set(p.TABS_STATE,e.tabs),clearInterval(g)})),e.$on("$destroy",(function(){clearInterval(g),window.editor=null,window.yasr=null})),$(document).mouseup((function(t){const n=$("#sampleQueriesCollapse");!n.is(t.target)&&0===n.has(t.target).length&&e.showSampleQueries&&E()}));let k=d.get(p.TABS_STATE_MAXID)||1;function A(e){return $(e).attr("data-id")}function I(){if(e.currentTabConfig.resultsCount>=0){const e=$(".saveAsDropDown");e.length>0&&!window.editor.queryValid?yasr.header.find(".saveAsDropDown").remove():0===e.length&&window.editor.queryValid&&yasr.updateDownloadDropdown()}}function N(t){return!(e.queryIsRunning&&!e.namespacesLoading)||(t?n.info("New tabs may not be opened while query or update is running."):n.info("Tabs may not be switched while query or update is running."),!1)}e.highlightNextTabChange=!1,e.$on("tabAction",(function(n,r){r.relatedTarget&&(t.cancel(r.relatedTarget.timer),$(r.relatedTarget).css("color",""),e.saveTab(A(r.relatedTarget))),e.loadTab(A(r.target));const o=["#ED4F2F","","#ED4F2F"],i=[400,400,400];if(e.highlightNextTabChange){e.highlightNextTabChange=!1;let n=0;$(r.target).css("color",o[n]);const a=function(){n++,n<o.length?($(r.target).css("color",o[n]),r.target.timer=t(a,i[n])):$(r.target).css("color","")};t(a,i[n])}})),e.$on("deleteAllexeptSelected",(function(t,n){e.tabsData=n,e.tabs=n})),e.currentQuery={},e.showSampleQueries=!1,e.savedQuery={},e.sampleQueries={},e.editQueryModal=T("#editQueryContainer"),e.deleteQueryModal=T("#confirmDeleteContainer"),e.saveQueryModal=T("#saveQueryContainer"),e.getResultsDescription=function(){let t;if(0===e.currentTabConfig.resultsCount)t="No results.";else{const n=(e.currentTabConfig.page-1)*e.currentTabConfig.pageSize+Math.min(e.currentTabConfig.resultsCount,e.currentTabConfig.pageSize);t="Showing results from "+s("currency")(e.currentTabConfig.offset,"",0)+" to "+s("currency")(n,"",0),e.currentTabConfig.allResultsCount>0&&(t+=e.currentTabConfig.allResultsCountExact?" of ":" of at least ",t+=s("currency")(e.currentTabConfig.allResultsCount,"",0)),t+="."}return t},e.getUpdateDescription=function(){return e.currentTabConfig.customUpdateMessage?e.currentTabConfig.customUpdateMessage:void 0===e.currentTabConfig.sizeDelta?"":e.currentTabConfig.sizeDelta<0?"Removed "+Math.abs(e.currentTabConfig.sizeDelta)+" statements.":e.currentTabConfig.sizeDelta>0?"Added "+e.currentTabConfig.sizeDelta+" statements.":"The number of statements did not change."},e.getStaleWarningMessage=function(){const t=60*Math.round((Date.now()-e.currentTabConfig.timeFinished)/6e4);if(t>=3600)return"Possibly stale result (obtained "+e.getHumanReadableSeconds(t)+" ago)."};const L=function(){};angular.element(u).bind("resize",L),e.$on("$destroy",(function(){angular.element(u).unbind("resize",L)}))}function o(e,t,n){n.queryExists&&(e.queryExists=!0),e.query=angular.copy(n.query),e.title=n.title,e.edit=n.edit,e.okButtonText=n.okButtonText,e.ok=function(){e.form.$valid&&t.close(e.query)},e.cancel=function(){t.dismiss("cancel")}}angular.module("graphdb.framework.core.directives.queryeditor.controllers",["graphdb.framework.utils.localstorageadapter","graphdb.framework.rest.sparql.service"]).controller("QueryEditorCtrl",r).controller("QuerySampleModalCtrl",o),r.$inject=["$scope","$timeout","toastr","$repositories","$modal","ModalService","SparqlRestService","$filter","$window","$jwtAuth","RDF4JRepositoriesRestService","MonitoringRestService","LocalStorageAdapter","LSKeys"],o.$inject=["$scope","$modalInstance","data"]},34:function(e,t,n){"use strict";n.r(t);n(29),n(4),n(32);var r=n(209),o=n.n(r),i=n(207),a=n.n(i);function s(e,t,n,r,i,s,u,c,l,f,d,p){let h;return{restrict:"AE",scope:!1,templateUrl:"js/angular/core/directives/queryeditor/templates/query-editor.html",link:function(g,y,m){g.nostorage=m.hasOwnProperty("nostorage"),g.notabs=m.hasOwnProperty("notabs"),g.notoolbar=m.hasOwnProperty("notoolbar"),g.notoolbarSaved=m.hasOwnProperty("notoolbarSaved"),g.notoolbarCopy=m.hasOwnProperty("notoolbarCopy"),g.notoolbarInference=m.hasOwnProperty("notoolbarInference"),g.notoolbarSameAs=m.hasOwnProperty("notoolbarSameAs"),g.nostatus=m.hasOwnProperty("nostatus"),g.norun=m.hasOwnProperty("norun"),g.runButtonName="Run",m.runButtonName&&(g.runButtonName=m.runButtonName);if(g.nocount="true"===m.nocount,m.callbackOnChange){const e=g[m.callbackOnChange];"function"==typeof e&&(h=e)}e((function(){!function(g){function y(){angular.element("#wb-sparql-saveQuery")[0].click()}function m(){g.runQuery(!1,!1)}function v(){g.runQuery(!1,!0)}function x(){if(g.tabs.length<2||!g.currentQuery.id||!g.isTabChangeOk(!1))return;let e=I(g.currentQuery.id);e=(e+1)%g.tabs.length,b(g.tabs[e].id)}function w(){if(g.tabs.length<2||!g.currentQuery.id||!g.isTabChangeOk(!1))return;let e=I(g.currentQuery.id);e--,-1===e&&(e=g.tabs.length-1),b(g.tabs[e].id)}function b(t){e((function(){let e=$('a[data-id = "'+t+'"]');0===e.length&&(e=$("a[data-id]").first()),e.tab("show")}),0)}g.changePagination=function(){g.runQuery(!0,g.explainRequested)},window.editor=o.a.fromTextArea(document.getElementById("query"),{persistent:null,value:"",indentUnit:4,createShareLink:null,cursorHeight:1,sparql:{showQueryButton:!1,acceptHeaderGraph:"application/x-graphdb-table-results+json, application/rdf+json;q=0.9, */*;q=0.8",acceptHeaderSelect:"application/x-sparqlstar-results+json, application/sparql-results+json;q=0.9, */*;q=0.8"},extraKeys:{"Ctrl-Enter":m,"Cmd-Enter":m,"Shift-Ctrl-Enter":v,"Shift-Cmd-Enter":v,"Ctrl-Alt-T":g.addNewTab,"Cmd-Alt-T":g.addNewTab,"Ctrl-S":y,"Cmd-S":y,"Ctrl-Alt-Left":w,"Cmd-Alt-Left":w,"Ctrl-Alt-Right":x,"Cmd-Alt-Right":x}}),window.editor.toastBuildIndex=function(){n.warning("",'<div class="autocomplete-toast"><a href="autocomplete">Autocomplete is OFF<br>Go to Setup -> Autocomplete</a></div>',{allowHtml:!0})},window.editor.toastError=function(e){n.error("Cannot execute autocomplete query. "+getError(e))},window.editor.on("changes",(function(){angular.element(".CodeMirror-linenumbers").css("width","1px"),angular.element(".CodeMirror-sizer").css("margin-left","0px"),clearTimeout(g.changesTimeout);const e=!window.editor.queryValid;g.changesTimeout=setTimeout(h?h():function(){const t=I(g.currentQuery.id)+1;$('a[data-id = "'+t+'"]').toggleClass("query-has-error",e).attr("title",e?"Query contains a syntax error. See the relevant line for more information.":"")},200),g.currentQuery.query=window.editor.getValue(),g.currentQuery.queryType=window.editor.getQueryType()})),$(".fullscreenToggleBtns").hide();const C=function(e){$(e.target).removeClass("fa-link").addClass("fa-check").blur(),setTimeout((function(){$(e.target).removeClass("fa-check").addClass("fa-link")}),1e3)};window.onbeforeunload=function(){g.nostorage||d.set(p.TABS_STATE,g.tabs),g.saveTab(g.currentQuery.id)};const S=o.a.executeQuery,M=o.a.getUrlArguments;function E(e,t,n){return{status:e,statusText:t,responseText:n}}let T,R;g.$on("$destroy",(function(){g.nostorage||d.set(p.TABS_STATE,g.tabs),o.a.executeQuery=S,o.a.getUrlArguments=M,g.saveTab(g.currentQuery.id)})),o.a.drawButtons=function(e){e.buttons=$("#yasqe_buttons_mocked")},o.a.getActiveRepository=function(){return r.getActiveRepository()},o.a.getUrlArguments=function(e,t){const n=M(e,t),r=window.editor.getQueryType();return"SELECT"!==r&&"CONSTRUCT"!==r&&"DESCRIBE"!==r||(n.push({name:"limit",value:g.currentTabConfig.pageSize+1}),g.currentTabConfig.offset=(g.currentTabConfig.page-1)*g.currentTabConfig.pageSize+1,n.push({name:"offset",value:g.currentTabConfig.offset-1})),!g.explainRequested||"SELECT"!==r&&"CONSTRUCT"!==r||n.push({name:"explain",value:"true"}),n},o.a.executeQuery=function(e){if(R&&$(R.resultsContainer).length&&$(R.resultsContainer).empty(),e.options.sparql.headers["X-GraphDB-Catch"]=g.currentTabConfig.pageSize+"; throw",g.currentTrackAlias="query-editor-"+performance.now()+"-"+Date.now(),e.options.sparql.headers["X-GraphDB-Track-Alias"]=g.currentTrackAlias,g.countTimeouted=!1,"query"===e.getQueryMode()?e.options.sparql.endpoint="repositories/"+r.getActiveRepository():"update"===e.getQueryMode()&&(e.options.sparql.endpoint="repositories/"+r.getActiveRepository()+"/statements"),e.options.sparql.args=[{name:"infer",value:g.currentQuery.inference},{name:"sameAs",value:g.currentQuery.sameAs}],g.currentTabConfig.customUpdateMessage="","update"!==window.editor.getQueryMode()){const t=g.currentTabConfig,n=g.executedQueryTab.id;return window.editor.options.sparql.handlers.countCallback=function(e,r,o){if(200===e.status){const i=g.tabs[I(n)];i&&(R.setResultsCount(e,r,o),t.allResultsCount=R.allCount,i.allResultsCount=R.allCount,t.allResultsCountExact=!0,i.allResultsCountExact=!0,g.saveTab(i.id))}else t.countTimeouted=!0},null!=g.currentQuery.outputType?R.options.output=g.currentQuery.outputType:R.options.output="table",g.currentTabConfig.queryType=window.editor.getQueryType(),g.queryStartTime=(new Date).getTime(),S(e,{setQueryLimit:function(e){return"CONSTRUCT"===g.currentTabConfig.queryType&&r.isActiveRepoOntopType()?window.editor.getValueWithoutComments():e}})}{const t=function(){g.currentTabConfig.queryType="UPDATE",l.getRepositorySize().success((function(t){return g.repoSize=parseInt(t),g.queryStartTime=(new Date).getTime(),S(e,{})})).error((function(t){return n.warning("Could not get repository size for: "+r.getActiveRepository()+"; "+getError(t)),g.queryStartTime=(new Date).getTime(),S(e,{})}))};f.checkConnector(window.editor.getValue()).then((function(e){if(e.data.command&&!e.data.hasSupport){g.currentTabConfig.queryType="ERROR",g.currentTabConfig.timeFinished=Date.now(),g.currentTabConfig.timeTook=(g.currentTabConfig.timeFinished-g.queryStartTime)/1e3;const t=E(-1,"No support for "+e.data.connectorName,e.data.connectorName+" connectors are not supported because the plugin "+e.data.pluginName+" is not active.");return R.results={getException:function(){return t}},g.setLoader(!1),void A({customError:t},"",null)}if("create"===e.data.command||"repair"===e.data.command){const t="repair"===e.data.command;t?(g.setLoader(!0,"Repairing connector "+e.data.name),g.currentTabConfig.customUpdateMessage="Repaired connector "+e.data.name+"."):(g.setLoader(!0,"Creating connector "+e.data.name),g.currentTabConfig.customUpdateMessage="Created connector "+e.data.name+".");const n=g.$new(!0);n.beingBuiltConnector={percentDone:0,status:{processedEntities:0,estimatedEntities:0,indexedEntities:0,entitiesPerSecond:0},actionName:t?"Repairing":"Creating",eta:"-",inline:!1,iri:e.data.iri,name:e.data.name,doneCallback:function(){T.dismiss("cancel")}},n.getHumanReadableSeconds=g.getHumanReadableSeconds,T=u.open({templateUrl:"pages/connectorProgress.html",controller:"CreateProgressCtrl",size:"lg",backdrop:"static",scope:n})}else"drop"===e.data.command&&(g.setLoader(!0,"Deleting connector "+e.data.name),g.currentTabConfig.customUpdateMessage="Deleted connector "+e.data.name+".");t()}),(function(){t()}))}};const k=o.a.getAjaxConfig;function A(e,t,n){e.getResponseHeader&&e.getResponseHeader("content-type")&&(e.contentType=e.getResponseHeader("content-type")),delete e.response;const r=I(g.executedQueryTab.id),o=g.tabs[r],i={queryType:g.currentTabConfig.queryType,yasrData:e,textStatus:t,jqXhrOrErrorString:n,page:g.currentTabConfig.page,pageSize:g.currentTabConfig.pageSize,allResultsCount:g.currentTabConfig.allResultsCount,allResultsCountExact:g.currentTabConfig.allResultsCountExact,resultsCount:g.currentTabConfig.resultsCount,offset:g.currentTabConfig.offset,timeTook:g.currentTabConfig.timeTook,timeFinished:g.currentTabConfig.timeFinished,sizeDelta:g.currentTabConfig.sizeDelta,customUpdateMessage:g.currentTabConfig.customUpdateMessage,errorMessage:g.currentTabConfig.errorMessage,warningMessage:g.currentTabConfig.warningMessage};"ERROR"!==g.currentTabConfig.queryType&&"UPDATE"!==g.currentTabConfig.queryType&&"ASK"!==g.currentTabConfig.queryType&&(i.outputType=g.yasr.options.output),angular.extend(g.currentQuery,i),angular.extend(o,i),g.nostorage||d.set(p.TABS_STATE,g.tabs),$('a[data-id = "'+g.executedQueryTab.id+'"]').tab("show")}function I(e){for(let t=0;t<g.tabs.length;t++){if(g.tabs[t].id===e)return t}}function N(e){return angular.isDefined(e)&&"false"!==e}function L(e,n,r){const o=g.getExistingTabId(e),i=g.$on("tabLoaded",(function(){angular.isDefined(n)&&(g.currentQuery.inference=N(n)),angular.isDefined(r)&&(g.currentQuery.sameAs=N(r)),N(t.search().execute)&&("update"===window.editor.getQueryMode()?s.openSimpleModal({title:"Confirm execute",message:"This is an update and it may change the data in the repository.<br>Are you sure you want to execute it automatically?",warning:!0}).result.then((function(){g.runQuery(!1)})):g.runQuery(!1)),i()}));g.highlightNextTabChange=!0,angular.isDefined(o)?b(o):g.addNewTab(null,e.name,e.body)}function D(){if(t.search().savedQueryName)e=t.search().savedQueryName,r=t.search().owner,o=t.search().infer,a=t.search().sameAs,i.getSavedQuery(e,r).success((function(e){L(e,o,a)})).error((function(t){n.error("Could not get data for saved query: "+e+"; "+getError(t))}));else if(t.search().query){L({name:t.search().name,body:t.search().query},t.search().infer,t.search().sameAs)}else{b(d.get(p.TABS_STATE_CURRENT_ID))}var e,r,o,a}function P(){g.getNamespaces(),o.a.signal(window.editor,"repositoryOrAuthorizationChanged",r.getActiveRepository(),c.getAuthToken()),D()}o.a.getAjaxConfig=function(e,t){const n=k(e,t);return _.extend(n.headers,{Authorization:c.getAuthToken()}),n},g.copyToClipboardQuery=function(e,t){s.openCopyToClipboardModal(function(e,t){let n=[location.protocol,"//",location.host,location.pathname].join("");e?(n=n+"?savedQueryName="+encodeURIComponent(e),null!=t&&(n+="&owner="+encodeURIComponent(t))):n=n+"?"+$.param({name:g.currentQuery.name,infer:g.currentQuery.inference,sameAs:g.currentQuery.sameAs,query:window.editor.getValue()});return n}(e,t))},g.copyToClipboardResult=function(e){s.openCopyToClipboardModal(e)},g.goToVisual=function(){const e={query:window.editor.getValue(),sameAs:g.currentQuery.sameAs,inference:g.currentQuery.inference};t.path("graphs-visualizations").search(e)},$("textarea").on("paste",(function(){e((function(){g.addKnownPrefixes()}),0)})),R=a()(document.getElementById("yasr"),{getUsedPrefixes:{},persistency:!1}),window.yasr=R,R.afterCopy=C,R.getQueryResultsAsFormat=function(e){const t=$("#wb-download");t.attr("action","repositories/"+r.getActiveRepository()),$("#wb-download-query").val(g.currentQuery.query),window.editor.getValue()!==g.currentQuery.query&&n.warning("The query in your editor does not match the query results. Download will save the results from the last executed query."),$("#wb-download-infer").val(g.currentQuery.inference),$("#wb-download-sameAs").val(g.currentQuery.sameAs);const o=localStorage.getItem("com.ontotext.graphdb.auth");o&&$("#wb-auth-token").val(o),$("#wb-download-accept").val(e),t.submit()},window.editor.options.sparql.handlers.complete=function(t,r,o){function i(){A(t,r,o)}if(T&&T.dismiss("cancel"),null===window.editor)return void g.setLoader(!1);if(g.currentTabConfig.errorMessage=t.getResponseHeader("X-GraphDB-Error"),g.currentTabConfig.warningMessage=t.getResponseHeader("X-GraphDB-Warning"),R.currentQuery=g.currentQuery,g.currentTabConfig.timeFinished=Date.now(),g.currentTabConfig.timeTook=(g.currentTabConfig.timeFinished-g.queryStartTime)/1e3,t.status>=400)return t.responseText=t.responseText.replace(/^([^: ]+: )+/,""),g.currentTabConfig.queryType="ERROR",i(),g.setYasrResponse(t,r,o),void g.setLoader(!1);if(0===t.status){g.currentTabConfig.queryType="ERROR";const e=E(-1,"Request was aborted","The request has been aborted. There are no results to show.");return R.results={getException:function(){return e}},g.setLoader(!1),void A({customError:e},"",null)}let a;if(g.setLoader(!1),"update"===window.editor.getQueryMode())a=function(){l.getRepositorySize().success((function(e){let t;void 0!==g.repoSize&&(t=Number(e)-g.repoSize),g.currentTabConfig.sizeDelta=t,i()})).error((function(e){n.warning("Could not get repository size for: "+g.getActiveRepository()+"; "+getError(e)),g.currentTabConfig.sizeDelta=void 0,i()}))};else{if(200===t.status){const e=t.getResponseHeader("Content-Type");0!==e.indexOf("application/sparql-results+json")&&0!==e.indexOf("application/x-sparqlstar-results+json")&&0!==e.indexOf("application/x-graphdb-table-results+json")||t.responseJSON.results&&(g.currentTabConfig.resultsCount=t.responseJSON.results.bindings.length,t.responseJSON.results.bindings.length>g.currentTabConfig.pageSize&&(t.responseJSON.results.bindings.length=g.currentTabConfig.pageSize),g.currentTabConfig.allResultsCountExact||((g.nocount||g.countTimeouted||g.currentTabConfig.resultsCount<=g.currentTabConfig.pageSize)&&(t.status=204),g.currentTabConfig.allResultsCount=Math.max(g.currentTabConfig.allResultsCount,g.currentTabConfig.pageSize*(g.currentTabConfig.page-1)+g.currentTabConfig.resultsCount),g.currentTabConfig.resultsCount<=g.currentTabConfig.pageSize&&(g.currentTabConfig.allResultsCountExact=!0)))}g.setLoader(!0,"Rendering results",null,!0),a=function(){g.setYasrResponse(t,r,o),i(),g.setLoader(!1)}}e((function(){a(),"CONSTRUCT"!==window.editor.getQueryType()?($(".yasr_btnGroup.nav.nav-tabs li a.disabled").removeClass("disabled").css("font-weight","400"),$(".yasr_btnGroup.nav.nav-tabs li.disabled a").addClass("disabled").css("font-weight","200"),"DESCRIBE"===window.editor.getQueryType()&&$(".yasr_btnGroup.nav.nav-tabs li a").removeClass("disabled").css("font-weight","400")):"CONSTRUCT"===window.editor.getQueryType()&&$(".yasr_btnGroup.nav.nav-tabs li a.disabled").removeClass("disabled").css("font-weight","400"),$("#yasr").css("padding","0"),$(".yasr_btnGroup li:nth-child(2)").hasClass("active")&&e((function(){$(".yasr_btnGroup li:nth-child(2) a").get(0).click()}),100),$("#wb-sparql-addNewTab").click((function(){$(".dataTables_filter").hide(),$(".resultsTable").hide()}))}),100)},window.editor.options.sparql.handlers.resetResults=function(){},g.yasr=R,g.setYasrResponse=function(e,t,n){e.responseJSON&&(e.response=e.responseJSON,e.responseText=void 0),R.setResponse(e,t,n)},g.$watch("yasr.options.output",(function(e){if(e&&"UPDATE"!==g.currentTabConfig.queryType&&"ASK"!==g.currentTabConfig.queryType){const t=g.tabs[I(g.currentQuery.id)];angular.isDefined(t)&&g.currentTabConfig.queryType&&t.outputType!==e&&(t.outputType=g.currentQuery.outputType=e,g.saveTab(t.id))}})),void g.$watch("namespaces",(function(){g.namespaces&&(R&&R.options&&g.namespaces&&(R.options.getUsedPrefixes=g.namespaces),o.a.signal(window.editor,"namespacesChanged",g.namespaces))})),$(document).mouseup((function(e){const t=$("#sampleQueriesCollapse");!t.is(e.target)&&0===t.has(e.target).length&&g.showSampleQueries&&g.toggleSampleQueries()})),r.getActiveRepository()&&P();g.$on("repositoryIsSet",(function(){r.getActiveRepository()&&P()})),e((function(){angular.element(document).find(".CodeMirror textarea:first-child").focus()}),50)}(g)}),150)}}}angular.module("graphdb.framework.core.directives.queryeditor.queryeditor",["ngCookies","graphdb.framework.externalsync.controllers","graphdb.framework.rest.connectors.service","graphdb.framework.utils.localstorageadapter"]).directive("queryEditor",s),s.$inject=["$timeout","$location","toastr","$repositories","SparqlRestService","ModalService","$modal","$jwtAuth","RDF4JRepositoriesRestService","ConnectorsRestService","LocalStorageAdapter","LSKeys"]},37:function(e,t){angular.module("graphdb.framework.rest.graphexplore.data.service",[]).factory("GraphDataRestService",a),a.$inject=["$http"];const n="rest/class-hierarchy",r="rest/domain-range",o="rest/dependencies/",i="rest/explore-graph/";function a(e){return{getClassHierarchyData:function(t){return e.get(n,{params:{graphURI:t}})},reloadClassHierarchy:function(t){return e.get(n,{params:{doReload:!0,graphURI:t}})},getClassInstances:function(t){return e.get(`${n}/class-instances`,{params:{targetUri:t}})},getDomainRangeData:function(t,n){return e.get(r,{params:{targetUri:t,collapsed:n}})},checkDomainRangeData:function(t){return e.head(r,{params:{targetUri:t}})},getRelationshipsData:function(t,n,r){return e.get(`${o}matrix`,{params:{mode:n,classes:_.map(t,(function(e){return e.name})),graphURI:r}})},getRelationshipsClasses:function(t,n){return e.get(`${o}classes`,{params:{mode:t,graphURI:n}})},getRelationshipsStatus:function(t){return e.get(`${o}status`,{params:{graphURI:t}})},calculateRelationships:function(t){return e.get(`${o}update`,{params:{graphURI:t}})},getPredicates:function(t,n,r){return e.get(`${o}predicates`,{params:{from:t,to:n,mode:"all",graphURI:r}})},getInstanceNode:function(t){return e.get(`${i}node`,{params:{iri:t}})},getInstanceNodeLinks:function(t){return e.get(`${i}links`,{params:{iri:t}})},getRdfsLabelAndComment:function(t,n,r){const o=r||{};return e({url:"rest/explore/details",method:"GET",params:_.extend(o,{uri:t,languages:n}),headers:{Accept:"application/json"}})}}}},49:function(e,t){function n(e){return{initLazyList:function(t,n,r,o,i){return e((function(){const e=t+o-1,a=Math.max(0-o,e),s=Math.min(e+n-1,i.length);a>s?r([]):$.isArray(i)&&r(i.slice(a,s+1))}),100,!0)}}}angular.module("graphdb.framework.graphexplore.services.uiscroll",[]).factory("UiScrollService",n),n.$inject=["$timeout"]},50:function(e,t){angular.module("graphdb.framework.graphexplore.services.rdfsdetails",[]).factory("RdfsLabelCommentService",(function(){return{processAndFilterLabelAndComment:function(e){function t(e){const t={};for(let n in e)if(e.hasOwnProperty(n)){let r=n;n.indexOf(":")>-1&&(r=n,n=n.split(":")[1].toLowerCase()),t[n]=e[r]}return t}const n=e.results.bindings,r=[],o=[];_.each(n,(function(e){let n;angular.isUndefined(e.label)||(n=t(e.label),r.push(n)),angular.isUndefined(e.comment)||(n=t(e.comment),o.push(n))}));const i=function(e){return"en"===e.lang||"de"===e.lang},a=$.grep(r,i)[0],s=$.grep(o,i)[0],u=angular.isUndefined(a)?r.length>0?r[0].value:void 0:a.value,c=angular.isUndefined(s)?o.length>0?o[0].value:void 0:s.value;return{rdfsLabel:u,rdfsComment:c}}}}))},51:function(e,t){angular.module("graphdb.framework.rest.graphexplore.savedgraphs.service",[]).factory("SavedGraphsRestService",r),r.$inject=["$http"];const n="rest/explore-graph/saved";function r(e){return{getSavedGraphs:function(){return e.get(n)},getSavedGraph:function(t){return e.get(`${n}/${encodeURIComponent(t)}`)},editSavedGraph:function(t){return e.put(`${n}/${encodeURIComponent(t.id)}`,t)},deleteSavedGraph:function(t){return e.delete(`${n}/${encodeURIComponent(t.id)}`)},addNewSavedGraph:function(t){return e.post(n,t)}}}},52:function(e,t){angular.module("graphdb.framework.rest.graphconfig.service",[]).factory("GraphConfigRestService",o);const n="rest/explore-graph/",r=`${n}config`;function o(e){return{getGraphConfigs:function(){return e.get(r)},getGraphConfigSamples:function(){return e.get(`${n}samples`)},loadGraphForConfig:function(t,n,o,i){return e.get(`${r}/graph/${encodeURIComponent(t.id)}?includeInferred=${n}&linksLimit=${o}&sameAsState=${i}`)},getConfig:function(t){return e.get(`${r}/${encodeURIComponent(t)}`)},createGraphConfig:function(t){return e.post(r,t)},updateGraphConfig:function(t){return e.put(`${r}/${encodeURIComponent(t.id)}`,t)},deleteGraphConfig:function(t){return e.delete(`${r}/${encodeURIComponent(t.id)}`)},validateQuery:function(t,r,o,i,a){return e({method:"POST",url:`${n}validate`,data:{query:t,queryType:r,params:o,all:i,oneOf:a}})}}}o.$inject=["$http"]},53:function(e,t,n){"use strict";n.r(t);n(4);const r=400,o=50,i=1500,a=25;function s(e,t,n,s,u,c,l,f,d,p,h,g,y,m,v){e.classHierarchyData={},e.instancesObj={},e.instancesQueryObj={},e.instancesObj.items=[],e.instancesNotFiltered=[],e.isWarningShowed=!1,e.onopen=e.onclose=()=>angular.noop(),e.currentBrowserLimit=2e3,g.firefox?e.currentBrowserLimit=o:(g.safari||g.msie||g.msedge)&&(e.currentBrowserLimit=r);const x={};let w=0,b=0;t.key="",x.get=function(t,n,r){return f.initLazyList(t,n,r,w,e.instancesObj.items)};let C=allGraphs;const S=function(){if(e.getActiveRepository())return v.resolveGraphs().success((function(t){e.graphsInRepo=t.results.bindings,M()})).error((function(t){e.repositoryError=getError(t),c.error(getError(t),"Error getting graphs")}))},M=function(){const t=y.get(`classHierarchy-selectedGraph-${s.getActiveRepository()}`);null!==t&&e.graphsInRepo.some(e=>e.contextID.uri===t.contextID.uri)?C=t:y.set(`classHierarchy-selectedGraph-${s.getActiveRepository()}`,C)};function E(t,n,r){e.classCountSlider.options&&e.classCountSlider.options.ceil!==n&&(e.classCountSlider={});var o;e.classCountSlider.value||(e.showExternalElements=!0,e.classCountSlider={value:n,options:{floor:1,ceil:n,vertical:!0,showSelectionBar:!0,onChange:function(){p(T,100,!0)}}},null===y.get(m.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE)&&n>e.currentBrowserLimit&&(o=e.currentBrowserLimit,g.chrome?c.warning("Disabling animations for more than "+o+" classes.","Reducing visual effects"):c.warning(g.name+" performs poorly with more than "+o+" classes. Please consider using Chrome for more optimal performance.","Reducing visual effects")));const s=y.get(m.CLASS_HIERARCHY_SWITCH_PREFIXES);null!=s&&"true"!==s&&(e.showExternalElements=!0),r?e.classCountSlider.value=r:n>=i&&(e.classCountSlider.value=i,c.warning("Class count is reduced to "+i+" for faster initial load. Use the slider to see all classes.","Reducing class count")),n>=a&&!window.ActiveXObject&&"ActiveXObject"in window&&!e.isWarningShowed&&(e.classCountSlider.value=a,e.isWarningShowed=!0,c.warning("Class count is reduced to "+a+" for faster load in IE. If you want better performance please switch to different browser.","Reducing class count")),p((function(){e.$broadcast("reCalcViewDimensions")}),200),T();let u=0;$("rzslider").on("wheel",(function(t){t.preventDefault(),t.stopPropagation();const n=(new Date).getTime();if(!(n-u>100))return;u=n,t=t.originalEvent;let r=e.classCountSlider.value;t.deltaY<=-1?r+=1:t.deltaY>=1&&(r-=1),r!==e.classCountSlider.value&&r>=e.classCountSlider.options.floor&&r<=e.classCountSlider.options.ceil&&e.$apply((function(){e.classCountSlider.value=r,p(T,100,!0)}))}))}function T(){e.currentSliderValue=e.classCountSlider.value}function R(e){const t=e.fullName,r=e.name;l.checkDomainRangeData(t).success((function(e,o){204===o?c.warning("No domain-range data available for '"+r+"'"):(y.set(m.CLASS_HIERARCHY_LAST_SELECTED_CLASS,n.hash()),n.hash("").path("domain-range-graph").search("uri",t).search("name",r))})).error((function(){c.error("Request for "+r+" failed!")}))}function k(){n.replace().hash("1"),e.instancesObj.items=[],e.showExternalElements=!1,e.showClassInfoPanel=!1,y.clearClassHieararchyState(),e.hidePrefixes="true"===y.get(m.CLASS_HIERARCHY_HIDE_PREFIXES),e.currentSliderValue=void 0,e.classHierarchyData={},t.$broadcast("angucomplete-alt:clearInput")}function A(){e.hasClassHierarchy()&&p((function(){$("#toolbar").removeClass("ng-hide")}),0)}t.$watch((function(){return t.key}),(function(){w=0,_.each(e.instancesObj.items,(function(e){t.key>e&&w++})),b++})),x.revision=function(){return b},e.adapterContainer={adapter:{remain:!0}},e.$on("goToDomainRangeGraphView",(function(e,t){R(t)})),e.$on("classCount",E),e.$on("repositoryIsSet",(function(){if(I===s.getActiveRepository())return;I=s.getActiveRepository();if(e.repositoryError=null,!I)return;C=allGraphs,S().then(N)})),e.datasource=x,e.goToDomainRangeGraphView=R,e.toggleClassInfoSidePanel=function(){e.showClassInfoPanel=!e.showClassInfoPanel,t.$broadcast("sidePanelClosed")},e.getActiveRepositoryNoError=function(){if(!e.repositoryError)return s.getActiveRepository()},e.isSystemRepository=function(){return s.isSystemRepository()},e.confirmReloadClassHierarchy=function(){h.openSimpleModal({title:"Confirm operation",message:"Calculating class hierarchy data may take some time. Are you sure?",warning:!0}).result.then((function(){k(),e.loader=!0,e.hierarchyError=!1,l.reloadClassHierarchy(C.contextID.uri).success((function(t){e.loader=!1,e.classHierarchyData=t,A(),E()})).error((function(t){e.loader=!1,e.hierarchyError=getError(t),c.error(getError(t),"Request for RDF Class Hierarchy failed!")}))}))},e.focusOnRoot=function(){e.$broadcast("rootFocus")},e.copyToClipboard=function(e){h.openCopyToClipboardModal(e)},e.searchedClassCallback=function(e){if(e){const n={name:e.title};t.$broadcast("searchedClass",n)}},e.instancesQueryObj.query="",e.instancesFilterFunc=function(t){return t.resolvedUri.toLowerCase().indexOf(e.instancesQueryObj.query.toLowerCase())>=0},S(),e.$watch("instancesObj.items",(function(){e.instancesObj.items.length>0&&p((function(){e.adapterContainer.adapter.reload()}),30)})),e.$watch("selectedClass",(function(){e.showClassInfoPanel&&function(t){const n=t.fullName;let r=t.name;if(r===n){const e=r.lastIndexOf("#");r=r.substring(e+1)}e.encodedUri=encodeURIComponent(n);const o=encodeURIComponent("prefix onto:<http://www.ontotext.com/> select ?s from onto:disable-sameAs { ?s a <"+n+"> . }");e.viewInstancesUri="sparql?name="+r+"&infer=true&sameAs=false&query="+o+"&execute=true",l.getRdfsLabelAndComment(n).success((function(t){e.rdfsLabel=t.label,e.rdfsComment=t.comment,e.expanded=!1})).error((function(){c.error("Error getting rdfs:label and rdfs:comment")})),e.instancesQueryObj.query="",e.instancesLoader=!0,l.getClassInstances(n).success((function(t){e.instancesObj.items=[],_.each(t,(function(t,n){const r={};r.type=t.startsWith("<<")&&t.endsWith(">>")?"triple":"uri",r.absUri=encodeURIComponent(t),r.absUriNonEncoded=t,r.resolvedUri=n,e.instancesObj.items.push(r)})),e.instancesLoader=!1,e.instancesSearchPlaceholder=e.instancesObj.items.length<1e3?"Search class instances":"Search first 1000 class instances",e.instancesNotFiltered=e.instancesObj.items})).error((function(){c.error("Request for class instances for  failed!")}))}(e.selectedClass)})),$(document).ready((function(){$(".prefix-toggle").click((function(){$(".tooltip").hide()}))}));let I=s.getActiveRepository();function N(){k(),e.isSystemRepository()||(e.hierarchyError=!1,e.loader=!0,l.getClassHierarchyData(C.contextID.uri).success((function(t,n){e.showExternalElements=!0,e.loader=!1,e.classHierarchyData=t,207===n&&c.warning("You can update the diagram by pressing the reload button.","Repository data has changed"),A()})).error((function(t){e.loader=!1,e.hierarchyError=getError(t),c.error(getError(t),"Request for RDF Class Hierarchy failed!")})))}e.hasClassHierarchy=function(){return e.classHierarchyData.classCount&&e.getActiveRepositoryNoError()&&!e.isSystemRepository()},e.chosenGraph=function(e){C=e,N(),y.set(`classHierarchy-selectedGraph-${s.getActiveRepository()}`,C)},e.getSelGraphValue=function(){return C.contextID.value},e.isAllGraphsSelected=function(){return"All graphs"===e.getSelGraphValue()}}angular.module("graphdb.framework.graphexplore.controllers.class",["pageslide-directive","ngAnimate","ui.scroll.jqlite","ui.scroll","angucomplete-alt","rzSlider","toastr","graphdb.framework.utils.localstorageadapter"]).controller("RdfClassHierarchyCtlr",s),s.$inject=["$scope","$rootScope","$location","$repositories","$window","toastr","GraphDataRestService","UiScrollService","RdfsLabelCommentService","$timeout","ModalService","bowser","LocalStorageAdapter","LSKeys","RDF4JRepositoriesRestService"]},54:function(e,t,n){"use strict";n.r(t);n(4);function r(e,t,n,r,o,i,a,s,u,c,l,f){e.predicatesObj={},e.predicatesQueryObj={},e.predicatesObj.items=[],e.predicatesQueryObj.query="",e.predicatesListNotFiltered=[],e.predicatesSearchPlaceholder="Search predicates",e.onopen=e.onclose=()=>angular.noop();const d={};let p=0,h=0;n.key="",d.get=function(t,n,r){return c.initLazyList(t,n,r,p,e.predicatesObj.items)},n.$watch((function(){return n.key}),(function(){p=0,_.each(e.predicatesObj.items,(function(e){n.key>e&&p++})),h++})),d.revision=function(){return h},e.adapterContainer={adapter:{remain:!0}};const g=a.get(s.DOMAIN_RANGE_COLLAPSE_EDGES);function y(){const e=a.get(s.CLASS_HIERARCHY_LAST_SELECTED_CLASS);t.search("").hash(e).path("hierarchy")}e.collapseEdges=null===g||"true"===g,e.datasource=d,e.$on("reloadDomainRangeGraphView",(function(e,n){const r=n.objectPropClassUri,o=n.objectPropClassName;t.path("domain-range-graph").search("uri",r).search("name",o)})),e.$on("switchEdgeMode",(function(e,n){t.path("domain-range-graph").search("uri",n.uri).search("name",n.name).search("collapsed",n.collapsed)})),e.$on("repositoryIsSet",(function(){if(m===o.getActiveRepository())return;m=o.getActiveRepository();y()})),e.$on("changeCollapsedEdgesState",(function(t,n){e.collapseEdges=!n,a.set(s.DOMAIN_RANGE_COLLAPSE_EDGES,e.collapseEdges)})),e.goToClassHierarchyView=y,e.copyToClipboard=function(e){l.openCopyToClipboardModal(e)},e.toggleCollapseEdgesState=function(){e.collapseEdges=!e.collapseEdges,i.history.pushState({collapsed:e.collapseEdges},"domainRangePage",null)},e.predicatesListFilterFunc=function(t){return t.resolvedUri.toLowerCase().indexOf(e.predicatesQueryObj.query.toLowerCase())>=0},e.$watch("predicatesObj.items",(function(){e.predicatesObj.items>0&&r((function(){e.adapterContainer.adapter.reload()}),30)})),e.$watch("selectedPredicate",(function(){e.showPredicatesInfoPanel&&function(t){const n=t.target,r=t.source;e.encodedUri=encodeURIComponent(t.uri),e.sourceTargetObjectNodeUri=n.objectPropClassUri?n.objectPropClassUri:r.objectPropClassUri,e.encodedSourceTargetObjectNodeUri=encodeURIComponent(e.sourceTargetObjectNodeUri),e.sourceTargetObjectNodeName=n.objectPropClassName?n.objectPropClassName:r.objectPropClassName?r.objectPropClassName:"<i>Literal</i>",-1===e.sourceTargetObjectNodeName.indexOf("Literal")?u.getRdfsLabelAndComment(e.sourceTargetObjectNodeUri).success((function(t){e.rdfsLabel=t.label,e.rdfsComment=t.comment})).error((function(){f.error("Error getting rdfs:label and rdfs:comment")})):(e.rdfsComment=void 0,e.rdfsLabel=void 0);e.predicatesObj.items=[],e.predicatesQueryObj.query="";const o=n.allEdges?n.allEdges:r.allEdges;_.each(o,(function(t){const n={};n.absUri=encodeURIComponent(t.uri),n.absUriNonEncoded=t.uri,n.resolvedUri=t.name,n.isImplicit=t.implicit,e.predicatesObj.items.push(n)})),e.predicatesListNotFiltered=e.predicatesObj.items}(e.selectedPredicate)})),$(document).ready((function(){$(".compact-mode-toggle").click((function(){$(".tooltip").hide()}))}));let m=o.getActiveRepository()}angular.module("graphdb.framework.graphexplore.controllers.domainrange",["ui.scroll.jqlite","ui.scroll","ngSanitize","graphdb.framework.utils.localstorageadapter"]).controller("DomainRangeGraphCtlr",r),r.$inject=["$scope","$location","$rootScope","$timeout","$repositories","$window","LocalStorageAdapter","LSKeys","GraphDataRestService","UiScrollService","ModalService","toastr"]},55:function(e,t,n){(function(e){const t={WAIT:"WAIT",NO_REPO:"NO_REPO",READY:"READY",IN_PROGRESS:"IN_PROGRESS",ERROR:"ERROR"},n={contextID:{type:"all",value:"All graphs",uri:""}};function r(e){if(e<1e3)return e;const t=Math.floor(Math.log(e)/Math.log(1e3));let n=e/Math.pow(1e3,t);return n=n%1>1/Math.pow(1e3,t-1)?n.toFixed(2):n.toFixed(0),n+["K","M","G","T","P","H"][t-1]}function o(e,r,o,i,a,s,u,c,l,f){let d=null;e.status=o.getActiveRepository()?t.WAIT:t.NO_REPO;let p=n;const h=function(){f.resolveGraphs().success((function(t){e.graphsInRepo=t.results.bindings,g(),e.isSystemRepository()?"READY"!==e.status&&m():(e.status="WAIT",m(!0))})).error((function(t){e.repositoryError=getError(t),i.error(getError(t),"Error getting graphs")}))},g=function(){const t=l.get(`dependencies-selectedGraph-${o.getActiveRepository()}`);null!==t&&e.graphsInRepo.some(e=>e.contextID.uri===t.contextID.uri)?p=t:l.set(`dependencies-selectedGraph-${o.getActiveRepository()}`,p)},y=function(n){d3.select("#dependencies-chord").html(""),e.status=t.WAIT,s.getRelationshipsData(n,e.direction,p.contextID.uri).success((function(n){e.dependenciesData={matrix:n.right,nodes:n.left,hasLinks:_.sum(_.map(n.right,(function(e){return _.sum(e)})))>0,direction:e.direction},e.status=t.READY})).error((function(n){e.status=t.READY,i.error(getError(n),"Could not get dependencies count")}))},m=function(n){(e.status!==t.READY||n)&&(e.status=t.WAIT,s.getRelationshipsStatus(p.contextID.uri).success((function(n){if(e.status=n,e.status===t.IN_PROGRESS){if(null!==d)return;d=a(m,2e3)}e.status===t.READY&&(null!==d&&(a.cancel(d),d=null),s.getRelationshipsClasses(e.direction,p.contextID.uri).success((function(t,n){e.allClasses.items=_.filter(t,b),e.allNotFilteredClasses=t,e.selectedClasses=void 0,angular.isUndefined(e.selectedClasses)&&(e.selectedClasses=t.slice(0,10)),y(e.selectedClasses),207===n&&i.warning("You can update the diagram by pressing the reload button.","Repository data has changed")}))),0===e.status.indexOf("ERROR;")&&(e.status=t.ERROR,i.error("There was an error while calculating dependencies: "+e.status.substring("ERROR;".length)))})).error((function(n){e.status=t.ERROR,i.error(getError(n),"Could not get dependencies count status!")})))};e.allClasses={},e.allClasses.items=[],e.allNotFilteredClasses=[],e.direction="all";const v={};let x=0,w=0;function b(t){return-1!==t.name.toLowerCase().indexOf(e.classQuery.query.toLowerCase())}r.key="",v.get=function(t,n,r){return u.initLazyList(t,n,r,x,e.allClasses.items)},r.$watch((function(){return r.key}),(function(){x=0,_.each(e.allClasses.items,(function(e){r.key>e&&x++})),w++})),v.revision=function(){return w},e.datasource=v,e.adapterContainer={adapter:{remain:!0}},e.classQuery={},e.classQuery.query="",e.classFilterFunc=b,e.$watch("allClasses.items",(function(){e.allClasses.items.length>0&&a((function(){e.adapterContainer.adapter.reload()}),30)})),e.$watch("direction",(function(){!o.getActiveRepository()||e.isSystemRepository()||o.isActiveRepoFedXType()||h()})),e.$on("$destroy",(function(){a.cancel(d)})),e.isLoading=function(){return e.status===t.IN_PROGRESS||e.status===t.WAIT},e.confirmCalculateDependencies=function(){c.openSimpleModal({title:"Confirm operation",message:"Calculating relationships data may take some time. Are you sure?",warning:!0}).result.then((function(){e.calculateDependencies()}))},e.calculateDependencies=function(){e.status=t.WAIT,e.selectedClasses=void 0,s.calculateRelationships(p.contextID.uri).success((function(e){0===e.indexOf("ERROR;")?i.error("There was an error while calculating dependencies: "+e.substring("ERROR;".length)):m()})).error((function(e){i.error("Could not force dependencies count"+getError(e))}))},e.addClass=function(t){e.selectedClasses.push(t),y(e.selectedClasses)},e.removeClass=function(t){_.remove(e.selectedClasses,(function(e){return e.name===t.name})),y(e.selectedClasses)},e.showClass=function(t){e.classToShow=t},e.isClassByNameShown=function(t){return void 0!==_.find(e.selectedClasses,{name:t})},e.addClassByName=function(t){e.selectedClasses.push(_.find(e.allClasses.items,{name:t})),y(e.selectedClasses)},e.removeClassByName=function(t){_.remove(e.selectedClasses,(function(e){return e.name===t})),y(e.selectedClasses)},e.removeAllClasses=function(){e.selectedClasses=[],y(e.selectedClasses)},e.isSystemRepository=function(){return"SYSTEM"===o.getActiveRepository()};const C=e.$on("repositoryIsSet",(function(){e.classQuery={},e.classQuery.query="",e.repositoryError=null,p=n,o.getActiveRepository()&&!o.isActiveRepoFedXType()?h():e.status=t.NO_REPO}));window.addEventListener("beforeunload",(function e(){C(),window.removeEventListener("beforeunload",e)})),e.selectGraph=function(e){p=e,m(!0),l.set(`dependencies-selectedGraph-${o.getActiveRepository()}`,p)},e.getSelectedGraphValue=function(){return p.contextID.value},e.isAllGraphsSelected=function(){return"All graphs"===e.getSelectedGraphValue()}}Object.defineProperty(e,"allGraphs",{get:()=>n}),angular.module("graphdb.framework.graphexplore.controllers.dependencies",["ui.scroll.jqlite","ui.scroll","toastr","ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.utils.localstorageadapter"]).controller("DependenciesChordCtrl",o).config(["$tooltipProvider",function(e){e.options({appendToBody:!0})}]).filter("humanize",(function(){return r})),o.$inject=["$scope","$rootScope","$repositories","toastr","$timeout","GraphDataRestService","UiScrollService","ModalService","LocalStorageAdapter","RDF4JRepositoriesRestService"]}).call(this,n(3))},56:function(e,t,n){"use strict";n.r(t);n(2);var r=n(205),o=n(208),i=n.n(o);n(4);function a(e,t,n,o,a,s,u,c,l,f,d,p,h,g,y,m,v,x,w,b){e.languageChanged=!1,e.propertiesObj={},e.propertiesQueryObj={},e.propertiesObj.items=[],e.propertiesNotFiltered=[],e.searchVisible=!1,e.nodeSelected=!1,e.queryResultsMode=!1,e.embedded=f.search().embedded,e.openedNodeInfoPanel=void 0,e.onopen=e.onclose=()=>angular.noop(),e.embedded&&(f.search().query||f.search().uri||f.search().config||f.search().saved)&&(e.noGoHome=!0);const C={};let S=0,M=0,E={},T=0;const R=16,k=d3.behavior.zoom().scaleExtent([.5,10]);let A;const I=1e3,N=1e3;let L;function D(e){h.openCopyToClipboardModal(e)}function P(t){const n=t.appSettings;e.defaultSettings.includeInferred=n.DEFAULT_INFERENCE,e.defaultSettings.sameAsState=n.DEFAULT_INFERENCE&&n.DEFAULT_SAMEAS,e.defaultSettings.includeSchema=n.DEFAULT_VIS_GRAPH_SCHEMA;const r=m.get(v.GRAPHS_VIZ);if(r&&"object"==typeof r)try{e.saveSettings=r,void 0===e.saveSettings.includeSchema&&(e.saveSettings.includeSchema=e.defaultSettings.includeSchema,e.saveSettings.rejectedPredicates=[...e.saveSettings.rejectedPredicates,...e.defaultSettings.rejectedPredicates].unique())}catch(t){e.saveSettings=angular.copy(e.defaultSettings),m.set(v.GRAPHS_VIZ,e.saveSettings)}else e.saveSettings=angular.copy(e.defaultSettings)}t.key="",C.get=function(t,n,r){return p.initLazyList(t,n,r,S,e.propertiesObj.items)},t.$watch((function(){return t.key}),(function(){S=0,_.each(e.propertiesObj.items,(function(e){t.key>e&&S++})),M++})),C.revision=function(){return M},e.datasource=C,e.adapterContainer={adapter:{remain:!0}},e.propertiesQueryObj.query="",e.propertiesSearchPlaceholder="Search instance properties",e.propertiesFilterFunc=function(t){return t.key.toLowerCase().indexOf(e.propertiesQueryObj.query.toLowerCase())>=0},e.resetState=function(){e.searchVisible=!1,e.nodeSelected=!1,e.configLoaded=null,e.queryResultsMode=!1,e.lastSavedGraphName=null,e.lastSavedGraphId=null,e.shared=!1,e.numberOfPinnedNodes=0,E={},T=0},e.pushHistory=function(t,n){e.embedded&&(t.embedded=!0),f.search(t),f.state(n)},e.goToHome=function(){e.resetState(),f.url("graphs-visualizations")},e.shouldShowSettings=function(){return e.configLoaded&&e.configLoaded.id===e.defaultGraphConfig.id},e.shouldDisableSameAs=function(){const t=$("#sameAsCheck");return e.settings&&!e.settings.includeInferred&&t.prop("checked")&&(t.prop("checked",!1),e.settings.sameAsState=!1),e.settings&&!e.settings.includeInferred},e.$watch("propertiesObj.items",(function(){angular.isDefined(e.propertiesObj.items)&&e.propertiesObj.items.length>0&&a((function(){e.adapterContainer.adapter.reload()}),500)})),e.toggleMoreInfo=function(e){angular.element(e.currentTarget).parent().next().toggle(200),angular.element(e.currentTarget).children("span").toggleClass("icon-caret-down").toggleClass("icon-caret-up")},e.copyToClipboard=D,e.defaultSettings={linksLimit:20,includeInferred:!0,sameAsState:!0,languages:["en"],showLinksText:!0,preferredTypes:[],rejectedTypes:[],preferredPredicates:[],rejectedPredicates:["http://dbpedia.org/property/logo","http://dbpedia.org/property/hasPhotoCollection","http://dbpedia.org/property/website","http://dbpedia.org/property/homepage","http://dbpedia.org/ontology/thumbnail","http://xmlns.com/foaf/0.1/depiction","http://xmlns.com/foaf/0.1/homepage","http://xmlns.com/foaf/0.1/mbox","http://dbpedia.org/ontology/wikiPage*","http://dbpedia.org/property/wikiPage*","http://factforge.net/*"],preferredTypesOnly:!1,preferredPredicatesOnly:!1,includeSchema:!0},e.saveSettings=angular.copy(e.defaultSettings);const q=d.getPrincipal();function O(){e.settings.languagesMap=_.map(e.settings.languages,(function(e){return{text:e}})),e.settings.preferredTypesMap=_.map(e.settings.preferredTypes,(function(e){return{text:e}})),e.settings.rejectedTypesMap=_.map(e.settings.rejectedTypes,(function(e){return{text:e}})),e.settings.preferredPredicatesMap=_.map(e.settings.preferredPredicates,(function(e){return{text:e}})),e.settings.rejectedPredicatesMap=_.map(e.settings.rejectedPredicates,(function(e){return{text:e}}))}q?P(q):e.$on("securityInit",(function(){P(d.getPrincipal())})),e.resetSettings=function(){e.settings=angular.copy(e.defaultSettings),O()},e.changeLimit=function(t){let n=e.settings.linksLimit+t;n<1&&(n=1),n>1e3&&(n=1e3),e.settings.linksLimit=n},e.showSettings=function(){e.showInfoPanel=!0,e.showFilter=!0,e.showNodeInfo=!1,e.showPredicates=!1,e.saveSettings?e.settings=angular.copy(e.saveSettings):e.settings=angular.copy(e.defaultSettings),O()},e.reExpandNode=function(){e.rootNodeIri&&e.$broadcast("onRootNodeChange",e.rootNodeIri)};const U=function(t,n,r){const i=void 0===n?e.saveSettings.sameAsState:!0===n,a=void 0===r?e.saveSettings.includeInferred:!0===r;e.loading=!0,s({url:"rest/explore-graph/graph",method:"POST",headers:{"Content-Type":"application/json"},data:{query:t,linksLimit:e.saveSettings.linksLimit,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:a,sameAsState:i}}).then((function(e){oe(e)}),(function(t){e.loading=!1,o.error(getError(t.data),"Cannot load visual graph!")}))};function j(){this.nodes=[],this.links=[],this.addNode=function(e,t,n){return e.x=t,e.y=n,this.nodes.push(e),e},this.computeConnectedness=function(){const e={},t={};_.each(this.links,(function(n){const r=n.source.iri,o=n.target.iri,i=_.min([r,o])+"|"+_.max([r,o]);t[i]||(t[i]=1,e[r]=(e[r]||0)+1,e[o]=(e[o]||0)+1)})),_.each(this.links,(function(t){e[t.source.iri]>1&&e[t.target.iri]>1?t.connectedness=Math.min(5,Math.max(e[t.source.iri],e[t.target.iri])-1):t.connectedness=0}))},this.addAndMatchLinks=function(e){const t=this.nodes;Array.prototype.push.apply(this.links,function(e,t){return _.map(e,(function(e){return{source:_.find(t,(function(t){return t.iri===e.source})),target:_.find(t,(function(t){return t.iri===e.target})),predicates:e.predicates}}))}(e,t)),this.computeConnectedness()};const t=function(e,t){return n(e,t).length};function n(e,t){return _.filter(t,(function(t){return t.source.iri===e.iri||t.target.iri===e.iri}))}this.countLinks=t,this.linksTypes=function(e,t){const r=n(e,t),o=_.map(r,(function(t){return t.source.iri===e.iri?t.target.types:t.source.types}));return _.uniq(_.flatten(o))},this.linksPredicates=function(e,t){const r=n(e,t),o=_.map(r,(function(e){return e.predicates}));return _.uniq(_.flatten(o))},this.removeNode=function(n){this.links=_.reject(this.links,(function(e){return e.source.iri===n.iri||e.target.iri===n.iri}));const r=this.links;this.nodes=_.reject(this.nodes,(function(e){return 0===t(e,r)})),0===this.nodes.length&&(e.nodeSelected=!1),this.computeConnectedness()},this.removeNodeLeafLinks=function(e){let r=this.links;this.links=_.reject(this.links,(function(o){if(o.source.iri===e.iri&&1===t(o.target,r)||o.target.iri===e.iri&&1===t(o.source,r))return!0;let i;return o.source.iri===e.iri&&2===t(o.target,r)?i=n(o.target,r):o.target.iri===e.iri&&2===t(o.source,r)&&(i=n(o.source,r)),i?(i[0].source.iri===e.iri||i[0].target.iri)&&(i[1].source.iri===e.iri||i[1].target.iri):void 0})),r=this.links,this.nodes=_.reject(this.nodes,(function(n){return 0===t(n,r)&&n.iri!==e.iri})),this.computeConnectedness()},this.copyState=function(){return{nodes:_.map(this.nodes,(function(e){return{iri:e.iri,size:e.size,labels:angular.copy(e.labels),types:angular.copy(e.types),rdfRank:e.rdfRank,x:e.x,y:e.y,fixed:e.fixed}})),links:_.map(this.links,(function(e){return{source:e.source.iri,target:e.target.iri,predicates:e.predicates}})),colorIndex:T,type2color:E,scale:k.scale(),translate:k.translate()}},this.restoreState=function(t){e.nodeSelected=!0,e.searchVisible=!1,this.nodes=angular.copy(t.nodes),this.links=[],this.addAndMatchLinks(t.links),_.each(this.nodes,(function(t){t.fixed&&e.numberOfPinnedNodes++})),angular.isDefined(t.colorIndex)&&angular.isDefined(t.type2color)&&(T=t.colorIndex,E=angular.copy(t.type2color)),angular.isDefined(t.translate)&&angular.isDefined(t.scale)&&(A="translate("+t.translate[0]+", "+t.translate[1]+") scale("+t.scale+")",k.translate(t.translate),k.scale(t.scale)),te()}}e.updateSettings=function(){e.saveSettings=e.settings,e.saveSettings.languages=_.map(e.saveSettings.languagesMap,(function(e){return e.text})),e.saveSettings.preferredTypes=_.map(e.saveSettings.preferredTypesMap,(function(e){return e.text})),e.saveSettings.rejectedTypes=_.map(e.saveSettings.rejectedTypesMap,(function(e){return e.text})),e.saveSettings.preferredPredicates=_.map(e.saveSettings.preferredPredicatesMap,(function(e){return e.text})),e.saveSettings.rejectedPredicates=_.map(e.saveSettings.rejectedPredicatesMap,(function(e){return e.text})),e.rootNodeIri?e.reExpandNode(e.rootNodeIri):e.queryResultsMode&&f.search().query?U(f.search().query,f.search().sameAs,f.search().inference):"query"===e.configLoaded.startMode&&e.loadGraphConfig(e.configLoaded),e.saveSettings.showLinksText?d3.selectAll("svg .link-wrapper text").style("display","block"):d3.selectAll("svg .link-wrapper text").style("display","none"),e.showInfoPanel=!1,e.showFilter=!1,m.set(v.GRAPHS_VIZ,e.saveSettings)},e.showInfoPanel=!1;let z=new j;e.defaultGraphConfig={id:"default",name:"Easy graph",startMode:"search"},e.getGraphConfigs=function(t){w.getGraphConfigs().success((function(n){e.graphConfigs=n,t&&t()})).error((function(e){o.error(getError(e),"Could not get graph configs")}))},e.loadConfigForId=function(t,n){t===e.defaultGraphConfig.id?e.loadGraphConfig(e.defaultGraphConfig):w.getConfig(t).success((function(t){e.loadGraphConfig(t),n()})).error((function(e){o.error(getError(e),"Could not load config "+t)}))},e.findConfigById=function(t){return t===e.defaultGraphConfig.id?e.defaultGraphConfig:$.grep(e.graphConfigs,(function(e){return e.id===t}))[0]},e.easyGraphSearch=function(t){e.configLoaded=e.defaultGraphConfig,e.openUri(t)},e.loadGraphConfig=function(t){e.configLoaded=t,"search"===t.startMode?e.searchVisible=!0:"node"===t.startMode&&t.startIRI?a((function(){e.openUri(t.startIRI,!0)}),0):"query"===t.startMode&&t.startGraphQuery&&(e.loading=!0,w.loadGraphForConfig(t,t.startQueryIncludeInferred,e.saveSettings.linksLimit,t.startQuerySameAs).then((function(e){oe(e)}),(function(t){e.loading=!1,o.error(getError(t),"Could not load graph from config")})))},e.deleteConfig=function(t){h.openSimpleModal({title:"Confirm",message:"Are you sure you want to delete the graph config '"+t.name+"'?",warning:!0}).result.then((function(){w.deleteGraphConfig(t).success((function(){e.getGraphConfigs(),e.refreshSavedGraphs()})).error((function(e){o.error(getError(e),"Could not delete graph config")}))}))},e.goToGraphConfig=function(t){e.pushHistory({config:t.id},{config:t}),e.resetState(),e.loadGraphConfig(t)},y.onpopstate=function(t){e.resetState(),t.state&&(t.state.config?(e.loadGraphConfig(t.state.config),t.state.uri&&e.openUri(t.state.uri,!0)):t.state.savedGraph&&e.loadSavedGraph(t.state.savedGraph,!0))};const Q=function(){f.search().query?(e.searchVisible=!1,e.queryResultsMode=!0,U(f.search().query,f.search().sameAs,f.search().inference)):e.$on("onRootNodeChange",(function(t,n){e.loading=!0,angular.isDefined(n)&&(e.rootNodeIri=n,s({url:"rest/explore-graph/node",method:"GET",params:{iri:n,config:e.configLoaded?e.configLoaded.id:e.defaultGraphConfig.id,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:e.saveSettings.includeInferred,sameAsState:e.saveSettings.sameAsState}}).then((function(t){e.nodeSelected=!0,e.searchVisible=!1,null===t.data.types&&(t.data.types="greyColor"),z=new j;const n=z.addNode(t.data,I/2,N/2);A="translate(0, -70) scale(1)",k.translate([0,-70]),k.scale(1),ae(n,!0)})).catch((function(t){e.loading=!1,o.error(getError(t),"Could not load visual graph")})))})),f.search().uri&&e.openUri(f.search().uri),f.search().saved&&x.getSavedGraph(f.search().saved).success((function(t){e.loadSavedGraph(t)})).error((function(e){const t=getError(e);o.error(t,"Error! Could not open saved graph")}))},H=function(){f.search().config?e.loadConfigForId(f.search().config,Q):f.search().query||f.search().uri?(e.loadGraphConfig(e.defaultGraphConfig),Q()):Q()};function F(t){!n.getActiveRepository()||e.hasInitedRepository&&!t||(e.hasInitedRepository=!0,t||e.getGraphConfigs(H),e.getNamespacesPromise=b.getNamespaces(e.getActiveRepository()).success((function(t){const n=_.map(t.results.bindings,(function(e){return{uri:e.namespace.value,prefix:e.prefix.value}}));e.namespaces=_.sortBy(n,(function(e){return e.uri.length})),G()})).error((function(e){o.error(getError(e),"Cannot get namespaces for repository. View will not work properly!")})))}function G(){e.getAutocompletePromise=c.checkAutocompleteStatus()}e.replaceIRIWithPrefix=function(t){const n=e.namespaces,r=_.findLast(n,(function(e){return 0===t.indexOf(e.uri)}));return r?r.prefix+":"+t.substring(r.uri.length):t},e.addedTag=function(t){return t.text.indexOf(":")<0?(o.warning("Enter an absolute full or prefixed IRI"),null):(t.text=function(e,t){if(!/^<?(http|urn).*>?/.test(e)){const n=e.split(":"),r=n[0],o=n[1];if(!angular.isUndefined(o)){const e=u.getNamespaceUriForPrefix(t,r);if(e)return e+o}}return e}(t.text,e.namespaces),e.pageslideExpanded=!0,t)},e.validateTag=function(e,t,n){if(e.text.indexOf(":")<0)return n?o.warning("Enter an absolute full or prefixed IRI, optionally ending in *",t):o.warning("Enter an absolute full or prefixed IRI",t),!1;const r=e.text.indexOf("*");if(r>=0){if(!n)return o.warning("Wildcards not allowed here",t),!1;if(r<e.text.length-1)return o.warning("Wildcard allowed only as the last character",t),!1}return!0},e.getTagClass=function(e){return e.endsWith("*")?"tag-item-wildcard":null},e.getActiveRepository=function(){return n.getActiveRepository()},e.hasInitedRepository=!1,e.$on("autocompleteStatus",(function(){G()})),e.$on("repositoryIsSet",(function(t,n){n.newRepo&&(e.hasInitedRepository=!1),F(n.newRepo),n.newRepo&&(e.resetState(),$(".graph-visualization svg").empty(),f.search().query&&(e.goToHome(),Q()))})),F();const B=500,V=1.75,Y=d3.scale.linear().domain([0,9]).range(["hsl(0, 100%, 75%)","hsl(360, 90%, 82%)"]).interpolate(d3.interpolateHslLong),W=d3.scale.linear().domain([0,9]).range(["hsl(180, 50%, 75%)","hsl(540, 40%, 82%)"]).interpolate(d3.interpolateHslLong);e.getColor=function(e){angular.isUndefined(E[e])&&(E[e]=T,T++);const t=E[e];return t>39?"#c2c2c2":t%2==0?Y(t/2):W(t/2)};const X=d3.layout.force().gravity(.07).size([I,N]),Z=d3.select(".main-container .graph-visualization").append("svg").attr("viewBox","0 0 "+I+" "+N).attr("preserveAspectRatio","xMidYMid meet");let K=0,J=0;const ee=new function(){this.state=!1,this.setLoadingState=function(e){this.state=e},this.getLoadingState=function(){return this.state},this.init=function(e,t){d3.select(t).append("circle").attr("cx",(function(){return e.x})).attr("cy",(function(){return e.y})).attr("class","loader-container").attr("r",(function(){return e.size})).style("fill","fff").style("opacity","0.7"),d3.select(t).append("image").attr("xlink:href","js/angular/templates/loader/ot-loader.svg?v=1.10.2").attr("x",(function(){return e.x-e.size+5})).attr("y",(function(){return e.y-e.size})).attr("width",(function(){return 2*e.size})).attr("height",(function(){return 2*e.size})).attr("class","node-loader")}};function te(n){d3.selectAll("svg g").remove(),d3.selectAll("svg rect").remove(),d3.selectAll(".d3-tip").remove(),d3.selectAll(".menu-events").remove(),k.on("zoom",(function(){A="translate("+d3.event.translate+") scale("+d3.event.scale+")",u.attr("transform",A)})),Z.append("rect").attr("width",10*I).attr("height",10*N).attr("x",-(10*I-I)/2).attr("y",-(10*N-N)/2).style("fill","none").style("pointer-events","all").call(k).on("click",(function(){d3.event.stopPropagation(),se(),X.stop()}));const u=Z.append("g").attr("class","nodes-container").attr("transform",(function(){return angular.isDefined(A)&&!n?A:""})),c=i()().attr("class","d3-tip").customPosition((function(){const e=L.getBoundingClientRect();return{top:e.bottom+10+"px",left:e.left-30+"px"}})).html((function(t){let n="";return t.fixed&&(n+='<i class="icon-pin"></i>&nbsp;&nbsp;'),t.types.length>0?n+=_.join(_.map(t.types,(function(t){return e.replaceIRIWithPrefix(t)}))," Â· "):n+="<i>No types</i>",n})),l=function(e){let t="";return t+=_.join(_.map(e.predicates,(function(t,n){if(0===n)return ue(t);if(n<10)return" Â· "+ue(t);if(10===n){const t=function(e){return e.predicates.length-10}(e);return" Â· more "+(t>1?t+" predicates":t+" predicate")+" to show"}})),""),t};let d;const p=i()().attr("class","d3-tip").customPosition((function(e){const t=d.getBoundingClientRect(),n=function(e){const t=l(e),n=document.createElement("canvas").getContext("2d");return n.font="13px Arial",e.predicates.length<10?n.measureText(t).width:n.measureText(t).width/2}(e);return{top:t.top-30+"px",left:t.left-30+"px",width:n+"px"}})).html((function(e){return l(e)}));const h=function(){a.cancel(void 0),a.cancel(K),L=null,c.hide(),J=a((function(){se()}),500)};Z.call(c);Z.call(p);let g=Z.selectAll(".link"),y=Z.selectAll(".node");X.nodes(z.nodes).charge(-3e3),X.links(z.links).linkDistance((function(e){return function(e){const t=$("<span></span>"),n=e.predicates[0].split("/"),r=n[n.length-1];t.addClass("predicate-text").text(r),$("body").append(t);const o=t.width()+2*e.source.size+2*e.target.size+50;return t.remove(),.75*o}(e)+30*e.connectedness})),u.append("defs").selectAll("marker").data(X.links()).enter().append("marker").attr("class","arrow-marker").attr("id",(function(e){return e.target.size})).attr("viewBox","0 -5 10 10").attr("refX",(function(e){return e.target.size+11})).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5 L10,0 L0, -5"),g=u.selectAll(".link").data(z.links).enter().append("g").attr("class","link-wrapper").attr("id",(function(e){return e.source.iri+">"+e.target.iri})).append("line").attr("class","link").style("stroke-width",1).style("fill","transparent").style("marker-end",(function(e){return"url("+f.absUrl()+"#"+e.target.size+")"}));const m=u.selectAll(".link-wrapper").append("text").text((function(e){return function(e){if(e.predicates.length>1)return e.predicates.length+" predicates";return ue(e.predicates[0])}(e)})).attr("class",(function(e){return e.predicates.length>1?"predicates":"predicate"})).attr("dy","-0.5em").style("text-anchor","middle").style("display",e.saveSettings.showLinksText?"":"none").on("mouseover",(function(e){d3.event.stopPropagation(),function(e){a.cancel(void 0);const t=d=d3.event.target;a((function(){d===t&&e.predicates.length>1&&p.show(e,d)}),300)}(e)})).on("mouseout",(function(){a.cancel(void 0),d=null,p.hide()})).on("click",(function(t){d3.event.stopPropagation(),function(t){e.showNodeInfo=!1,e.showPredicates=!0,e.showFilter=!1,t.predicates.length>1&&(e.predicates=_.map(t.predicates,(function(e){return ue(e)})),e.showInfoPanel=!0)}(t)}));let v,x=0,w=0,b=0;const C=function(){d3.event.button&&0!==d3.event.button||(h(),a.cancel(v),e.showPredicates=!1,d3.event.timeStamp-x<B?w++:w=1,x=d3.event.timeStamp,d3.event.preventDefault())},S=function(n){if(d3.event.button&&0!==d3.event.button)return;a.cancel(v);const r=d3.event,i=this;if(d3.event.timeStamp-x<B)if(1===w)v=a((function(){!function(n,r,i){if(e.showInfoPanel=!1,e.showPredicates=!1,e.showNodeInfo=!1,i.shiftKey&&(i.ctrlKey||i.metaKey))return void t.$broadcast("onRootNodeChange",n.iri);if(i.ctrlKey||i.metaKey)return void re(n);if(void 0!==e.openedNodeInfoPanel&&e.openedNodeInfoPanel===n)return e.pageslideExpanded=!1,void(e.openedNodeInfoPanel=void 0);!function(t){X.stop(),e.openedNodeInfoPanel=t,e.showNodeInfo=!0,e.showFilter=!1,e.showPredicates=!1,e.nodeLabels=t.labels,e.nodeTypes=t.types,e.rdfRank=t.rdfRank,e.nodeIri=t.iri,e.encodedIri=encodeURI(t.iri),e.showInfoPanel=!0,e.rdfsLabel=t.labels[0].label,e.rdfsComment=t.comment,e.expanded=!1,e.propertiesQueryObj.query="",e.dataNodeKeysQuery="",s.get("rest/explore-graph/properties",{params:{iri:t.iri,config:e.configLoaded.id,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:e.saveSettings.includeInferred,sameAsState:e.saveSettings.sameAsState,rejectedPredicates:e.shouldShowSettings()?e.saveSettings.rejectedPredicates:[]}}).then((function(t){e.data=_.mapKeys(t.data,(function(t,n){return e.replaceIRIWithPrefix(n)})),e.propertiesObj.items=[],_.forEach(e.data,(function(t,n){e.propertiesObj.items.push({key:n,value:t})})),e.nodeImage=void 0,e.propertiesNotFiltered=e.propertiesObj.items;const n=_.find(e.propertiesObj.items,(function(e){return"image"===e.key}));n&&(e.nodeImage=n.value[0].v),e.propertiesObj.items=_.reject(e.propertiesObj.items,(function(e){return"image"===e.key})),e.propertiesNotFiltered=e.propertiesObj.items}),(function(e){o.warning(getError(e.data),"Error")}))}(n)}(n,0,r)}),40+B-(d3.event.timeStamp-x));else if(2===w){z.countLinks(n,z.links)<=e.saveSettings.linksLimit?ae(n,!1,i.parentNode):o.info("Increase limit to see more connections and try again","Node already expanded to predefined maximum links to show."),e.closeInfoPanel()}d3.event.preventDefault()};function M(e,t){let n,r,o,i,a=!0;if("down"===t)n=2*e.size,r=e.size/3,o=.8,i=.3;else if("down-fixed"===t)n=2*e.size,r=e.size,o=.8,i=.66;else if("up"===t)n=e.size/3,r=2*e.size,o=.3,i=.8;else{if("fixed"!==t)return;n=e.size,o=.66,a=!1}let s=u.selectAll(".node-wrapper").filter((function(t){return t===e})).append("text").text("î¤").classed("icon-any pinned",!0).style("font-size",n+"px").attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).attr("opacity",o);"fixed"!==t&&"down-fixed"!==t||(e.pin=s),a&&(s=s.transition().duration(1e3).style("font-size",(function(){return r+"px"})).attr("opacity",i),"down-fixed"!==t&&s.remove())}const E=d3.behavior.drag().origin((function(e){return e})).on("dragstart",(function(e){0===d3.event.sourceEvent.button&&(e.fixedBeforeDrag=e.fixed,e.isBeingDragged=!0,e.beginDragging=!0,se(),d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0))})).on("drag",(function(t){t.isBeingDragged&&(w=0,t.px=d3.event.x,t.py=d3.event.y,t.fixed?t.beginDragging&&M(t,"fixed"):(e.numberOfPinnedNodes++,t.fixed=!0,M(t,"down-fixed")),t.pinWasFixed=!0,t.beginDragging=null,X.resume())})).on("dragend",(function(e){e.isBeingDragged&&(e.pinWasFixed&&(e.pinWasFixed=null,d3.select(".pinned").remove()),e.isBeingDragged=!1,d3.select(this).classed("dragging",!1))}));y=u.selectAll(".node").data(z.nodes).enter().append("g").attr("class","node-wrapper").attr("id",(function(e){return e.iri})).append("circle").attr("class","node").attr("r",(function(e){return e.size})).style("fill",(function(t){return"greyColor"===t.types?"c2c2c2":e.getColor(t.types[0])})).call(E).on("mouseover",(function(t){if(!t.isBeingDragged){const n=d3.event;a.cancel(J),K=a(()=>{(function(t,n){if(e.showInfoPanel)return!1;(ne.closeIcon||ne.expandIcon||ne.focusIcon||ne.copyURIIcon)&&ne.removeIcons();if(X.alpha()<.05)return ne.initIcons(t,n.parentNode),X.stop(),!0;return!1})(t,this)&&function(e,t){a.cancel(void 0);const n=L=t.target;a((function(){L===n&&c.show(e,L)}),300)}(t,n)},400)}})).on("mouseout",h).on("mousedown",C).on("touchstart",(function(e){C(),b=0,v=a((function(){b<5&&re(e),v=null,w=0}),1e3)})).on("touchmove",(function(){b++})).on("mouseup",S).on("touchend",S).on("contextmenu",(function(t){d3.event.shiftKey||(d3.event.preventDefault(),se(),e.closeInfoPanel(),t.fixed?(e.numberOfPinnedNodes--,t.fixed=!1,M(t,"up"),X.resume()):(e.numberOfPinnedNodes++,t.fixed=!0,M(t,"down")),function(e){L&&c.show(e,L)}(t))}));const T=u.selectAll(".node-wrapper").append("foreignObject").style("pointer-events","none").attr("width",(function(e){return 2*e.size*V}));u.insert("g").attr("class","menu-events"),function(e){e.each((function(e){e.fontSize=r.a.Text.calcFontSizeRaw(e.labels[0].label,e.size,R,!0)})).attr("height",(function(e){return 3*e.fontSize})).append("xhtml:div").attr("class","node-label-body").style("font-size",(function(e){return e.fontSize+"px"})).append("xhtml:div").text((function(e){return e.labels[0].label})),a((function(){$(".node-label-body div").each((function(e,t){let n=t.textContent.substring(0,t.textContent.length-1);let r=0;for(;r<200&&(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)n=n.substring(0,n.length-1),t.textContent=n+"â¦",r++}))}),50)}(T),X.on("tick",(function(){d3.geom.quadtree(z.nodes);z.nodes.length;g.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),m.attr("x",(function(e){return e.x=.5*(e.source.x+e.target.x)})).attr("y",(function(e){return e.y=.5*(e.source.y+e.target.y)})).attr("transform",(function(e){return"rotate("+function(e,t){const n=e.source,r=e.target,o={x:n.x,y:n.y},i={x:r.x,y:r.y};if(t)return 180*Math.atan2(i.y-o.y,i.x-o.x)/Math.PI;{const e=180*Math.atan2(i.y-o.y,i.x-o.x)/Math.PI;return e<=90&&e>=-90?e:(e>0?-1:1)*(180-Math.abs(e))}}(e,e.direction)+", "+e.x+", "+e.y+")"})),y.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),u.select(".node-loader").attr("x",(function(e){return e.x-e.size+3})).attr("y",(function(e){return e.y-e.size})),u.select(".loader-container").attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),T.attr("x",(function(e){return e.x-e.size*V})).attr("y",(function(e){return e.y-3*e.fontSize/2})),d3.select(".pinned").attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))})),angular.isDefined(ee)&&ee.setLoadingState(!1),e.loading&&(e.loading=!1),d3.selectAll(".link-wrapper").each((function(){const e=$(this).attr("id").split(">")[0],t=$(this).attr("id").split(">")[1];d3.selectAll(".link").each((function(n){if(n.source.iri===t&&n.target.iri===e){let e=n.source.iri;e+=">",e+=n.target.iri;const t=document.createTextNode("  â¶");document.getElementById(e).lastChild.appendChild(t),n.direction="double"}}))})),d3.selectAll(".d3-actions-tip").remove(),X.start()}te();const ne=new function(){function e(e,t){return"translate("+(t.x-14+(t.size+15)*Math.cos(e*Math.PI/180-Math.PI/2))+","+(t.y-14+(t.size+15)*Math.sin(e*Math.PI/180-Math.PI/2))+")"}this.closeIcon=void 0,this.expandIcon=void 0,this.collapseIcon=void 0,this.focusIcon=void 0,this.copyURIIcon=void 0,this.actionsTip=void 0,this.removeIcons=function(){this.closeIcon.remove("g"),this.expandIcon&&this.expandIcon.remove("g"),this.collapseIcon&&this.collapseIcon.remove("g"),this.focusIcon.remove("g"),this.copyURIIcon.remove("g"),this.closeIcon=void 0,this.expandIcon=void 0,this.collapseIcon=void 0,this.focusIcon=void 0,this.copyURIIcon=void 0,this.expandedState=!1},this.expandedState=!1,this.initIcons=function(n,r){const o=i()().attr("class","d3-tip d3-actions-tip").customPosition((function(){const e=d3.event.target.getBoundingClientRect();return{top:e.top-20+"px",left:e.right+10+"px"}})).html((function(e){return e}));Z.call(o);n.isExpanded?(this.collapseIcon=d3.select(".menu-events").append("g").attr("class","collapse-icon").attr("name","collapse").attr("transform",(function(){return e(20,n)})),this.collapseIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.collapseIcon.append("path").attr("d","M22.67,12a.59.59,0,0,1-.53.65l-6.88.72H15.2a.59.59,0,0,1-.59-.65l.72-6.88A.58.58,0,0,1,16,5.33a.59.59,0,0,1,.53.65L16,11.11,21.3,5.79a.64.64,0,0,1,.91.91L16.89,12,22,11.49A.59.59,0,0,1,22.67,12ZM12.59,14.75l-6.75.85a.59.59,0,0,0-.51.66.58.58,0,0,0,.66.51l4.95-.62-5.2,5.2a.64.64,0,1,0,.91.91l5.2-5.2L11.23,22a.59.59,0,0,0,.51.66h.07a.59.59,0,0,0,.59-.52l.85-6.75a.59.59,0,0,0-.17-.49A.58.58,0,0,0,12.59,14.75Z").style("fill","#ed4f2f"),this.collapseIcon.on("click",(function(){var e;(e=n).isExpanded=!1,z.removeNodeLeafLinks(e),te()})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(K),a.cancel(J)})).on("mouseout",(function(){o.hide(),J=a((function(){se()}),500)}))):(this.expandIcon=d3.select(".menu-events").append("g").attr("class","expand-icon").attr("name","expand").attr("transform",(function(){return e(20,n)})),this.expandIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.expandIcon.append("path").attr("d","M22.37,6.28l-.72,6.88a.59.59,0,0,1-.59.53H21a.59.59,0,0,1-.53-.65L21,7.9l-5.32,5.32a.64.64,0,0,1-.91-.91L20.1,7,15,7.53a.59.59,0,0,1-.12-1.18l6.88-.72a.59.59,0,0,1,.65.65ZM12.89,20.34,7.95,21l5.2-5.2a.64.64,0,0,0-.91-.91L7,20.05l.62-4.95A.59.59,0,0,0,6.48,15l-.85,6.75a.59.59,0,0,0,.59.67h.07L13,21.52a.59.59,0,1,0-.15-1.18Z").style("fill","#ed4f2f"),this.expandIcon.on("click",(function(){ae(n,!1,r)})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(J),a.cancel(K)})).on("mouseout",(function(){o.hide(),J=a((function(){se()}),500)}))),this.focusIcon=d3.select(".menu-events").append("g").attr("class","focus-icon").attr("name","focus").attr("transform",(function(){return e(20,n)})),this.focusIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.focusIcon.append("path").attr("d","M14.2,23.81a9.8,9.8,0,1,1,6.93-2.87h0A9.74,9.74,0,0,1,14.2,23.81Zm0-18.17a8.37,8.37,0,1,0,5.92,14.29h0A8.37,8.37,0,0,0,14.2,5.64Zm1.42,6.95a2,2,0,1,0,0,2.85A2,2,0,0,0,15.62,12.59Z").style("fill","#ed4f2f"),this.focusIcon.on("click",(function(){t.$broadcast("onRootNodeChange",n.iri)})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(J),a.cancel(K)})).on("mouseout",(function(){o.hide(),J=a((function(){se()}),500)})),this.copyURIIcon=d3.select(".menu-events").append("g").attr("class","icon-link").attr("name","link").attr("transform",(function(){return e(20,n)})),this.copyURIIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.copyURIIcon.append("path").attr("d","M 13.457031 10.164062 C 13.648438 10.164062 13.820312 10.242188 13.941406 10.363281 L 15.492188 11.859375 C 15.984375 12.332031 16.292969 12.992188 16.292969 13.714844 C 16.292969 14.441406 15.984375 15.097656 15.492188 15.574219 L 10.394531 20.496094 C 9.902344 20.972656 9.222656 21.265625 8.472656 21.265625 C 7.71875 21.265625 7.039062 20.972656 6.546875 20.496094 L 4.996094 19 C 4.507812 18.523438 4.203125 17.867188 4.203125 17.144531 C 4.203125 16.421875 4.507812 15.765625 4.996094 15.289062 L 7.542969 12.824219 C 7.667969 12.707031 7.84375 12.628906 8.035156 12.628906 C 8.417969 12.628906 8.726562 12.929688 8.726562 13.300781 C 8.726562 13.484375 8.648438 13.652344 8.523438 13.773438 L 5.976562 16.234375 C 5.738281 16.46875 5.589844 16.792969 5.589844 17.148438 C 5.589844 17.503906 5.738281 17.824219 5.976562 18.058594 L 7.527344 19.566406 C 7.773438 19.792969 8.105469 19.929688 8.472656 19.929688 C 8.835938 19.929688 9.167969 19.792969 9.414062 19.566406 L 14.511719 14.644531 C 14.753906 14.410156 14.90625 14.089844 14.90625 13.730469 C 14.90625 13.375 14.753906 13.054688 14.511719 12.820312 L 12.964844 11.324219 C 12.839844 11.203125 12.761719 11.039062 12.761719 10.855469 C 12.761719 10.488281 13.070312 10.1875 13.449219 10.1875 Z M 17.082031 3.976562 C 17.082031 3.976562 17.085938 3.976562 17.085938 3.976562 C 17.824219 3.976562 18.492188 4.261719 18.980469 4.722656 L 20.535156 6.203125 C 21.042969 6.679688 21.355469 7.34375 21.355469 8.082031 C 21.355469 8.792969 21.058594 9.441406 20.582031 9.914062 L 18.0625 12.402344 C 17.9375 12.527344 17.761719 12.605469 17.566406 12.605469 C 17.183594 12.605469 16.875 12.304688 16.875 11.9375 C 16.875 11.753906 16.949219 11.589844 17.070312 11.46875 L 19.605469 8.984375 C 19.847656 8.75 19.996094 8.429688 19.996094 8.070312 C 19.996094 7.714844 19.847656 7.394531 19.605469 7.160156 L 18.019531 5.667969 C 17.773438 5.445312 17.4375 5.304688 17.070312 5.300781 C 16.703125 5.304688 16.367188 5.453125 16.128906 5.691406 L 11.085938 10.667969 C 10.84375 10.898438 10.695312 11.222656 10.695312 11.578125 C 10.695312 11.933594 10.84375 12.257812 11.085938 12.488281 L 12.675781 13.980469 C 12.804688 14.101562 12.882812 14.273438 12.882812 14.457031 C 12.882812 14.828125 12.574219 15.128906 12.191406 15.128906 C 12.003906 15.128906 11.832031 15.054688 11.707031 14.9375 L 10.140625 13.457031 C 9.636719 12.980469 9.324219 12.316406 9.324219 11.582031 C 9.324219 10.863281 9.621094 10.214844 10.101562 9.742188 L 15.140625 4.765625 C 15.625 4.285156 16.304688 3.980469 17.054688 3.976562 Z M 17.082031 3.976562").style("fill","#ed4f2f"),this.copyURIIcon.on("click",(function(){D(n.iri),se(),o.hide()})).on("mouseover",(function(){o.show("<div style='text-align: center;'><b>Copy to ClipBoard</b><br>"+n.iri+"</div>"),a.cancel(J),a.cancel(K)})).on("mouseout",(function(){o.hide(),J=a((function(){se()}),500)})),this.closeIcon=d3.select(".menu-events").append("g").attr("class","close-icon").attr("name","remove").attr("transform",(function(){return e(20,n)})),this.closeIcon.append("circle").attr("cx",14).attr("cy",14).attr("r",13).style("fill","#eee"),this.closeIcon.append("path").attr("d","M14.94,14l5.87-5.87a.66.66,0,1,0-.94-.94L14,13.06,8.13,7.19a.66.66,0,0,0-.94.94L13.06,14,7.19,19.87a.66.66,0,1,0,.94.94L14,14.94l5.87,5.87a.66.66,0,1,0,.94-.94Z").style("fill","#ed4f2f"),this.closeIcon.on("click",(function(){re(n)})).on("mouseover",(function(){o.show(this.getAttribute("name")),a.cancel(J),a.cancel(K)})).on("mouseout",(function(){o.hide(),J=a((function(){se()}),500)})),this.animateMenu(n)},this.animateMenu=function(t){let n=0;let r=20;this.expandIcon&&this.expandIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return e(r,t)})).delay(n+=35),this.collapseIcon&&this.collapseIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return e(r,t)})).delay(n+=35),this.copyURIIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return r+=30,e(r,t)})).delay(n+=35),this.focusIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return r+=30,e(r,t)})).delay(n+=35),this.closeIcon.transition().duration(100).style("opacity",1).ease("sin").attr("transform",(function(){return r+=30,e(r,t)})).delay(n+=35),this.expandedState=!0}};function re(e){z.removeNode(e),te()}function oe(t){!function(t){e.nodeSelected=!0,null===t.data.types&&(t.data.types="greyColor"),z=new j,A="translate(0, -70) scale(1)",k.translate([0,-70]),k.scale(1)}(t),ie(t)}function ie(t,n,r){let i=t.data;i=_.filter(i,(function(e){return-1===_.findIndex(z.links,(function(t){return e.source===t.source.iri&&e.target===t.target.iri}))})),i=_.filter(i,(function(e){return e.source!==e.target}));const a=_.union(_.flatten(_.map(t.data,(function(e){return[e.source,e.target]})))),u=_.map(z.nodes,(function(e){return e.iri})),c=_.reject(a,(function(e){return _.includes(u,e)}));if(0===c.length)r?o.info("This node has no visible connections. Check your Graph Settings if you expect such."):0===i.length&&o.info("This node has no other visible connections. Check your Graph Settings if you expect such."),z.addAndMatchLinks(i),te();else{const t=[],r=[];_.forEach(c,(function(n,o){t.push(s({url:"rest/explore-graph/node",method:"GET",params:{iri:n,config:e.configLoaded.id,languages:e.shouldShowSettings()?e.saveSettings.languages:[],includeInferred:e.saveSettings.includeInferred,sameAsState:e.saveSettings.sameAsState}}).then((function(e){r[o]=e.data})))})),l.all(t).then((function(){_.forEach(r,(function(e,t){const o=2*Math.PI*t/r.length,i=(n?n.x:0)+Math.cos(o)*N/3,a=(n?n.y:0)+Math.sin(o)*N/3;z.addNode(e,i,a)})),z.addAndMatchLinks(i),n&&(n.isExpanded=!0),te()}))}}function ae(t,n,r){if(ee.getLoadingState())return;ee.init(t,r);const i=t.iri;s({url:"rest/explore-graph/links",method:"GET",params:{iri:i,linksLimit:e.saveSettings.linksLimit,includeInferred:e.saveSettings.includeInferred,config:e.configLoaded.id,preferredTypes:e.shouldShowSettings()?e.saveSettings.preferredTypes:[],rejectedTypes:e.shouldShowSettings()?e.saveSettings.rejectedTypes:[],preferredPredicates:e.shouldShowSettings()?e.saveSettings.preferredPredicates:[],rejectedPredicates:e.shouldShowSettings()?e.saveSettings.rejectedPredicates:[],preferredTypesOnly:e.shouldShowSettings()?e.saveSettings.preferredTypesOnly:[],preferredPredicatesOnly:e.shouldShowSettings()?e.saveSettings.preferredPredicatesOnly:[],languages:e.shouldShowSettings()?e.saveSettings.languages:[],sameAsState:e.saveSettings.sameAsState,includeSchema:e.saveSettings.includeSchema}}).then((function(e){ie(e,t,n)}),(function(t){const n=getError(t.data);o.error(n,"Error exploring node"),e.loading=!1,ee.setLoadingState(!1)}))}function se(){angular.isDefined(ne)&&ne.expandedState&&ne.removeIcons()}function ue(t){const n=e.replaceIRIWithPrefix(t);return n.length===t.length?t.split("/")[t.split("/").length-1]:n}e.toggleSidePanel=function(){e.pageslideExpanded=!e.pageslideExpanded},e.closeInfoPanel=function(){e.pageslideExpanded=!1,e.openedNodeInfoPanel=void 0,a((function(){e.showInfoPanel=!1}))},e.splitPredicate=function(e){return e.split("/")[e.split("/").length-1]},e.getActiveRepository=function(){return n.getActiveRepository()},e.isLoadingLocation=function(){return n.isLoadingLocation()},e.hasActiveLocation=function(){return n.hasActiveLocation()},e.rotate=function(e){se();const t=2*(e?1:-1)*Math.PI/180,n=Math.cos(t),r=Math.sin(t),o=I/2,i=N/2;d3.selectAll(".node-wrapper").each((function(e){e.x=o+(n*(e.x-o)+r*(e.y-i)),e.y=i+(-r*(e.x-o)+n*(e.y-i)),e.fixed&&(e.px=e.x,e.py=e.y)})),X.resume()},e.openUri=function(t,n){if(!n){const n={};e.configLoaded.id!==e.defaultGraphConfig.id&&(n.config=e.configLoaded.id),n.uri=t,e.pushHistory(n,{uri:t,config:e.configLoaded})}e.$broadcast("onRootNodeChange",t)},e.saveOrUpdateGraph=function(){const t=JSON.stringify(z.copyState()),n={id:e.lastSavedGraphId,name:e.lastSavedGraphName,data:t,shared:e.shared};n.id?e.saveGraphModal("update",n):e.saveGraphModal("new",n)},e.renameSavedGraph=function(t){e.saveGraphModal("rename",{id:t.id,name:t.name,config:t.config,shared:t.shared})};const ce=function(t){x.editSavedGraph(t).success((function(){e.lastSavedGraphName=t.name,e.shared=t.shared,e.refreshSavedGraphs(),o.success("Saved graph "+t.name+" was edited.")})).error((function(e){const t=getError(e);o.error(t,"Error! Cannot edit saved graph")}))};e.saveGraphModal=function(t,n,r){g.open({templateUrl:"js/angular/graphexplore/templates/modal/save-graph.html",controller:"SaveGraphModalCtrl",resolve:{data:function(){return{mode:t,graph:n,graphExists:r,shared:n.shared}}}}).result.then((function(t){if(t.restart)e.saveGraphModal(t.mode,t.graph,!1);else switch(t.mode){case"new":!function(t){e.configLoaded&&(t.config=e.configLoaded.id),x.addNewSavedGraph(t).success((function(n,r,i){e.lastSavedGraphName=t.name,e.lastSavedGraphId=i()["x-saved-graph-id"],e.shared=t.shared,e.refreshSavedGraphs(),o.success("Saved graph "+t.name+" was saved.")})).error((function(n,r){if(422===r)e.saveGraphModal("new",t,!0);else{const e=getError(n);o.error(e,"Error! Cannot create saved graph")}}))}(t.graph);break;case"update":case"rename":ce(t.graph)}}))},e.refreshSavedGraphs=function(){x.getSavedGraphs().success((function(t){e.savedGraphs=t})).error((function(e){const t=getError(e);o.error(t,"Error! Could not get saved graphs")}))},e.loadSavedGraph=function(t,n){t.owner?(e.lastSavedGraphName=t.name,e.lastSavedGraphId=t.id,e.shared=t.shared,e.configLoaded=e.findConfigById(t.config)):(e.lastSavedGraphName=null,e.lastSavedGraphId=null,e.shared=t.shared),e.configLoaded||(e.configLoaded=e.defaultGraphConfig),z.restoreState(JSON.parse(t.data)),n||e.pushHistory({saved:t.id},{savedGraph:t})},e.copyToClipboardSavedGraph=function(e){D([location.protocol,"//",location.host,location.pathname,"?saved=",e.id].join(""))},e.deleteSavedGraph=function(t){h.openSimpleModal({title:"Confirm",message:"Are you sure you want to delete the saved graph '"+t.name+"'?",warning:!0}).result.then((function(){!function(t){x.deleteSavedGraph(t).success((function(){e.refreshSavedGraphs(),o.success("Saved graph "+t.name+" was deleted.")})).error((function(e){const t=getError(e);o.error(t,"Error! Cannot delete saved graph")}))}(t)}))},e.openIRI=function(t,n){return n.shiftKey?e.$broadcast("onRootNodeChange",t):window.open(t,"_blank"),!1},e.togglePinAllNodes=function(){se();const t=e.numberOfPinnedNodes<=0;e.numberOfPinnedNodes=0,d3.selectAll(".node").each((function(n){n.fixed=t,t&&e.numberOfPinnedNodes++})),X.resume()},$("body").on("keydown",(function(t){"input"!==t.target.nodeName&&e.nodeSelected&&(37===t.keyCode?e.rotate(!0):39===t.keyCode&&e.rotate(!1))})),e.getLiteralFromPropValue=function(e){return e.substring(e.indexOf(":")+1)}}function s(e,t,n){switch(e.mode=n.mode,e.graph=angular.copy(n.graph),e.graphExists=n.graphExists,e.mode){case"new":e.title="Create new saved graph",e.okButtonText="Create";break;case"update":e.title="Update saved graph",e.okButtonText="Save";break;case"rename":e.title="Rename saved graph",e.okButtonText="Save"}e.ok=function(){e.form.$valid&&t.close({graph:e.graph,mode:e.mode})},e.saveNew=function(){e.graph.name=e.graph.name+" (new)",t.close({graph:e.graph,mode:"new",restart:!0})},e.cancel=function(){t.dismiss("cancel")}}angular.module("graphdb.framework.graphexplore.controllers.graphviz",["ui.scroll.jqlite","ui.scroll","toastr","ui.bootstrap","ngTagsInput","graphdb.framework.utils.localstorageadapter"]).controller("GraphsVisualizationsCtrl",a).controller("SaveGraphModalCtrl",s).config(["$tooltipProvider",function(e){e.options({appendToBody:!0})}]),a.$inject=["$scope","$rootScope","$repositories","toastr","$timeout","$http","ClassInstanceDetailsService","AutocompleteRestService","$q","$location","$jwtAuth","UiScrollService","ModalService","$modal","$window","LocalStorageAdapter","LSKeys","SavedGraphsRestService","GraphConfigRestService","RDF4JRepositoriesRestService"],s.$inject=["$scope","$modalInstance","data"]},57:function(e,t,n){"use strict";n.r(t);n(31),n(4);function r(e,t,n,r,o,i,a,s,u,c,l,f,d,p,h,g){e.page=1,e.totalPages=5,e.helpHidden=1===h.get(g.HIDE_GRAPH_CONFIG_HELP),e.toggleHelp=function(t){void 0===t&&(t=h.get(g.HIDE_GRAPH_CONFIG_HELP)),1!==t?(h.set(g.HIDE_GRAPH_CONFIG_HELP,1),e.helpHidden=!0):(h.set(g.HIDE_GRAPH_CONFIG_HELP,0),e.helpHidden=!1)},e.fixedVisualCallback=function(t,n){e.newConfig.startIRI=t,e.newConfig.startIRILabel=n},e.isDefaultGraph=function(e){return"Minimal"===e.name||"Advanced"===e.name},e.isUserGraph=function(t){return!e.isDefaultGraph(t)},e.getSampleName=function(e,t){const n=e[t+"Description"];return n||(e.id?"Copy of "+e.name:e.name)};const y=function(){c.getGraphConfigSamples().success((function(t){e.samples=_.filter(t,(function(t){return!t.id||e.newConfig.id!==t.id||(e.revertConfig=t,!1)}))})).error((function(e){r.error(getError(e),"Could not get graph configs. You may not see sample values")}))},m=f.configName;function v(e){r.warning(e)}function x(t){let n;return"query"===t.startMode&&1===e.page?n=t.startGraphQuery:2===e.page?n=t.expandQuery:3===e.page?n=t.resourceQuery:4===e.page?n=t.predicateLabelQuery:5===e.page&&(n=t.resourcePropertiesQuery),angular.isDefined(n)?n:""}function w(){function i(){e.getAutocompletePromise=l.checkAutocompleteStatus()}y(),e.createGraphConfig=function(){c.createGraphConfig(e.newConfig).success((async function(){await d.showToastMessageWithDelay("Saved new graph config"),n.url("graphs-visualizations")})).error((function(e){r.error(getError(e),"Error! Could not create graph config")}))},e.updateGraphConfig=function(){c.updateGraphConfig(e.newConfig).success((async function(){await d.showToastMessageWithDelay("Graph config saved"),n.url("graphs-visualizations")})).error((function(e){r.error(getError(e),"Error! Could not save graph config")}))},e.$on("autocompleteStatus",(function(){i()})),i(),e.getNamespacesPromise=p.getNamespaces(e.getActiveRepository());const a=function(e,t,n,r,o,i){t?c.validateQuery(t,n,r,o,i).success((function(){e()})).error((function(e){v(getError(e))})):e()};e.validateCurrentPage=function(t){e.updateModel(),1===e.page?"node"!==e.newConfig.startMode||e.newConfig.startIRI?"query"!==e.newConfig.startMode||e.newConfig.startGraphQuery?"query"===e.newConfig.startMode?a(t,e.newConfig.startGraphQuery,"graph"):t():v("Please provide start graph query."):v("Please select start node."):2===e.page?a(t,e.newConfig.expandQuery,"construct",["node"]):3===e.page?a(t,e.newConfig.resourceQuery,"tuple",["node"],[],["type","label","comment","rank"]):4===e.page?a(t,e.newConfig.predicateLabelQuery,"tuple",["edge"],["label"]):5===e.page&&a(t,e.newConfig.resourcePropertiesQuery,"tuple",["node"],["property","value"])},e.goToPage=function(t){e.page!==t&&e.validateCurrentPage((function(){e.showEditor(),e.page=t,e.notoolbar=1!==e.page}))},e.goToPreviousPage=function(){e.page>1&&e.goToPage(e.page-1)},e.goToNextPage=function(){e.goToPage(e.page+1)},e.saveGraphConfig=function(){e.newConfig.startQueryIncludeInferred=e.currentQuery.inference,e.newConfig.startQuerySameAs=e.currentQuery.sameAs,e.validateCurrentPage((function(){e.newConfig.name?e.isUpdate?e.updateGraphConfig(e.newConfig):e.createGraphConfig(e.newConfig):v("Please provide config name.")}))},e.updateModel=function(){const t=window.editor.getValue().trim();"query"===e.newConfig.startMode&&1===e.page?e.newConfig.startGraphQuery=t:2===e.page?e.newConfig.expandQuery=t:3===e.page?e.newConfig.resourceQuery=t:4===e.page?e.newConfig.predicateLabelQuery=t:5===e.page&&(e.newConfig.resourcePropertiesQuery=t)},e.setQuery=function(e){window.editor.setValue(e||" ")},e.updateDirty=function(){if(e.revertConfig){const t=x(e.revertConfig),n=window.editor.getValue().trim();e.queryEditorIsDirty=t!==n}},e.updateEditor=function(){t((function(){e.currentQuery.query=x(e.newConfig),o.isActiveRepoOntopType()&&(e.nocount=!0),e.currentQuery.inference=e.newConfig.startQueryIncludeInferred,e.currentQuery.sameAs=e.newConfig.startQuerySameAs,N(e.currentQuery.id),T(e.currentQuery.id)}),100)},e.showEditor=function(){window.editor&&window.editor.xhr&&window.editor.xhr.abort(),e.viewMode="yasr"},e.showPreview=function(){e.currentQuery.outputType="table",e.runQuery()},e.revertEditor=function(){e.setQuery(x(e.revertConfig))},e.$watch("newConfig.startMode",(function(n){"query"===n&&t((function(){e.updateEditor()}),0)})),e.$watch("page",(function(n){("query"===e.newConfig.startMode||n>1)&&t((function(){e.showEditor(),e.updateEditor()}),0)}))}e.newConfig={startQueryIncludeInferred:!0,startQuerySameAs:!0},e.newConfig.startMode="search",e.isUpdate=!1,e.shared=!1,e.encodeQuery=function(e){return encodeURIComponent(e)},m?(e.isUpdate=!0,c.getConfig(m).success((function(t){e.newConfig=t,w()})).error((function(e){r.error(getError(e),"Could not load config for name "+m)}))):(e.isUpdate=!1,w());const b={id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:e.newConfig.startQueryIncludeInferred,sameAs:e.newConfig.startQuerySameAs};e.resetCurrentTabConfig=function(){e.currentTabConfig={pageSize:100,page:1,allResultsCount:0,resultsCount:0}},e.queryExists=!1,e.resetCurrentTabConfig(),e.tabsData=e.tabs=[b],e.saveTab=function(t){const n=function(t){for(let n=0;n<e.tabsData.length;n++){if(e.tabsData[n].id===t)return n}}(t);if(void 0===n)return{};const r=e.tabsData[n];return e.saveQueryToLocal(r),r},e.loadTab=N,e.addNewTab=function(e,t,n){},e.runQuery=R,e.getNamespaces=k,e.changePagination=function(){R(!0,e.explainRequested)},e.toggleSampleQueries=function(){},e.addKnownPrefixes=A,e.getExistingTabId=I,e.querySelected=function(t){const n=I(t);e.toggleSampleQueries(),angular.isDefined(n)?T(n):e.addNewTab(null,t.name,t.body)},e.saveQueryToLocal=C,e.setLoader=S,e.getLoaderMessage=function(){const t=(Date.now()-e.queryStartTime)/1e3,n=e.getHumanReadableSeconds(t);let r="";r=e.progressMessage?e.progressMessage+"... "+n:"Running operation..."+n;e.extraMessage&&t>10&&(r+="\n"+e.extraMessage);return r},e.fixSizesOnHorizontalViewModeSwitch=M,e.changeViewMode=function(n){e.viewMode="none",e.orientationViewMode=!e.orientationViewMode,M(),$(".dataTables_filter").remove(),$(".resultsTable").remove(),t((function(){N(n),T(n)}),100)},e.showHideEditor=E,e.focusQueryEditor=function(){angular.element(document).find(".editable-input").is(":focus")||angular.element(document).find(".CodeMirror textarea:first-child").focus()},e.orientationViewMode=!0;e.getActiveRepository();function C(e){}function S(t,n,r){const o=angular.element(document.getElementById("yasr-inner"));e.queryIsRunning=t,t?(e.queryStartTime=Date.now(),e.countTimeouted=!1,e.progressMessage=n,e.extraMessage=r,o.addClass("hide")):(e.progressMessage="",e.extraMessage="",o.removeClass("hide")),null===e.$$phase&&e.$apply()}function M(n){function r(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}const o=n;if(e.orientationViewMode){if("yasr"===e.viewMode){let e=r()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px"}else e.noPadding={},document.querySelector(".CodeMirror-wrap").style.height="";document.getElementById("yasr").style.minHeight=""}else if(e.noPadding={paddingRight:15,paddingLeft:0},window.editor&&document.querySelector(".CodeMirror-wrap")){let e=r()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px",document.getElementById("yasr").style.minHeight=e+"px"}else{let n;n=t(o?function(){e.fixSizesOnHorizontalViewModeSwitch(o)}:e.fixSizesOnHorizontalViewModeSwitch,100),e.$on("$destroy",(function(){t.cancel(n)}))}window.yasr&&window.yasr.container&&t((function(){window.yasr.container.resize()}),100)}function E(){M(!0)}function T(e){t((function(){$('a[data-id = "'+e+'"]').tab("show")}),0)}function R(t,n){e.executedQueryTab=e.currentQuery,n&&"SELECT"!==window.editor.getQueryType()&&"CONSTRUCT"!==window.editor.getQueryType()?r.warning("Explain only works with SELECT or CONSTRUCT queries."):"update"!==window.editor.getQueryMode()?(e.explainRequested=n,e.queryIsRunning||(t?e.currentTabConfig.resultsCount=0:e.resetCurrentTabConfig(),e.viewMode="editor",e.orientationViewMode&&e.fixSizesOnHorizontalViewModeSwitch(),S(!0,"Evaluating query"),window.editor.query())):r.warning("Cannot execute updates from this editor.")}function k(){S(!0,"Refreshing namespaces","Normally this is a fast operation but it may take longer if a bigger repository needs to be initialised first."),p.getRepositoryNamespaces().success((function(t){const n={};t.results.bindings.forEach((function(e){n[e.prefix.value]=e.namespace.value})),e.namespaces=n})).error((function(t){e.repositoryError=getError(t)})).finally((function(){S(!1)}))}function A(){s.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success((function(e){angular.isDefined(window.editor)&&angular.isDefined(e)&&e!==window.editor.getValue()&&window.editor.setValue(e)})).error((function(e){let t=getError(e);return r.error(t,"Error! Could not add known prefixes"),!0}))}function I(t){let n=void 0;return angular.forEach(e.tabsData,(function(e){if(e.name===t.name&&e.query===t.body)return n=e.id,e})),n}e.orientationViewMode||E(),e.getActiveRepository()&&k(),e.$on("$destroy",(function(){window.editor=null,window.yasr=null})),$("textarea").on("paste",(function(){t((function(){A()}),0)})),e.$watchCollection("[currentQuery.inference, currentQuery.sameAs]",(function(){e.currentQuery}));function N(n){e.tabsData=[e.currentQuery];let r=e.currentQuery;null==e.currentQuery.query||""===e.currentQuery.query?window.editor.setValue(" "):window.editor.setValue(e.currentQuery.query),t((function(){e.currentTabConfig={},e.currentTabConfig.queryType=r.queryType,e.currentTabConfig.resultsCount=r.resultsCount,e.currentTabConfig.offset=r.offset,e.currentTabConfig.allResultsCount=r.allResultsCount,e.currentTabConfig.page=r.page,e.currentTabConfig.pageSize=r.pageSize,e.currentTabConfig.timeFinished=r.timeFinished,e.currentTabConfig.timeTook=r.timeTook,e.currentTabConfig.sizeDelta=r.sizeDelta,e.$apply()}),0),$("#yasr").css("padding","0")}function L(e){return $(e).attr("data-id")}e.$on("tabAction",(function(t,n){n.relatedTarget&&e.saveTab(L(n.relatedTarget)),e.loadTab(L(n.target))})),e.$on("deleteAllexeptSelected",(function(t,n){e.tabsData=n,e.tabs=n})),e.currentQuery=angular.copy(b),e.showSampleQueries=!1,e.savedQuery={},e.sampleQueries={},e.getResultsDescription=function(){},e.getUpdateDescription=function(){},e.getStaleWarningMessage=function(){}}angular.module("graphdb.framework.graphexplore.controllers.graphviz.config",["graphdb.framework.utils.notifications","graphdb.framework.utils.localstorageadapter"]).controller("GraphConfigCtrl",r),r.$inject=["$scope","$timeout","$location","toastr","$repositories","$modal","ModalService","SparqlRestService","$filter","GraphConfigRestService","AutocompleteRestService","$routeParams","Notifications","RDF4JRepositoriesRestService","LocalStorageAdapter","LSKeys"]},58:function(e,t,n){"use strict";n.r(t);var r=n(208),o=n.n(r),i=n(214),a=n(205),s=n(206);n(4);function u(e,t,n,r,u,c,l,f,d,p,h){return{restrict:"AE",template:'<div id="classChart"></div>',scope:{classHierarchyData:"=",flattenedClassNames:"=",selectedClass:"=",currentSliderValue:"=",showClassInfoPanel:"=",showExternalElements:"=",hidePrefixes:"=",currentBrowserLimit:"="},link:function(g,y,m){!function(g,y){var m=800,v=800,x=v,w=20,b=d3.layout.pack().size([x-w,x-w]).value((function(e){return e.size})),C=d3.scale.linear().domain([0,4]).range(["hsl(19, 70%, 90%)","hsl(19, 70%, 50%)"]).interpolate(d3.interpolateHcl),S=d3.select("#classChart").insert("svg:svg","h2").attr("viewBox","0 0 "+m+" "+v).attr("preserveAspectRatio","xMidYMid meet").on("dblclick.zoom",null);function M(){return S.append("svg:g").attr({id:"main-group",transform:"translate("+m/2+","+v/2+")"})}function E(){return"true"===p.get(h.CLASS_HIERARCHY_HIDE_PREFIXES)}function T(){var e=s.a.Export.getCSSRules("css/rdf-class-hierarchy-labels.css?v=1.10.2");d3.selectAll("#main-group").append("defs"),$("defs").append('<style type="text/css"><![CDATA['+e+"]]></style>"),d3.selectAll("g").style("opacity",1);var t=s.a.Export.generateBase64ImageSource();d3.select(this).attr({href:t,download:"class-hierarchy-"+c.getActiveRepository()+".svg"})}g.hidePrefixes=E();var R,k,A=M();if(!g.classHierarchyData.classCount&&c.getActiveRepository()&&!c.isSystemRepository()){e.loader=!0,e.hierarchyError=!1;const t=p.get(`classHierarchy-selectedGraph-${c.getActiveRepository()}`);n.getClassHierarchyData(null!==t?t.contextID.uri:"").success((function(t,n,r){e.loader=!1,207===n&&l.warning("You can update the diagram by pressing the reload button.","Repository data has changed"),g.classHierarchyData=t,d3.select("#download-svg").on("mouseover",T)})).error((function(t){e.loader=!1,e.hierarchyError=getError(t),l.error("Request for "+d+" failed! "+getError(t))}))}var I,N,L,D,P,q,O,U,j={};function z(n,s,c,l){L&&L(),D&&D(),d3.selectAll("#main-group").remove(),A=M(),i.a.SingleChild.addPlaceholders(n,!0),N=c||n;var p,h=b.nodes(n);N.isInFocusTransitive=!0,i.a.SingleChild.removePlaceholders(h),i.a.SingleChild.centerNodes(h),i.a.SingleChild.makePositionsRelativeToZero(h);var y=o()().attr("class","d3-tip").customPosition((function(e){return{top:"inherit",bottom:r.innerHeight-d3.event.clientY+"px",right:r.innerWidth-d3.event.clientX+"px"}})).html((function(e){return e.name}));S.call(y);var m=A.selectAll("circle").data(h).enter().append("g");s.doFade&&m.each((function(e){a.a.Transition.fadeIn(d3.select(this),550)}));var v,E=[],T=m.append("circle").attr("class",(function(e){return e.role})).style("fill",(function(e){return e.children?C(e.depth):"#E0D0D0"})).each((function(e){if(e.circle=d3.select(this),e.name!==d){var t=e.name;E.push({name:t}),j[[t]]=e,e.circle.classed("rdf-class",!0),e.circle.on("mouseover",(function(){s.noPrefixes?y.show(e):e.textHidden?y.show(e):y.hide(e)})),e.circle.on("mouseout",y.hide)}}));function $(e){d3.selectAll(".selected").classed("selected",e.selected=!1),e.circle.classed("selected",e.selected=!0),v=e}function P(){g.showClassInfoPanel=!1}E&&(E=_.uniqBy(E,"name"),g.flattenedClassNames=E);var q=a.a.Click.delayDblClick();d3.selectAll(".parent, .topLevelParent, .child, .root").call(q);k=function(e){V(e),e.name===d?(P(),d3.selectAll(".selected").classed("selected",!1)):($(e),g.selectedClass=v,g.showClassInfoPanel=!0,g.$on("sidePanelClosed",(function(t){d3.selectAll(".selected").classed("selected",e.selected=!1)})))},q.on("click",(function(e){e.id&&r.history.pushState({id:e.id},"classHierarchyPage"+e.id,"hierarchy#"+e.id),y.hide(),k(e)})),q.on("dblclick",(function(t){t!==n&&(y.hide(),$(t),e.$broadcast("goToDomainRangeGraphView",v,N),d3.event.stopPropagation())}));var O=0;S.on("wheel",(function(){y.hide();var e=d3.event;e.preventDefault(),e.stopPropagation();var t=(new Date).getTime();if(t-O>100){O=t;var n="";e.deltaY<=-1?n="in":e.deltaY>=1&&(n="out");var o=e.target.__data__;if(o||(o=N),"in"===n){if(o!==N){for(;o.parent&&!o.parent.isInFocusTransitive;)o=o.parent;o.depth<N.depth&&(o=N)}if(o===N&&o.children){for(var i=o.children[0],a=1;a<o.children.length;a++)o.children[a].sortingRank>i.sortingRank&&(i=o.children[a]);o=i}V(o,!0)}else"out"===n&&(o=N.parent)&&V(o,!0);N.name===d&&r.history.replaceState({id:1},"classHierarchyPage1","hierarchy#1"),Q()}}));var U=A.selectAll("text").data(h).enter().append("text").attr("class",(function(e){return e.children&&e.children.length?"label":"label child-label"})).each((function(e){e.textSel=d3.select(this)}));s.noPrefixes?(I!==n&&(U.each((function(e){var t=e.name.indexOf(":");e.name.indexOf("http://")>-1?e.noPrefixName=e.name:t>-1&&(e.noPrefixName=e.name.substring(t+1))})),I=n),U.style("font-size",(function(e){return a.a.Text.calcFontSize(e.noPrefixName,e.r)})).text((function(e){return a.a.Text.getTextWithElipsisIfNeeded(e.noPrefixName,e.r/3)}))):U.style("font-size",(function(e){return a.a.Text.calcFontSize(e.name,e.r)})).text((function(e){return a.a.Text.getTextWithElipsisIfNeeded(e.name,e.r/3)})),U.style("display",(function(e){return e.parent===n?(e.textHidden=this.textContent.indexOf("...")+3===this.textContent.length,null):(e.textHidden=!0,"none")})),s.doFade&&!s.keepPrevState&&U.each((function(e){a.a.Transition.fadeIn(d3.select(this),550)})),R=function(){function e(e){e&&T.each((function(t){e==t.id&&k(t)}))}var n=t.hash();r.onpopstate=function(t){t.state&&e(t.state.id)},e(n)};var z=A.selectAll("circle, text");function H(e,t){var n=x/e[2];p=e,z.attr("transform",(function(t){return"translate("+(t.x-e[0])*n+","+(t.y-e[1])*n+")"})),T.attr("r",(function(e){return e.r*n})),t&&U.each((function(e){e.fullName!==N.topLevelParentUri&&N.topLevelParentUri!==d||(e.textSel.style("display","none"),N.children&&N.children.length?_.each(N.children,(function(e){e.textSel.style("display","inline")})):N.textSel.style("display","inline"),N.parent&&_.each(N.parent.children,(function(e){e.name!==N.name&&e.textSel.style("display","inline")})))})),U.style("font-size",(function(e){return s.noPrefixes?a.a.Text.calcFontSize(e.noPrefixName,e.r*n):a.a.Text.calcFontSize(e.name,e.r*n)})).text((function(e){return s.noPrefixes?a.a.Text.getTextWithElipsisIfNeeded(e.noPrefixName,e.r*n/3):a.a.Text.getTextWithElipsisIfNeeded(e.name,e.r*n/3)}))}function F(e){var t=2*e+w;return 2*e/t<.3&&(t=2*e+2),t}function G(e){!e.isInFocusTransitive&&e.parent&&e.parent.isInFocusTransitive||(e.textHidden=!0,this.style.display="none")}function B(e){!e.isInFocusTransitive&&e.parent&&e.parent.isInFocusTransitive&&(e.textHidden=this.textContent.indexOf("...")+3===this.textContent.length,this.style.display="")}function V(e,t){if(u((function(){g.showExternalElements=e.name===d})),e.id&&r.history.replaceState({id:e.id},"classHierarchyPage"+e.id,"hierarchy#"+e.id),N!==e){if(t&&(P(),d3.selectAll(".selected").classed("selected",!1)),N.parent)for(var n=N;n;)n.isInFocusTransitive=!1,n=n.parent;for(n=e;n;)n.isInFocusTransitive=n.children,n=n.parent;if(2*(N=e).r/(2*N.r+w)<.3||g.currentSliderValue>g.currentBrowserLimit)H([N.x,N.y,F(N.r)]),U.each((function(e){G.call(this,e),B.call(this,e)}));else d3.transition().duration(f).tween("zoom",(function(e){var t=d3.interpolateZoom(p,[N.x,N.y,F(N.r)]);return function(e){H(t(e))}})).selectAll("text").each("start",G).each("end",B)}}H([N.x,N.y,F(N.r)],l),L=g.$on("rootFocus",(function(){r.history.pushState({id:1},"classHierarchyPage1","hierarchy#1"),k(n)})),D=g.$on("classSearch",(function(e){k(e)}))}function Q(){var t=g.classHierarchyData.classCount;let n=p.get(h.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE);(!n||n>t)&&(n=t,p.set(h.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE,n)),e.$broadcast("classCount",t,n)}window.addEventListener("resize",Q),window.addEventListener("beforeunload",(function e(){window.removeEventListener("resize",Q),window.removeEventListener("beforeunload",e)})),g.$watch("classHierarchyData",(function(){P&&P(),q&&q(),O&&O(),U&&U();var e=E();if(g.classHierarchyData.classCount){Q();var t=angular.copy(g.classHierarchyData);var n,r,o=function(e){return b.nodes(e).sort((function(e,t){return e.sortingRank>t.sortingRank?-1:e.sortingRank<t.sortingRank?1:e.depth>t.depth?1:e.depth<t.depth?-1:0}))}(t);function i(e,t){var o={keepPrevState:!0,noPrefixes:E()};r=o.noPrefixes,z(n||e,o,N,!0),u((function(){p.set(h.CLASS_HIERARCHY_SWITCH_PREFIXES,t),R()}),70)}function a(e,o,a){if(e){p.set(h.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE,e),n={name:d,children:[]};for(var s=new Set,u=1;u<=e;u++)s.add(o[u].id),o[u].parent===o[0]&&n.children.push(o[u]);if(function e(t){if(t.children){for(var n=[],r=0;r<t.children.length;r++)s.has(t.children[r].id)&&n.push($.extend({},t.children[r]));t.children=n;for(r=0;r<t.children.length;r++)e(t.children[r])}}(n),a)r=angular.isUndefined(r)?E():r,z(n,{noPrefixes:r});else i(t)}}var s,c=p.get(h.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE);if(c)a(c,o);else{var l={doFade:!0,keepPrevState:!0,noPrefixes:E()};z(t,l),R()}P=g.$watch("hidePrefixes",(function(n){angular.isUndefined(n)||e?e=void 0:u((function(){!function(e){angular.isUndefined(e)||p.set(h.CLASS_HIERARCHY_HIDE_PREFIXES,e)}(n),i(t,!0)}),50)}),!0),q=g.$watch("currentSliderValue",(function(e){a(e,o,!0)}),!0),U=g.$on("onEnterKeypressSearchAction",(function(e){s&&k(s)})),O=g.$on("searchedClass",(function(e,t){(s=j[t.name])&&k(s)}))}}),!0)}(g)}}}angular.module("graphdb.framework.graphexplore.directives.class",["graphdb.framework.graphexplore.controllers.class","graphdb.framework.utils.localstorageadapter"]).constant("ZOOM_DURATION",500).constant("ROOT_OBJ_NAME","RDF Class Hierarchy").directive("rdfClassHierarchy",u),u.$inject=["$rootScope","$location","GraphDataRestService","$window","$timeout","$repositories","toastr","ZOOM_DURATION","ROOT_OBJ_NAME","LocalStorageAdapter","LSKeys"]},59:function(e,t,n){"use strict";n.r(t);var r=n(206),o=n(205);n(4);function i(e,t,n,i,a,s,u,c,l,f,d,p,h){return{restrict:"AE",template:'<div id="domain-range"></div>',scope:{showPredicatesInfoPanel:"=",selectedPredicate:"=",collapseEdges:"="},link:function(f){const d=c((function(){!function(f){d3.selection.prototype.moveToFront=function(){return this.each((function(){d3.select(this.parentNode.appendChild(this))}))},d3.selection.prototype.moveToBack=function(){return this.each((function(){const e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)}))};var d=1200,g=d/18,y=d/110,m=y/2,v=d/90,x=d/1e3,w=d/600,b=d3.layout.force().size([d,600]).charge(-900),C=b.drag().on("dragstart",(function(e){d3.select(this).classed("selected",e.selected=!0)})),S=d3.select("#domain-range").append("svg").attr("viewBox","0 0 "+d+" 600").attr("preserveAspectRatio","xMidYMid meet").on("dblclick.zoom",null),M=S.append("defs");M.append("marker").attr({id:"arrow",viewBox:"0 -5 10 10",refX:10,refY:0,markerUnits:"strokeWidth",markerWidth:5,markerHeight:5,orient:"auto",fill:p}).append("path").attr({d:"M0,-5L10,0L0,5",class:"arrowHead"}),M.append("marker").attr({id:"collapsed-arrow",viewBox:"0 -5 10 10",refX:9,refY:0,markerUnits:"strokeWidth",markerWidth:4,markerHeight:4,orient:"auto",fill:p}).append("path").attr({d:"M0,-5L10,0L0,5",class:"arrowHead"}),M.append("marker").attr({id:"arrow-loop",viewBox:"0 -5 10 10",refX:7,refY:0,markerUnits:"strokeWidth",markerWidth:5,markerHeight:5,orient:"auto",fill:p}).append("path").attr({d:"M0,-5L10,0L0,5",class:"arrowHead"}),d3.select("#download-svg").on("mouseover",(function(){var e=r.a.Export.getCSSRules("css/domain-range-graph.css?v=1.10.2");$("defs").append('<style type="text/css"><![CDATA['+e+"]]></style>");var t=r.a.Export.generateBase64ImageSource();d3.select(this).attr({href:t,download:"domain-range-graph-"+n.getActiveRepository()+".svg"})}));var E=d/7,_=1.2*E,T=d3.select(".legend-container").append("svg").attr("viewBox","0 0 "+E+" "+_).attr("preserveAspectRatio","xMidYMid meet");T.append("rect").attr({width:E,height:_}).style("fill","rgba(235, 235, 235, 0.9)");var R=d/75,k=d/40,A=R+g/2.5,I=k,N=A+d/90,L=v/1.1,D=k,P=(T.append("circle").attr({class:"legend-class-node",cx:(R+A)/2,cy:D,r:g/4.5}),I+d/370);T.append("text").attr({x:N,y:P}).style("font-size",L+"px").text("main class node");var q=D+d/30;T.append("circle").attr({class:"legend-object-node",cx:(R+A)/2,cy:q,r:y/1.25});var O=P+d/30;T.append("text").attr({x:N,y:O}).style("font-size",L+"px").text("class node");var U=q+d/45;T.append("circle").attr({class:"legend-datatype-node",cx:(R+A)/2,cy:U,r:m});var j=O+d/45;T.append("text").attr({x:N,y:j}).style("font-size",L+"px").text("datatype node");var z=U+d/45;d3.select(".legend-class-node");T.append("line").attr({class:"property-arrow",x1:R,y1:z,x2:A,y2:z}).style("stroke-width",x).attr("marker-end","url("+a.absUrl()+"#arrow)"),T.append("text").attr({x:N,y:z+d/370}).style("font-size",L+"px").text("explicit property");var Q=z+d/45;T.append("line").attr({class:"implicit-property-arrow",x1:R,y1:Q,x2:A,y2:Q}).style("stroke-width",x).attr("marker-end","url("+a.absUrl()+"#arrow)"),T.append("text").attr({x:N,y:Q+d/370}).style("font-size",L+"px").text("implicit property");var H=Q+d/45;T.append("line").attr({class:"collapsed-property-arrow",x1:R,y1:H,x2:A,y2:H}).style("stroke-width",w).attr("marker-end","url("+a.absUrl()+"#collapsed-arrow)"),T.append("text").attr({x:N,y:H+d/370}).style("font-size",L+"px").text("collapsed property");var F=S,G=a.search().uri,B=a.search().name,V=a.search().collapsed;i.getDomainRangeData(G,V).success((function(e,t,n){f.domainRangeGraphData=e})).error((function(e){l.error("Request for "+B+" failed!")})),$(window).on("popstate",(function(){s.set(u.DOMAIN_RANGE_WENT_BACK,!0)})),t.onpopstate=function(t){t.state&&e.$broadcast("changeCollapsedEdgesState",t.state.collapsed)},f.$watch("collapseEdges",(function(){angular.isUndefined(f.collapseEdges)||(s.set(u.DOMAIN_RANGE_COLLAPSE_EDGES,f.collapseEdges),"true"!==s.get(u.DOMAIN_RANGE_WENT_BACK)&&function(t){e.$broadcast("switchEdgeMode",{uri:G,name:B,collapsed:t})}(f.collapseEdges),s.remove(u.DOMAIN_RANGE_WENT_BACK))})),f.$watch("domainRangeGraphData",(function(){if(f.domainRangeGraphData){var n=angular.copy(f.domainRangeGraphData);b.nodes(n.nodes).links(n.links);var r=F.selectAll(".link").data(n.links).enter().append("g");function i(e){e.style("stroke",p),e.style("stroke-width",w),e.attr("marker-end","url("+a.absUrl()+"#collapsed-arrow)")}var s,u,l=0;r.each((function(e){if(e.objectPropNodeClassUri!==G)s=r.append("line").attr({class:"link","marker-end":"url("+a.absUrl()+"#arrow)"}).style("stroke-width",x).each((function(e){switch(e.propertyType){case"objectLeft":e.targetRadius=g;break;case"objectRight":e.targetRadius=y;break;case"datatype":e.targetRadius=m;break;default:e.targetRadius=0}var t=d3.select(this);e.targetNodeEdgeCount>1?i(t):e.implicit&&t.style("stroke-dasharray","3, 3")}));else{if(angular.isUndefined(u)){var t=g/2;u=d3.select(this).append("path").attr({d:"M 0 0 A "+t+" "+t+" 0 1 1 0 "+t,class:"loop-link",fill:"none","marker-end":"url("+a.absUrl()+"#arrow-loop)"}).style("stroke-width",x)}(l+=e.targetNodeEdgeCount)>1&&i(d3.select(".loop-link"))}}));var S={};function M(){$.isEmptyObject(S)||(S.text.style("fill","black"),S.background.style("fill","#f0f0f0"))}function E(e){M(),S.text=d3.select(this),S.background=d3.select(this.previousSibling),S.text.style("fill","white"),S.background.style("fill",p),c((function(){f.showPredicatesInfoPanel=!0,f.selectedPredicate=e})),d3.event.stopPropagation()}$("document").ready((function(){$("#domain-range").bind("click",M)}));var _=r.append("text").attr("class",(function(e){return e.objectPropNodeClassUri===G?"loop-link-property-name":"property-name"})).attr("dx",(function(e){return g/2*("objectLeft"===e.propertyType?1:-1)})).style("text-anchor",(function(e){return"objectLeft"===e.propertyType?"end":"start"})).style("font-size",v).text((function(e){return e.targetNodeEdgeCount>1?e.targetNodeEdgeCount+" predicates":e.name}));_.each((function(e){var n=d3.select(this);/\d\spredicates/.test(n.text())?n.style("font-weight","bold").on("click",E):n.on("click",(function(e){t.open("resource?uri="+encodeURIComponent(e.uri),"_blank")}))}));var T=d/600,R=r.append("rect").attr("class",(function(e){return e.objectPropNodeClassUri!==G?"link-background":"loop-link-background"})).attr("width",(function(e){return e.calculatedWidth=this.previousSibling.getBBox().width,e.calculatedWidth+2*T})).attr("height",(function(e){return e.calculatedHeight=this.previousSibling.getBBox().height,e.calculatedHeight+T})).attr("transform",(function(e){var t=T-g/2*("objectLeft"===e.propertyType?1:-1);return"objectLeft"===e.propertyType&&(t+=e.calculatedWidth),"translate(-"+t+",-"+(T+e.calculatedHeight/2)+")"})).on("click",(function(e){d3.event.stopPropagation()})),k=F.selectAll(".node").data(n.nodes).enter().append("g"),A=k.filter((function(e){return e.objectPropClassUri!==G})).append("circle").each((function(e){var t=d3.select(this);"main"===e.classPosition?t.attr({class:"class-node",r:g}).attr("marker-end","url("+a.absUrl()+"#loop-link)"):null===e.objectPropClassName?t.attr({class:"datatype-node",r:m}):t.attr({class:"object-prop-node",r:y})})).call(C);d3.selectAll(".object-prop-node").on("dblclick",(function(t,n){f.$apply((function(){e.$broadcast("reloadDomainRangeGraphView",t,n)}))})),k.filter((function(e){return e.objectPropClassName&&e.objectPropClassUri!==G})).append("text").attr("class",(function(e){return e.classPosition+"-class-label"})).style("font-size",v).text((function(e){return e.objectPropClassName})).on("click",(function(e){t.open("resource?uri="+encodeURIComponent(e.objectPropClassUri),"_blank")}));var I=k.select("text");F.select(".class-node").each((function(){d3.select(this.parentNode).append("text").attr("class","rdf-class-label").style("font-size",(function(e){return o.a.Text.calcFontSize(B,g)})).text(B).on("click",(function(e){t.open("resource?uri="+encodeURIComponent(G),"_blank")}))}));var N=F.select(".class-node + text"),L=d3.select(".class-node"),D=d3.selectAll(".loop-link-background"),P=d3.selectAll(".loop-link-property-name");if(_=d3.selectAll(".property-name"),!angular.isUndefined(u)){var q=[];D.each((function(e,t){d3.select(this);q.push({idx:t,width:e.calculatedWidth,height:e.calculatedHeight})}))}b.on("tick",(function(e){var t=8*e.alpha;function n(e){var t=e.x+2*g,n=e.y-g/1.9;var r=[];D.each((function(o,i){r.push(o),i<h?function(r,o){var i=$.grep(q,(function(e){return e.idx==o}));o>0&&(t+=parseFloat(o*(i[0].height/(o/1.4)))),r.attr({transform:"rotate(270, "+e.x+","+e.y+") translate("+t+","+n+")",width:i[0].height,height:i[0].width})}(d3.select(this),i):d3.select(this).remove()})),function(e){var t;d3.select(".view-more-preds-label").style("font-weight","bold").each((function(n){n.target.allEdges=e,t=this.getComputedTextLength()})).on("click",E),d3.select(".view-more-preds-rect").attr("height",t+2*T)}(r)}s.filter((function(e){return e.objectPropNodeClassUri!==G})).attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.targetX})).attr("y2",(function(e){return e.targetY})).each((function(e){!function(e){"objectLeft"===e.propertyType?(e.source.x-=8*t,e.source.y-=t/9):(e.target.x+=8*t,e.target.y-=t/9)}(e);var n=Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x);e.targetX=e.target.x-Math.cos(n)*e.targetRadius,e.targetY=e.target.y-Math.sin(n)*e.targetRadius})),A.each((function(e){"main"!==e.classPosition||angular.isUndefined(u)||(!function(e){var t=e.x+.96*g,n=e.y-g/5.7-5;u.attr("transform","rotate(270, "+e.x+","+e.y+") translate("+t+","+n+")")}(e),function(e){function t(t,n){var r=$.grep(q,(function(e){return e.idx==n})),o=0;n>0&&(o=parseFloat(2*n*(r[0].height/1.4)));var i=e.x,a=e.y-2.1*g-o;t.attr({x:i,y:a}).moveToFront()}P.each((function(e,n){var r=d3.select(this),o=P.size()-h;o<0?t(r,n):(0==n&&!f.collapseEdges&&o>1&&(!function(e,t,n){e.classed("view-more-preds-label",!0).text(n+" predicates more ..."),null!==this.nextSibling&&t.classed("view-more-preds-rect",!0)}(r,d3.select(this.nextSibling),o),t(r,n)),n<h?t(r,n):r.remove())}))}(e),n(e)),e.objectPropClassUri!==G&&d3.select(this).attr("cx",(function(e){return"main"===e.classPosition?function(e){!window.ActiveXObject&&"ActiveXObject"in window&&(Math.log10=function(e){return Math.log(e)/Math.LN10});var t=L.attr("cx")-d/2,n=.5*Math.log10(Math.abs(t));return e.x+=t>0?-n:n,e.x}(e):e.x})).attr("cy",(function(e){return e.y}))})),N.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).moveToFront(),R.filter((function(e){return e.objectPropNodeClassUri!==G})).attr("x",(function(e){return e.target.x>e.source.x?e.source.x+(e.target.x-e.source.x)/2:e.target.x+(e.source.x-e.target.x)/2})).attr("y",(function(e){return e.target.y>e.source.y?e.source.y+(e.target.y-e.source.y)/2:e.target.y+(e.source.y-e.target.y)/2})).moveToFront(),_.attr("x",(function(e){return e.target.x>e.source.x?e.source.x+(e.target.x-e.source.x)/2:e.target.x+(e.source.x-e.target.x)/2})).attr("y",(function(e){return e.target.y>e.source.y?e.source.y+(e.target.y-e.source.y)/2:e.target.y+(e.source.y-e.target.y)/2})).moveToFront(),I.attr("x",(function(e){return"right"===e.classPosition?e.x+1.2*y:e.x-1.2*y})).attr("y",(function(e){return e.y})).moveToFront()})).linkDistance(d/3.5).start()}}))}(f)}),50);f.$on("$destroy",(function(){c.cancel(d)}))}}}angular.module("graphdb.framework.graphexplore.directives.domainrange",["graphdb.framework.graphexplore.controllers.domainrange","graphdb.framework.utils.localstorageadapter"]).constant("ONTO_RED","#F04E23").constant("ONTO_GREEN","#0CB0A0").constant("ONTO_BLUE","#003663").constant("NON_COLLAPSED_REFLEXIVE_LINK_LIMIT",6).directive("domainRangeGraph",i),i.$inject=["$rootScope","$window","$repositories","GraphDataRestService","$location","LocalStorageAdapter","LSKeys","$timeout","toastr","ONTO_RED","ONTO_GREEN","ONTO_BLUE","NON_COLLAPSED_REFLEXIVE_LINK_LIMIT"]},60:function(e,t){function n(e,t){return{restrict:"A",scope:{},templateUrl:"js/angular/graphexplore/templates/systemRepoWarningTemplate.html",link:function(n){n.isSystemRepository=function(){return"SYSTEM"===e.getActiveRepository()},n.hasPermission=function(){return t.hasPermission()}}}}angular.module("graphdb.framework.graphexplore.directives.sysrepo",["graphdb.framework.graphexplore.controllers.class"]).directive("systemRepoWarning",n),n.$inject=["$repositories","$rootScope"]},61:function(e,t){function n(e){return{restrict:"AE",scope:{rdfsLabel:"=",rdfsComment:"=",expanded:"=",alwaysExpanded:"="},templateUrl:"js/angular/graphexplore/templates/rdfsCommentLabelTemplate.html",link:function(t,n){t.stringLimit=e,t.scrollToTop=function(){n[0].getElementsByClassName("rdfs-comment")[0].scrollTop=0},t.checkCommentLength=function(){return n[0].getElementsByClassName("rdfs-comment-text")[0].innerText.length<e},t.equalHeights=function(){const e=n[0].getElementsByClassName("rdfs-comment-text")[0].innerHeight;e<250&&t.expanded&&(n[0].getElementsByClassName("rdfs-comment")[0].innerHeight=e)},t.toggleFullComment=function(){t.expanded=!t.expanded},t.$watch("expanded || alwaysExpanded",(function(n){t.stringLimit=n?t.rdfsComment.length:e}))}}}angular.module("graphdb.framework.graphexplore.directives.rdfsdetails",[]).directive("rdfsCommentLabel",n).constant("SHORT_COMMENT_LENGTH",100),n.$inject=["SHORT_COMMENT_LENGTH"]},62:function(e,t,n){"use strict";n.r(t);var r=n(206);n(37);function o(e,t){return{restrict:"A",template:'<div id="dependencies-chord"></div>',scope:{dependenciesData:"="},link:function(n){n.$watch("dependenciesData",(function(){if(n.dependenciesData){const o=n.dependenciesData;!function(o,i){if(function(){let e=!0;for(const t of o){if(t.some(e=>0!==e)){e=!1;break}}return e}())return;const a=d3.scale.category20(),s=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);d3.select("body").on("click",(function(){s.style("opacity",0)}));const u=Math.min(800,800)/2.8,c=u-24,l=d3.svg.arc().innerRadius(c).outerRadius(u),f=d3.layout.chord().padding(.04).sortSubgroups(d3.descending).sortChords(d3.ascending),d=d3.svg.chord().radius(c),p=d3.select("#dependencies-chord").append("svg").attr("viewBox","0 0 800 800").attr("preserveAspectRatio","xMidYMid meet").style("font","10px sans-serif").append("g").attr("id","circle").attr("transform","translate(400,400)");p.append("circle").attr("r",u).style("fill","none"),f.matrix(o);const h=p.selectAll(".group").data(f.groups).enter().append("g").attr("class","group").on("mouseover",(function(e,t){g.classed("fade",(function(e){return e.source.index!==t&&e.target.index!==t}))}));h.append("title").text((function(e,t){return i[t]})),h.append("path").attr("id",(function(e,t){return"group"+t})).attr("d",l).style("fill",(function(e,t){return a(t)})),h.append("text").each((function(e){e.angle=(e.startAngle+e.endAngle)/2})).attr("dy",".35em").attr("transform",(function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+(c+26)+")"+(e.angle>Math.PI?"rotate(180)":"")})).style("text-anchor",(function(e){return e.angle>Math.PI?"end":null})).text((function(e){return i[e.index]}));const g=p.selectAll(".chord").data(f.chords).enter().append("path").attr("class","chord").style("fill",(function(e){return a(e.target.index)})).style("fill-opacity",".67").style("stroke","#000").style("stroke-width",".25px").style("cursor","pointer").attr("d",d);g.on("mouseover",(function(){d3.select(this).style({"fill-opacity":"1"})})),g.on("mouseout",(function(){d3.select(this).style({"fill-opacity":".67"})})),g.on("click",(function(e){const r=i[e.source.index],o=i[e.target.index],a=d3.event.pageX,u=d3.event.pageY;t.getPredicates(r,o,n.selectedGraph&&n.selectedGraph.contextID.uri).success((function(e){let t="<div class='dependencies-tooltip'>"+("<div class='row'>"+r+" <i class='fa fa-exchange'></i> "+o+"</div>")+_.map(e.slice(0,10),(function(e){const t=" <i class='fa fa-long-arrow-"+("out"===e.direction?"right":"left")+"'></i>";return"<div class='row'>"+e.predicate+" : "+e.weight+t+" </div>"})).join("");e.length>10?t=t+"<div class='pull-right'>And "+(e.length-10).toString()+" more...</div></div>":t+="</div>",s.html(t).style("left",a+"px").style("top",u+"px")})),s.transition().duration(200).style("opacity",1)})),d3.select("#circle").on("mouseleave",(function(){p.selectAll(".chord").classed("fade",!1)})),d3.select("#download-svg").on("mouseover",(function(){const t=r.a.Export.generateBase64ImageSource();d3.select(this).attr({href:t,download:"dependencies-"+e.getActiveRepository()+".svg"})}))}(o.matrix,o.nodes,o.direction)}}))}}}angular.module("graphdb.framework.graphexplore.directives.dependencies",["graphdb.framework.graphexplore.controllers.dependencies","graphdb.framework.rest.graphexplore.data.service"]).directive("dependenciesChord",o),o.$inject=["$repositories","GraphDataRestService"]},63:function(e,t){function n(){return{restrict:"AE",scope:{filterQueryObj:"=",filterFunction:"&",listItemsObj:"=",listItemsNotFiltered:"=",searchPlaceholder:"@"},templateUrl:"js/angular/graphexplore/templates/listItemsSearchFilterTemplate.html",link:function(e){e.filterFunction=e.filterFunction(),e.$watch("filterQueryObj.query",(function(){var t,n,r,o;e.listItemsObj.items=(t=e.filterQueryObj.query,n=e.listItemsObj.items,r=e.listItemsNotFiltered,o=e.filterFunction,t.length>0?_.filter(r,o):n.length!==r.length?r:n)}))}}}angular.module("graphdb.framework.graphexplore.directives.searchfilter",[]).directive("listItemsSearchFilter",n),n.$inject=[]},64:function(e,t){function n(e,t){return{restrict:"AE",scope:{searchData:"=",searchFields:"@",titleField:"@",searchPlaceholder:"@",initialValue:"=",searchedObjCallback:"&"},templateUrl:"js/angular/graphexplore/templates/searchIconInputTemplate.html",link:function(n,r){n.searchedObjCallback=n.searchedObjCallback(),n.performSearchActionOnEnter=function(){e.$broadcast("onEnterKeypressSearchAction")},n.showInput=function(){$("#selectGraphDropdown").hide(),r.find("#search_input #search_input_value")[0].value="",r.find(".search-icon").addClass("animated bounceOut").css("z-index","-1"),r.find("#search_input .angucomplete-holder").css("display","block"),t((function(){r.find("#search_input .angucomplete-holder").css("width","250px").css("left","-215px"),t((function(){r.find(".close-icon").css("display","block").addClass("animated bounceIn").css("z-index","3"),r.find("#search_input #search_input_value").focus()}),200)}),1)},n.hideInput=function(){r.find("#search_input #search_input_value")[0].value="",r.find("#search_input .angucomplete-holder").css("width","0px").css("left","35px"),t((function(){r.find("#search_input .angucomplete-holder").css("display","none"),$("#selectGraphDropdown").show()}),250),r.find(".close-icon").addClass("animated bounceOut").removeClass("bounceOut").css("z-index","-1").css("display","none").click((function(){$(".tooltip").hide()})),t((function(){r.find(".search-icon").css("display","inline-block").removeClass("bounceOut").addClass("bounceIn").css("z-index","3")}),200)}}}}angular.module("graphdb.framework.graphexplore.directives.searchcontrols",[]).directive("searchIconInput",n),n.$inject=["$rootScope","$timeout"]},94:function(e,t,n){"use strict";n.r(t);n(2),n(13),n(7),n(8),n(220),n(221),n(215),n(213),n(208),n(222),n(224),n(225),n(217),n(205),n(214),n(206),n(37),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(56),n(57),n(58),n(59),n(60),n(61),n(62),n(63),n(64),n(33),n(34);angular.module("graphdb.framework.graphexplore",["graphdb.framework.core.controllers","graphdb.framework.core.directives","graphdb.framework.rest.graphexplore.data.service","graphdb.framework.graphexplore.services.uiscroll","graphdb.framework.graphexplore.services.rdfsdetails","graphdb.framework.rest.graphexplore.savedgraphs.service","graphdb.framework.rest.graphconfig.service","graphdb.framework.graphexplore.controllers.class","graphdb.framework.graphexplore.controllers.domainrange","graphdb.framework.graphexplore.controllers.dependencies","graphdb.framework.graphexplore.controllers.graphviz","graphdb.framework.graphexplore.controllers.graphviz.config","graphdb.framework.graphexplore.directives.sysrepo","graphdb.framework.graphexplore.directives.rdfsdetails","graphdb.framework.graphexplore.directives.searchfilter","graphdb.framework.graphexplore.directives.class","graphdb.framework.graphexplore.directives.domainrange","graphdb.framework.graphexplore.directives.dependencies","graphdb.framework.graphexplore.directives.searchcontrols","graphdb.framework.core.directives.queryeditor.controllers","graphdb.framework.core.directives.queryeditor.queryeditor"])}}]);
//# sourceMappingURL=14.c7175f400470b470e034.bundle.js.map