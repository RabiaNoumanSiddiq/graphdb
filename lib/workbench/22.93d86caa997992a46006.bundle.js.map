{"version":3,"sources":["webpack:///./src/js/lib/common/d3-utils.js","webpack:///./src/js/lib/common/svg-export.js","webpack:///./src/js/lib/d3-tip/d3-tip-patch.js","webpack:///./src/js/lib/common/circle-packing.js","webpack:///./src/js/angular/graphexplore/directives/rdf-class-hierarchy.directive.js"],"names":["D3","Text","calcFontSizeRaw","text","radius","minimumSize","isMultiline","textSize","substring","length","match","Math","round","calcFontSize","getTextWithElipsisIfNeeded","str","threshold","Transition","fadeIn","sel","duration","style","transition","fadeOut","Click","delayDblClick","event","d3","dispatch","rebind","selection","down","wait","on","mouse","document","body","Date","d","a","b","sqrt","pow","window","clearTimeout","dblclick","setTimeout","click","SVG","Export","getCSSRules","cssSourceFilePath","cssRules","$","sheet","rules","cssStr","_","each","value","cssText","generateBase64ImageSource","exportSvg","selectAll","attr","version","xmlns","node","parentNode","innerHTML","btoa","unescape","encodeURIComponent","direction","offset","html","initNode","svg","point","target","customPosition","tip","vis","el","tagName","toLowerCase","ownerSVGElement","createSVGPoint","appendChild","show","args","Array","prototype","slice","call","arguments","SVGElement","pop","coords","content","apply","this","poffset","dir","nodel","getNodeEl","i","directions","scrollTop","documentElement","scrollLeft","customPos","opacity","classed","direction_callbacks","get","top","left","hide","n","v","functor","destroy","remove","map","bbox","getScreenBBox","y","offsetHeight","x","offsetWidth","s","e","w","nw","ne","sw","se","keys","select","createElement","position","targetel","getScreenCTM","matrix","tbbox","getBBox","width","height","matrixTransform","CirclePacking","SingleChild","addPlaceholders","first","children","placeholderSize","size","push","name","removePlaceholders","nodes","splice","centerNodes","reposition","makePositionsRelativeToZero","offsetX","offsetY","classHierarchyDirective","$rootScope","$location","GraphDataRestService","$window","$timeout","$repositories","toastr","ZOOM_DURATION","ROOT_OBJ_NAME","LocalStorageAdapter","LSKeys","restrict","template","scope","classHierarchyData","flattenedClassNames","selectedClass","currentSliderValue","showClassInfoPanel","showExternalElements","hidePrefixes","currentBrowserLimit","link","element","attrs","diameter","margin","pack","layout","color","scale","linear","domain","range","interpolate","interpolateHcl","insert","appendMainGroup","append","id","transform","getPrefixesState","CLASS_HIERARCHY_HIDE_PREFIXES","prepareForSVGImageExport","imgSrc","href","download","getActiveRepository","autoZoomToPreviousState","doFocus","g","classCount","isSystemRepository","loader","hierarchyError","selGraphFromCache","getClassHierarchyData","contextID","uri","success","response","status","headers","warning","error","getError","oldRoot","focus","rootFocusEvent","classSearchEvent","prefixesWatch","currentClassCountWatch","searchedClassBroadcast","onEnterClassSearchBroadcast","flattenedClassData","drawDiagram","root","config","newFocus","switchPrefixes","view","isInFocusTransitive","bottom","innerHeight","clientY","right","innerWidth","clientX","circleGroup","data","enter","doFade","circle","role","depth","key","noPrefixes","textHidden","getCurrentClassDataAndMarkSelected","obj","selected","closeClassInfoPanel","uniqBy","clickCancel","zoom","$on","history","pushState","$broadcast","stopPropagation","lastTimeWheel","preventDefault","now","getTime","deltaY","__data__","parent","newobj","sortingRank","replaceState","sendSliderData","textSel","idx","indexOf","noPrefixName","r","textContent","keepPrevState","focusOnCurrentClass","focusHistoryId","hash","onpopstate","state","zoomTo","k","fullName","topLevelParentUri","c","adjustRadius","newr","textUpdateStart","display","textUpdateEnd","shouldClosePanel","p","tween","interpolateZoom","t","currentClassCount","CLASS_HIERARCHY_CURRENT_SLIDER_VALUE","set","addEventListener","removeResizeListener","removeEventListener","$watch","initialPrefixesState","angular","copy","newRoot","noPrefixesGlobal","sorted","sort","sortRoot","restoreDiagramState","currentRoot","prefixesConfig","CLASS_HIERARCHY_SWITCH_PREFIXES","redrawFilteredDiagram","sortedRoot","useSlider","addedIds","Set","add","fixChildren","newChildren","has","extend","isUndefined","currentSearchedClass","basicConfig","undefined","savePrefixesState","searchedClass","renderCirclePacking","module","constant","directive","$inject"],"mappings":"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","file":"22.93d86caa997992a46006.bundle.js","sourcesContent":["var D3 = D3 || {};\n\nD3.Text = function () {\n    function calcFontSizeRaw(text, radius, minimumSize, isMultiline) {\n        minimumSize = minimumSize || 10;\n\n        var textSize = radius / 3;\n        if (typeof text === \"string\") {\n            var len = text.substring(0, radius / 3).length + 1.5;\n            textSize *= 10 / len;\n            textSize += 1;\n            // experimental alternative method:\n            // var textSize = 3.3 * radius / text.length;\n\n            // Tweak for Indian scripts and CJK ones\n            if (text.match(/[\\u0900-\\u0DFF\\u1100-\\u11FF\\u2E80-\\u2EFF\\u3000-\\u9FFF]/)) {\n                textSize *= 0.6;\n            }\n\n            if (textSize < minimumSize) {\n                textSize = minimumSize;\n            }\n\n            /* Disabled for the time being, better without this\n            if (isMultiline) {\n                var numWords = text.split(/\\s+/).length;\n                if (numWords > 1) {\n                    if (numWords > 4) {\n                        numWords = 4;\n                    }\n                    textSize += textSize * (4 - numWords) * 0.1;\n                }\n            }\n            */\n\n            return Math.round(textSize);\n        }\n\n        if (textSize < minimumSize) {\n            textSize = minimumSize;\n        }\n\n        return Math.round(textSize);\n    }\n\n    function calcFontSize(text, radius, minimumSize, isMultiline) {\n        return calcFontSizeRaw(text, radius, minimumSize, isMultiline) + 'px';\n    }\n\n    function getTextWithElipsisIfNeeded(str, threshold) {\n        if (typeof str === \"string\") {\n            if (str.length > threshold) {\n                return str.substring(0, threshold - 3) + \"...\";\n            }\n        }\n        return str;\n    }\n\n    return {\n        calcFontSizeRaw: calcFontSizeRaw,\n        calcFontSize: calcFontSize,\n        getTextWithElipsisIfNeeded: getTextWithElipsisIfNeeded\n    };\n}();\n\nD3.Transition = function () {\n    function fadeIn(sel, duration) {\n        sel.style(\"opacity\", 0.0)\n            .transition()\n            .duration(duration)\n            .style(\"opacity\", 1.0);\n    }\n\n    function fadeOut(sel, duration) {\n        sel.style(\"opacity\", 1.0)\n            .transition()\n            .duration(duration)\n            .style(\"opacity\", 0.0);\n    }\n\n    return {\n        fadeIn: fadeIn,\n        fadeOut: fadeOut\n    };\n}();\n\nD3.Click = function () {\n    function delayDblClick() {\n        var event = d3.dispatch('click', 'dblclick');\n\n        function cc(selection) {\n            var down,\n                tolerance = 5,\n                last,\n                wait = null;\n\n            // euclidean distance\n            function dist(a, b) {\n                return Math.sqrt(Math.pow(a[0] - b[0], 2), Math.pow(a[1] - b[1], 2));\n            }\n\n            selection.on('mousedown', function () {\n                down = d3.mouse(document.body);\n                last = +new Date();\n            });\n            selection.on('mouseup', function (d) {\n                if (dist(down, d3.mouse(document.body)) > tolerance) {\n                    return;\n                } else {\n                    if (wait) {\n                        window.clearTimeout(wait);\n                        wait = null;\n                        event.dblclick(d);\n                    } else {\n                        wait = window.setTimeout((function (e) {\n                            return function () {\n                                event.click(d);\n                                wait = null;\n                            };\n                        })(d3.event), 250);\n                    }\n                }\n            });\n        }\n\n        return d3.rebind(cc, event, 'on');\n    }\n\n    return {\n        delayDblClick: delayDblClick\n    };\n}();\n\nexport default D3;\n","var SVG = SVG || {};\n\nSVG.Export = function () {\n    function getCSSRules(cssSourceFilePath) {\n        var cssRules = $('link[href=\"' + cssSourceFilePath + '\"]')[0].sheet.rules;\n        var cssStr = \"\";\n        _.each(cssRules, function (value) {\n            cssStr += value.cssText;\n        });\n        return cssStr;\n    }\n\n    function generateBase64ImageSource() {\n        // add needed xml namespace\n        var exportSvg = d3.selectAll(\"svg\")\n            .attr({\n                version: \"1.1\",\n                xmlns: \"http://www.w3.org/2000/svg\"\n            })\n            .node().parentNode.innerHTML;\n\n        // convert selected html to base64\n        return \"data:image/svg+xml;charset=utf-8;base64,\" + btoa(unescape(encodeURIComponent(exportSvg)));\n    }\n\n    return {\n        getCSSRules: getCSSRules,\n        generateBase64ImageSource: generateBase64ImageSource\n    };\n}();\n\nexport default SVG;\n","// d3.tip\n// Copyright (c) 2013 Justin Palmer\n//\n// Tooltips for d3.js SVG visualizations\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module with d3 as a dependency.\n        define([], factory)\n    } else if (typeof module === 'object' && module.exports) {\n        // CommonJS\n        module.exports = function(d3) {\n            d3.tip = factory(d3)\n            return d3.tip\n        }\n    } else {\n        // Browser global.\n        root.d3.tip = factory(root.d3)\n    }\n}(this, function () {\n    // Public - contructs a new tooltip\n    //\n    // Returns a tip\n    return function() {\n        var direction = d3_tip_direction,\n            offset    = d3_tip_offset,\n            html      = d3_tip_html,\n            node      = initNode(),\n            svg       = null,\n            point     = null,\n            target    = null,\n            customPosition = null\n\n        function tip(vis) {\n            svg = getSVGNode(vis)\n            point = svg.createSVGPoint()\n            document.body.appendChild(node)\n        }\n\n        // Public - show the tooltip on the screen\n        //\n        // Returns a tip\n        tip.show = function() {\n            var args = Array.prototype.slice.call(arguments)\n            if(args[args.length - 1] instanceof SVGElement) target = args.pop()\n\n            var content = html.apply(this, args),\n                poffset = offset.apply(this, args),\n                dir     = direction.apply(this, args),\n                nodel   = getNodeEl(),\n                i       = directions.length,\n                coords,\n                scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,\n                scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft,\n                customPos = customPosition.apply(this, args)\n\n            nodel.html(content)\n                .style({ opacity: 1, 'pointer-events': 'all' })\n\n            while(i--) nodel.classed(directions[i], false)\n            coords = direction_callbacks.get(dir).apply(this)\n\n            if (customPos) {\n                nodel.style(customPos)\n            } else {\n                nodel.classed(dir, true).style({\n                    top: (coords.top +  poffset[0]) + scrollTop + 'px',\n                    left: (coords.left + poffset[1]) + scrollLeft + 'px'\n                })\n            }\n\n            return tip\n        }\n\n        // Public - hide the tooltip\n        //\n        // Returns a tip\n        tip.hide = function() {\n            var nodel = getNodeEl()\n            nodel.style({ opacity: 0, 'pointer-events': 'none' })\n            return tip\n        }\n\n        // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.\n        //\n        // n - name of the attribute\n        // v - value of the attribute\n        //\n        // Returns tip or attribute value\n        tip.attr = function(n, v) {\n            if (arguments.length < 2 && typeof n === 'string') {\n                return getNodeEl().attr(n)\n            } else {\n                var args =  Array.prototype.slice.call(arguments)\n                d3.selection.prototype.attr.apply(getNodeEl(), args)\n            }\n\n            return tip\n        }\n\n        // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.\n        //\n        // n - name of the property\n        // v - value of the property\n        //\n        // Returns tip or style property value\n        tip.style = function(n, v) {\n            if (arguments.length < 2 && typeof n === 'string') {\n                return getNodeEl().style(n)\n            } else {\n                var args =  Array.prototype.slice.call(arguments)\n                d3.selection.prototype.style.apply(getNodeEl(), args)\n            }\n\n            return tip\n        }\n\n        // Public: Set or get the direction of the tooltip\n        //\n        // v - One of n(north), s(south), e(east), or w(west), nw(northwest),\n        //     sw(southwest), ne(northeast) or se(southeast)\n        //\n        // Returns tip or direction\n        tip.direction = function(v) {\n            if (!arguments.length) return direction\n            direction = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        // Public: Sets or gets the offset of the tip\n        //\n        // v - Array of [x, y] offset\n        //\n        // Returns offset or\n        tip.offset = function(v) {\n            if (!arguments.length) return offset\n            offset = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        // Public: sets or gets the html value of the tooltip\n        //\n        // v - String value of the tip\n        //\n        // Returns html value or tip\n        tip.html = function(v) {\n            if (!arguments.length) return html\n            html = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        tip.customPosition = function(v) {\n            if (!arguments.length) return customPosition\n            customPosition = v == null ? v : d3.functor(v)\n\n            return tip\n        }\n\n        // Public: destroys the tooltip and removes it from the DOM\n        //\n        // Returns a tip\n        tip.destroy = function() {\n            if(node) {\n                getNodeEl().remove();\n                node = null;\n            }\n            return tip;\n        }\n\n        function d3_tip_direction() { return 'n' }\n        function d3_tip_offset() { return [0, 0] }\n        function d3_tip_html() { return ' ' }\n\n        var direction_callbacks = d3.map({\n                n:  direction_n,\n                s:  direction_s,\n                e:  direction_e,\n                w:  direction_w,\n                nw: direction_nw,\n                ne: direction_ne,\n                sw: direction_sw,\n                se: direction_se\n            }),\n\n            directions = direction_callbacks.keys()\n\n        function direction_n() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.n.y - node.offsetHeight,\n                left: bbox.n.x - node.offsetWidth / 2\n            }\n        }\n\n        function direction_s() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.s.y,\n                left: bbox.s.x - node.offsetWidth / 2\n            }\n        }\n\n        function direction_e() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.e.y - node.offsetHeight / 2,\n                left: bbox.e.x\n            }\n        }\n\n        function direction_w() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.w.y - node.offsetHeight / 2,\n                left: bbox.w.x - node.offsetWidth\n            }\n        }\n\n        function direction_nw() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.nw.y - node.offsetHeight,\n                left: bbox.nw.x - node.offsetWidth\n            }\n        }\n\n        function direction_ne() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.ne.y - node.offsetHeight,\n                left: bbox.ne.x\n            }\n        }\n\n        function direction_sw() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.sw.y,\n                left: bbox.sw.x - node.offsetWidth\n            }\n        }\n\n        function direction_se() {\n            var bbox = getScreenBBox()\n            return {\n                top:  bbox.se.y,\n                left: bbox.e.x\n            }\n        }\n\n        function initNode() {\n            var node = d3.select(document.createElement('div'))\n            node.style({\n                position: 'absolute',\n                top: 0,\n                opacity: 0,\n                'pointer-events': 'none',\n                'box-sizing': 'border-box'\n            })\n\n            return node.node()\n        }\n\n        function getSVGNode(el) {\n            el = el.node()\n            if(el.tagName.toLowerCase() === 'svg')\n                return el\n\n            return el.ownerSVGElement\n        }\n\n        function getNodeEl() {\n            if(node === null) {\n                node = initNode();\n                // re-add node to DOM\n                document.body.appendChild(node);\n            };\n            return d3.select(node);\n        }\n\n        // Private - gets the screen coordinates of a shape\n        //\n        // Given a shape on the screen, will return an SVGPoint for the directions\n        // n(north), s(south), e(east), w(west), ne(northeast), se(southeast), nw(northwest),\n        // sw(southwest).\n        //\n        //    +-+-+\n        //    |   |\n        //    +   +\n        //    |   |\n        //    +-+-+\n        //\n        // Returns an Object {n, s, e, w, nw, sw, ne, se}\n        function getScreenBBox() {\n            var targetel   = target || d3.event.target;\n\n            while ('undefined' === typeof targetel.getScreenCTM && 'undefined' === targetel.parentNode) {\n                targetel = targetel.parentNode;\n            }\n\n            var bbox       = {},\n                matrix     = targetel.getScreenCTM(),\n                tbbox      = targetel.getBBox(),\n                width      = tbbox.width,\n                height     = tbbox.height,\n                x          = tbbox.x,\n                y          = tbbox.y\n\n            point.x = x\n            point.y = y\n            bbox.nw = point.matrixTransform(matrix)\n            point.x += width\n            bbox.ne = point.matrixTransform(matrix)\n            point.y += height\n            bbox.se = point.matrixTransform(matrix)\n            point.x -= width\n            bbox.sw = point.matrixTransform(matrix)\n            point.y -= height / 2\n            bbox.w  = point.matrixTransform(matrix)\n            point.x += width\n            bbox.e = point.matrixTransform(matrix)\n            point.x -= width / 2\n            point.y -= height / 2\n            bbox.n = point.matrixTransform(matrix)\n            point.y += height\n            bbox.s = point.matrixTransform(matrix)\n\n            return bbox\n        }\n\n        return tip\n    };\n\n}));","var CirclePacking = CirclePacking || {};\n\nCirclePacking.SingleChild = function () {\n    /*\n     Functions that enable single child circles to display properly, see\n     http://stackoverflow.com/questions/22307486/d3-js-packed-circle-layout-how-to-adjust-child-radius\n     */\n    function addPlaceholders(node, first) {\n        if (node.children) {\n            for (var i = 0; i < node.children.length; i++) {\n                var child = node.children[i];\n                addPlaceholders(child);\n            }\n\n            if (node.children.length === 1) {\n                var placeholderSize = node.size * 1.2;\n                if (first) {\n                    placeholderSize = node.children[0].size * 0.1;\n                }\n                node.children.push({\n                    name: 'placeholder', size: placeholderSize,\n                    // children: []\n                });\n            }\n        }\n    }\n\n    function removePlaceholders(nodes) {\n        for (var i = nodes.length - 1; i >= 0; i--) {\n            var node = nodes[i];\n\n            if (node.name === 'placeholder') {\n                nodes.splice(i, 1);\n            } else {\n                if (node.children) {\n                    removePlaceholders(node.children);\n                }\n            }\n        }\n    }\n\n    function centerNodes(nodes) {\n        for (var i = 0; i < nodes.length; i++) {\n            var node = nodes[i];\n\n            if (node.children) {\n                if (node.children.length === 1) {\n                    var offset = node.x - node.children[0].x;\n                    node.children[0].x += offset;\n                    reposition(node.children[0], offset);\n                }\n            }\n        }\n\n        function reposition(node, offset) {\n            if (node.children) {\n                for (var i = 0; i < node.children.length; i++) {\n                    node.children[i].x += offset;\n                    reposition(node.children[i], offset);\n                }\n            }\n        }\n    }\n\n    function makePositionsRelativeToZero(nodes) {\n        //use this to have vis centered at 0,0,0 (easier for positioning)\n        var offsetX = nodes[0].x;\n        var offsetY = nodes[0].y;\n\n        for (var i = 0; i < nodes.length; i++) {\n\n            var node = nodes[i];\n\n            node.x -= offsetX;\n            node.y -= offsetY;\n        }\n    }\n\n    return {\n        addPlaceholders: addPlaceholders,\n        removePlaceholders: removePlaceholders,\n        centerNodes: centerNodes,\n        makePositionsRelativeToZero: makePositionsRelativeToZero\n    }\n}();\n\nexport default CirclePacking;\n","import d3tip from 'lib/d3-tip/d3-tip-patch';\nimport CirclePacking from 'lib/common/circle-packing';\nimport D3 from 'lib/common/d3-utils';\nimport SVG from 'lib/common/svg-export';\nimport 'angular/utils/local-storage-adapter';\n\nangular\n    .module('graphdb.framework.graphexplore.directives.class', [\n        'graphdb.framework.graphexplore.controllers.class',\n        'graphdb.framework.utils.localstorageadapter'\n    ])\n    .constant(\"ZOOM_DURATION\", 500)\n    .constant(\"ROOT_OBJ_NAME\", \"RDF Class Hierarchy\")\n    .directive('rdfClassHierarchy', classHierarchyDirective);\n\nclassHierarchyDirective.$inject = ['$rootScope', '$location', 'GraphDataRestService', '$window', '$timeout', '$repositories', 'toastr', 'ZOOM_DURATION', 'ROOT_OBJ_NAME', 'LocalStorageAdapter', 'LSKeys'];\n\nfunction classHierarchyDirective($rootScope, $location, GraphDataRestService, $window, $timeout, $repositories, toastr, ZOOM_DURATION, ROOT_OBJ_NAME, LocalStorageAdapter, LSKeys) {\n    return {\n        restrict: 'AE',\n        template: '<div id=\"classChart\"></div>',\n        scope: {\n            classHierarchyData: '=',\n            flattenedClassNames: '=',\n            selectedClass: '=',\n            currentSliderValue: '=',\n            showClassInfoPanel: '=',\n            showExternalElements: '=',\n            hidePrefixes: '=',\n            currentBrowserLimit: '='\n        },\n        link: linkFunc\n    };\n\n    function linkFunc(scope, element, attrs) {\n        renderCirclePacking(scope, element);\n    }\n\n    function renderCirclePacking(scope, element) {\n\n        var width = 800,\n            height = 800,\n            diameter = height,\n            margin = 20,\n            node,\n            root;\n\n        var pack = d3.layout.pack()\n            .size([diameter - margin, diameter - margin])\n            .value(function (d) {\n                return d.size;\n            });\n\n        var colors = [\n            \"hsl(33, 75%, 75%)\",\n            \"hsl(213, 75%, 75%)\",\n            \"hsl(333, 75%, 75%)\",\n            \"hsl(153, 75%, 75%)\",\n            \"hsl(273, 75%, 75%)\",\n            \"hsl(93, 75%, 75%)\"\n        ];\n\n        var color = d3.scale.linear()\n            .domain([0, 4])\n            .range([\"hsl(19, 70%, 90%)\", \"hsl(19, 70%, 50%)\"])\n            .interpolate(d3.interpolateHcl);\n\n        var svg = d3.select(\"#classChart\")\n            .insert(\"svg:svg\", \"h2\")\n            .attr(\"viewBox\", \"0 0 \" + width + \" \" + height)\n            .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n            .on(\"dblclick.zoom\", null);\n\n        function appendMainGroup() {\n            return svg.append(\"svg:g\")\n                .attr({\n                    id: \"main-group\",\n                    transform: \"translate(\" + width / 2 + \",\" + height / 2 + \")\"\n                });\n        }\n\n        function savePrefixesState(hidePrefixes) {\n            if (!angular.isUndefined(hidePrefixes)) {\n                LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_HIDE_PREFIXES, hidePrefixes);\n            }\n        }\n\n        function getPrefixesState() {\n            return LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_HIDE_PREFIXES) === \"true\";\n        }\n\n        /*\n         * Prepares SVG document image export by adding xml namespaces and\n         * additional style information\n         */\n        function prepareForSVGImageExport() {\n            // get css rules for the diagram\n            var cssRules = SVG.Export.getCSSRules(\"css/rdf-class-hierarchy-labels.css?v=1.10.2\");\n            // inline css rules in a defs tag\n            d3.selectAll(\"#main-group\")\n                .append(\"defs\");\n            $(\"defs\").append('<style type=\"text/css\"><![CDATA[' + cssRules + ']]></style>');\n\n            // switch opacity to visible\n            d3.selectAll(\"g\")\n                .style(\"opacity\", 1);\n\n            // convert selected html to base64\n            var imgSrc = SVG.Export.generateBase64ImageSource();\n\n            // set the binary image and a name for the downloadable file on the export button\n            d3.select(this).attr({\n                href: imgSrc,\n                download: \"class-hierarchy-\" + $repositories.getActiveRepository() + \".svg\"\n            });\n        }\n\n        scope.hidePrefixes = getPrefixesState();\n\n        var g = appendMainGroup();\n\n        if (!scope.classHierarchyData.classCount && $repositories.getActiveRepository() && !$repositories.isSystemRepository()) {\n            $rootScope.loader = true;\n            $rootScope.hierarchyError = false;\n            const selGraphFromCache = LocalStorageAdapter.get(`classHierarchy-selectedGraph-${$repositories.getActiveRepository()}`);\n            GraphDataRestService.getClassHierarchyData(selGraphFromCache !== null ? selGraphFromCache.contextID.uri : \"\")\n                .success(function (response, status, headers) {\n                    $rootScope.loader = false;\n                    if (status === 207) {\n                        toastr.warning(\"You can update the diagram by pressing the reload button.\", \"Repository data has changed\");\n                    }\n                    scope.classHierarchyData = response;\n\n                    d3.select(\"#download-svg\")\n                        .on(\"mouseover\", prepareForSVGImageExport);\n\n                }).error(function (response) {\n                $rootScope.loader = false;\n                $rootScope.hierarchyError = getError(response);\n                toastr.error(\"Request for \" + ROOT_OBJ_NAME + \" failed! \" + getError(response));\n            });\n        }\n\n\n        var autoZoomToPreviousState,\n            doFocus;\n\n        var oldRoot,\n            focus,\n            rootFocusEvent,\n            classSearchEvent,\n            flattenedClassData = {};\n\n        function drawDiagram(root, config, newFocus, switchPrefixes) {\n            if (rootFocusEvent) rootFocusEvent();\n            if (classSearchEvent) classSearchEvent();\n            // remove old group tag containing the diagram\n            d3.selectAll(\"#main-group\").remove();\n\n            // append new empty group tag in order to rerender new diagram\n            g = appendMainGroup();\n\n            // fix for single child classes\n            CirclePacking.SingleChild.addPlaceholders(root, true);\n            focus = newFocus ? newFocus : root;\n\n            var nodes = pack.nodes(root),\n                view;\n\n            focus.isInFocusTransitive = true;\n\n            // fixes for single child classes\n            CirclePacking.SingleChild.removePlaceholders(nodes);\n            CirclePacking.SingleChild.centerNodes(nodes);\n            CirclePacking.SingleChild.makePositionsRelativeToZero(nodes);\n\n            var tip = d3tip()\n                .attr('class', 'd3-tip')\n                //.offset([-10, 0])\n                .customPosition(function (d) {\n                    return {\n                        top: 'inherit',\n                        bottom: ($window.innerHeight - d3.event.clientY) + 'px',\n                        right: ($window.innerWidth - d3.event.clientX) + 'px'\n                    };\n                })\n                .html(function (d) {\n                    return d.name;\n                });\n\n            svg.call(tip);\n\n            var circleGroup = g.selectAll(\"circle\")\n                .data(nodes)\n                .enter().append(\"g\");\n\n            if (config.doFade) {\n                circleGroup.each(function (d) {\n                    D3.Transition.fadeIn(d3.select(this), 550);\n                });\n            }\n\n            var flattenedClassNames = [];\n\n            var circle = circleGroup\n                .append(\"circle\")\n                .attr(\"class\", function (d) {\n                    return d.role;\n                })\n                .style(\"fill\", function (d) {\n                    //return colors[d.depth % 6];\n                    return d.children ? color(d.depth) : \"#E0D0D0\";\n                })\n                .each(function (d) {\n                    d.circle = d3.select(this);\n                    if (d.name !== ROOT_OBJ_NAME) {\n                        var key = d.name;\n                        flattenedClassNames.push({name: key});\n                        flattenedClassData[[key]] = d;\n\n                        d.circle.classed(\"rdf-class\", true);\n                        d.circle.on('mouseover', function () {\n                            if (config.noPrefixes) {\n                                tip.show(d);\n                            } else if (!d.textHidden) {\n                                tip.hide(d);\n                            } else {\n                                tip.show(d);\n                            }\n                        });\n                        d.circle.on('mouseout', tip.hide);\n                    }\n                });\n\n            if (flattenedClassNames) {\n                flattenedClassNames = _.uniqBy(flattenedClassNames, 'name');\n                scope.flattenedClassNames = flattenedClassNames;\n            }\n\n            var selectedClass;\n\n            function getCurrentClassDataAndMarkSelected(obj) {\n                d3.selectAll(\".selected\").classed(\"selected\", obj.selected = false);\n                obj.circle.classed(\"selected\", obj.selected = true);\n                selectedClass = obj;\n            }\n\n            function showClassInfoPanel() {\n                scope.selectedClass = selectedClass;\n                scope.showClassInfoPanel = true;\n            }\n\n            function closeClassInfoPanel() {\n                scope.showClassInfoPanel = false;\n            }\n\n            function goToDomainRangeGraphView() {\n                $rootScope.$broadcast('goToDomainRangeGraphView', selectedClass, focus);\n            }\n\n            var clickCancel = D3.Click.delayDblClick();\n            var parentCircles = d3.selectAll(\".parent, .topLevelParent, .child, .root\")\n                .call(clickCancel);\n\n            doFocus = function (obj) {\n                zoom(obj);\n\n                if (obj.name === ROOT_OBJ_NAME) {\n                    closeClassInfoPanel();\n                    d3.selectAll(\".selected\").classed(\"selected\", false);\n                } else {\n                    getCurrentClassDataAndMarkSelected(obj);\n                    showClassInfoPanel();\n\n                    // FIXME: is it ok to bind this event handler every time and not just once?\n                    scope.$on('sidePanelClosed', function (event) {\n                        d3.selectAll(\".selected\").classed(\"selected\", obj.selected = false);\n                    });\n                }\n\n\n                //do not stop event propagation here\n            };\n\n            clickCancel.on(\"click\", function (obj) {\n                // add clicked class to browser history\n                if (obj.id) {\n                    $window.history.pushState({id: obj.id}, \"classHierarchyPage\" + obj.id, \"hierarchy#\" + obj.id);\n                }\n\n                //hide current d3-tip tooltip\n                tip.hide();\n\n                doFocus(obj);\n            });\n\n            clickCancel.on(\"dblclick\", function (obj) {\n                if (obj === root) {\n                    return;\n                }\n                // hide current d3-tip tooltip in order not to appear in the next view\n                tip.hide();\n                getCurrentClassDataAndMarkSelected(obj);\n                goToDomainRangeGraphView();\n\n                d3.event.stopPropagation();\n            });\n\n            var lastTimeWheel = 0;\n            svg.on('wheel', function () {\n                // hide current d3-tip tooltip\n                tip.hide();\n\n                var e = d3.event;\n                e.preventDefault();\n                e.stopPropagation();\n\n                // at least 100ms must have passed since last time we updated\n                var now = new Date().getTime();\n                if (now - lastTimeWheel > 100) {\n                    lastTimeWheel = now;\n                } else {\n                    return;\n                }\n\n                var direction = '';\n                if (e.deltaY <= -1) {\n                    direction = 'in';\n                } else if (e.deltaY >= 1) {\n                    direction = 'out';\n                }\n\n                var obj = e.target.__data__;\n\n                if (!obj) {\n                    // scroll outside the big circle\n                    obj = focus;\n                }\n\n                if (direction === 'in') {\n                    // determine object to zoom to\n\n                    if (obj !== focus) {\n                        // consider the object on which the scroll event occurred\n                        // and find the furthest parent that has no focused children\n                        while (obj.parent && !obj.parent.isInFocusTransitive) {\n                            obj = obj.parent;\n                        }\n                        if (obj.depth < focus.depth) {\n                            // however if that parent is of lower depth than the focus we ignore it\n                            obj = focus;\n                        }\n                    }\n\n                    if (obj === focus && obj.children) {\n                        // if object is in focus and it has children we zoom to its biggest child\n                        // TODO: sort children on backend\n                        var newobj = obj.children[0];\n                        for (var i = 1; i < obj.children.length; i++) {\n                            if (obj.children[i].sortingRank > newobj.sortingRank) {\n                                newobj = obj.children[i];\n                            }\n                        }\n                        obj = newobj;\n                    }\n\n                    zoom(obj, true);\n                } else if (direction === 'out') {\n                    // zooming out simply goes one parent up\n                    obj = focus.parent;\n                    if (obj) {\n                        zoom(obj, true);\n                    }\n                }\n\n                if (focus.name === ROOT_OBJ_NAME) {\n                    $window.history.replaceState({id: 1}, \"classHierarchyPage1\", \"hierarchy#1\");\n                }\n\n                // redraw slider on zoom out\n                sendSliderData();\n            });\n\n            var text = g.selectAll(\"text\")\n                .data(nodes)\n                .enter().append(\"text\")\n                .attr(\"class\", function (d) {\n                    return d.children && d.children.length ? \"label\" : \"label child-label\";\n                })\n                .each(function (d) {\n                    d.textSel = d3.select(this);\n                });\n\n            function trimPrefixes(d) {\n                var idx = d.name.indexOf(\":\");\n                var absUriIdx = d.name.indexOf(\"http://\");\n                if (absUriIdx > -1) {\n                    // if we have no prefix available ignore\n                    d.noPrefixName = d.name;\n                } else if (idx > -1) {\n                    d.noPrefixName = d.name.substring(idx + 1);\n                }\n            }\n\n            if (config.noPrefixes) {\n                if (oldRoot !== root) {\n                    text.each(trimPrefixes);\n                    oldRoot = root;\n                }\n\n                text\n                    .style(\"font-size\", function (d) {\n                        return D3.Text.calcFontSize(d.noPrefixName, d.r);\n                    })\n                    .text(function (d) {\n                        return D3.Text.getTextWithElipsisIfNeeded(d.noPrefixName, d.r / 3);\n                    });\n            } else {\n                text\n                    .style(\"font-size\", function (d) {\n                        return D3.Text.calcFontSize(d.name, d.r);\n                    })\n                    .text(function (d) {\n                        return D3.Text.getTextWithElipsisIfNeeded(d.name, d.r / 3);\n                    })\n            }\n\n            // TODO: make this use the full version (same as zoom)\n            text.style(\"display\", function (d) {\n                if (d.parent === root) {\n                    d.textHidden = this.textContent.indexOf(\"...\") + 3 === this.textContent.length;\n                    return null;\n                } else {\n                    d.textHidden = true;\n                    return \"none\";\n                }\n            });\n\n            if (config.doFade && !config.keepPrevState) {\n                text.each(function (d) {\n                    D3.Transition.fadeIn(d3.select(this), 550);\n                });\n            }\n\n            autoZoomToPreviousState = function () {\n                function focusOnCurrentClass(focusHistoryId) {\n                    if (focusHistoryId) {\n                        circle.each(function (d) {\n                            if (focusHistoryId == d.id) {\n                                doFocus(d);\n                            }\n                        });\n                    }\n                }\n\n                var focusHistoryId = $location.hash();\n\n                $window.onpopstate = function (event) {\n                    if (event.state) {\n                        var focusHistoryId = event.state.id;\n                        focusOnCurrentClass(focusHistoryId);\n                    }\n                };\n\n                focusOnCurrentClass(focusHistoryId);\n            };\n\n            var node = g.selectAll(\"circle, text\");\n\n            function zoomTo(v, switchPrefixes) {\n                var k = diameter / v[2];\n                view = v;\n\n                node.attr(\"transform\", function (d) {\n                    return \"translate(\" + (d.x - v[0]) * k + \",\" + (d.y - v[1]) * k + \")\";\n                });\n\n                circle.attr(\"r\", function (d) {\n                    return d.r * k;\n                });\n\n                function switchPrefixesInPlace(d) {\n                    // if uris match with the topLevelParentUri of the focused element\n                    // or your focus is a top level parent hide its label and if it is not\n                    // a child element show all of its child labels. If it is a child element\n                    // only show its label.\n                    if (d.fullName === focus.topLevelParentUri || focus.topLevelParentUri === ROOT_OBJ_NAME) {\n                        d.textSel.style(\"display\", \"none\");\n                        if (focus.children && focus.children.length) {\n                            _.each(focus.children, function (c) {\n                                c.textSel.style(\"display\", \"inline\");\n                            });\n                        } else {\n                            focus.textSel.style(\"display\", \"inline\");\n                        }\n\n                        // in order to show prefixes of siblings check if the focused\n                        // element has a parent and show all of its children except\n                        // for the name of the focused element because you need to see\n                        // its children\n                        if (focus.parent) {\n                            _.each(focus.parent.children, function (c) {\n                                if (c.name !== focus.name) {\n                                    c.textSel.style(\"display\", \"inline\");\n                                }\n                            });\n                        }\n                    }\n                }\n\n                if (switchPrefixes) {\n                    text.each(switchPrefixesInPlace);\n                }\n\n                text\n                    .style(\"font-size\", function (d) {\n                        if (config.noPrefixes) {\n                            return D3.Text.calcFontSize(d.noPrefixName, d.r * k);\n                        }\n                        return D3.Text.calcFontSize(d.name, d.r * k);\n                    })\n                    .text(function (d) {\n                        if (config.noPrefixes) {\n                            return D3.Text.getTextWithElipsisIfNeeded(d.noPrefixName, d.r * k / 3);\n                        }\n                        return D3.Text.getTextWithElipsisIfNeeded(d.name, d.r * k / 3);\n                    });\n            }\n\n\n            function adjustRadius(r) {\n                var newr = r * 2 + margin;\n                if (r * 2 / newr < 0.3) {\n                    // for very small circles we need to adjust\n                    newr = r * 2 + 2;\n                }\n                return newr;\n            }\n\n            zoomTo([focus.x, focus.y, adjustRadius(focus.r)], switchPrefixes);\n\n            function textUpdateStart(d) {\n                if (d.isInFocusTransitive || !(d.parent && d.parent.isInFocusTransitive)) {\n                    // hide labels of classes that are in focus (including children) OR whose parents aren't in focus\n                    d.textHidden = true;\n                    this.style.display = \"none\";\n                }\n            }\n\n            function textUpdateEnd(d) {\n                if (d.isInFocusTransitive || !(d.parent && d.parent.isInFocusTransitive)) {\n                    // hide labels of classes that are in focus (including children) OR whose parents aren't in focus\n                    // this.style.display = \"none\";\n                } else {\n                    // show all other labels\n                    d.textHidden = this.textContent.indexOf(\"...\") + 3 === this.textContent.length;\n                    this.style.display = \"\";\n                }\n            }\n\n            function zoom(d, shouldClosePanel) {\n                // use empty timeout to force the following code to be executed on the next $digest cycle\n                // in order to avoid '$digest in progress' error\n                $timeout(function () {\n                    scope.showExternalElements = (d.name === ROOT_OBJ_NAME);\n                });\n\n                if (d.id) {\n                    $window.history.replaceState({id: d.id}, \"classHierarchyPage\" + d.id, \"hierarchy#\" + d.id);\n                }\n\n                if (focus === d) {\n                    return;\n                }\n\n                if (shouldClosePanel) {\n                    closeClassInfoPanel();\n                    d3.selectAll(\".selected\").classed(\"selected\", false);\n                }\n\n                if (focus.parent) {\n                    var p = focus;\n                    while (p) {\n                        p.isInFocusTransitive = false;\n                        p = p.parent;\n                    }\n                }\n\n                var p = d;\n                while (p) {\n                    p.isInFocusTransitive = p.children;\n                    p = p.parent;\n                }\n\n                focus = d;\n\n                var isVerySmallCircle = focus.r * 2 / (focus.r * 2 + margin) < 0.3;\n\n                if (isVerySmallCircle || scope.currentSliderValue > scope.currentBrowserLimit) {\n                    // no fancy animation for slower browsers if above the limit or if zooming to a very small circle\n                    zoomTo([focus.x, focus.y, adjustRadius(focus.r)]);\n\n                    text.each(function (d) {\n                        textUpdateStart.call(this, d);\n                        textUpdateEnd.call(this, d);\n                    });\n                } else {\n                    // the fancy version for faster browsers\n                    var transition = d3.transition()\n                        .duration(ZOOM_DURATION)\n                        .tween(\"zoom\", function (d) {\n                            var i = d3.interpolateZoom(view, [focus.x, focus.y, adjustRadius(focus.r)]);\n                            return function (t) {\n                                zoomTo(i(t));\n                            };\n                        });\n\n                    transition.selectAll(\"text\")\n                    // Experimental: hide texts to be hidden on \"start\", show texts to be shown on \"end\"\n                        .each(\"start\", textUpdateStart)\n                        .each(\"end\", textUpdateEnd);\n                }\n            }\n\n            rootFocusEvent = scope.$on('rootFocus', function () {\n                $window.history.pushState({id: 1}, \"classHierarchyPage1\", \"hierarchy#1\");\n                doFocus(root);\n            });\n\n            classSearchEvent = scope.$on('classSearch', function (selectedClass) {\n                doFocus(selectedClass);\n            });\n        }\n\n        function sendSliderData() {\n            var currentClassCount = scope.classHierarchyData.classCount;\n            let currentSliderValue = LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE);\n\n            if (!currentSliderValue || currentSliderValue > currentClassCount) {\n                currentSliderValue = currentClassCount;\n                LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE, currentSliderValue);\n            }\n\n            $rootScope.$broadcast(\"classCount\", currentClassCount, currentSliderValue);\n        }\n\n        window.addEventListener('resize', sendSliderData);\n\n        window.addEventListener('beforeunload', removeResizeListener);\n\n        function removeResizeListener() {\n            window.removeEventListener('resize', sendSliderData);\n            window.removeEventListener('beforeunload', removeResizeListener);\n        }\n\n        var prefixesWatch,\n            currentClassCountWatch,\n            searchedClassBroadcast,\n            onEnterClassSearchBroadcast;\n\n        scope.$watch('classHierarchyData', function () {\n            // when data changes unregister watchers by calling them\n            if (prefixesWatch) prefixesWatch();\n            if (currentClassCountWatch) currentClassCountWatch();\n            if (searchedClassBroadcast) searchedClassBroadcast();\n            if (onEnterClassSearchBroadcast) onEnterClassSearchBroadcast();\n\n            // get initial state of prefixes (hidden or not) when changing repositories\n            // in order to avoid triggering an unwanted prefixes watch\n            var initialPrefixesState = getPrefixesState();\n\n            if (scope.classHierarchyData.classCount) {\n                sendSliderData();\n\n                var root = angular.copy(scope.classHierarchyData);\n\n                function sortRoot(root) {\n                    // add all classes to a flat array, add parent information\n                    // and sort according to instancesCount DESC, depth ASC\n                    return pack\n                        .nodes(root)\n                        .sort(function (a, b) {\n                            if (a.sortingRank > b.sortingRank) {\n                                return -1;\n                            } else if (a.sortingRank < b.sortingRank) {\n                                return 1;\n                            } else if (a.depth > b.depth) {\n                                return 1;\n                            } else if (a.depth < b.depth) {\n                                return -1;\n                            } else {\n                                return 0;\n                            }\n                        });\n                }\n\n                var sorted = sortRoot(root);\n\n                // we start with an empty new root\n                var newRoot;\n                var noPrefixesGlobal;\n\n\n                function restoreDiagramState(currentRoot, switchPrefixes) {\n                    var prefixesConfig = {\n                        keepPrevState: true,\n                        noPrefixes: getPrefixesState()\n                    };\n\n                    // get noPrefixes flag from drawDiagram configuration params\n                    noPrefixesGlobal = prefixesConfig.noPrefixes;\n\n                    if (newRoot) {\n                        drawDiagram(newRoot, prefixesConfig, focus, true);\n                    } else {\n                        drawDiagram(currentRoot, prefixesConfig, focus, true);\n                    }\n\n                    $timeout(function () {\n                        LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_SWITCH_PREFIXES, switchPrefixes);\n                        autoZoomToPreviousState();\n                    }, 70);\n                }\n\n                function redrawFilteredDiagram(currentSliderValue, sortedRoot, useSlider) {\n                    if (!currentSliderValue) {\n                        return;\n                    }\n\n                    LocalStorageAdapter.set(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE, currentSliderValue);\n\n                    newRoot = {\n                        name: ROOT_OBJ_NAME,\n                        children: []\n                    };\n\n                    // walk through the given count of (sorted) classes\n                    // - record the id of each class we've seen\n                    // - add the root level classes to the new root\n                    var addedIds = new Set();\n                    for (var k = 1; k <= currentSliderValue; k++) {\n                        addedIds.add(sortedRoot[k].id);\n                        if (sortedRoot[k].parent === sortedRoot[0]) { // i.e. the parent is the \"class hierarchy\"\n                            newRoot.children.push(sortedRoot[k]);\n                        }\n                    }\n\n                    // walk through all the classes in the new root and only keep those that have an \"added id\"\n                    // we create separate copies of the arrays in order not to contaminate the original data\n                    // we also copy each class's object ($.extend ...) for the same reason\n                    function fixChildren(node) {\n                        if (!node.children) {\n                            return;\n                        }\n                        var newChildren = [];\n                        for (var i = 0; i < node.children.length; i++) {\n                            if (addedIds.has(node.children[i].id)) {\n                                newChildren.push($.extend({}, node.children[i]));\n                            }\n                        }\n                        node.children = newChildren;\n                        for (var i = 0; i < node.children.length; i++) {\n                            fixChildren(node.children[i]);\n                        }\n                    }\n\n                    fixChildren(newRoot);\n\n                    if (useSlider) {\n                        // redraw diagram when slider value changes and persist current state\n                        // in local storage\n                        noPrefixesGlobal = angular.isUndefined(noPrefixesGlobal) ? getPrefixesState() : noPrefixesGlobal;\n                        var redrawConfig = {\n                            noPrefixes: noPrefixesGlobal\n                        };\n                        drawDiagram(newRoot, redrawConfig);\n                    } else {\n                        // if the user returns to the diagram with back browser button\n                        // read the saved state (show/hide prefixes, current slider value)\n                        // from local storage and render the diagram according to the saved metrics\n                        restoreDiagramState(root);\n                    }\n                }\n\n                var currentSliderValue = LocalStorageAdapter.get(LSKeys.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE);\n                if (currentSliderValue) {\n                    redrawFilteredDiagram(currentSliderValue, sorted);\n                } else {\n                    var basicConfig = {\n                        doFade: true,\n                        keepPrevState: true,\n                        noPrefixes: getPrefixesState()\n                    };\n                    drawDiagram(root, basicConfig);\n                    autoZoomToPreviousState();\n                }\n\n                prefixesWatch = scope.$watch('hidePrefixes', function (hidePrefixes) {\n                    if (angular.isUndefined(hidePrefixes) || initialPrefixesState) {\n                        initialPrefixesState = undefined;\n                        return;\n                    }\n                    // if digest overflows a possible fix might be wrapping this in $timeout\n                    $timeout(function () {\n                        savePrefixesState(hidePrefixes);\n                        restoreDiagramState(root, true);\n                    }, 50);\n                }, true);\n\n                currentClassCountWatch = scope.$watch('currentSliderValue', function (currentSliderValue) {\n                    redrawFilteredDiagram(currentSliderValue, sorted, true);\n                }, true);\n\n                // we handle this event for the cases where we already have searched for a given class and\n                // hit enter again on the already selected class in order again react and zoom to it again\n                // if we are not at the moment\n                var currentSearchedClass;\n                onEnterClassSearchBroadcast = scope.$on('onEnterKeypressSearchAction', function (event) {\n                    if (currentSearchedClass) {\n                        doFocus(currentSearchedClass);\n                    }\n                });\n\n                searchedClassBroadcast = scope.$on('searchedClass', function (event, searchedClass) {\n                    currentSearchedClass = flattenedClassData[searchedClass.name];\n                    if (currentSearchedClass) {\n                        doFocus(currentSearchedClass);\n                    }\n                });\n            }\n        }, true);\n    }\n}\n"],"sourceRoot":""}